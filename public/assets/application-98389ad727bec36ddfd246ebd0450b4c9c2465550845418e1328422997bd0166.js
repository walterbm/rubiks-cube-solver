/*!
 * jQuery JavaScript Library v1.11.2
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-17T15:27Z
 */
!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=t.length,i=re.type(t);return"function"===i||re.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t}function n(t,e,i){if(re.isFunction(e))return re.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return re.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(fe.test(e))return re.filter(e,t,i);e=re.filter(e,t)}return re.grep(t,function(t){return re.inArray(t,e)>=0!==i})}function r(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function o(t){var e=Te[t]={};return re.each(t.match(ye)||[],function(t,i){e[i]=!0}),e}function a(){pe.addEventListener?(pe.removeEventListener("DOMContentLoaded",s,!1),t.removeEventListener("load",s,!1)):(pe.detachEvent("onreadystatechange",s),t.detachEvent("onload",s))}function s(){(pe.addEventListener||"load"===event.type||"complete"===pe.readyState)&&(a(),re.ready())}function l(t,e,i){if(void 0===i&&1===t.nodeType){var n="data-"+e.replace(He,"-$1").toLowerCase();if(i=t.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:we.test(i)?re.parseJSON(i):i}catch(r){}re.data(t,e,i)}else i=void 0}return i}function h(t){var e;for(e in t)if(("data"!==e||!re.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function c(t,e,i,n){if(re.acceptData(t)){var r,o,a=re.expando,s=t.nodeType,l=s?re.cache:t,h=s?t[a]:t[a]&&a;if(h&&l[h]&&(n||l[h].data)||void 0!==i||"string"!=typeof e)return h||(h=s?t[a]=q.pop()||re.guid++:a),l[h]||(l[h]=s?{}:{toJSON:re.noop}),("object"==typeof e||"function"==typeof e)&&(n?l[h]=re.extend(l[h],e):l[h].data=re.extend(l[h].data,e)),o=l[h],n||(o.data||(o.data={}),o=o.data),void 0!==i&&(o[re.camelCase(e)]=i),"string"==typeof e?(r=o[e],null==r&&(r=o[re.camelCase(e)])):r=o,r}}function u(t,e,i){if(re.acceptData(t)){var n,r,o=t.nodeType,a=o?re.cache:t,s=o?t[re.expando]:re.expando;if(a[s]){if(e&&(n=i?a[s]:a[s].data)){re.isArray(e)?e=e.concat(re.map(e,re.camelCase)):e in n?e=[e]:(e=re.camelCase(e),e=e in n?[e]:e.split(" ")),r=e.length;for(;r--;)delete n[e[r]];if(i?!h(n):!re.isEmptyObject(n))return}(i||(delete a[s].data,h(a[s])))&&(o?re.cleanData([t],!0):ie.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}function f(){return!0}function d(){return!1}function p(){try{return pe.activeElement}catch(t){}}function m(t){var e=De.split("|"),i=t.createDocumentFragment();if(i.createElement)for(;e.length;)i.createElement(e.pop());return i}function E(t,e){var i,n,r=0,o=typeof t.getElementsByTagName!==xe?t.getElementsByTagName(e||"*"):typeof t.querySelectorAll!==xe?t.querySelectorAll(e||"*"):void 0;if(!o)for(o=[],i=t.childNodes||t;null!=(n=i[r]);r++)!e||re.nodeName(n,e)?o.push(n):re.merge(o,E(n,e));return void 0===e||e&&re.nodeName(t,e)?re.merge([t],o):o}function g(t){Ae.test(t.type)&&(t.defaultChecked=t.checked)}function v(t,e){return re.nodeName(t,"table")&&re.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function y(t){return t.type=(null!==re.find.attr(t,"type"))+"/"+t.type,t}function T(t){var e=$e.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function b(t,e){for(var i,n=0;null!=(i=t[n]);n++)re._data(i,"globalEval",!e||re._data(e[n],"globalEval"))}function R(t,e){if(1===e.nodeType&&re.hasData(t)){var i,n,r,o=re._data(t),a=re._data(e,o),s=o.events;if(s){delete a.handle,a.events={};for(i in s)for(n=0,r=s[i].length;r>n;n++)re.event.add(e,i,s[i][n])}a.data&&(a.data=re.extend({},a.data))}}function x(t,e){var i,n,r;if(1===e.nodeType){if(i=e.nodeName.toLowerCase(),!ie.noCloneEvent&&e[re.expando]){r=re._data(e);for(n in r.events)re.removeEvent(e,n,r.handle);e.removeAttribute(re.expando)}"script"===i&&e.text!==t.text?(y(e).text=t.text,T(e)):"object"===i?(e.parentNode&&(e.outerHTML=t.outerHTML),ie.html5Clone&&t.innerHTML&&!re.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===i&&Ae.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===i?e.defaultSelected=e.selected=t.defaultSelected:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue)}}function w(e,i){var n,r=re(i.createElement(e)).appendTo(i.body),o=t.getDefaultComputedStyle&&(n=t.getDefaultComputedStyle(r[0]))?n.display:re.css(r[0],"display");return r.detach(),o}function H(t){var e=pe,i=Je[t];return i||(i=w(t,e),"none"!==i&&i||(Ke=(Ke||re("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=(Ke[0].contentWindow||Ke[0].contentDocument).document,e.write(),e.close(),i=w(t,e),Ke.detach()),Je[t]=i),i}function _(t,e){return{get:function(){var i=t();if(null!=i)return i?void delete this.get:(this.get=e).apply(this,arguments)}}}function S(t,e){if(e in t)return e;for(var i=e.charAt(0).toUpperCase()+e.slice(1),n=e,r=fi.length;r--;)if(e=fi[r]+i,e in t)return e;return n}function M(t,e){for(var i,n,r,o=[],a=0,s=t.length;s>a;a++)n=t[a],n.style&&(o[a]=re._data(n,"olddisplay"),i=n.style.display,e?(o[a]||"none"!==i||(n.style.display=""),""===n.style.display&&Me(n)&&(o[a]=re._data(n,"olddisplay",H(n.nodeName)))):(r=Me(n),(i&&"none"!==i||!r)&&re._data(n,"olddisplay",r?i:re.css(n,"display"))));for(a=0;s>a;a++)n=t[a],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?o[a]||"":"none"));return t}function C(t,e,i){var n=li.exec(e);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):e}function A(t,e,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===e?1:0,a=0;4>o;o+=2)"margin"===i&&(a+=re.css(t,i+Se[o],!0,r)),n?("content"===i&&(a-=re.css(t,"padding"+Se[o],!0,r)),"margin"!==i&&(a-=re.css(t,"border"+Se[o]+"Width",!0,r))):(a+=re.css(t,"padding"+Se[o],!0,r),"padding"!==i&&(a+=re.css(t,"border"+Se[o]+"Width",!0,r)));return a}function k(t,e,i){var n=!0,r="width"===e?t.offsetWidth:t.offsetHeight,o=ti(t),a=ie.boxSizing&&"border-box"===re.css(t,"boxSizing",!1,o);if(0>=r||null==r){if(r=ei(t,e,o),(0>r||null==r)&&(r=t.style[e]),ni.test(r))return r;n=a&&(ie.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+A(t,e,i||(a?"border":"content"),n,o)+"px"}function L(t,e,i,n,r){return new L.prototype.init(t,e,i,n,r)}function N(){return setTimeout(function(){di=void 0}),di=re.now()}function P(t,e){var i,n={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)i=Se[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function F(t,e,i){for(var n,r=(yi[e]||[]).concat(yi["*"]),o=0,a=r.length;a>o;o++)if(n=r[o].call(i,e,t))return n}function D(t,e,i){var n,r,o,a,s,l,h,c,u=this,f={},d=t.style,p=t.nodeType&&Me(t),m=re._data(t,"fxshow");i.queue||(s=re._queueHooks(t,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,re.queue(t,"fx").length||s.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],h=re.css(t,"display"),c="none"===h?re._data(t,"olddisplay")||H(t.nodeName):h,"inline"===c&&"none"===re.css(t,"float")&&(ie.inlineBlockNeedsLayout&&"inline"!==H(t.nodeName)?d.zoom=1:d.display="inline-block")),i.overflow&&(d.overflow="hidden",ie.shrinkWrapBlocks()||u.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in e)if(r=e[n],mi.exec(r)){if(delete e[n],o=o||"toggle"===r,r===(p?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;p=!0}f[n]=m&&m[n]||re.style(t,n)}else h=void 0;if(re.isEmptyObject(f))"inline"===("none"===h?H(t.nodeName):h)&&(d.display=h);else{m?"hidden"in m&&(p=m.hidden):m=re._data(t,"fxshow",{}),o&&(m.hidden=!p),p?re(t).show():u.done(function(){re(t).hide()}),u.done(function(){var e;re._removeData(t,"fxshow");for(e in f)re.style(t,e,f[e])});for(n in f)a=F(p?m[n]:0,n,u),n in m||(m[n]=a.start,p&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}}function z(t,e){var i,n,r,o,a;for(i in t)if(n=re.camelCase(i),r=e[n],o=t[i],re.isArray(o)&&(r=o[1],o=t[i]=o[0]),i!==n&&(t[n]=o,delete t[i]),a=re.cssHooks[n],a&&"expand"in a){o=a.expand(o),delete t[n];for(i in o)i in t||(t[i]=o[i],e[i]=r)}else e[n]=r}function V(t,e,i){var n,r,o=0,a=vi.length,s=re.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var e=di||N(),i=Math.max(0,h.startTime+h.duration-e),n=i/h.duration||0,o=1-n,a=0,l=h.tweens.length;l>a;a++)h.tweens[a].run(o);return s.notifyWith(t,[h,o,i]),1>o&&l?i:(s.resolveWith(t,[h]),!1)},h=s.promise({elem:t,props:re.extend({},e),opts:re.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:di||N(),duration:i.duration,tweens:[],createTween:function(e,i){var n=re.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)h.tweens[i].run(1);return e?s.resolveWith(t,[h,e]):s.rejectWith(t,[h,e]),this}}),c=h.props;for(z(c,h.opts.specialEasing);a>o;o++)if(n=vi[o].call(h,t,c,h.opts))return n;return re.map(c,F,h),re.isFunction(h.opts.start)&&h.opts.start.call(t,h),re.fx.timer(re.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function I(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,o=e.toLowerCase().match(ye)||[];if(re.isFunction(i))for(;n=o[r++];)"+"===n.charAt(0)?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function B(t,e,i,n){function r(s){var l;return o[s]=!0,re.each(t[s]||[],function(t,s){var h=s(e,i,n);return"string"!=typeof h||a||o[h]?a?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)}),l}var o={},a=t===ji;return r(e.dataTypes[0])||!o["*"]&&r("*")}function U(t,e){var i,n,r=re.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((r[n]?t:i||(i={}))[n]=e[n]);return i&&re.extend(!0,t,i),t}function O(t,e,i){for(var n,r,o,a,s=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(a in s)if(s[a]&&s[a].test(r)){l.unshift(a);break}if(l[0]in i)o=l[0];else{for(a in i){if(!l[0]||t.converters[a+" "+l[0]]){o=a;break}n||(n=a)}o=o||n}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}function j(t,e,i,n){var r,o,a,s,l,h={},c=t.dataTypes.slice();if(c[1])for(a in t.converters)h[a.toLowerCase()]=t.converters[a];for(o=c.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=h[l+" "+o]||h["* "+o],!a)for(r in h)if(s=r.split(" "),s[1]===o&&(a=h[l+" "+s[0]]||h["* "+s[0]])){a===!0?a=h[r]:h[r]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&t["throws"])e=a(e);else try{e=a(e)}catch(u){return{state:"parsererror",error:a?u:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}function W(t,e,i,n){var r;if(re.isArray(e))re.each(e,function(e,r){i||$i.test(t)?n(t,r):W(t+"["+("object"==typeof r?e:"")+"]",r,i,n)});else if(i||"object"!==re.type(e))n(t,e);else for(r in e)W(t+"["+r+"]",e[r],i,n)}function G(){try{return new t.XMLHttpRequest}catch(e){}}function X(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function $(t){return re.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var q=[],Y=q.slice,Q=q.concat,Z=q.push,K=q.indexOf,J={},te=J.toString,ee=J.hasOwnProperty,ie={},ne="1.11.2",re=function(t,e){return new re.fn.init(t,e)},oe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ae=/^-ms-/,se=/-([\da-z])/gi,le=function(t,e){return e.toUpperCase()};re.fn=re.prototype={jquery:ne,constructor:re,selector:"",length:0,toArray:function(){return Y.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:Y.call(this)},pushStack:function(t){var e=re.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return re.each(this,t,e)},map:function(t){return this.pushStack(re.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(Y.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:q.sort,splice:q.splice},re.extend=re.fn.extend=function(){var t,e,i,n,r,o,a=arguments[0]||{},s=1,l=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[s]||{},s++),"object"==typeof a||re.isFunction(a)||(a={}),s===l&&(a=this,s--);l>s;s++)if(null!=(r=arguments[s]))for(n in r)t=a[n],i=r[n],a!==i&&(h&&i&&(re.isPlainObject(i)||(e=re.isArray(i)))?(e?(e=!1,o=t&&re.isArray(t)?t:[]):o=t&&re.isPlainObject(t)?t:{},a[n]=re.extend(h,o,i)):void 0!==i&&(a[n]=i));return a},re.extend({expando:"jQuery"+(ne+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===re.type(t)},isArray:Array.isArray||function(t){return"array"===re.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!re.isArray(t)&&t-parseFloat(t)+1>=0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==re.type(t)||t.nodeType||re.isWindow(t))return!1;try{if(t.constructor&&!ee.call(t,"constructor")&&!ee.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(ie.ownLast)for(e in t)return ee.call(t,e);for(e in t);return void 0===e||ee.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?J[te.call(t)]||"object":typeof t},globalEval:function(e){e&&re.trim(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(ae,"ms-").replace(se,le)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,n){var r,o=0,a=t.length,s=i(t);if(n){if(s)for(;a>o&&(r=e.apply(t[o],n),r!==!1);o++);else for(o in t)if(r=e.apply(t[o],n),r===!1)break}else if(s)for(;a>o&&(r=e.call(t[o],o,t[o]),r!==!1);o++);else for(o in t)if(r=e.call(t[o],o,t[o]),r===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(oe,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?re.merge(n,"string"==typeof t?[t]:t):Z.call(n,t)),n},inArray:function(t,e,i){var n;if(e){if(K)return K.call(e,t,i);for(n=e.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in e&&e[i]===t)return i}return-1},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;i>n;)t[r++]=e[n++];if(i!==i)for(;void 0!==e[n];)t[r++]=e[n++];return t.length=r,t},grep:function(t,e,i){for(var n,r=[],o=0,a=t.length,s=!i;a>o;o++)n=!e(t[o],o),n!==s&&r.push(t[o]);return r},map:function(t,e,n){var r,o=0,a=t.length,s=i(t),l=[];if(s)for(;a>o;o++)r=e(t[o],o,n),null!=r&&l.push(r);else for(o in t)r=e(t[o],o,n),null!=r&&l.push(r);return Q.apply([],l)},guid:1,proxy:function(t,e){var i,n,r;return"string"==typeof e&&(r=t[e],e=t,t=r),re.isFunction(t)?(i=Y.call(arguments,2),n=function(){return t.apply(e||this,i.concat(Y.call(arguments)))},n.guid=t.guid=t.guid||re.guid++,n):void 0},now:function(){return+new Date},support:ie}),re.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){J["[object "+e+"]"]=e.toLowerCase()});var he=/*!
 * Sizzle CSS Selector Engine v2.2.0-pre
 * http://sizzlejs.com/
 *
 * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-16
 */
function(t){function e(t,e,i,n){var r,o,a,s,l,h,u,d,p,m;if((e?e.ownerDocument||e:B)!==L&&k(e),e=e||L,i=i||[],s=e.nodeType,"string"!=typeof t||!t||1!==s&&9!==s&&11!==s)return i;if(!n&&P){if(11!==s&&(r=ve.exec(t)))if(a=r[1]){if(9===s){if(o=e.getElementById(a),!o||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(a))&&V(e,o)&&o.id===a)return i.push(o),i}else{if(r[2])return K.apply(i,e.getElementsByTagName(t)),i;if((a=r[3])&&b.getElementsByClassName)return K.apply(i,e.getElementsByClassName(a)),i}if(b.qsa&&(!F||!F.test(t))){if(d=u=I,p=e,m=1!==s&&t,1===s&&"object"!==e.nodeName.toLowerCase()){for(h=H(t),(u=e.getAttribute("id"))?d=u.replace(Te,"\\$&"):e.setAttribute("id",d),d="[id='"+d+"'] ",l=h.length;l--;)h[l]=d+f(h[l]);p=ye.test(t)&&c(e.parentNode)||e,m=h.join(",")}if(m)try{return K.apply(i,p.querySelectorAll(m)),i}catch(E){}finally{u||e.removeAttribute("id")}}}return S(t.replace(le,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>R.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[I]=!0,t}function r(t){var e=L.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),n=t.length;n--;)R.attrHandle[i[n]]=e}function a(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||$)-(~t.sourceIndex||$);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function s(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return n(function(e){return e=+e,n(function(i,n){for(var r,o=t([],i.length,e),a=o.length;a--;)i[r=o[a]]&&(i[r]=!(n[r]=i[r]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function u(){}function f(t){for(var e=0,i=t.length,n="";i>e;e++)n+=t[e].value;return n}function d(t,e,i){var n=e.dir,r=i&&"parentNode"===n,o=O++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||r)return t(e,i,o)}:function(e,i,a){var s,l,h=[U,o];if(a){for(;e=e[n];)if((1===e.nodeType||r)&&t(e,i,a))return!0}else for(;e=e[n];)if(1===e.nodeType||r){if(l=e[I]||(e[I]={}),(s=l[n])&&s[0]===U&&s[1]===o)return h[2]=s[2];if(l[n]=h,h[2]=t(e,i,a))return!0}}}function p(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function m(t,i,n){for(var r=0,o=i.length;o>r;r++)e(t,i[r],n);return n}function E(t,e,i,n,r){for(var o,a=[],s=0,l=t.length,h=null!=e;l>s;s++)(o=t[s])&&(!i||i(o,n,r))&&(a.push(o),h&&e.push(s));return a}function g(t,e,i,r,o,a){return r&&!r[I]&&(r=g(r)),o&&!o[I]&&(o=g(o,a)),n(function(n,a,s,l){var h,c,u,f=[],d=[],p=a.length,g=n||m(e||"*",s.nodeType?[s]:s,[]),v=!t||!n&&e?g:E(g,f,t,s,l),y=i?o||(n?t:p||r)?[]:a:v;if(i&&i(v,y,s,l),r)for(h=E(y,d),r(h,[],s,l),c=h.length;c--;)(u=h[c])&&(y[d[c]]=!(v[d[c]]=u));if(n){if(o||t){if(o){for(h=[],c=y.length;c--;)(u=y[c])&&h.push(v[c]=u);o(null,y=[],h,l)}for(c=y.length;c--;)(u=y[c])&&(h=o?te(n,u):f[c])>-1&&(n[h]=!(a[h]=u))}}else y=E(y===a?y.splice(p,y.length):y),o?o(null,a,y,l):K.apply(a,y)})}function v(t){for(var e,i,n,r=t.length,o=R.relative[t[0].type],a=o||R.relative[" "],s=o?1:0,l=d(function(t){return t===e},a,!0),h=d(function(t){return te(e,t)>-1},a,!0),c=[function(t,i,n){var r=!o&&(n||i!==M)||((e=i).nodeType?l(t,i,n):h(t,i,n));return e=null,r}];r>s;s++)if(i=R.relative[t[s].type])c=[d(p(c),i)];else{if(i=R.filter[t[s].type].apply(null,t[s].matches),i[I]){for(n=++s;r>n&&!R.relative[t[n].type];n++);return g(s>1&&p(c),s>1&&f(t.slice(0,s-1).concat({value:" "===t[s-2].type?"*":""})).replace(le,"$1"),i,n>s&&v(t.slice(s,n)),r>n&&v(t=t.slice(n)),r>n&&f(t))}c.push(i)}return p(c)}function y(t,i){var r=i.length>0,o=t.length>0,a=function(n,a,s,l,h){var c,u,f,d=0,p="0",m=n&&[],g=[],v=M,y=n||o&&R.find.TAG("*",h),T=U+=null==v?1:Math.random()||.1,b=y.length;for(h&&(M=a!==L&&a);p!==b&&null!=(c=y[p]);p++){if(o&&c){for(u=0;f=t[u++];)if(f(c,a,s)){l.push(c);break}h&&(U=T)}r&&((c=!f&&c)&&d--,n&&m.push(c))}if(d+=p,r&&p!==d){for(u=0;f=i[u++];)f(m,g,a,s);if(n){if(d>0)for(;p--;)m[p]||g[p]||(g[p]=Q.call(l));g=E(g)}K.apply(l,g),h&&!n&&g.length>0&&d+i.length>1&&e.uniqueSort(l)}return h&&(U=T,M=v),m};return r?n(a):a}var T,b,R,x,w,H,_,S,M,C,A,k,L,N,P,F,D,z,V,I="sizzle"+1*new Date,B=t.document,U=0,O=0,j=i(),W=i(),G=i(),X=function(t,e){return t===e&&(A=!0),0},$=1<<31,q={}.hasOwnProperty,Y=[],Q=Y.pop,Z=Y.push,K=Y.push,J=Y.slice,te=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},ee="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=ne.replace("w","w#"),oe="\\["+ie+"*("+ne+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ie+"*\\]",ae=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",se=new RegExp(ie+"+","g"),le=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),he=new RegExp("^"+ie+"*,"+ie+"*"),ce=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),ue=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),fe=new RegExp(ae),de=new RegExp("^"+re+"$"),pe={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+ae),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+ee+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,Ee=/^h\d$/i,ge=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,Te=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Re=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},xe=function(){k()};try{K.apply(Y=J.call(B.childNodes),B.childNodes),Y[B.childNodes.length].nodeType}catch(we){K={apply:Y.length?function(t,e){Z.apply(t,J.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}b=e.support={},w=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},k=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:B;return n!==L&&9===n.nodeType&&n.documentElement?(L=n,N=n.documentElement,i=n.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",xe,!1):i.attachEvent&&i.attachEvent("onunload",xe)),P=!w(n),b.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),b.getElementsByTagName=r(function(t){return t.appendChild(n.createComment("")),!t.getElementsByTagName("*").length}),b.getElementsByClassName=ge.test(n.getElementsByClassName),b.getById=r(function(t){return N.appendChild(t).id=I,!n.getElementsByName||!n.getElementsByName(I).length}),b.getById?(R.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&P){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},R.filter.ID=function(t){var e=t.replace(be,Re);return function(t){return t.getAttribute("id")===e}}):(delete R.find.ID,R.filter.ID=function(t){var e=t.replace(be,Re);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),R.find.TAG=b.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):b.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},R.find.CLASS=b.getElementsByClassName&&function(t,e){return P?e.getElementsByClassName(t):void 0},D=[],F=[],(b.qsa=ge.test(n.querySelectorAll))&&(r(function(t){N.appendChild(t).innerHTML="<a id='"+I+"'></a><select id='"+I+"-\f]' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&F.push("[*^$]="+ie+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||F.push("\\["+ie+"*(?:value|"+ee+")"),t.querySelectorAll("[id~="+I+"-]").length||F.push("~="),t.querySelectorAll(":checked").length||F.push(":checked"),t.querySelectorAll("a#"+I+"+*").length||F.push(".#.+[+~]")}),r(function(t){var e=n.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&F.push("name"+ie+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||F.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),F.push(",.*:")})),(b.matchesSelector=ge.test(z=N.matches||N.webkitMatchesSelector||N.mozMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&r(function(t){b.disconnectedMatch=z.call(t,"div"),z.call(t,"[s!='']:x"),D.push("!=",ae)}),F=F.length&&new RegExp(F.join("|")),D=D.length&&new RegExp(D.join("|")),e=ge.test(N.compareDocumentPosition),V=e||ge.test(N.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},X=e?function(t,e){if(t===e)return A=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!b.sortDetached&&e.compareDocumentPosition(t)===i?t===n||t.ownerDocument===B&&V(B,t)?-1:e===n||e.ownerDocument===B&&V(B,e)?1:C?te(C,t)-te(C,e):0:4&i?-1:1)}:function(t,e){if(t===e)return A=!0,0;var i,r=0,o=t.parentNode,s=e.parentNode,l=[t],h=[e];if(!o||!s)return t===n?-1:e===n?1:o?-1:s?1:C?te(C,t)-te(C,e):0;if(o===s)return a(t,e);for(i=t;i=i.parentNode;)l.unshift(i);for(i=e;i=i.parentNode;)h.unshift(i);for(;l[r]===h[r];)r++;return r?a(l[r],h[r]):l[r]===B?-1:h[r]===B?1:0},n):L},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==L&&k(t),i=i.replace(ue,"='$1']"),!(!b.matchesSelector||!P||D&&D.test(i)||F&&F.test(i)))try{var n=z.call(t,i);if(n||b.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(r){}return e(i,L,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==L&&k(t),V(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==L&&k(t);var i=R.attrHandle[e.toLowerCase()],n=i&&q.call(R.attrHandle,e.toLowerCase())?i(t,e,!P):void 0;return void 0!==n?n:b.attributes||!P?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,r=0;if(A=!b.detectDuplicates,C=!b.sortStable&&t.slice(0),t.sort(X),A){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return C=null,t},x=e.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=x(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=x(e);return i},R=e.selectors={cacheLength:50,createPseudo:n,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(be,Re),t[3]=(t[3]||t[4]||t[5]||"").replace(be,Re),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pe.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&fe.test(i)&&(e=H(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(be,Re).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=j[t+" "];return e||(e=new RegExp("(^|"+ie+")"+t+"("+ie+"|$)"))&&j(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(r){var o=e.attr(r,t);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o.replace(se," ")+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(t,e,i,n,r){var o="nth"!==t.slice(0,3),a="last"!==t.slice(-4),s="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,l){var h,c,u,f,d,p,m=o!==a?"nextSibling":"previousSibling",E=e.parentNode,g=s&&e.nodeName.toLowerCase(),v=!l&&!s;if(E){if(o){for(;m;){for(u=e;u=u[m];)if(s?u.nodeName.toLowerCase()===g:1===u.nodeType)return!1;p=m="only"===t&&!p&&"nextSibling"}return!0}if(p=[a?E.firstChild:E.lastChild],a&&v){for(c=E[I]||(E[I]={}),h=c[t]||[],d=h[0]===U&&h[1],f=h[0]===U&&h[2],u=d&&E.childNodes[d];u=++d&&u&&u[m]||(f=d=0)||p.pop();)if(1===u.nodeType&&++f&&u===e){c[t]=[U,d,f];break}}else if(v&&(h=(e[I]||(e[I]={}))[t])&&h[0]===U)f=h[1];else for(;(u=++d&&u&&u[m]||(f=d=0)||p.pop())&&((s?u.nodeName.toLowerCase()!==g:1!==u.nodeType)||!++f||(v&&((u[I]||(u[I]={}))[t]=[U,f]),u!==e)););return f-=r,f===n||f%n===0&&f/n>=0}}},PSEUDO:function(t,i){var r,o=R.pseudos[t]||R.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[I]?o(i):o.length>1?(r=[t,t,"",i],R.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,r=o(t,i),a=r.length;a--;)n=te(t,r[a]),t[n]=!(e[n]=r[a])}):function(t){return o(t,0,r)}):o}},pseudos:{not:n(function(t){var e=[],i=[],r=_(t.replace(le,"$1"));return r[I]?n(function(t,e,i,n){for(var o,a=r(t,null,n,[]),s=t.length;s--;)(o=a[s])&&(t[s]=!(e[s]=o))}):function(t,n,o){return e[0]=t,r(e,null,o,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(be,Re),function(e){return(e.textContent||e.innerText||x(e)).indexOf(t)>-1}}),lang:n(function(t){return de.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(be,Re).toLowerCase(),function(e){var i;do if(i=P?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===N},focus:function(t){return t===L.activeElement&&(!L.hasFocus||L.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!R.pseudos.empty(t)},header:function(t){return Ee.test(t.nodeName)},input:function(t){return me.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:h(function(){return[0]}),last:h(function(t,e){return[e-1]}),eq:h(function(t,e,i){return[0>i?i+e:i]}),even:h(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:h(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:h(function(t,e,i){for(var n=0>i?i+e:i;--n>=0;)t.push(n);return t}),gt:h(function(t,e,i){for(var n=0>i?i+e:i;++n<e;)t.push(n);return t})}},R.pseudos.nth=R.pseudos.eq;for(T in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})R.pseudos[T]=s(T);for(T in{submit:!0,reset:!0})R.pseudos[T]=l(T);return u.prototype=R.filters=R.pseudos,R.setFilters=new u,H=e.tokenize=function(t,i){var n,r,o,a,s,l,h,c=W[t+" "];if(c)return i?0:c.slice(0);for(s=t,l=[],h=R.preFilter;s;){(!n||(r=he.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),n=!1,(r=ce.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(le," ")}),s=s.slice(n.length));for(a in R.filter)!(r=pe[a].exec(s))||h[a]&&!(r=h[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return i?s.length:s?e.error(t):W(t,l).slice(0)},_=e.compile=function(t,e){var i,n=[],r=[],o=G[t+" "];if(!o){for(e||(e=H(t)),i=e.length;i--;)o=v(e[i]),o[I]?n.push(o):r.push(o);o=G(t,y(r,n)),o.selector=t}return o},S=e.select=function(t,e,i,n){var r,o,a,s,l,h="function"==typeof t&&t,u=!n&&H(t=h.selector||t);if(i=i||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&b.getById&&9===e.nodeType&&P&&R.relative[o[1].type]){if(e=(R.find.ID(a.matches[0].replace(be,Re),e)||[])[0],!e)return i;h&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(r=pe.needsContext.test(t)?0:o.length;r--&&(a=o[r],!R.relative[s=a.type]);)if((l=R.find[s])&&(n=l(a.matches[0].replace(be,Re),ye.test(o[0].type)&&c(e.parentNode)||e))){if(o.splice(r,1),t=n.length&&f(o),!t)return K.apply(i,n),i;break}}return(h||_(t,u))(n,e,!P,i,ye.test(t)&&c(e.parentNode)||e),i},b.sortStable=I.split("").sort(X).join("")===I,b.detectDuplicates=!!A,k(),b.sortDetached=r(function(t){return 1&t.compareDocumentPosition(L.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),b.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||o(ee,function(t,e,i){var n;return i?void 0:t[e]===!0?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);re.find=he,re.expr=he.selectors,re.expr[":"]=re.expr.pseudos,re.unique=he.uniqueSort,re.text=he.getText,re.isXMLDoc=he.isXML,re.contains=he.contains;var ce=re.expr.match.needsContext,ue=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^.[^:#\[\.,]*$/;re.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?re.find.matchesSelector(n,t)?[n]:[]:re.find.matches(t,re.grep(e,function(t){return 1===t.nodeType}))},re.fn.extend({find:function(t){var e,i=[],n=this,r=n.length;if("string"!=typeof t)return this.pushStack(re(t).filter(function(){for(e=0;r>e;e++)if(re.contains(n[e],this))return!0}));for(e=0;r>e;e++)re.find(t,n[e],i);return i=this.pushStack(r>1?re.unique(i):i),i.selector=this.selector?this.selector+" "+t:t,i},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&ce.test(t)?re(t):t||[],!1).length}});var de,pe=t.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Ee=re.fn.init=function(t,e){var i,n;if(!t)return this;if("string"==typeof t){if(i="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:me.exec(t),!i||!i[1]&&e)return!e||e.jquery?(e||de).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof re?e[0]:e,re.merge(this,re.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:pe,!0)),ue.test(i[1])&&re.isPlainObject(e))for(i in e)re.isFunction(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}if(n=pe.getElementById(i[2]),n&&n.parentNode){if(n.id!==i[2])return de.find(t);this.length=1,this[0]=n}return this.context=pe,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):re.isFunction(t)?"undefined"!=typeof de.ready?de.ready(t):t(re):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),re.makeArray(t,this))};Ee.prototype=re.fn,de=re(pe);var ge=/^(?:parents|prev(?:Until|All))/,ve={children:!0,contents:!0,next:!0,prev:!0};re.extend({dir:function(t,e,i){for(var n=[],r=t[e];r&&9!==r.nodeType&&(void 0===i||1!==r.nodeType||!re(r).is(i));)1===r.nodeType&&n.push(r),r=r[e];return n},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}}),re.fn.extend({has:function(t){var e,i=re(t,this),n=i.length;return this.filter(function(){for(e=0;n>e;e++)if(re.contains(this,i[e]))return!0})},closest:function(t,e){for(var i,n=0,r=this.length,o=[],a=ce.test(t)||"string"!=typeof t?re(t,e||this.context):0;r>n;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&re.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?re.unique(o):o)},index:function(t){return t?"string"==typeof t?re.inArray(this[0],re(t)):re.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(re.unique(re.merge(this.get(),re(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),re.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return re.dir(t,"parentNode")},parentsUntil:function(t,e,i){return re.dir(t,"parentNode",i)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return re.dir(t,"nextSibling")},prevAll:function(t){return re.dir(t,"previousSibling")},nextUntil:function(t,e,i){return re.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return re.dir(t,"previousSibling",i)},siblings:function(t){return re.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return re.sibling(t.firstChild)},contents:function(t){return re.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:re.merge([],t.childNodes)}},function(t,e){re.fn[t]=function(i,n){var r=re.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=re.filter(n,r)),this.length>1&&(ve[t]||(r=re.unique(r)),ge.test(t)&&(r=r.reverse())),this.pushStack(r)}});var ye=/\S+/g,Te={};re.Callbacks=function(t){t="string"==typeof t?Te[t]||o(t):re.extend({},t);var e,i,n,r,a,s,l=[],h=!t.once&&[],c=function(o){for(i=t.memory&&o,n=!0,a=s||0,s=0,r=l.length,e=!0;l&&r>a;a++)if(l[a].apply(o[0],o[1])===!1&&t.stopOnFalse){i=!1;break}e=!1,l&&(h?h.length&&c(h.shift()):i?l=[]:u.disable())},u={add:function(){if(l){var n=l.length;!function o(e){re.each(e,function(e,i){var n=re.type(i);"function"===n?t.unique&&u.has(i)||l.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),e?r=l.length:i&&(s=n,c(i))}return this},remove:function(){return l&&re.each(arguments,function(t,i){for(var n;(n=re.inArray(i,l,n))>-1;)l.splice(n,1),e&&(r>=n&&r--,a>=n&&a--)}),this},has:function(t){return t?re.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],r=0,this},disable:function(){return l=h=i=void 0,this},disabled:function(){return!l},lock:function(){return h=void 0,i||u.disable(),this},locked:function(){return!h},fireWith:function(t,i){return!l||n&&!h||(i=i||[],i=[t,i.slice?i.slice():i],e?h.push(i):c(i)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},re.extend({Deferred:function(t){var e=[["resolve","done",re.Callbacks("once memory"),"resolved"],["reject","fail",re.Callbacks("once memory"),"rejected"],["notify","progress",re.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return re.Deferred(function(i){re.each(e,function(e,o){var a=re.isFunction(t[e])&&t[e];r[o[1]](function(){var t=a&&a.apply(this,arguments);t&&re.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,a?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?re.extend(t,n):n}},r={};return n.pipe=n.then,re.each(e,function(t,o){var a=o[2],s=o[3];n[o[1]]=a.add,s&&a.add(function(){i=s},e[1^t][2].disable,e[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=a.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,o=Y.call(arguments),a=o.length,s=1!==a||t&&re.isFunction(t.promise)?a:0,l=1===s?t:re.Deferred(),h=function(t,i,n){return function(r){i[t]=this,n[t]=arguments.length>1?Y.call(arguments):r,n===e?l.notifyWith(i,n):--s||l.resolveWith(i,n)}};if(a>1)for(e=new Array(a),i=new Array(a),n=new Array(a);a>r;r++)o[r]&&re.isFunction(o[r].promise)?o[r].promise().done(h(r,n,o)).fail(l.reject).progress(h(r,i,e)):--s;return s||l.resolveWith(n,o),l.promise()}});var be;re.fn.ready=function(t){return re.ready.promise().done(t),this},re.extend({isReady:!1,readyWait:1,holdReady:function(t){t?re.readyWait++:re.ready(!0)},ready:function(t){if(t===!0?!--re.readyWait:!re.isReady){if(!pe.body)return setTimeout(re.ready);re.isReady=!0,t!==!0&&--re.readyWait>0||(be.resolveWith(pe,[re]),re.fn.triggerHandler&&(re(pe).triggerHandler("ready"),re(pe).off("ready")))}}}),re.ready.promise=function(e){if(!be)if(be=re.Deferred(),"complete"===pe.readyState)setTimeout(re.ready);else if(pe.addEventListener)pe.addEventListener("DOMContentLoaded",s,!1),t.addEventListener("load",s,!1);else{pe.attachEvent("onreadystatechange",s),t.attachEvent("onload",s);var i=!1;try{i=null==t.frameElement&&pe.documentElement}catch(n){}i&&i.doScroll&&!function r(){if(!re.isReady){try{i.doScroll("left")}catch(t){return setTimeout(r,50)}a(),re.ready()}}()}return be.promise(e)};var Re,xe="undefined";for(Re in re(ie))break;ie.ownLast="0"!==Re,ie.inlineBlockNeedsLayout=!1,re(function(){var t,e,i,n;i=pe.getElementsByTagName("body")[0],i&&i.style&&(e=pe.createElement("div"),n=pe.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(e),typeof e.style.zoom!==xe&&(e.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ie.inlineBlockNeedsLayout=t=3===e.offsetWidth,t&&(i.style.zoom=1)),i.removeChild(n))}),function(){var t=pe.createElement("div");if(null==ie.deleteExpando){ie.deleteExpando=!0;try{delete t.test}catch(e){ie.deleteExpando=!1}}t=null}(),re.acceptData=function(t){var e=re.noData[(t.nodeName+" ").toLowerCase()],i=+t.nodeType||1;return 1!==i&&9!==i?!1:!e||e!==!0&&t.getAttribute("classid")===e};var we=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,He=/([A-Z])/g;re.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return t=t.nodeType?re.cache[t[re.expando]]:t[re.expando],!!t&&!h(t)},data:function(t,e,i){return c(t,e,i)},removeData:function(t,e){return u(t,e)},_data:function(t,e,i){return c(t,e,i,!0)},_removeData:function(t,e){return u(t,e,!0)}}),re.fn.extend({data:function(t,e){var i,n,r,o=this[0],a=o&&o.attributes;if(void 0===t){if(this.length&&(r=re.data(o),1===o.nodeType&&!re._data(o,"parsedAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=re.camelCase(n.slice(5)),l(o,n,r[n])));re._data(o,"parsedAttrs",!0)}return r}return"object"==typeof t?this.each(function(){re.data(this,t)}):arguments.length>1?this.each(function(){re.data(this,t,e)}):o?l(o,t,re.data(o,t)):void 0},removeData:function(t){return this.each(function(){re.removeData(this,t)})}}),re.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=re._data(t,e),i&&(!n||re.isArray(i)?n=re._data(t,e,re.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=re.queue(t,e),n=i.length,r=i.shift(),o=re._queueHooks(t,e),a=function(){re.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete o.stop,r.call(t,a,o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return re._data(t,i)||re._data(t,i,{empty:re.Callbacks("once memory").add(function(){re._removeData(t,e+"queue"),re._removeData(t,i)})})}}),re.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?re.queue(this[0],t):void 0===e?this:this.each(function(){var i=re.queue(this,t,e);re._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&re.dequeue(this,t)})},dequeue:function(t){return this.each(function(){re.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=re.Deferred(),o=this,a=this.length,s=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)i=re._data(o[a],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(s));return s(),r.promise(e)}});var _e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Se=["Top","Right","Bottom","Left"],Me=function(t,e){return t=e||t,"none"===re.css(t,"display")||!re.contains(t.ownerDocument,t)},Ce=re.access=function(t,e,i,n,r,o,a){var s=0,l=t.length,h=null==i;if("object"===re.type(i)){r=!0;for(s in i)re.access(t,e,s,i[s],!0,o,a)}else if(void 0!==n&&(r=!0,re.isFunction(n)||(a=!0),h&&(a?(e.call(t,n),e=null):(h=e,e=function(t,e,i){return h.call(re(t),i)})),e))for(;l>s;s++)e(t[s],i,a?n:n.call(t[s],s,e(t[s],i)));return r?t:h?e.call(t):l?e(t[0],i):o},Ae=/^(?:checkbox|radio)$/i;!function(){var t=pe.createElement("input"),e=pe.createElement("div"),i=pe.createDocumentFragment();if(e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ie.leadingWhitespace=3===e.firstChild.nodeType,ie.tbody=!e.getElementsByTagName("tbody").length,ie.htmlSerialize=!!e.getElementsByTagName("link").length,ie.html5Clone="<:nav></:nav>"!==pe.createElement("nav").cloneNode(!0).outerHTML,t.type="checkbox",t.checked=!0,i.appendChild(t),ie.appendChecked=t.checked,e.innerHTML="<textarea>x</textarea>",ie.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,i.appendChild(e),e.innerHTML="<input type='radio' checked='checked' name='t'/>",ie.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,ie.noCloneEvent=!0,e.attachEvent&&(e.attachEvent("onclick",function(){ie.noCloneEvent=!1}),e.cloneNode(!0).click()),null==ie.deleteExpando){ie.deleteExpando=!0;try{delete e.test}catch(n){ie.deleteExpando=!1}}}(),function(){var e,i,n=pe.createElement("div");for(e in{submit:!0,change:!0,focusin:!0})i="on"+e,(ie[e+"Bubbles"]=i in t)||(n.setAttribute(i,"t"),ie[e+"Bubbles"]=n.attributes[i].expando===!1);n=null}();var ke=/^(?:input|select|textarea)$/i,Le=/^key/,Ne=/^(?:mouse|pointer|contextmenu)|click/,Pe=/^(?:focusinfocus|focusoutblur)$/,Fe=/^([^.]*)(?:\.(.+)|)$/;re.event={global:{},add:function(t,e,i,n,r){var o,a,s,l,h,c,u,f,d,p,m,E=re._data(t);if(E){for(i.handler&&(l=i,i=l.handler,r=l.selector),i.guid||(i.guid=re.guid++),(a=E.events)||(a=E.events={}),(c=E.handle)||(c=E.handle=function(t){return typeof re===xe||t&&re.event.triggered===t.type?void 0:re.event.dispatch.apply(c.elem,arguments)},c.elem=t),e=(e||"").match(ye)||[""],s=e.length;s--;)o=Fe.exec(e[s])||[],d=m=o[1],p=(o[2]||"").split(".").sort(),d&&(h=re.event.special[d]||{},d=(r?h.delegateType:h.bindType)||d,h=re.event.special[d]||{},u=re.extend({type:d,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&re.expr.match.needsContext.test(r),namespace:p.join(".")},l),(f=a[d])||(f=a[d]=[],f.delegateCount=0,h.setup&&h.setup.call(t,n,p,c)!==!1||(t.addEventListener?t.addEventListener(d,c,!1):t.attachEvent&&t.attachEvent("on"+d,c))),h.add&&(h.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),r?f.splice(f.delegateCount++,0,u):f.push(u),re.event.global[d]=!0);t=null}},remove:function(t,e,i,n,r){var o,a,s,l,h,c,u,f,d,p,m,E=re.hasData(t)&&re._data(t);if(E&&(c=E.events)){for(e=(e||"").match(ye)||[""],h=e.length;h--;)if(s=Fe.exec(e[h])||[],d=m=s[1],p=(s[2]||"").split(".").sort(),d){for(u=re.event.special[d]||{},d=(n?u.delegateType:u.bindType)||d,f=c[d]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;o--;)a=f[o],!r&&m!==a.origType||i&&i.guid!==a.guid||s&&!s.test(a.namespace)||n&&n!==a.selector&&("**"!==n||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,u.remove&&u.remove.call(t,a));l&&!f.length&&(u.teardown&&u.teardown.call(t,p,E.handle)!==!1||re.removeEvent(t,d,E.handle),delete c[d])}else for(d in c)re.event.remove(t,d+e[h],i,n,!0);re.isEmptyObject(c)&&(delete E.handle,re._removeData(t,"events"))}},trigger:function(e,i,n,r){var o,a,s,l,h,c,u,f=[n||pe],d=ee.call(e,"type")?e.type:e,p=ee.call(e,"namespace")?e.namespace.split("."):[];if(s=c=n=n||pe,3!==n.nodeType&&8!==n.nodeType&&!Pe.test(d+re.event.triggered)&&(d.indexOf(".")>=0&&(p=d.split("."),d=p.shift(),p.sort()),a=d.indexOf(":")<0&&"on"+d,e=e[re.expando]?e:new re.Event(d,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:re.makeArray(i,[e]),h=re.event.special[d]||{},r||!h.trigger||h.trigger.apply(n,i)!==!1)){if(!r&&!h.noBubble&&!re.isWindow(n)){for(l=h.delegateType||d,Pe.test(l+d)||(s=s.parentNode);s;s=s.parentNode)f.push(s),c=s;
c===(n.ownerDocument||pe)&&f.push(c.defaultView||c.parentWindow||t)}for(u=0;(s=f[u++])&&!e.isPropagationStopped();)e.type=u>1?l:h.bindType||d,o=(re._data(s,"events")||{})[e.type]&&re._data(s,"handle"),o&&o.apply(s,i),o=a&&s[a],o&&o.apply&&re.acceptData(s)&&(e.result=o.apply(s,i),e.result===!1&&e.preventDefault());if(e.type=d,!r&&!e.isDefaultPrevented()&&(!h._default||h._default.apply(f.pop(),i)===!1)&&re.acceptData(n)&&a&&n[d]&&!re.isWindow(n)){c=n[a],c&&(n[a]=null),re.event.triggered=d;try{n[d]()}catch(m){}re.event.triggered=void 0,c&&(n[a]=c)}return e.result}},dispatch:function(t){t=re.event.fix(t);var e,i,n,r,o,a=[],s=Y.call(arguments),l=(re._data(this,"events")||{})[t.type]||[],h=re.event.special[t.type]||{};if(s[0]=t,t.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,t)!==!1){for(a=re.event.handlers.call(this,t,l),e=0;(r=a[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,o=0;(n=r.handlers[o++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(n.namespace))&&(t.handleObj=n,t.data=n.data,i=((re.event.special[n.origType]||{}).handle||n.handler).apply(r.elem,s),void 0!==i&&(t.result=i)===!1&&(t.preventDefault(),t.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,r,o,a=[],s=e.delegateCount,l=t.target;if(s&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==t.type)){for(r=[],o=0;s>o;o++)n=e[o],i=n.selector+" ",void 0===r[i]&&(r[i]=n.needsContext?re(i,this).index(l)>=0:re.find(i,this,null,[l]).length),r[i]&&r.push(n);r.length&&a.push({elem:l,handlers:r})}return s<e.length&&a.push({elem:this,handlers:e.slice(s)}),a},fix:function(t){if(t[re.expando])return t;var e,i,n,r=t.type,o=t,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=Ne.test(r)?this.mouseHooks:Le.test(r)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,t=new re.Event(o),e=n.length;e--;)i=n[e],t[i]=o[i];return t.target||(t.target=o.srcElement||pe),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,a.filter?a.filter(t,o):t},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,r,o=e.button,a=e.fromElement;return null==t.pageX&&null!=e.clientX&&(n=t.target.ownerDocument||pe,r=n.documentElement,i=n.body,t.pageX=e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!t.relatedTarget&&a&&(t.relatedTarget=a===t.target?e.toElement:a),t.which||void 0===o||(t.which=1&o?1:2&o?3:4&o?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==p()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){return this===p()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return re.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(t){return re.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,n){var r=re.extend(new re.Event,i,{type:t,isSimulated:!0,originalEvent:{}});n?re.event.trigger(r,null,e):re.event.dispatch.call(e,r),r.isDefaultPrevented()&&i.preventDefault()}},re.removeEvent=pe.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)}:function(t,e,i){var n="on"+e;t.detachEvent&&(typeof t[n]===xe&&(t[n]=null),t.detachEvent(n,i))},re.Event=function(t,e){return this instanceof re.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?f:d):this.type=t,e&&re.extend(this,e),this.timeStamp=t&&t.timeStamp||re.now(),void(this[re.expando]=!0)):new re.Event(t,e)},re.Event.prototype={isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=f,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=f,t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=f,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},re.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){re.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,o=t.handleObj;return(!r||r!==n&&!re.contains(n,r))&&(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}}),ie.submitBubbles||(re.event.special.submit={setup:function(){return re.nodeName(this,"form")?!1:void re.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,i=re.nodeName(e,"input")||re.nodeName(e,"button")?e.form:void 0;i&&!re._data(i,"submitBubbles")&&(re.event.add(i,"submit._submit",function(t){t._submit_bubble=!0}),re._data(i,"submitBubbles",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&re.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return re.nodeName(this,"form")?!1:void re.event.remove(this,"._submit")}}),ie.changeBubbles||(re.event.special.change={setup:function(){return ke.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(re.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),re.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),re.event.simulate("change",this,t,!0)})),!1):void re.event.add(this,"beforeactivate._change",function(t){var e=t.target;ke.test(e.nodeName)&&!re._data(e,"changeBubbles")&&(re.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||re.event.simulate("change",this.parentNode,t,!0)}),re._data(e,"changeBubbles",!0))})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return re.event.remove(this,"._change"),!ke.test(this.nodeName)}}),ie.focusinBubbles||re.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){re.event.simulate(e,t.target,re.event.fix(t),!0)};re.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=re._data(n,e);r||n.addEventListener(t,i,!0),re._data(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=re._data(n,e)-1;r?re._data(n,e,r):(n.removeEventListener(t,i,!0),re._removeData(n,e))}}}),re.fn.extend({on:function(t,e,i,n,r){var o,a;if("object"==typeof t){"string"!=typeof e&&(i=i||e,e=void 0);for(o in t)this.on(o,e,i,t[o],r);return this}if(null==i&&null==n?(n=e,i=e=void 0):null==n&&("string"==typeof e?(n=i,i=void 0):(n=i,i=e,e=void 0)),n===!1)n=d;else if(!n)return this;return 1===r&&(a=n,n=function(t){return re().off(t),a.apply(this,arguments)},n.guid=a.guid||(a.guid=re.guid++)),this.each(function(){re.event.add(this,t,n,i,e)})},one:function(t,e,i,n){return this.on(t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,re(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return(e===!1||"function"==typeof e)&&(i=e,e=void 0),i===!1&&(i=d),this.each(function(){re.event.remove(this,t,i,e)})},trigger:function(t,e){return this.each(function(){re.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?re.event.trigger(t,e,i,!0):void 0}});var De="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ze=/ jQuery\d+="(?:null|\d+)"/g,Ve=new RegExp("<(?:"+De+")[\\s/>]","i"),Ie=/^\s+/,Be=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ue=/<([\w:]+)/,Oe=/<tbody/i,je=/<|&#?\w+;/,We=/<(?:script|style|link)/i,Ge=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^$|\/(?:java|ecma)script/i,$e=/^true\/(.*)/,qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ye={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ie.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Qe=m(pe),Ze=Qe.appendChild(pe.createElement("div"));Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td,re.extend({clone:function(t,e,i){var n,r,o,a,s,l=re.contains(t.ownerDocument,t);if(ie.html5Clone||re.isXMLDoc(t)||!Ve.test("<"+t.nodeName+">")?o=t.cloneNode(!0):(Ze.innerHTML=t.outerHTML,Ze.removeChild(o=Ze.firstChild)),!(ie.noCloneEvent&&ie.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||re.isXMLDoc(t)))for(n=E(o),s=E(t),a=0;null!=(r=s[a]);++a)n[a]&&x(r,n[a]);if(e)if(i)for(s=s||E(t),n=n||E(o),a=0;null!=(r=s[a]);a++)R(r,n[a]);else R(t,o);return n=E(o,"script"),n.length>0&&b(n,!l&&E(t,"script")),n=s=r=null,o},buildFragment:function(t,e,i,n){for(var r,o,a,s,l,h,c,u=t.length,f=m(e),d=[],p=0;u>p;p++)if(o=t[p],o||0===o)if("object"===re.type(o))re.merge(d,o.nodeType?[o]:o);else if(je.test(o)){for(s=s||f.appendChild(e.createElement("div")),l=(Ue.exec(o)||["",""])[1].toLowerCase(),c=Ye[l]||Ye._default,s.innerHTML=c[1]+o.replace(Be,"<$1></$2>")+c[2],r=c[0];r--;)s=s.lastChild;if(!ie.leadingWhitespace&&Ie.test(o)&&d.push(e.createTextNode(Ie.exec(o)[0])),!ie.tbody)for(o="table"!==l||Oe.test(o)?"<table>"!==c[1]||Oe.test(o)?0:s:s.firstChild,r=o&&o.childNodes.length;r--;)re.nodeName(h=o.childNodes[r],"tbody")&&!h.childNodes.length&&o.removeChild(h);for(re.merge(d,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=f.lastChild}else d.push(e.createTextNode(o));for(s&&f.removeChild(s),ie.appendChecked||re.grep(E(d,"input"),g),p=0;o=d[p++];)if((!n||-1===re.inArray(o,n))&&(a=re.contains(o.ownerDocument,o),s=E(f.appendChild(o),"script"),a&&b(s),i))for(r=0;o=s[r++];)Xe.test(o.type||"")&&i.push(o);return s=null,f},cleanData:function(t,e){for(var i,n,r,o,a=0,s=re.expando,l=re.cache,h=ie.deleteExpando,c=re.event.special;null!=(i=t[a]);a++)if((e||re.acceptData(i))&&(r=i[s],o=r&&l[r])){if(o.events)for(n in o.events)c[n]?re.event.remove(i,n):re.removeEvent(i,n,o.handle);l[r]&&(delete l[r],h?delete i[s]:typeof i.removeAttribute!==xe?i.removeAttribute(s):i[s]=null,q.push(r))}}}),re.fn.extend({text:function(t){return Ce(this,function(t){return void 0===t?re.text(this):this.empty().append((this[0]&&this[0].ownerDocument||pe).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var i,n=t?re.filter(t,this):this,r=0;null!=(i=n[r]);r++)e||1!==i.nodeType||re.cleanData(E(i)),i.parentNode&&(e&&re.contains(i.ownerDocument,i)&&b(E(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&re.cleanData(E(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&re.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return re.clone(this,t,e)})},html:function(t){return Ce(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(ze,""):void 0;if(!("string"!=typeof t||We.test(t)||!ie.htmlSerialize&&Ve.test(t)||!ie.leadingWhitespace&&Ie.test(t)||Ye[(Ue.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(Be,"<$1></$2>");try{for(;n>i;i++)e=this[i]||{},1===e.nodeType&&(re.cleanData(E(e,!1)),e.innerHTML=t);e=0}catch(r){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,re.cleanData(E(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=Q.apply([],t);var i,n,r,o,a,s,l=0,h=this.length,c=this,u=h-1,f=t[0],d=re.isFunction(f);if(d||h>1&&"string"==typeof f&&!ie.checkClone&&Ge.test(f))return this.each(function(i){var n=c.eq(i);d&&(t[0]=f.call(this,i,n.html())),n.domManip(t,e)});if(h&&(s=re.buildFragment(t,this[0].ownerDocument,!1,this),i=s.firstChild,1===s.childNodes.length&&(s=i),i)){for(o=re.map(E(s,"script"),y),r=o.length;h>l;l++)n=s,l!==u&&(n=re.clone(n,!0,!0),r&&re.merge(o,E(n,"script"))),e.call(this[l],n,l);if(r)for(a=o[o.length-1].ownerDocument,re.map(o,T),l=0;r>l;l++)n=o[l],Xe.test(n.type||"")&&!re._data(n,"globalEval")&&re.contains(a,n)&&(n.src?re._evalUrl&&re._evalUrl(n.src):re.globalEval((n.text||n.textContent||n.innerHTML||"").replace(qe,"")));s=i=null}return this}}),re.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){re.fn[t]=function(t){for(var i,n=0,r=[],o=re(t),a=o.length-1;a>=n;n++)i=n===a?this:this.clone(!0),re(o[n])[e](i),Z.apply(r,i.get());return this.pushStack(r)}});var Ke,Je={};!function(){var t;ie.shrinkWrapBlocks=function(){if(null!=t)return t;t=!1;var e,i,n;return i=pe.getElementsByTagName("body")[0],i&&i.style?(e=pe.createElement("div"),n=pe.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(e),typeof e.style.zoom!==xe&&(e.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",e.appendChild(pe.createElement("div")).style.width="5px",t=3!==e.offsetWidth),i.removeChild(n),t):void 0}}();var ti,ei,ii=/^margin/,ni=new RegExp("^("+_e+")(?!px)[a-z%]+$","i"),ri=/^(top|right|bottom|left)$/;t.getComputedStyle?(ti=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):t.getComputedStyle(e,null)},ei=function(t,e,i){var n,r,o,a,s=t.style;return i=i||ti(t),a=i?i.getPropertyValue(e)||i[e]:void 0,i&&(""!==a||re.contains(t.ownerDocument,t)||(a=re.style(t,e)),ni.test(a)&&ii.test(e)&&(n=s.width,r=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=i.width,s.width=n,s.minWidth=r,s.maxWidth=o)),void 0===a?a:a+""}):pe.documentElement.currentStyle&&(ti=function(t){return t.currentStyle},ei=function(t,e,i){var n,r,o,a,s=t.style;return i=i||ti(t),a=i?i[e]:void 0,null==a&&s&&s[e]&&(a=s[e]),ni.test(a)&&!ri.test(e)&&(n=s.left,r=t.runtimeStyle,o=r&&r.left,o&&(r.left=t.currentStyle.left),s.left="fontSize"===e?"1em":a,a=s.pixelLeft+"px",s.left=n,o&&(r.left=o)),void 0===a?a:a+""||"auto"}),function(){function e(){var e,i,n,r;i=pe.getElementsByTagName("body")[0],i&&i.style&&(e=pe.createElement("div"),n=pe.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(e),e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",o=a=!1,l=!0,t.getComputedStyle&&(o="1%"!==(t.getComputedStyle(e,null)||{}).top,a="4px"===(t.getComputedStyle(e,null)||{width:"4px"}).width,r=e.appendChild(pe.createElement("div")),r.style.cssText=e.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",r.style.marginRight=r.style.width="0",e.style.width="1px",l=!parseFloat((t.getComputedStyle(r,null)||{}).marginRight),e.removeChild(r)),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=e.getElementsByTagName("td"),r[0].style.cssText="margin:0;border:0;padding:0;display:none",s=0===r[0].offsetHeight,s&&(r[0].style.display="",r[1].style.display="none",s=0===r[0].offsetHeight),i.removeChild(n))}var i,n,r,o,a,s,l;i=pe.createElement("div"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=i.getElementsByTagName("a")[0],n=r&&r.style,n&&(n.cssText="float:left;opacity:.5",ie.opacity="0.5"===n.opacity,ie.cssFloat=!!n.cssFloat,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===i.style.backgroundClip,ie.boxSizing=""===n.boxSizing||""===n.MozBoxSizing||""===n.WebkitBoxSizing,re.extend(ie,{reliableHiddenOffsets:function(){return null==s&&e(),s},boxSizingReliable:function(){return null==a&&e(),a},pixelPosition:function(){return null==o&&e(),o},reliableMarginRight:function(){return null==l&&e(),l}}))}(),re.swap=function(t,e,i,n){var r,o,a={};for(o in e)a[o]=t.style[o],t.style[o]=e[o];r=i.apply(t,n||[]);for(o in e)t.style[o]=a[o];return r};var oi=/alpha\([^)]*\)/i,ai=/opacity\s*=\s*([^)]*)/,si=/^(none|table(?!-c[ea]).+)/,li=new RegExp("^("+_e+")(.*)$","i"),hi=new RegExp("^([+-])=("+_e+")","i"),ci={position:"absolute",visibility:"hidden",display:"block"},ui={letterSpacing:"0",fontWeight:"400"},fi=["Webkit","O","Moz","ms"];re.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=ei(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ie.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,a,s=re.camelCase(e),l=t.style;if(e=re.cssProps[s]||(re.cssProps[s]=S(l,s)),a=re.cssHooks[e]||re.cssHooks[s],void 0===i)return a&&"get"in a&&void 0!==(r=a.get(t,!1,n))?r:l[e];if(o=typeof i,"string"===o&&(r=hi.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(re.css(t,e)),o="number"),null!=i&&i===i&&("number"!==o||re.cssNumber[s]||(i+="px"),ie.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),!(a&&"set"in a&&void 0===(i=a.set(t,i,n)))))try{l[e]=i}catch(h){}}},css:function(t,e,i,n){var r,o,a,s=re.camelCase(e);return e=re.cssProps[s]||(re.cssProps[s]=S(t.style,s)),a=re.cssHooks[e]||re.cssHooks[s],a&&"get"in a&&(o=a.get(t,!0,i)),void 0===o&&(o=ei(t,e,n)),"normal"===o&&e in ui&&(o=ui[e]),""===i||i?(r=parseFloat(o),i===!0||re.isNumeric(r)?r||0:o):o}}),re.each(["height","width"],function(t,e){re.cssHooks[e]={get:function(t,i,n){return i?si.test(re.css(t,"display"))&&0===t.offsetWidth?re.swap(t,ci,function(){return k(t,e,n)}):k(t,e,n):void 0},set:function(t,i,n){var r=n&&ti(t);return C(t,i,n?A(t,e,n,ie.boxSizing&&"border-box"===re.css(t,"boxSizing",!1,r),r):0)}}}),ie.opacity||(re.cssHooks.opacity={get:function(t,e){return ai.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var i=t.style,n=t.currentStyle,r=re.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,(e>=1||""===e)&&""===re.trim(o.replace(oi,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===e||n&&!n.filter)||(i.filter=oi.test(o)?o.replace(oi,r):o+" "+r)}}),re.cssHooks.marginRight=_(ie.reliableMarginRight,function(t,e){return e?re.swap(t,{display:"inline-block"},ei,[t,"marginRight"]):void 0}),re.each({margin:"",padding:"",border:"Width"},function(t,e){re.cssHooks[t+e]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[t+Se[n]+e]=o[n]||o[n-2]||o[0];return r}},ii.test(t)||(re.cssHooks[t+e].set=C)}),re.fn.extend({css:function(t,e){return Ce(this,function(t,e,i){var n,r,o={},a=0;if(re.isArray(e)){for(n=ti(t),r=e.length;r>a;a++)o[e[a]]=re.css(t,e[a],!1,n);return o}return void 0!==i?re.style(t,e,i):re.css(t,e)},t,e,arguments.length>1)},show:function(){return M(this,!0)},hide:function(){return M(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Me(this)?re(this).show():re(this).hide()})}}),re.Tween=L,L.prototype={constructor:L,init:function(t,e,i,n,r,o){this.elem=t,this.prop=i,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(re.cssNumber[i]?"":"px")},cur:function(){var t=L.propHooks[this.prop];return t&&t.get?t.get(this):L.propHooks._default.get(this)},run:function(t){var e,i=L.propHooks[this.prop];return this.pos=e=this.options.duration?re.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=re.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){re.fx.step[t.prop]?re.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[re.cssProps[t.prop]]||re.cssHooks[t.prop])?re.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},re.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},re.fx=L.prototype.init,re.fx.step={};var di,pi,mi=/^(?:toggle|show|hide)$/,Ei=new RegExp("^(?:([+-])=|)("+_e+")([a-z%]*)$","i"),gi=/queueHooks$/,vi=[D],yi={"*":[function(t,e){var i=this.createTween(t,e),n=i.cur(),r=Ei.exec(e),o=r&&r[3]||(re.cssNumber[t]?"":"px"),a=(re.cssNumber[t]||"px"!==o&&+n)&&Ei.exec(re.css(i.elem,t)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],r=r||[],a=+n||1;do s=s||".5",a/=s,re.style(i.elem,t,a+o);while(s!==(s=i.cur()/n)&&1!==s&&--l)}return r&&(a=i.start=+a||+n||0,i.unit=o,i.end=r[1]?a+(r[1]+1)*r[2]:+r[2]),i}]};re.Animation=re.extend(V,{tweener:function(t,e){re.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,n=0,r=t.length;r>n;n++)i=t[n],yi[i]=yi[i]||[],yi[i].unshift(e)},prefilter:function(t,e){e?vi.unshift(t):vi.push(t)}}),re.speed=function(t,e,i){var n=t&&"object"==typeof t?re.extend({},t):{complete:i||!i&&e||re.isFunction(t)&&t,duration:t,easing:i&&e||e&&!re.isFunction(e)&&e};return n.duration=re.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in re.fx.speeds?re.fx.speeds[n.duration]:re.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){re.isFunction(n.old)&&n.old.call(this),n.queue&&re.dequeue(this,n.queue)},n},re.fn.extend({fadeTo:function(t,e,i,n){return this.filter(Me).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=re.isEmptyObject(t),o=re.speed(e,i,n),a=function(){var e=V(this,re.extend({},t),o);(r||re._data(this,"finish"))&&e.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",o=re.timers,a=re._data(this);if(r)a[r]&&a[r].stop&&n(a[r]);else for(r in a)a[r]&&a[r].stop&&gi.test(r)&&n(a[r]);for(r=o.length;r--;)o[r].elem!==this||null!=t&&o[r].queue!==t||(o[r].anim.stop(i),e=!1,o.splice(r,1));(e||!i)&&re.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=re._data(this),n=i[t+"queue"],r=i[t+"queueHooks"],o=re.timers,a=n?n.length:0;for(i.finish=!0,re.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;a>e;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),re.each(["toggle","show","hide"],function(t,e){var i=re.fn[e];re.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(P(e,!0),t,n,r)}}),re.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){re.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),re.timers=[],re.fx.tick=function(){var t,e=re.timers,i=0;for(di=re.now();i<e.length;i++)t=e[i],t()||e[i]!==t||e.splice(i--,1);e.length||re.fx.stop(),di=void 0},re.fx.timer=function(t){re.timers.push(t),t()?re.fx.start():re.timers.pop()},re.fx.interval=13,re.fx.start=function(){pi||(pi=setInterval(re.fx.tick,re.fx.interval))},re.fx.stop=function(){clearInterval(pi),pi=null},re.fx.speeds={slow:600,fast:200,_default:400},re.fn.delay=function(t,e){return t=re.fx?re.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var n=setTimeout(e,t);i.stop=function(){clearTimeout(n)}})},function(){var t,e,i,n,r;e=pe.createElement("div"),e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=e.getElementsByTagName("a")[0],i=pe.createElement("select"),r=i.appendChild(pe.createElement("option")),t=e.getElementsByTagName("input")[0],n.style.cssText="top:1px",ie.getSetAttribute="t"!==e.className,ie.style=/top/.test(n.getAttribute("style")),ie.hrefNormalized="/a"===n.getAttribute("href"),ie.checkOn=!!t.value,ie.optSelected=r.selected,ie.enctype=!!pe.createElement("form").enctype,i.disabled=!0,ie.optDisabled=!r.disabled,t=pe.createElement("input"),t.setAttribute("value",""),ie.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),ie.radioValue="t"===t.value}();var Ti=/\r/g;re.fn.extend({val:function(t){var e,i,n,r=this[0];{if(arguments.length)return n=re.isFunction(t),this.each(function(i){var r;1===this.nodeType&&(r=n?t.call(this,i,re(this).val()):t,null==r?r="":"number"==typeof r?r+="":re.isArray(r)&&(r=re.map(r,function(t){return null==t?"":t+""})),e=re.valHooks[this.type]||re.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))});if(r)return e=re.valHooks[r.type]||re.valHooks[r.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(Ti,""):null==i?"":i)}}}),re.extend({valHooks:{option:{get:function(t){var e=re.find.attr(t,"value");return null!=e?e:re.trim(re.text(t))}},select:{get:function(t){for(var e,i,n=t.options,r=t.selectedIndex,o="select-one"===t.type||0>r,a=o?null:[],s=o?r+1:n.length,l=0>r?s:o?r:0;s>l;l++)if(i=n[l],!(!i.selected&&l!==r||(ie.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&re.nodeName(i.parentNode,"optgroup"))){if(e=re(i).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var i,n,r=t.options,o=re.makeArray(e),a=r.length;a--;)if(n=r[a],re.inArray(re.valHooks.option.get(n),o)>=0)try{n.selected=i=!0}catch(s){n.scrollHeight}else n.selected=!1;return i||(t.selectedIndex=-1),r}}}}),re.each(["radio","checkbox"],function(){re.valHooks[this]={set:function(t,e){return re.isArray(e)?t.checked=re.inArray(re(t).val(),e)>=0:void 0}},ie.checkOn||(re.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var bi,Ri,xi=re.expr.attrHandle,wi=/^(?:checked|selected)$/i,Hi=ie.getSetAttribute,_i=ie.input;re.fn.extend({attr:function(t,e){return Ce(this,re.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){re.removeAttr(this,t)})}}),re.extend({attr:function(t,e,i){var n,r,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o)return typeof t.getAttribute===xe?re.prop(t,e,i):(1===o&&re.isXMLDoc(t)||(e=e.toLowerCase(),n=re.attrHooks[e]||(re.expr.match.bool.test(e)?Ri:bi)),void 0===i?n&&"get"in n&&null!==(r=n.get(t,e))?r:(r=re.find.attr(t,e),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):void re.removeAttr(t,e))},removeAttr:function(t,e){var i,n,r=0,o=e&&e.match(ye);if(o&&1===t.nodeType)for(;i=o[r++];)n=re.propFix[i]||i,re.expr.match.bool.test(i)?_i&&Hi||!wi.test(i)?t[n]=!1:t[re.camelCase("default-"+i)]=t[n]=!1:re.attr(t,i,""),t.removeAttribute(Hi?i:n)},attrHooks:{type:{set:function(t,e){if(!ie.radioValue&&"radio"===e&&re.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}}}),Ri={set:function(t,e,i){return e===!1?re.removeAttr(t,i):_i&&Hi||!wi.test(i)?t.setAttribute(!Hi&&re.propFix[i]||i,i):t[re.camelCase("default-"+i)]=t[i]=!0,i}},re.each(re.expr.match.bool.source.match(/\w+/g),function(t,e){var i=xi[e]||re.find.attr;xi[e]=_i&&Hi||!wi.test(e)?function(t,e,n){var r,o;return n||(o=xi[e],xi[e]=r,r=null!=i(t,e,n)?e.toLowerCase():null,xi[e]=o),r}:function(t,e,i){return i?void 0:t[re.camelCase("default-"+e)]?e.toLowerCase():null}}),_i&&Hi||(re.attrHooks.value={set:function(t,e,i){return re.nodeName(t,"input")?void(t.defaultValue=e):bi&&bi.set(t,e,i)}}),Hi||(bi={set:function(t,e,i){var n=t.getAttributeNode(i);return n||t.setAttributeNode(n=t.ownerDocument.createAttribute(i)),n.value=e+="","value"===i||e===t.getAttribute(i)?e:void 0}},xi.id=xi.name=xi.coords=function(t,e,i){var n;return i?void 0:(n=t.getAttributeNode(e))&&""!==n.value?n.value:null},re.valHooks.button={get:function(t,e){var i=t.getAttributeNode(e);return i&&i.specified?i.value:void 0},set:bi.set},re.attrHooks.contenteditable={set:function(t,e,i){bi.set(t,""===e?!1:e,i)}},re.each(["width","height"],function(t,e){re.attrHooks[e]={set:function(t,i){return""===i?(t.setAttribute(e,"auto"),i):void 0}}})),ie.style||(re.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var Si=/^(?:input|select|textarea|button|object)$/i,Mi=/^(?:a|area)$/i;re.fn.extend({prop:function(t,e){return Ce(this,re.prop,t,e,arguments.length>1)},removeProp:function(t){return t=re.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(e){}})}}),re.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,i){var n,r,o,a=t.nodeType;if(t&&3!==a&&8!==a&&2!==a)return o=1!==a||!re.isXMLDoc(t),o&&(e=re.propFix[e]||e,r=re.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=re.find.attr(t,"tabindex");return e?parseInt(e,10):Si.test(t.nodeName)||Mi.test(t.nodeName)&&t.href?0:-1}}}}),ie.hrefNormalized||re.each(["href","src"],function(t,e){re.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),ie.optSelected||(re.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}}),re.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){re.propFix[this.toLowerCase()]=this}),ie.enctype||(re.propFix.enctype="encoding");var Ci=/[\t\r\n\f]/g;re.fn.extend({addClass:function(t){var e,i,n,r,o,a,s=0,l=this.length,h="string"==typeof t&&t;if(re.isFunction(t))return this.each(function(e){re(this).addClass(t.call(this,e,this.className))});if(h)for(e=(t||"").match(ye)||[];l>s;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ci," "):" ")){for(o=0;r=e[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=re.trim(n),i.className!==a&&(i.className=a)}return this},removeClass:function(t){var e,i,n,r,o,a,s=0,l=this.length,h=0===arguments.length||"string"==typeof t&&t;if(re.isFunction(t))return this.each(function(e){re(this).removeClass(t.call(this,e,this.className))});if(h)for(e=(t||"").match(ye)||[];l>s;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ci," "):"")){for(o=0;r=e[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");a=t?re.trim(n):"",i.className!==a&&(i.className=a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):this.each(re.isFunction(t)?function(i){re(this).toggleClass(t.call(this,i,this.className,e),e)}:function(){if("string"===i)for(var e,n=0,r=re(this),o=t.match(ye)||[];e=o[n++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);
else(i===xe||"boolean"===i)&&(this.className&&re._data(this,"__className__",this.className),this.className=this.className||t===!1?"":re._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Ci," ").indexOf(e)>=0)return!0;return!1}}),re.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){re.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),re.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var Ai=re.now(),ki=/\?/,Li=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;re.parseJSON=function(e){if(t.JSON&&t.JSON.parse)return t.JSON.parse(e+"");var i,n=null,r=re.trim(e+"");return r&&!re.trim(r.replace(Li,function(t,e,r,o){return i&&e&&(n=0),0===n?t:(i=r||e,n+=!o-!r,"")}))?Function("return "+r)():re.error("Invalid JSON: "+e)},re.parseXML=function(e){var i,n;if(!e||"string"!=typeof e)return null;try{t.DOMParser?(n=new DOMParser,i=n.parseFromString(e,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e))}catch(r){i=void 0}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||re.error("Invalid XML: "+e),i};var Ni,Pi,Fi=/#.*$/,Di=/([?&])_=[^&]*/,zi=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Vi=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ii=/^(?:GET|HEAD)$/,Bi=/^\/\//,Ui=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Oi={},ji={},Wi="*/".concat("*");try{Pi=location.href}catch(Gi){Pi=pe.createElement("a"),Pi.href="",Pi=Pi.href}Ni=Ui.exec(Pi.toLowerCase())||[],re.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Pi,type:"GET",isLocal:Vi.test(Ni[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":re.parseJSON,"text xml":re.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?U(U(t,re.ajaxSettings),e):U(re.ajaxSettings,t)},ajaxPrefilter:I(Oi),ajaxTransport:I(ji),ajax:function(t,e){function i(t,e,i,n){var r,c,g,v,T,R=e;2!==y&&(y=2,s&&clearTimeout(s),h=void 0,a=n||"",b.readyState=t>0?4:0,r=t>=200&&300>t||304===t,i&&(v=O(u,b,i)),v=j(u,v,b,r),r?(u.ifModified&&(T=b.getResponseHeader("Last-Modified"),T&&(re.lastModified[o]=T),T=b.getResponseHeader("etag"),T&&(re.etag[o]=T)),204===t||"HEAD"===u.type?R="nocontent":304===t?R="notmodified":(R=v.state,c=v.data,g=v.error,r=!g)):(g=R,(t||!R)&&(R="error",0>t&&(t=0))),b.status=t,b.statusText=(e||R)+"",r?p.resolveWith(f,[c,R,b]):p.rejectWith(f,[b,R,g]),b.statusCode(E),E=void 0,l&&d.trigger(r?"ajaxSuccess":"ajaxError",[b,u,r?c:g]),m.fireWith(f,[b,R]),l&&(d.trigger("ajaxComplete",[b,u]),--re.active||re.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r,o,a,s,l,h,c,u=re.ajaxSetup({},e),f=u.context||u,d=u.context&&(f.nodeType||f.jquery)?re(f):re.event,p=re.Deferred(),m=re.Callbacks("once memory"),E=u.statusCode||{},g={},v={},y=0,T="canceled",b={readyState:0,getResponseHeader:function(t){var e;if(2===y){if(!c)for(c={};e=zi.exec(a);)c[e[1].toLowerCase()]=e[2];e=c[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===y?a:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return y||(t=v[i]=v[i]||t,g[t]=e),this},overrideMimeType:function(t){return y||(u.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>y)for(e in t)E[e]=[E[e],t[e]];else b.always(t[b.status]);return this},abort:function(t){var e=t||T;return h&&h.abort(e),i(0,e),this}};if(p.promise(b).complete=m.add,b.success=b.done,b.error=b.fail,u.url=((t||u.url||Pi)+"").replace(Fi,"").replace(Bi,Ni[1]+"//"),u.type=e.method||e.type||u.method||u.type,u.dataTypes=re.trim(u.dataType||"*").toLowerCase().match(ye)||[""],null==u.crossDomain&&(n=Ui.exec(u.url.toLowerCase()),u.crossDomain=!(!n||n[1]===Ni[1]&&n[2]===Ni[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Ni[3]||("http:"===Ni[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=re.param(u.data,u.traditional)),B(Oi,u,e,b),2===y)return b;l=re.event&&u.global,l&&0===re.active++&&re.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!Ii.test(u.type),o=u.url,u.hasContent||(u.data&&(o=u.url+=(ki.test(o)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=Di.test(o)?o.replace(Di,"$1_="+Ai++):o+(ki.test(o)?"&":"?")+"_="+Ai++)),u.ifModified&&(re.lastModified[o]&&b.setRequestHeader("If-Modified-Since",re.lastModified[o]),re.etag[o]&&b.setRequestHeader("If-None-Match",re.etag[o])),(u.data&&u.hasContent&&u.contentType!==!1||e.contentType)&&b.setRequestHeader("Content-Type",u.contentType),b.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+Wi+"; q=0.01":""):u.accepts["*"]);for(r in u.headers)b.setRequestHeader(r,u.headers[r]);if(u.beforeSend&&(u.beforeSend.call(f,b,u)===!1||2===y))return b.abort();T="abort";for(r in{success:1,error:1,complete:1})b[r](u[r]);if(h=B(ji,u,e,b)){b.readyState=1,l&&d.trigger("ajaxSend",[b,u]),u.async&&u.timeout>0&&(s=setTimeout(function(){b.abort("timeout")},u.timeout));try{y=1,h.send(g,i)}catch(R){if(!(2>y))throw R;i(-1,R)}}else i(-1,"No Transport");return b},getJSON:function(t,e,i){return re.get(t,e,i,"json")},getScript:function(t,e){return re.get(t,void 0,e,"script")}}),re.each(["get","post"],function(t,e){re[e]=function(t,i,n,r){return re.isFunction(i)&&(r=r||n,n=i,i=void 0),re.ajax({url:t,type:e,dataType:r,data:i,success:n})}}),re._evalUrl=function(t){return re.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},re.fn.extend({wrapAll:function(t){if(re.isFunction(t))return this.each(function(e){re(this).wrapAll(t.call(this,e))});if(this[0]){var e=re(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(re.isFunction(t)?function(e){re(this).wrapInner(t.call(this,e))}:function(){var e=re(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=re.isFunction(t);return this.each(function(i){re(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){re.nodeName(this,"body")||re(this).replaceWith(this.childNodes)}).end()}}),re.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0||!ie.reliableHiddenOffsets()&&"none"===(t.style&&t.style.display||re.css(t,"display"))},re.expr.filters.visible=function(t){return!re.expr.filters.hidden(t)};var Xi=/%20/g,$i=/\[\]$/,qi=/\r?\n/g,Yi=/^(?:submit|button|image|reset|file)$/i,Qi=/^(?:input|select|textarea|keygen)/i;re.param=function(t,e){var i,n=[],r=function(t,e){e=re.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=re.ajaxSettings&&re.ajaxSettings.traditional),re.isArray(t)||t.jquery&&!re.isPlainObject(t))re.each(t,function(){r(this.name,this.value)});else for(i in t)W(i,t[i],e,r);return n.join("&").replace(Xi,"+")},re.fn.extend({serialize:function(){return re.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=re.prop(this,"elements");return t?re.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!re(this).is(":disabled")&&Qi.test(this.nodeName)&&!Yi.test(t)&&(this.checked||!Ae.test(t))}).map(function(t,e){var i=re(this).val();return null==i?null:re.isArray(i)?re.map(i,function(t){return{name:e.name,value:t.replace(qi,"\r\n")}}):{name:e.name,value:i.replace(qi,"\r\n")}}).get()}}),re.ajaxSettings.xhr=void 0!==t.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&G()||X()}:G;var Zi=0,Ki={},Ji=re.ajaxSettings.xhr();t.attachEvent&&t.attachEvent("onunload",function(){for(var t in Ki)Ki[t](void 0,!0)}),ie.cors=!!Ji&&"withCredentials"in Ji,Ji=ie.ajax=!!Ji,Ji&&re.ajaxTransport(function(t){if(!t.crossDomain||ie.cors){var e;return{send:function(i,n){var r,o=t.xhr(),a=++Zi;if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)o[r]=t.xhrFields[r];t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)void 0!==i[r]&&o.setRequestHeader(r,i[r]+"");o.send(t.hasContent&&t.data||null),e=function(i,r){var s,l,h;if(e&&(r||4===o.readyState))if(delete Ki[a],e=void 0,o.onreadystatechange=re.noop,r)4!==o.readyState&&o.abort();else{h={},s=o.status,"string"==typeof o.responseText&&(h.text=o.responseText);try{l=o.statusText}catch(c){l=""}s||!t.isLocal||t.crossDomain?1223===s&&(s=204):s=h.text?200:404}h&&n(s,l,h,o.getAllResponseHeaders())},t.async?4===o.readyState?setTimeout(e):o.onreadystatechange=Ki[a]=e:e()},abort:function(){e&&e(void 0,!0)}}}}),re.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return re.globalEval(t),t}}}),re.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),re.ajaxTransport("script",function(t){if(t.crossDomain){var e,i=pe.head||re("head")[0]||pe.documentElement;return{send:function(n,r){e=pe.createElement("script"),e.async=!0,t.scriptCharset&&(e.charset=t.scriptCharset),e.src=t.url,e.onload=e.onreadystatechange=function(t,i){(i||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),e=null,i||r(200,"success"))},i.insertBefore(e,i.firstChild)},abort:function(){e&&e.onload(void 0,!0)}}}});var tn=[],en=/(=)\?(?=&|$)|\?\?/;re.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=tn.pop()||re.expando+"_"+Ai++;return this[t]=!0,t}}),re.ajaxPrefilter("json jsonp",function(e,i,n){var r,o,a,s=e.jsonp!==!1&&(en.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&en.test(e.data)&&"data");return s||"jsonp"===e.dataTypes[0]?(r=e.jsonpCallback=re.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(en,"$1"+r):e.jsonp!==!1&&(e.url+=(ki.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return a||re.error(r+" was not called"),a[0]},e.dataTypes[0]="json",o=t[r],t[r]=function(){a=arguments},n.always(function(){t[r]=o,e[r]&&(e.jsonpCallback=i.jsonpCallback,tn.push(r)),a&&re.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),re.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||pe;var n=ue.exec(t),r=!i&&[];return n?[e.createElement(n[1])]:(n=re.buildFragment([t],e,r),r&&r.length&&re(r).remove(),re.merge([],n.childNodes))};var nn=re.fn.load;re.fn.load=function(t,e,i){if("string"!=typeof t&&nn)return nn.apply(this,arguments);var n,r,o,a=this,s=t.indexOf(" ");return s>=0&&(n=re.trim(t.slice(s,t.length)),t=t.slice(0,s)),re.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),a.length>0&&re.ajax({url:t,type:o,dataType:"html",data:e}).done(function(t){r=arguments,a.html(n?re("<div>").append(re.parseHTML(t)).find(n):t)}).complete(i&&function(t,e){a.each(i,r||[t.responseText,e,t])}),this},re.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){re.fn[e]=function(t){return this.on(e,t)}}),re.expr.filters.animated=function(t){return re.grep(re.timers,function(e){return t===e.elem}).length};var rn=t.document.documentElement;re.offset={setOffset:function(t,e,i){var n,r,o,a,s,l,h,c=re.css(t,"position"),u=re(t),f={};"static"===c&&(t.style.position="relative"),s=u.offset(),o=re.css(t,"top"),l=re.css(t,"left"),h=("absolute"===c||"fixed"===c)&&re.inArray("auto",[o,l])>-1,h?(n=u.position(),a=n.top,r=n.left):(a=parseFloat(o)||0,r=parseFloat(l)||0),re.isFunction(e)&&(e=e.call(t,i,s)),null!=e.top&&(f.top=e.top-s.top+a),null!=e.left&&(f.left=e.left-s.left+r),"using"in e?e.using.call(t,f):u.css(f)}},re.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){re.offset.setOffset(this,t,e)});var e,i,n={top:0,left:0},r=this[0],o=r&&r.ownerDocument;if(o)return e=o.documentElement,re.contains(e,r)?(typeof r.getBoundingClientRect!==xe&&(n=r.getBoundingClientRect()),i=$(o),{top:n.top+(i.pageYOffset||e.scrollTop)-(e.clientTop||0),left:n.left+(i.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):n},position:function(){if(this[0]){var t,e,i={top:0,left:0},n=this[0];return"fixed"===re.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),re.nodeName(t[0],"html")||(i=t.offset()),i.top+=re.css(t[0],"borderTopWidth",!0),i.left+=re.css(t[0],"borderLeftWidth",!0)),{top:e.top-i.top-re.css(n,"marginTop",!0),left:e.left-i.left-re.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||rn;t&&!re.nodeName(t,"html")&&"static"===re.css(t,"position");)t=t.offsetParent;return t||rn})}}),re.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i=/Y/.test(e);re.fn[t]=function(n){return Ce(this,function(t,n,r){var o=$(t);return void 0===r?o?e in o?o[e]:o.document.documentElement[n]:t[n]:void(o?o.scrollTo(i?re(o).scrollLeft():r,i?r:re(o).scrollTop()):t[n]=r)},t,n,arguments.length,null)}}),re.each(["top","left"],function(t,e){re.cssHooks[e]=_(ie.pixelPosition,function(t,i){return i?(i=ei(t,e),ni.test(i)?re(t).position()[e]+"px":i):void 0})}),re.each({Height:"height",Width:"width"},function(t,e){re.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){re.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||r===!0?"margin":"border");return Ce(this,function(e,i,n){var r;return re.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===n?re.css(e,i,a):re.style(e,i,n,a)},e,o?n:void 0,o,null)}})}),re.fn.size=function(){return this.length},re.fn.andSelf=re.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return re});var on=t.jQuery,an=t.$;return re.noConflict=function(e){return t.$===re&&(t.$=an),e&&t.jQuery===re&&(t.jQuery=on),re},typeof e===xe&&(t.jQuery=t.$=re),re}),function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,n=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),i=t("meta[name=csrf-param]").attr("content");t('form input[name="'+i+'"]').val(e)},fire:function(e,i,n){var r=t.Event(i);return e.trigger(r,n),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},handleRemote:function(n){var r,o,a,s,l,h;if(i.fire(n,"ajax:before")){if(s=n.data("with-credentials")||null,l=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.attr("method"),o=n.attr("action"),a=n.serializeArray();var c=n.data("ujs:submit-button");c&&(a.push(c),n.data("ujs:submit-button",null))}else n.is(i.inputChangeSelector)?(r=n.data("method"),o=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(r=n.data("method")||"get",o=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):(r=n.data("method"),o=i.href(n),a=n.data("params")||null);return h={type:r||"GET",data:a,dataType:l,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),i.fire(n,"ajax:beforeSend",[t,r])?void n.trigger("ajax:send",t):!1},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:i.isCrossDomain(o)},s&&(h.xhrFields={withCredentials:s}),o&&(h.url=o),i.ajax(h)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var i=document.createElement("a");try{return i.href=t,i.href=i.href,!i.protocol||!i.host||e.protocol+"//"+e.host!=i.protocol+"//"+i.host}catch(n){return!0}},handleMethod:function(n){var r=i.href(n),o=n.data("method"),a=n.attr("target"),s=t("meta[name=csrf-token]").attr("content"),l=t("meta[name=csrf-param]").attr("content"),h=t('<form method="post" action="'+r+'"></form>'),c='<input name="_method" value="'+o+'" type="hidden" />';l===e||s===e||i.isCrossDomain(r)||(c+='<input name="'+l+'" value="'+s+'" type="hidden" />'),a&&h.attr("target",a),h.hide().append(c).appendTo("body"),h.submit()},formElements:function(e,i){return e.is("form")?t(e[0].elements).filter(i):e.find(i)},disableFormElements:function(e){i.formElements(e,i.disableSelector).each(function(){i.disableFormElement(t(this))})},disableFormElement:function(t){var i,n;i=t.is("button")?"html":"val",n=t.data("disable-with"),t.data("ujs:enable-with",t[i]()),n!==e&&t[i](n),t.prop("disabled",!0)},enableFormElements:function(e){i.formElements(e,i.enableSelector).each(function(){i.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,n=t.data("confirm"),r=!1;return n?(i.fire(t,"confirm")&&(r=i.confirm(n),e=i.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,i,n){var r,o,a=t(),s=i||"input,textarea",l=e.find(s);return l.each(function(){if(r=t(this),o=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):r.val(),!o==!n){if(r.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+r.attr("name")+'"]').length)return!0;a=a.add(r)}}),a.length?a:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var n=t.data("disable-with");t.data("ujs:enable-with",t.html()),n!==e&&t.html(n),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},i.fire(n,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),n.delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),n.delegate(i.buttonDisableSelector,"ajax:complete",function(){i.enableFormElement(t(this))}),n.delegate(i.linkClickSelector,"click.rails",function(n){var r=t(this),o=r.data("method"),a=r.data("params"),s=n.metaKey||n.ctrlKey;if(!i.allowAction(r))return i.stopEverything(n);if(!s&&r.is(i.linkDisableSelector)&&i.disableElement(r),r.data("remote")!==e){if(s&&(!o||"GET"===o)&&!a)return!0;var l=i.handleRemote(r);return l===!1?i.enableElement(r):l.fail(function(){i.enableElement(r)}),!1}return o?(i.handleMethod(r),!1):void 0}),n.delegate(i.buttonClickSelector,"click.rails",function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var r=i.handleRemote(n);return r===!1?i.enableFormElement(n):r.fail(function(){i.enableFormElement(n)}),!1}),n.delegate(i.inputChangeSelector,"change.rails",function(e){var n=t(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),n.delegate(i.formSubmitSelector,"submit.rails",function(n){var r,o,a=t(this),s=a.data("remote")!==e;if(!i.allowAction(a))return i.stopEverything(n);if(a.attr("novalidate")==e&&(r=i.blankInputs(a,i.requiredInputSelector),r&&i.fire(a,"ajax:aborted:required",[r])))return i.stopEverything(n);if(s){if(o=i.nonBlankInputs(a,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(a)},13);var l=i.fire(a,"ajax:aborted:file",[o]);return l||setTimeout(function(){i.enableFormElements(a)},13),l}return i.handleRemote(a),!1}setTimeout(function(){i.disableFormElements(a)},13)}),n.delegate(i.formInputClickSelector,"click.rails",function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),o=r?{name:r,value:n.val()}:null;n.closest("form").data("ujs:submit-button",o)}),n.delegate(i.formSubmitSelector,"ajax:send.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),n.delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),function(){var t,e,i,n,r,o,a,s,l,h,c,u,f,d,p,m,E,g,v,y,T,b,R,x,w,H,_,S,M,C,A,k,L,N,P,F,D,z,V,I,B,U,O,j,W,G,X,$,q,Y,Q,Z,K,J,te,ee,ie=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},ne=function(t,e){function i(){this.constructor=t}for(var n in e)re.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},re={}.hasOwnProperty,oe=[].slice,ae=function(t,e){return function(){return t.apply(e,arguments)}};N={},f=10,Z=!1,V=null,v=null,k=null,U=null,ee=null,n={BEFORE_CHANGE:"page:before-change",FETCH:"page:fetch",RECEIVE:"page:receive",CHANGE:"page:change",UPDATE:"page:update",LOAD:"page:load",RESTORE:"page:restore",BEFORE_UNLOAD:"page:before-unload",EXPIRE:"page:expire"},x=function(t){var e;return t=new i(t),X(),u(),null!=V&&V.start(),Z&&(e=K(t.absolute))?(w(e),H(t,null,!1)):H(t,Y)},K=function(t){var e;return e=N[t],e&&!e.transitionCacheDisabled?e:void 0},T=function(t){return null==t&&(t=!0),Z=t},y=function(t){return null==t&&(t=!0),h?t?null!=V?V:V=new o("html"):(null!=V&&V.uninstall(),V=null):void 0},H=function(t,e,i){return null==i&&(i=!0),J(n.FETCH,{url:t.absolute}),null!=ee&&ee.abort(),ee=new XMLHttpRequest,ee.open("GET",t.withoutHashForIE10compatibility(),!0),ee.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),ee.setRequestHeader("X-XHR-Referer",U),ee.onload=function(){var i;return J(n.RECEIVE,{url:t.absolute}),(i=z())?(O(t),j(),d.apply(null,R(i)),L(),"function"==typeof e&&e(),J(n.LOAD)):document.location.href=g()||t.absolute},V&&i&&(ee.onprogress=function(){return function(t){var e;return e=t.lengthComputable?t.loaded/t.total*100:V.value+(100-V.value)/10,V.advanceTo(e)}}(this)),ee.onloadend=function(){return ee=null},ee.onerror=function(){return document.location.href=t.absolute},ee.send()},w=function(t){return null!=ee&&ee.abort(),d(t.title,t.body),I(t),J(n.RESTORE)},u=function(){var t;return t=new i(v.url),N[t.absolute]={url:t.relative,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},m(f)},F=function(t){return null==t&&(t=f),/^[\d]+$/.test(t)?f=parseInt(t):void 0},m=function(t){var e,i,r,o,a,s;for(a=Object.keys(N),e=a.map(function(t){return N[t].cachedAt}).sort(function(t,e){return e-t}),s=[],i=0,o=a.length;o>i;i++)r=a[i],N[r].cachedAt<=e[t]&&(J(n.EXPIRE,N[r]),s.push(delete N[r]));return s},d=function(e,i,r,o){return J(n.BEFORE_UNLOAD),document.title=e,document.documentElement.replaceChild(i,document.body),null!=r&&t.update(r),Q(),o&&b(),v=window.history.state,null!=V&&V.done(),J(n.CHANGE),J(n.UPDATE)},b=function(){var t,e,i,n,r,o,a,s,l,h,c,u;for(u=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),i=0,r=u.length;r>i;i++)if(c=u[i],""===(l=c.type)||"text/javascript"===l){for(e=document.createElement("script"),h=c.attributes,n=0,o=h.length;o>n;n++)t=h[n],e.setAttribute(t.name,t.value);c.hasAttribute("async")||(e.async=!1),e.appendChild(document.createTextNode(c.innerHTML)),s=c.parentNode,a=c.nextSibling,s.removeChild(c),s.insertBefore(e,a)}},$=function(t){return t.innerHTML=t.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),t},Q=function(){var t,e;return t=(e=document.querySelectorAll("input[autofocus], textarea[autofocus]"))[e.length-1],t&&document.activeElement!==t?t.focus():void 0},O=function(t){return(t=new i(t)).absolute!==U?window.history.pushState({turbolinks:!0,url:t.absolute},"",t.absolute):void 0},j=function(){var t,e;return(t=ee.getResponseHeader("X-XHR-Redirected-To"))?(t=new i(t),e=t.hasNoHash()?document.location.hash:"",window.history.replaceState(window.history.state,"",t.href+e)):void 0},g=function(){var t;return null!=(t=ee.getResponseHeader("Location"))&&new i(t).crossOrigin()?t:void 0},X=function(){return U=document.location.href},G=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},W=function(){return v=window.history.state},L=function(){var t;return navigator.userAgent.match(/Firefox/)&&!(t=new i).hasNoHash()?(window.history.replaceState(v,"",t.withoutHash()),document.location.hash=t.hash):void 0},I=function(t){return window.scrollTo(t.positionX,t.positionY)},Y=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},p=function(t){var e,i,n;if(null==t||"object"!=typeof t)return t;e=new t.constructor;for(i in t)n=t[i],e[i]=p(n);return e},D=function(t){var e,i;return i=(null!=(e=document.cookie.match(new RegExp(t+"=(\\w+)")))?e[1].toUpperCase():void 0)||"",document.cookie=t+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",i},J=function(t,e){var i;return"undefined"!=typeof Prototype&&Event.fire(document,t,e,!0),i=document.createEvent("Events"),e&&(i.data=e),i.initEvent(t,!0,!0),document.dispatchEvent(i)},P=function(t){return!J(n.BEFORE_CHANGE,{url:t})},z=function(){var t,e,i,n,r,o;return e=function(){var t;return 400<=(t=ee.status)&&600>t},o=function(){var t;return null!=(t=ee.getResponseHeader("Content-Type"))&&t.match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},n=function(t){var e,i,n,r,o;for(r=t.querySelector("head").childNodes,o=[],e=0,i=r.length;i>e;e++)n=r[e],null!=("function"==typeof n.getAttribute?n.getAttribute("data-turbolinks-track"):void 0)&&o.push(n.getAttribute("src")||n.getAttribute("href"));return o},t=function(t){var e;return k||(k=n(document)),e=n(t),e.length!==k.length||r(e,k).length!==k.length},r=function(t,e){var i,n,r,o,a;for(t.length>e.length&&(r=[e,t],t=r[0],e=r[1]),o=[],i=0,n=t.length;n>i;i++)a=t[i],ie.call(e,a)>=0&&o.push(a);return o},!e()&&o()&&(i=E(ee.responseText),i&&!t(i))?i:void 0},R=function(e){var i;return i=e.querySelector("title"),[null!=i?i.textContent:void 0,$(e.querySelector("body")),t.get(e).token,"runScripts"]},t={get:function(t){var e;return null==t&&(t=document),{node:e=t.querySelector('meta[name="csrf-token"]'),token:null!=e&&"function"==typeof e.getAttribute?e.getAttribute("content"):void 0}},update:function(t){var e;return e=this.get(),null!=e.token&&null!=t&&e.token!==t?e.node.setAttribute("content",t):void 0}},E=function(t){var e;return e=document.documentElement.cloneNode(),e.innerHTML=t,e.head=e.querySelector("head"),e.body=e.querySelector("body"),e},i=function(){function t(e){return this.original=null!=e?e:document.location.href,this.original.constructor===t?this.original:void this._parse()}return t.prototype.withoutHash=function(){return this.href.replace(this.hash,"").replace("#","")},t.prototype.withoutHashForIE10compatibility=function(){return this.withoutHash()},t.prototype.hasNoHash=function(){return 0===this.hash.length},t.prototype.crossOrigin=function(){return this.origin!==(new t).origin},t.prototype._parse=function(){var t;return(null!=this.link?this.link:this.link=document.createElement("a")).href=this.original,t=this.link,this.href=t.href,this.protocol=t.protocol,this.host=t.host,this.hostname=t.hostname,this.port=t.port,this.pathname=t.pathname,this.search=t.search,this.hash=t.hash,this.origin=[this.protocol,"//",this.hostname].join(""),0!==this.port.length&&(this.origin+=":"+this.port),this.relative=[this.pathname,this.search,this.hash].join(""),this.absolute=this.href},t}(),r=function(t){function e(t){return this.link=t,this.link.constructor===e?this.link:(this.original=this.link.href,this.originalElement=this.link,this.link=this.link.cloneNode(!1),void e.__super__.constructor.apply(this,arguments))}return ne(e,t),e.HTML_EXTENSIONS=["html"],e.allowExtensions=function(){var t,i,n,r;for(i=1<=arguments.length?oe.call(arguments,0):[],n=0,r=i.length;r>n;n++)t=i[n],e.HTML_EXTENSIONS.push(t);return e.HTML_EXTENSIONS},e.prototype.shouldIgnore=function(){return this.crossOrigin()||this._anchored()||this._nonHtml()||this._optOut()||this._target()},e.prototype._anchored=function(){return(this.hash.length>0||"#"===this.href.charAt(this.href.length-1))&&this.withoutHash()===(new i).withoutHash()},e.prototype._nonHtml=function(){return this.pathname.match(/\.[a-z]+$/g)&&!this.pathname.match(new RegExp("\\.(?:"+e.HTML_EXTENSIONS.join("|")+")?$","g"))},e.prototype._optOut=function(){var t,e;for(e=this.originalElement;!t&&e!==document;)t=null!=e.getAttribute("data-no-turbolink"),e=e.parentNode;return t},e.prototype._target=function(){return 0!==this.link.target.length},e}(i),e=function(){function t(t){this.event=t,this.event.defaultPrevented||(this._extractLink(),this._validForTurbolinks()&&(P(this.link.absolute)||te(this.link.href),this.event.preventDefault()))}return t.installHandlerLast=function(e){return e.defaultPrevented?void 0:(document.removeEventListener("click",t.handle,!1),document.addEventListener("click",t.handle,!1))},t.handle=function(e){return new t(e)},t.prototype._extractLink=function(){var t;for(t=this.event.target;t.parentNode&&"A"!==t.nodeName;)t=t.parentNode;return"A"===t.nodeName&&0!==t.href.length?this.link=new r(t):void 0},t.prototype._validForTurbolinks=function(){return null!=this.link&&!(this.link.shouldIgnore()||this._nonStandardClick())},t.prototype._nonStandardClick=function(){return this.event.which>1||this.event.metaKey||this.event.ctrlKey||this.event.shiftKey||this.event.altKey},t}(),o=function(){function t(t){this.elementSelector=t,this._trickle=ae(this._trickle,this),this.value=0,this.content="",this.speed=300,this.opacity=.99,this.install()}var e;return e="turbolinks-progress-bar",t.prototype.install=function(){return this.element=document.querySelector(this.elementSelector),this.element.classList.add(e),this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement),this._updateStyle()},t.prototype.uninstall=function(){return this.element.classList.remove(e),document.head.removeChild(this.styleElement)
},t.prototype.start=function(){return this.advanceTo(5)},t.prototype.advanceTo=function(t){var e;if(t>(e=this.value)&&100>=e){if(this.value=t,this._updateStyle(),100===this.value)return this._stopTrickle();if(this.value>0)return this._startTrickle()}},t.prototype.done=function(){return this.value>0?(this.advanceTo(100),this._reset()):void 0},t.prototype._reset=function(){var t;return t=this.opacity,setTimeout(function(t){return function(){return t.opacity=0,t._updateStyle()}}(this),this.speed/2),setTimeout(function(e){return function(){return e.value=0,e.opacity=t,e._withSpeed(0,function(){return e._updateStyle(!0)})}}(this),this.speed)},t.prototype._startTrickle=function(){return this.trickling?void 0:(this.trickling=!0,setTimeout(this._trickle,this.speed))},t.prototype._stopTrickle=function(){return delete this.trickling},t.prototype._trickle=function(){return this.trickling?(this.advanceTo(this.value+Math.random()/2),setTimeout(this._trickle,this.speed)):void 0},t.prototype._withSpeed=function(t,e){var i,n;return i=this.speed,this.speed=t,n=e(),this.speed=i,n},t.prototype._updateStyle=function(t){return null==t&&(t=!1),t&&this._changeContentToForceRepaint(),this.styleElement.textContent=this._createCSSRule()},t.prototype._changeContentToForceRepaint=function(){return this.content=""===this.content?" ":""},t.prototype._createCSSRule=function(){return this.elementSelector+"."+e+"::before {\n  content: '"+this.content+"';\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 2000;\n  background-color: #0076ff;\n  height: 3px;\n  opacity: "+this.opacity+";\n  width: "+this.value+"%;\n  transition: width "+this.speed+"ms ease-out, opacity "+this.speed/2+"ms ease-in;\n  transform: translate3d(0,0,0);\n}"},t}(),c=function(t){return setTimeout(t,500)},M=function(){return document.addEventListener("DOMContentLoaded",function(){return J(n.CHANGE),J(n.UPDATE)},!0)},A=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(t,e){return jQuery.trim(e.responseText)?J(n.UPDATE):void 0}):void 0},C=function(t){var e,n;return(null!=(n=t.state)?n.turbolinks:void 0)?(e=N[new i(t.state.url).absolute])?(u(),w(e)):te(t.target.location.href):void 0},S=function(){return G(),W(),document.addEventListener("click",e.installHandlerLast,!0),window.addEventListener("hashchange",function(){return G(),W()},!1),c(function(){return window.addEventListener("popstate",C,!1)})},_=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),l=window.history&&window.history.pushState&&window.history.replaceState&&_,a=!navigator.userAgent.match(/CriOS\//),q="GET"===(B=D("request_method"))||""===B,h=l&&a&&q,s=document.addEventListener&&document.createEvent,s&&(M(),A()),h?(te=x,S()):te=function(t){return document.location.href=t},this.Turbolinks={visit:te,pagesCached:F,enableTransitionCache:T,enableProgressBar:y,allowLinkExtensions:r.allowExtensions,supported:h,EVENTS:p(n)}}.call(this);var THREE=THREE||{};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),THREE.Clock=function(t){this.autoStart=void 0!==t?t:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime+=this.getDelta(),this.elapsedTime},THREE.Clock.prototype.getDelta=function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=Date.now(),t=.001*(e-this.oldTime);this.oldTime=e,this.elapsedTime+=t}return t},THREE.Color=function(t){return void 0!==t&&this.setHex(t),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSV:function(t,e,i){var n,r,o;if(0===i)this.r=this.g=this.b=0;else switch(n=Math.floor(6*t),r=6*t-n,t=i*(1-e),o=i*(1-e*r),e=i*(1-e*(1-r)),n){case 1:this.r=o,this.g=i,this.b=t;break;case 2:this.r=t,this.g=i,this.b=e;break;case 3:this.r=t,this.g=o,this.b=i;break;case 4:this.r=e,this.g=t,this.b=i;break;case 5:this.r=i,this.g=t,this.b=o;break;case 6:case 0:this.r=i,this.g=e,this.b=t}return this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},getHex:function(){return~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(t,e){this.x=t||0,this.y=e||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t){return t.x===this.x&&t.y===this.y}},THREE.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideSelf:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},cross:function(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this},crossSelf:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){return(new THREE.Vector3).sub(this,t).lengthSq()},setPositionFromMatrix:function(t){this.x=t.n14,this.y=t.n24,this.z=t.n34},setRotationFromMatrix:function(t){var e=Math.cos(this.y);this.y=Math.asin(t.n13),Math.abs(e)>1e-5?(this.x=Math.atan2(-t.n23/e,t.n33/e),this.z=Math.atan2(-t.n12/e,t.n11/e)):(this.x=0,this.z=Math.atan2(t.n21,t.n22))},isZero:function(){return this.lengthSq()<1e-4}},THREE.Vector4=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},THREE.Ray=function(t,e){function i(t,e,i){return R.sub(i,t),u=R.dot(e),0>=u?null:(f=x.add(t,w.copy(e).multiplyScalar(u)),d=i.distanceTo(f))}function n(t,e,i,n){return R.sub(n,e),x.sub(i,e),w.sub(t,e),p=R.dot(R),m=R.dot(x),E=R.dot(w),g=x.dot(x),v=x.dot(w),y=1/(p*g-m*m),T=(g*E-m*v)*y,b=(p*v-m*E)*y,T>=0&&b>=0&&1>T+b}this.origin=t||new THREE.Vector3,this.direction=e||new THREE.Vector3,this.intersectScene=function(t){return this.intersectObjects(t.children)},this.intersectObjects=function(t){var e,i,n=[];for(e=0,i=t.length;i>e;e++)Array.prototype.push.apply(n,this.intersectObject(t[e]));return n.sort(function(t,e){return t.distance-e.distance}),n};var r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,e=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3;this.intersectObject=function(u){for(var f,d=[],p=0,m=u.children.length;m>p;p++)Array.prototype.push.apply(d,this.intersectObject(u.children[p]));if(u instanceof THREE.Particle){if(p=i(this.origin,this.direction,u.matrixWorld.getPosition()),null===p||p>u.scale.x)return[];f={distance:p,point:u.position,face:null,object:u},d.push(f)}else if(u instanceof THREE.Mesh){if(p=i(this.origin,this.direction,u.matrixWorld.getPosition()),null===p||p>u.geometry.boundingSphere.radius*Math.max(u.scale.x,Math.max(u.scale.y,u.scale.z)))return d;var E,g,v=u.geometry,y=v.vertices;for(u.matrixRotationWorld.extractRotation(u.matrixWorld),p=0,m=v.faces.length;m>p;p++)f=v.faces[p],t.copy(this.origin),e.copy(this.direction),g=u.matrixWorld,l=g.multiplyVector3(l.copy(f.centroid)).subSelf(t),E=l.dot(e),0>=E||(r=g.multiplyVector3(r.copy(y[f.a].position)),o=g.multiplyVector3(o.copy(y[f.b].position)),a=g.multiplyVector3(a.copy(y[f.c].position)),f instanceof THREE.Face4&&(s=g.multiplyVector3(s.copy(y[f.d].position))),h=u.matrixRotationWorld.multiplyVector3(h.copy(f.normal)),E=e.dot(h),!u.doubleSided&&!(u.flipSided?E>0:0>E))||(E=h.dot(l.sub(r,t))/E,c.add(t,e.multiplyScalar(E)),f instanceof THREE.Face3?n(c,r,o,a)&&(f={distance:t.distanceTo(c),point:c.clone(),face:f,object:u},d.push(f)):f instanceof THREE.Face4&&(n(c,r,o,s)||n(c,o,a,s))&&(f={distance:t.distanceTo(c),point:c.clone(),face:f,object:u},d.push(f)))}return d};var u,f,d,p,m,E,g,v,y,T,b,R=new THREE.Vector3,x=new THREE.Vector3,w=new THREE.Vector3},THREE.Rectangle=function(){function t(){o=n-e,a=r-i}var e,i,n,r,o,a,s=!0;this.getX=function(){return e},this.getY=function(){return i},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return e},this.getTop=function(){return i},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,a,l,h){s=!1,e=o,i=a,n=l,r=h,t()},this.addPoint=function(o,a){s?(s=!1,e=o,i=a,n=o,r=a):(e=o>e?e:o,i=a>i?i:a,n=n>o?n:o,r=r>a?r:a),t()},this.add3Points=function(o,a,l,h,c,u){s?(s=!1,e=l>o?c>o?o:c:c>l?l:c,i=h>a?u>a?a:u:u>h?h:u,n=o>l?o>c?o:c:l>c?l:c,r=a>h?a>u?a:u:h>u?h:u):(e=l>o?c>o?e>o?o:e:e>c?c:e:c>l?e>l?l:e:e>c?c:e,i=h>a?u>a?i>a?a:i:i>u?u:i:u>h?i>h?h:i:i>u?u:i,n=o>l?o>c?o>n?o:n:c>n?c:n:l>c?l>n?l:n:c>n?c:n,r=a>h?a>u?a>r?a:r:u>r?u:r:h>u?h>r?h:r:u>r?u:r),t()},this.addRectangle=function(o){s?(s=!1,e=o.getLeft(),i=o.getTop(),n=o.getRight(),r=o.getBottom()):(e=e<o.getLeft()?e:o.getLeft(),i=i<o.getTop()?i:o.getTop(),n=n>o.getRight()?n:o.getRight(),r=r>o.getBottom()?r:o.getBottom()),t()},this.inflate=function(o){e-=o,i-=o,n+=o,r+=o,t()},this.minSelf=function(o){e=e>o.getLeft()?e:o.getLeft(),i=i>o.getTop()?i:o.getTop(),n=n<o.getRight()?n:o.getRight(),r=r<o.getBottom()?r:o.getBottom(),t()},this.intersects=function(t){return Math.min(n,t.getRight())-Math.max(e,t.getLeft())>=0&&Math.min(r,t.getBottom())-Math.max(i,t.getTop())>=0},this.empty=function(){s=!0,r=n=i=e=0,t()},this.isEmpty=function(){return s}},THREE.Math={clamp:function(t,e,i){return e>t?e:t>i?i:t},clampBottom:function(t,e){return e>t?e:t},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var t,e=this.m;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},transposeIntoArray:function(t){var e=this.m;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}},THREE.Matrix4=function(t,e,i,n,r,o,a,s,l,h,c,u,f,d,p,m){this.set(void 0!==t?t:1,e||0,i||0,n||0,r||0,void 0!==o?o:1,a||0,s||0,l||0,h||0,void 0!==c?c:1,u||0,f||0,d||0,p||0,void 0!==m?m:1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,e,i,n,r,o,a,s,l,h,c,u,f,d,p,m){return this.n11=t,this.n12=e,this.n13=i,this.n14=n,this.n21=r,this.n22=o,this.n23=a,this.n24=s,this.n31=l,this.n32=h,this.n33=c,this.n34=u,this.n41=f,this.n42=d,this.n43=p,this.n44=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.set(t.n11,t.n12,t.n13,t.n14,t.n21,t.n22,t.n23,t.n24,t.n31,t.n32,t.n33,t.n34,t.n41,t.n42,t.n43,t.n44),this},lookAt:function(t,e,i){var n=THREE.Matrix4.__v1,r=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(t,e).normalize(),0===o.length()&&(o.z=1),n.cross(i,o).normalize(),0===n.length()&&(o.x+=1e-4,n.cross(i,o).normalize()),r.cross(o,n).normalize(),this.n11=n.x,this.n12=r.x,this.n13=o.x,this.n21=n.y,this.n22=r.y,this.n23=o.y,this.n31=n.z,this.n32=r.z,this.n33=o.z,this},multiply:function(t,e){var i=t.n11,n=t.n12,r=t.n13,o=t.n14,a=t.n21,s=t.n22,l=t.n23,h=t.n24,c=t.n31,u=t.n32,f=t.n33,d=t.n34,p=t.n41,m=t.n42,E=t.n43,g=t.n44,v=e.n11,y=e.n12,T=e.n13,b=e.n14,R=e.n21,x=e.n22,w=e.n23,H=e.n24,_=e.n31,S=e.n32,M=e.n33,C=e.n34,A=e.n41,k=e.n42,L=e.n43,N=e.n44;return this.n11=i*v+n*R+r*_+o*A,this.n12=i*y+n*x+r*S+o*k,this.n13=i*T+n*w+r*M+o*L,this.n14=i*b+n*H+r*C+o*N,this.n21=a*v+s*R+l*_+h*A,this.n22=a*y+s*x+l*S+h*k,this.n23=a*T+s*w+l*M+h*L,this.n24=a*b+s*H+l*C+h*N,this.n31=c*v+u*R+f*_+d*A,this.n32=c*y+u*x+f*S+d*k,this.n33=c*T+u*w+f*M+d*L,this.n34=c*b+u*H+f*C+d*N,this.n41=p*v+m*R+E*_+g*A,this.n42=p*y+m*x+E*S+g*k,this.n43=p*T+m*w+E*M+g*L,this.n44=p*b+m*H+E*C+g*N,this},multiplySelf:function(t){return this.multiply(this,t)},multiplyToArray:function(t,e,i){return this.multiply(t,e),i[0]=this.n11,i[1]=this.n21,i[2]=this.n31,i[3]=this.n41,i[4]=this.n12,i[5]=this.n22,i[6]=this.n32,i[7]=this.n42,i[8]=this.n13,i[9]=this.n23,i[10]=this.n33,i[11]=this.n43,i[12]=this.n14,i[13]=this.n24,i[14]=this.n34,i[15]=this.n44,this},multiplyScalar:function(t){return this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t,this},multiplyVector3:function(t){var e=t.x,i=t.y,n=t.z,r=1/(this.n41*e+this.n42*i+this.n43*n+this.n44);return t.x=(this.n11*e+this.n12*i+this.n13*n+this.n14)*r,t.y=(this.n21*e+this.n22*i+this.n23*n+this.n24)*r,t.z=(this.n31*e+this.n32*i+this.n33*n+this.n34)*r,t},multiplyVector4:function(t){var e=t.x,i=t.y,n=t.z,r=t.w;return t.x=this.n11*e+this.n12*i+this.n13*n+this.n14*r,t.y=this.n21*e+this.n22*i+this.n23*n+this.n24*r,t.z=this.n31*e+this.n32*i+this.n33*n+this.n34*r,t.w=this.n41*e+this.n42*i+this.n43*n+this.n44*r,t},rotateAxis:function(t){var e=t.x,i=t.y,n=t.z;return t.x=e*this.n11+i*this.n12+n*this.n13,t.y=e*this.n21+i*this.n22+n*this.n23,t.z=e*this.n31+i*this.n32+n*this.n33,t.normalize(),t},crossVector:function(t){var e=new THREE.Vector4;return e.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,e.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,e.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,e.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,e},determinant:function(){var t=this.n11,e=this.n12,i=this.n13,n=this.n14,r=this.n21,o=this.n22,a=this.n23,s=this.n24,l=this.n31,h=this.n32,c=this.n33,u=this.n34,f=this.n41,d=this.n42,p=this.n43,m=this.n44;return n*a*h*f-i*s*h*f-n*o*c*f+e*s*c*f+i*o*u*f-e*a*u*f-n*a*l*d+i*s*l*d+n*r*c*d-t*s*c*d-i*r*u*d+t*a*u*d+n*o*l*p-e*s*l*p-n*r*h*p+t*s*h*p+e*r*u*p-t*o*u*p-i*o*l*m+e*a*l*m+i*r*h*m-t*a*h*m-e*r*c*m+t*o*c*m},transpose:function(){var t;return t=this.n21,this.n21=this.n12,this.n12=t,t=this.n31,this.n31=this.n13,this.n13=t,t=this.n32,this.n32=this.n23,this.n23=t,t=this.n41,this.n41=this.n14,this.n14=t,t=this.n42,this.n42=this.n24,this.n24=t,t=this.n43,this.n43=this.n34,this.n43=t,this},clone:function(){var t=new THREE.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(t){return t[0]=this.n11,t[1]=this.n21,t[2]=this.n31,t[3]=this.n41,t[4]=this.n12,t[5]=this.n22,t[6]=this.n32,t[7]=this.n42,t[8]=this.n13,t[9]=this.n23,t[10]=this.n33,t[11]=this.n43,t[12]=this.n14,t[13]=this.n24,t[14]=this.n34,t[15]=this.n44,t},flattenToArrayOffset:function(t,e){return t[e]=this.n11,t[e+1]=this.n21,t[e+2]=this.n31,t[e+3]=this.n41,t[e+4]=this.n12,t[e+5]=this.n22,t[e+6]=this.n32,t[e+7]=this.n42,t[e+8]=this.n13,t[e+9]=this.n23,t[e+10]=this.n33,t[e+11]=this.n43,t[e+12]=this.n14,t[e+13]=this.n24,t[e+14]=this.n34,t[e+15]=this.n44,t},setTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},setScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},setRotationX:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},setRotationY:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},setRotationZ:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,a=t.y,s=t.z,l=r*o,h=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,h*a+i,h*s-n*o,0,l*s-n*a,h*s+n*o,r*s*s+i,0,0,0,0,1),this},setPosition:function(t){return this.n14=t.x,this.n24=t.y,this.n34=t.z,this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(t){var e=t.n11,i=t.n12,n=t.n13,r=t.n14,o=t.n21,a=t.n22,s=t.n23,l=t.n24,h=t.n31,c=t.n32,u=t.n33,f=t.n34,d=t.n41,p=t.n42,m=t.n43,E=t.n44;return this.n11=s*f*p-l*u*p+l*c*m-a*f*m-s*c*E+a*u*E,this.n12=r*u*p-n*f*p-r*c*m+i*f*m+n*c*E-i*u*E,this.n13=n*l*p-r*s*p+r*a*m-i*l*m-n*a*E+i*s*E,this.n14=r*s*c-n*l*c-r*a*u+i*l*u+n*a*f-i*s*f,this.n21=l*u*d-s*f*d-l*h*m+o*f*m+s*h*E-o*u*E,this.n22=n*f*d-r*u*d+r*h*m-e*f*m-n*h*E+e*u*E,this.n23=r*s*d-n*l*d-r*o*m+e*l*m+n*o*E-e*s*E,this.n24=n*l*h-r*s*h+r*o*u-e*l*u-n*o*f+e*s*f,this.n31=a*f*d-l*c*d+l*h*p-o*f*p-a*h*E+o*c*E,this.n32=r*c*d-i*f*d-r*h*p+e*f*p+i*h*E-e*c*E,this.n33=n*l*d-r*a*d+r*o*p-e*l*p-i*o*E+e*a*E,this.n34=r*a*h-i*l*h-r*o*c+e*l*c+i*o*f-e*a*f,this.n41=s*c*d-a*u*d-s*h*p+o*u*p+a*h*m-o*c*m,this.n42=i*u*d-n*c*d+n*h*p-e*u*p-i*h*m+e*c*m,this.n43=n*a*d-i*s*d-n*o*p+e*s*p+i*o*m-e*a*m,this.n44=i*s*h-n*a*h+n*o*c-e*s*c-i*o*u+e*a*u,this.multiplyScalar(1/t.determinant()),this},setRotationFromEuler:function(t,e){var i=t.x,n=t.y,r=t.z,o=Math.cos(i),i=Math.sin(i),a=Math.cos(n),n=Math.sin(n),s=Math.cos(r),r=Math.sin(r);switch(e){case"YXZ":var l=a*s,h=a*r,c=n*s,u=n*r;this.n11=l+u*i,this.n12=c*i-h,this.n13=o*n,this.n21=o*r,this.n22=o*s,this.n23=-i,this.n31=h*i-c,this.n32=u+l*i,this.n33=o*a;break;case"ZXY":l=a*s,h=a*r,c=n*s,u=n*r,this.n11=l-u*i,this.n12=-o*r,this.n13=c+h*i,this.n21=h+c*i,this.n22=o*s,this.n23=u-l*i,this.n31=-o*n,this.n32=i,this.n33=o*a;break;case"ZYX":l=o*s,h=o*r,c=i*s,u=i*r,this.n11=a*s,this.n12=c*n-h,this.n13=l*n+u,this.n21=a*r,this.n22=u*n+l,this.n23=h*n-c,this.n31=-n,this.n32=i*a,this.n33=o*a;break;case"YZX":l=o*a,h=o*n,c=i*a,u=i*n,this.n11=a*s,this.n12=u-l*r,this.n13=c*r+h,this.n21=r,this.n22=o*s,this.n23=-i*s,this.n31=-n*s,this.n32=h*r+c,this.n33=l-u*r;break;case"XZY":l=o*a,h=o*n,c=i*a,u=i*n,this.n11=a*s,this.n12=-r,this.n13=n*s,this.n21=l*r+u,this.n22=o*s,this.n23=h*r-c,this.n31=c*r-h,this.n32=i*s,this.n33=u*r+l;break;default:l=o*s,h=o*r,c=i*s,u=i*r,this.n11=a*s,this.n12=-a*r,this.n13=n,this.n21=h+c*n,this.n22=l-u*n,this.n23=-i*a,this.n31=u-l*n,this.n32=c+h*n,this.n33=o*a}return this},setRotationFromQuaternion:function(t){var e=t.x,i=t.y,n=t.z,r=t.w,o=e+e,a=i+i,s=n+n,t=e*o,l=e*a;e*=s;var h=i*a;return i*=s,n*=s,o*=r,a*=r,r*=s,this.n11=1-(h+n),this.n12=l-r,this.n13=e+a,this.n21=l+r,this.n22=1-(t+n),this.n23=i-o,this.n31=e-a,this.n32=i+o,this.n33=1-(t+h),this},scale:function(t){var e=t.x,i=t.y,t=t.z;return this.n11*=e,this.n12*=i,this.n13*=t,this.n21*=e,this.n22*=i,this.n23*=t,this.n31*=e,this.n32*=i,this.n33*=t,this.n41*=e,this.n42*=i,this.n43*=t,this},compose:function(t,e,i){var n=THREE.Matrix4.__m1,r=THREE.Matrix4.__m2;return n.identity(),n.setRotationFromQuaternion(e),r.setScale(i.x,i.y,i.z),this.multiply(n,r),this.n14=t.x,this.n24=t.y,this.n34=t.z,this},decompose:function(t,e,i){var n=THREE.Matrix4.__v1,r=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return n.set(this.n11,this.n21,this.n31),r.set(this.n12,this.n22,this.n32),o.set(this.n13,this.n23,this.n33),t=t instanceof THREE.Vector3?t:new THREE.Vector3,e=e instanceof THREE.Quaternion?e:new THREE.Quaternion,i=i instanceof THREE.Vector3?i:new THREE.Vector3,i.x=n.length(),i.y=r.length(),i.z=o.length(),t.x=this.n14,t.y=this.n24,t.z=this.n34,n=THREE.Matrix4.__m1,n.copy(this),n.n11/=i.x,n.n21/=i.x,n.n31/=i.x,n.n12/=i.y,n.n22/=i.y,n.n32/=i.y,n.n13/=i.z,n.n23/=i.z,n.n33/=i.z,e.setFromRotationMatrix(n),[t,e,i]},extractPosition:function(t){return this.n14=t.n14,this.n24=t.n24,this.n34=t.n34,this},extractRotation:function(t){var e=THREE.Matrix4.__v1,i=1/e.set(t.n11,t.n21,t.n31).length(),n=1/e.set(t.n12,t.n22,t.n32).length(),e=1/e.set(t.n13,t.n23,t.n33).length();return this.n11=t.n11*i,this.n21=t.n21*i,this.n31=t.n31*i,this.n12=t.n12*n,this.n22=t.n22*n,this.n32=t.n32*n,this.n13=t.n13*e,this.n23=t.n23*e,this.n33=t.n33*e,this}},THREE.Matrix4.makeInvert3x3=function(t){var e=t.m33,i=e.m,n=t.n33*t.n22-t.n32*t.n23,r=-t.n33*t.n21+t.n31*t.n23,o=t.n32*t.n21-t.n31*t.n22,a=-t.n33*t.n12+t.n32*t.n13,s=t.n33*t.n11-t.n31*t.n13,l=-t.n32*t.n11+t.n31*t.n12,h=t.n23*t.n12-t.n22*t.n13,c=-t.n23*t.n11+t.n21*t.n13,u=t.n22*t.n11-t.n21*t.n12,t=t.n11*n+t.n21*a+t.n31*h;return 0===t&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),t=1/t,i[0]=t*n,i[1]=t*r,i[2]=t*o,i[3]=t*a,i[4]=t*s,i[5]=t*l,i[6]=t*h,i[7]=t*c,i[8]=t*u,e},THREE.Matrix4.makeFrustum=function(t,e,i,n,r,o){var a;return a=new THREE.Matrix4,a.n11=2*r/(e-t),a.n12=0,a.n13=(e+t)/(e-t),a.n14=0,a.n21=0,a.n22=2*r/(n-i),a.n23=(n+i)/(n-i),a.n24=0,a.n31=0,a.n32=0,a.n33=-(o+r)/(o-r),a.n34=-2*o*r/(o-r),a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},THREE.Matrix4.makePerspective=function(t,e,i,n){var r,t=i*Math.tan(t*Math.PI/360);return r=-t,THREE.Matrix4.makeFrustum(r*e,t*e,r,t,i,n)},THREE.Matrix4.makeOrtho=function(t,e,i,n,r,o){var a,s,l,h;return a=new THREE.Matrix4,s=e-t,l=i-n,h=o-r,a.n11=2/s,a.n12=0,a.n13=0,a.n14=-((e+t)/s),a.n21=0,a.n22=2/l,a.n23=0,a.n24=-((i+n)/l),a.n31=0,a.n32=0,a.n33=-2/h,a.n34=-((o+r)/h),a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.name="",this.id=THREE.Object3DCount++,this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(t,e){this.matrix.rotateAxis(e),this.position.addSelf(e.multiplyScalar(t))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},lookAt:function(t){this.matrix.lookAt(t,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(t){if(-1===this.children.indexOf(t)){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);for(var e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof THREE.Scene&&e.addObject(t)}},remove:function(t){var e=this.children.indexOf(t);if(-1!==e){for(t.parent=void 0,this.children.splice(e,1),e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof THREE.Scene&&e.removeObject(t)}},getChildByName:function(t,e){var i,n,r;for(i=0,n=this.children.length;n>i;i++){if(r=this.children[i],r.name===t)return r;if(e&&(r=r.getChildByName(t,e),void 0!==r))return r}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;i>e;e++)this.children[e].updateMatrixWorld(t)}},THREE.Object3DCount=0,THREE.Projector=function(){function t(){var t=m[o]=m[o]||new THREE.RenderableObject;return o++,t}function e(){var t=E[s]=E[s]||new THREE.RenderableVertex;return s++,t}function i(t,e){return e.z-t.z}function n(t,e){var i=0,n=1,r=t.z+t.w,o=e.z+e.w,a=-t.z+t.w,s=-e.z+e.w;return r>=0&&o>=0&&a>=0&&s>=0?!0:0>r&&0>o||0>a&&0>s?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(t.lerpSelf(e,i),e.lerpSelf(t,1-n),!0))}var r,o,a,s,l,h,c,u,f,d,p,m=[],E=[],g=[],v=[],y=[],T=[],b={objects:[],sprites:[],lights:[],elements:[]},R=new THREE.Vector3,x=new THREE.Vector4,w=new THREE.Matrix4,H=new THREE.Matrix4,_=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],S=new THREE.Vector4,M=new THREE.Vector4;this.computeFrustum=function(t){for(_[0].set(t.n41-t.n11,t.n42-t.n12,t.n43-t.n13,t.n44-t.n14),_[1].set(t.n41+t.n11,t.n42+t.n12,t.n43+t.n13,t.n44+t.n14),_[2].set(t.n41+t.n21,t.n42+t.n22,t.n43+t.n23,t.n44+t.n24),_[3].set(t.n41-t.n21,t.n42-t.n22,t.n43-t.n23,t.n44-t.n24),_[4].set(t.n41-t.n31,t.n42-t.n32,t.n43-t.n33,t.n44-t.n34),_[5].set(t.n41+t.n31,t.n42+t.n32,t.n43+t.n33,t.n44+t.n34),t=0;6>t;t++){var e=_[t];e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))}},this.projectVector=function(t,e){return e.matrixWorldInverse.getInverse(e.matrixWorld),w.multiply(e.projectionMatrix,e.matrixWorldInverse),w.multiplyVector3(t),t},this.unprojectVector=function(t,e){return e.projectionMatrixInverse.getInverse(e.projectionMatrix),w.multiply(e.matrixWorld,e.projectionMatrixInverse),w.multiplyVector3(t),t},this.pickingRay=function(t,e){var i;return t.z=-1,i=new THREE.Vector3(t.x,t.y,1),this.unprojectVector(t,e),this.unprojectVector(i,e),i.subSelf(t).normalize(),new THREE.Ray(t,i)},this.projectGraph=function(e,n){o=0,b.objects.length=0,b.sprites.length=0,b.lights.length=0;var a=function(e){if(e.visible!==!1){var i;if((i=e instanceof THREE.Mesh||e instanceof THREE.Line)&&!(i=e.frustumCulled===!1))t:{for(var n=e.matrixWorld,o=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),s=0;6>s;s++)if(i=_[s].x*n.n14+_[s].y*n.n24+_[s].z*n.n34+_[s].w,o>=i){i=!1;break t}i=!0}for(i?(w.multiplyVector3(R.copy(e.position)),r=t(),r.object=e,r.z=R.z,b.objects.push(r)):e instanceof THREE.Sprite||e instanceof THREE.Particle?(w.multiplyVector3(R.copy(e.position)),r=t(),r.object=e,r.z=R.z,b.sprites.push(r)):e instanceof THREE.Light&&b.lights.push(e),i=0,n=e.children.length;n>i;i++)a(e.children[i])}};return a(e),n&&b.objects.sort(i),b},this.projectScene=function(t,r,o){var m,R,_,C,A,k,L,N,P,F,D,z,V,I,B,U,O=r.near,j=r.far;for(p=f=c=h=0,b.elements.length=0,void 0===r.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),t.add(r)),t.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),w.multiply(r.projectionMatrix,r.matrixWorldInverse),this.computeFrustum(w),b=this.projectGraph(t,!1),t=0,m=b.objects.length;m>t;t++)if(P=b.objects[t].object,F=P.matrixWorld,z=P.material,s=0,P instanceof THREE.Mesh){for(D=P.geometry,V=P.geometry.materials,C=D.vertices,I=D.faces,B=D.faceVertexUvs,D=P.matrixRotationWorld.extractRotation(F),R=0,_=C.length;_>R;R++)a=e(),a.positionWorld.copy(C[R].position),F.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),w.multiplyVector4(a.positionScreen),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.visible=a.positionScreen.z>O&&a.positionScreen.z<j;for(C=0,R=I.length;R>C;C++){if(_=I[C],_ instanceof THREE.Face3){if(A=E[_.a],k=E[_.b],L=E[_.c],!(A.visible&&k.visible&&L.visible)||!P.doubleSided&&P.flipSided==(L.positionScreen.x-A.positionScreen.x)*(k.positionScreen.y-A.positionScreen.y)-(L.positionScreen.y-A.positionScreen.y)*(k.positionScreen.x-A.positionScreen.x)<0)continue;N=g[h]=g[h]||new THREE.RenderableFace3,h++,l=N,l.v1.copy(A),l.v2.copy(k),l.v3.copy(L)}else if(_ instanceof THREE.Face4){if(A=E[_.a],k=E[_.b],L=E[_.c],N=E[_.d],!(A.visible&&k.visible&&L.visible&&N.visible)||!P.doubleSided&&P.flipSided==((N.positionScreen.x-A.positionScreen.x)*(k.positionScreen.y-A.positionScreen.y)-(N.positionScreen.y-A.positionScreen.y)*(k.positionScreen.x-A.positionScreen.x)<0||(k.positionScreen.x-L.positionScreen.x)*(N.positionScreen.y-L.positionScreen.y)-(k.positionScreen.y-L.positionScreen.y)*(N.positionScreen.x-L.positionScreen.x)<0))continue;U=v[c]=v[c]||new THREE.RenderableFace4,c++,l=U,l.v1.copy(A),l.v2.copy(k),l.v3.copy(L),l.v4.copy(N)}for(l.normalWorld.copy(_.normal),D.multiplyVector3(l.normalWorld),l.centroidWorld.copy(_.centroid),F.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),w.multiplyVector3(l.centroidScreen),L=_.vertexNormals,A=0,k=L.length;k>A;A++)N=l.vertexNormalsWorld[A],N.copy(L[A]),D.multiplyVector3(N);
for(A=0,k=B.length;k>A;A++)if(U=B[A][C])for(L=0,N=U.length;N>L;L++)l.uvs[A][L]=U[L];l.material=z,l.faceMaterial=null!==_.materialIndex?V[_.materialIndex]:null,l.z=l.centroidScreen.z,b.elements.push(l)}}else if(P instanceof THREE.Line)for(H.multiply(w,F),C=P.geometry.vertices,A=e(),A.positionScreen.copy(C[0].position),H.multiplyVector4(A.positionScreen),R=1,_=C.length;_>R;R++)A=e(),A.positionScreen.copy(C[R].position),H.multiplyVector4(A.positionScreen),k=E[s-2],S.copy(A.positionScreen),M.copy(k.positionScreen),n(S,M)&&(S.multiplyScalar(1/S.w),M.multiplyScalar(1/M.w),P=y[f]=y[f]||new THREE.RenderableLine,f++,u=P,u.v1.positionScreen.copy(S),u.v2.positionScreen.copy(M),u.z=Math.max(S.z,M.z),u.material=z,b.elements.push(u));for(t=0,m=b.sprites.length;m>t;t++)P=b.sprites[t].object,F=P.matrixWorld,P instanceof THREE.Particle&&(x.set(F.n14,F.n24,F.n34,1),w.multiplyVector4(x),x.z/=x.w,x.z>0&&x.z<1)&&(O=T[p]=T[p]||new THREE.RenderableParticle,p++,d=O,d.x=x.x/x.w,d.y=x.y/x.w,d.z=x.z,d.rotation=P.rotation.z,d.scale.x=P.scale.x*Math.abs(d.x-(x.x+r.projectionMatrix.n11)/(x.w+r.projectionMatrix.n14)),d.scale.y=P.scale.y*Math.abs(d.y-(x.y+r.projectionMatrix.n22)/(x.w+r.projectionMatrix.n24)),d.material=P.material,b.elements.push(d));return o&&b.elements.sort(i),b}},THREE.Quaternion=function(t,e,i,n){this.set(t||0,e||0,i||0,void 0!==n?n:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEuler:function(t){var e=Math.PI/360,i=t.x*e,n=t.y*e,r=t.z*e,t=Math.cos(n),n=Math.sin(n),e=Math.cos(-r),r=Math.sin(-r),o=Math.cos(i),i=Math.sin(i),a=t*e,s=n*r;return this.w=a*o-s*i,this.x=a*i+s*o,this.y=n*e*o+t*r*i,this.z=t*r*o-n*e*i,this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},setFromRotationMatrix:function(t){var e=Math.pow(t.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,e+t.n11+t.n22+t.n33))/2,this.x=Math.sqrt(Math.max(0,e+t.n11-t.n22-t.n33))/2,this.y=Math.sqrt(Math.max(0,e-t.n11+t.n22-t.n33))/2,this.z=Math.sqrt(Math.max(0,e-t.n11-t.n22+t.n33))/2,this.x=t.n32-t.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=t.n13-t.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=t.n21-t.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?this.w=this.z=this.y=this.x=0:(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},multiplySelf:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.x,a=t.y,s=t.z,t=t.w;return this.x=e*t+r*o+i*s-n*a,this.y=i*t+r*a+n*o-e*s,this.z=n*t+r*s+e*a-i*o,this.w=r*t-e*o-i*a-n*s,this},multiply:function(t,e){return this.x=t.x*e.w+t.y*e.z-t.z*e.y+t.w*e.x,this.y=-t.x*e.z+t.y*e.w+t.z*e.x+t.w*e.y,this.z=t.x*e.y-t.y*e.x+t.z*e.w+t.w*e.z,this.w=-t.x*e.x-t.y*e.y-t.z*e.z+t.w*e.w,this},multiplyVector3:function(t,e){e||(e=t);var i=t.x,n=t.y,r=t.z,o=this.x,a=this.y,s=this.z,l=this.w,h=l*i+a*r-s*n,c=l*n+s*i-o*r,u=l*r+o*n-a*i,i=-o*i-a*n-s*r;return e.x=h*l+i*-o+c*-s-u*-a,e.y=c*l+i*-a+u*-o-h*-s,e.z=u*l+i*-s+h*-a-c*-o,e}},THREE.Quaternion.slerp=function(t,e,i,n){var r=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(0>r?(i.w=-e.w,i.x=-e.x,i.y=-e.y,i.z=-e.z,r=-r):i.copy(e),Math.abs(r)>=1)return i.w=t.w,i.x=t.x,i.y=t.y,i.z=t.z,i;var o=Math.acos(r),r=Math.sqrt(1-r*r);return Math.abs(r)<.001?(i.w=.5*(t.w+e.w),i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i.z=.5*(t.z+e.z),i):(e=Math.sin((1-n)*o)/r,n=Math.sin(n*o)/r,i.w=t.w*e+i.w*n,i.x=t.x*e+i.x*n,i.y=t.y*e+i.y*n,i.z=t.z*e+i.z*n,i)},THREE.Vertex=function(t){this.position=t||new THREE.Vector3},THREE.Face3=function(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face4=function(t,e,i,n,r,o,a){this.a=t,this.b=e,this.c=i,this.d=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=a,this.centroid=new THREE.Vector3},THREE.UV=function(t,e){this.u=t||0,this.v=e||0},THREE.UV.prototype={constructor:THREE.UV,set:function(t,e){return this.u=t,this.v=e,this},copy:function(t){return this.u=t.u,this.v=t.v,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(t){var e=new THREE.Matrix4;e.extractRotation(t,new THREE.Vector3(1,1,1));for(var i=0,n=this.vertices.length;n>i;i++)t.multiplyVector3(this.vertices[i].position);for(i=0,n=this.faces.length;n>i;i++){var r=this.faces[i];e.multiplyVector3(r.normal);for(var o=0,a=r.vertexNormals.length;a>o;o++)e.multiplyVector3(r.vertexNormals[o]);t.multiplyVector3(r.centroid)}},computeCentroids:function(){var t,e,i;for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],i.centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.addSelf(this.vertices[i.d].position),i.centroid.divideScalar(4))},computeFaceNormals:function(){var t,e,i,n,r,o,a=new THREE.Vector3,s=new THREE.Vector3;for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],n=this.vertices[i.a],r=this.vertices[i.b],o=this.vertices[i.c],a.sub(o.position,r.position),s.sub(n.position,r.position),a.crossSelf(s),a.isZero()||a.normalize(),i.normal.copy(a)},computeVertexNormals:function(){var t,e,i,n;if(void 0===this.__tmpVertices){for(n=this.__tmpVertices=Array(this.vertices.length),t=0,e=this.vertices.length;e>t;t++)n[t]=new THREE.Vector3;for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],i instanceof THREE.Face3?i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:i instanceof THREE.Face4&&(i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(n=this.__tmpVertices,t=0,e=this.vertices.length;e>t;t++)n[t].set(0,0,0);for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],i instanceof THREE.Face3?(n[i.a].addSelf(i.normal),n[i.b].addSelf(i.normal),n[i.c].addSelf(i.normal)):i instanceof THREE.Face4&&(n[i.a].addSelf(i.normal),n[i.b].addSelf(i.normal),n[i.c].addSelf(i.normal),n[i.d].addSelf(i.normal));for(t=0,e=this.vertices.length;e>t;t++)n[t].normalize();for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],i instanceof THREE.Face3?(i.vertexNormals[0].copy(n[i.a]),i.vertexNormals[1].copy(n[i.b]),i.vertexNormals[2].copy(n[i.c])):i instanceof THREE.Face4&&(i.vertexNormals[0].copy(n[i.a]),i.vertexNormals[1].copy(n[i.b]),i.vertexNormals[2].copy(n[i.c]),i.vertexNormals[3].copy(n[i.d]))},computeTangents:function(){function t(t,e,i,n,r,o,w){s=t.vertices[e].position,l=t.vertices[i].position,h=t.vertices[n].position,c=a[r],u=a[o],f=a[w],d=l.x-s.x,p=h.x-s.x,m=l.y-s.y,E=h.y-s.y,g=l.z-s.z,v=h.z-s.z,y=u.u-c.u,T=f.u-c.u,b=u.v-c.v,R=f.v-c.v,x=1/(y*R-T*b),S.set((R*d-b*p)*x,(R*m-b*E)*x,(R*g-b*v)*x),M.set((y*p-T*d)*x,(y*E-T*m)*x,(y*v-T*g)*x),H[e].addSelf(S),H[i].addSelf(S),H[n].addSelf(S),_[e].addSelf(M),_[i].addSelf(M),_[n].addSelf(M)}var e,i,n,r,o,a,s,l,h,c,u,f,d,p,m,E,g,v,y,T,b,R,x,w,H=[],_=[],S=new THREE.Vector3,M=new THREE.Vector3,C=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Vector3;for(e=0,i=this.vertices.length;i>e;e++)H[e]=new THREE.Vector3,_[e]=new THREE.Vector3;for(e=0,i=this.faces.length;i>e;e++)o=this.faces[e],a=this.faceVertexUvs[0][e],o instanceof THREE.Face3?t(this,o.a,o.b,o.c,0,1,2):o instanceof THREE.Face4&&(t(this,o.a,o.b,o.c,0,1,2),t(this,o.a,o.b,o.d,0,1,3));var L=["a","b","c","d"];for(e=0,i=this.faces.length;i>e;e++)for(o=this.faces[e],n=0;n<o.vertexNormals.length;n++)k.copy(o.vertexNormals[n]),r=o[L[n]],w=H[r],C.copy(w),C.subSelf(k.multiplyScalar(k.dot(w))).normalize(),A.cross(o.vertexNormals[n],w),r=A.dot(_[r]),r=0>r?-1:1,o.vertexTangents[n]=new THREE.Vector4(C.x,C.y,C.z,r);this.hasTangents=!0},computeBoundingBox:function(){var t;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,i=this.vertices.length;i>e;e++)t=this.vertices[e],t.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=t.position.x:t.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=t.position.x),t.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=t.position.y:t.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=t.position.y),t.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=t.position.z:t.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=t.position.z)}},computeBoundingSphere:function(){for(var t=0,e=0,i=this.vertices.length;i>e;e++)t=Math.max(t,this.vertices[e].position.length());this.boundingSphere={radius:t}},mergeVertices:function(){var t,e,i,n={},r=[],o=[],a=Math.pow(10,4);for(e=0,i=this.vertices.length;i>e;e++)t=this.vertices[e].position,t=[Math.round(t.x*a),Math.round(t.y*a),Math.round(t.z*a)].join("_"),void 0===n[t]?(n[t]=e,r.push(this.vertices[e]),o[e]=r.length-1):o[e]=o[n[t]];for(e=0,i=this.faces.length;i>e;e++)n=this.faces[e],n instanceof THREE.Face3?(n.a=o[n.a],n.b=o[n.b],n.c=o[n.c]):n instanceof THREE.Face4&&(n.a=o[n.a],n.b=o[n.b],n.c=o[n.c],n.d=o[n.d]);this.vertices=r}},THREE.GeometryCount=0,THREE.Spline=function(t){function e(t,e,i,n,r,o,a){return t=.5*(i-t),n=.5*(n-e),(2*(e-i)+t+n)*a+(-3*(e-i)-2*t-n)*o+t*r+e}this.points=t;var i,n,r,o,a,s,l,h,c,u=[],f={x:0,y:0,z:0};this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}},this.getPoint=function(t){return i=(this.points.length-1)*t,n=Math.floor(i),r=i-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?n:n+1,u[3]=n>this.points.length-3?n:n+2,s=this.points[u[0]],l=this.points[u[1]],h=this.points[u[2]],c=this.points[u[3]],o=r*r,a=r*o,f.x=e(s.x,l.x,h.x,c.x,r,o,a),f.y=e(s.y,l.y,h.y,c.y,r,o,a),f.z=e(s.z,l.z,h.z,c.z,r,o,a),f},this.getControlPointsArray=function(){var t,e,i=this.points.length,n=[];for(t=0;i>t;t++)e=this.points[t],n[t]=[e.x,e.y,e.z];return n},this.getLength=function(t){var e,i,n,r=e=e=0,o=new THREE.Vector3,a=new THREE.Vector3,s=[],l=0;for(s[0]=0,t||(t=100),i=this.points.length*t,o.copy(this.points[0]),t=1;i>t;t++)e=t/i,n=this.getPoint(e),a.copy(n),l+=a.distanceTo(o),o.copy(n),e*=this.points.length-1,e=Math.floor(e),e!=r&&(s[e]=l,r=e);return s[s.length]=l,{chunks:s,total:l}},this.reparametrizeByArcLength=function(t){var e,i,n,r,o,a,s=[],l=new THREE.Vector3,h=this.getLength();for(s.push(l.copy(this.points[0]).clone()),e=1;e<this.points.length;e++){for(i=h.chunks[e]-h.chunks[e-1],a=Math.ceil(t*i/h.total),r=(e-1)/(this.points.length-1),o=e/(this.points.length-1),i=1;a-1>i;i++)n=r+i*(1/a)*(o-r),n=this.getPoint(n),s.push(l.copy(n).clone());s.push(l.copy(this.points[e]).clone())}this.points=s}},THREE.Edge=function(t,e,i,n){this.vertices=[t,e],this.vertexIndices=[i,n],this.faces=[],this.faceIndices=[]},THREE.Camera=function(){return arguments.length?(console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])):(THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,void(this.projectionMatrixInverse=new THREE.Matrix4))},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(t,e,i,n,r,o){THREE.Camera.call(this),this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(t,e,i,n){THREE.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(t,e){this.fov=2*Math.atan((void 0!==e?e:43.25)/(2*t)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(t,e,i,n,r,o){this.fullWidth=t,this.fullHeight=e,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,e=Math.tan(this.fov*Math.PI/360)*this.near,i=-e,n=t*i,t=Math.abs(t*e-n),i=Math.abs(e-i);this.projectionMatrix=THREE.Matrix4.makeFrustum(n+this.x*t/this.fullWidth,n+(this.x+this.width)*t/this.fullWidth,e-(this.y+this.height)*i/this.fullHeight,e-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(t){THREE.Object3D.call(this),this.color=new THREE.Color(t)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(t,e,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(t,e,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(t,e,i,n){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0,this.castShadow=void 0!==n?n:!1},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Material=function(t){this.name="",this.id=THREE.MaterialCount++,t=t||{},this.opacity=void 0!==t.opacity?t.opacity:1,this.transparent=void 0!==t.transparent?t.transparent:!1,this.blending=void 0!==t.blending?t.blending:THREE.NormalBlending,this.depthTest=void 0!==t.depthTest?t.depthTest:!0,this.depthWrite=void 0!==t.depthWrite?t.depthWrite:!0,this.polygonOffset=void 0!==t.polygonOffset?t.polygonOffset:!1,this.polygonOffsetFactor=void 0!==t.polygonOffsetFactor?t.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==t.polygonOffsetUnits?t.polygonOffsetUnits:0,this.alphaTest=void 0!==t.alphaTest?t.alphaTest:0,this.overdraw=void 0!==t.overdraw?t.overdraw:!1},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.LineBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.linewidth=void 0!==t.linewidth?t.linewidth:1,this.linecap=void 0!==t.linecap?t.linecap:"round",this.linejoin=void 0!==t.linejoin?t.linejoin:"round",this.vertexColors=t.vertexColors?t.vertexColors:!1,this.fog=void 0!==t.fog?t.fog:!0},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0!==t.fog?t.fog:!0,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe?t.wireframe:!1,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors?t.vertexColors:!1,this.skinning=void 0!==t.skinning?t.skinning:!1,this.morphTargets=void 0!==t.morphTargets?t.morphTargets:!1},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.ambient=new THREE.Color(void 0!==t.ambient?t.ambient:328965),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0!==t.fog?t.fog:!0,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe?t.wireframe:!1,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors?t.vertexColors:!1,this.skinning=void 0!==t.skinning?t.skinning:!1,this.morphTargets=void 0!==t.morphTargets?t.morphTargets:!1},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.ambient=new THREE.Color(void 0!==t.ambient?t.ambient:328965),this.specular=new THREE.Color(void 0!==t.specular?t.specular:1118481),this.shininess=void 0!==t.shininess?t.shininess:30,this.metal=void 0!==t.metal?t.metal:!1,this.perPixel=void 0!==t.perPixel?t.perPixel:!1,this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0!==t.fog?t.fog:!0,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe?t.wireframe:!1,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors?t.vertexColors:!1,this.skinning=void 0!==t.skinning?t.skinning:!1,this.morphTargets=void 0!==t.morphTargets?t.morphTargets:!1},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe?t.wireframe:!1,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.shading=t.shading?t.shading:THREE.FlatShading,this.wireframe=t.wireframe?t.wireframe:!1,this.wireframeLinewidth=t.wireframeLinewidth?t.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.MeshShaderMaterial=function(t){return console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial()."),new THREE.ShaderMaterial(t)},THREE.ParticleBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.map=void 0!==t.map?t.map:null,this.size=void 0!==t.size?t.size:1,this.sizeAttenuation=void 0!==t.sizeAttenuation?t.sizeAttenuation:!0,this.vertexColors=void 0!==t.vertexColors?t.vertexColors:!1,this.fog=void 0!==t.fog?t.fog:!0},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.program=void 0!==t.program?t.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(t){THREE.Material.call(this),this.domElement=t},THREE.ShaderMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.fragmentShader=void 0!==t.fragmentShader?t.fragmentShader:"void main() {}",this.vertexShader=void 0!==t.vertexShader?t.vertexShader:"void main() {}",this.uniforms=void 0!==t.uniforms?t.uniforms:{},this.attributes=t.attributes,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe?t.wireframe:!1,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.fog=void 0!==t.fog?t.fog:!1,this.lights=void 0!==t.lights?t.lights:!1,this.vertexColors=void 0!==t.vertexColors?t.vertexColors:!1,this.skinning=void 0!==t.skinning?t.skinning:!1,this.morphTargets=void 0!==t.morphTargets?t.morphTargets:!1},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(t,e,i,n,r,o){this.id=THREE.TextureCount++,this.image=t,this.mapping=void 0!==e?e:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var t=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return t.offset.copy(this.offset),t.repeat.copy(this.repeat),t}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(t,e,i,n,r,o,a,s,l){THREE.Texture.call(this,null,r,o,a,s,l),this.image={data:t,width:e,height:i},this.format=void 0!==n?n:THREE.RGBAFormat},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var t=new THREE.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return t.offset.copy(this.offset),t.repeat.copy(this.repeat),t},THREE.Particle=function(t){THREE.Object3D.call(this),this.material=t},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(t,e){THREE.Object3D.call(this),this.geometry=t,this.material=e,this.sortParticles=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(t,e,i){THREE.Object3D.call(this),this.geometry=t,this.material=e,this.type=void 0!==i?i:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(t,e){if(THREE.Object3D.call(this),this.geometry=t,this.material=e,e instanceof Array&&(console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=e[0]),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=t.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0;i<this.geometry.morphTargets.length;i++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},THREE.Bone=function(t){THREE.Object3D.call(this),this.skin=t,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(t,e){this.matrixAutoUpdate&&(e|=this.updateMatrix()),(e||this.matrixWorldNeedsUpdate)&&(t?this.skinMatrix.multiply(t,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,e)},THREE.SkinnedMesh=function(t,e){THREE.Mesh.call(this,t,e),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var i,n,r,o,a,s;if(void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)r=this.geometry.bones[i],o=r.pos,a=r.rotq,s=r.scl,n=this.addBone(),n.name=r.name,n.position.set(o[0],o[1],o[2]),n.quaternion.set(a[0],a[1],a[2],a[3]),n.useQuaternion=!0,void 0!==s?n.scale.set(s[0],s[1],s[2]):n.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)r=this.geometry.bones[i],n=this.bones[i],-1===r.parent?this.add(n):this.bones[r.parent].add(n);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.addBone=function(t){return void 0===t&&(t=new THREE.Bone(this)),this.bones.push(t),t},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var t=0,e=this.children.length;e>t;t++){var i=this.children[t];i instanceof THREE.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}for(var e=this.bones.length,i=this.bones,n=this.boneMatrices,t=0;e>t;t++)i[t].skinMatrix.flattenToArrayOffset(n,16*t)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var t,e=[],i=0;i<this.bones.length;i++){t=this.bones[i];var n=new THREE.Matrix4;n.getInverse(t.skinMatrix),e.push(n),t.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*i)}if(void 0===this.geometry.skinVerticesA)for(this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[],t=0;t<this.geometry.skinIndices.length;t++){var i=this.geometry.vertices[t].position,r=this.geometry.skinIndices[t].x,o=this.geometry.skinIndices[t].y,n=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesA.push(e[r].multiplyVector3(n)),n=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesB.push(e[o].multiplyVector3(n)),this.geometry.skinWeights[t].x+this.geometry.skinWeights[t].y!==1&&(i=.5*(1-(this.geometry.skinWeights[t].x+this.geometry.skinWeights[t].y)),this.geometry.skinWeights[t].x+=i,this.geometry.skinWeights[t].y+=i)}},THREE.MorphAnimMesh=function(t,e){THREE.Mesh.call(this,t,e),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype=new THREE.Mesh,THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.updateAnimation=function(t){var e=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):this.time%=this.duration,t=THREE.Math.clamp(Math.floor(this.time/e),0,this.geometry.morphTargets.length-1),t!=this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),e=this.time%e/e,this.directionBackwards&&(e=1-e),this.morphTargetInfluences[this.currentKeyframe]=e,this.morphTargetInfluences[this.lastKeyframe]=1-e},THREE.Ribbon=function(t,e){THREE.Object3D.call(this),this.geometry=t,this.material=e},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(t,e){void 0===e&&(e=0);for(var e=Math.abs(e),i=0;i<this.LODs.length&&!(e<this.LODs[i].visibleAtDistance);i++);this.LODs.splice(i,0,{visibleAtDistance:e,object3D:t}),this.add(t)},THREE.LOD.prototype.update=function(t){if(this.LODs.length>1){t.matrixWorldInverse.getInverse(t.matrixWorld),t=t.matrixWorldInverse,t=-(t.n31*this.position.x+t.n32*this.position.y+t.n33*this.position.z+t.n34),this.LODs[0].object3D.visible=!0;for(var e=1;e<this.LODs.length&&t>=this.LODs[e].visibleAtDistance;e++)this.LODs[e-1].object3D.visible=!1,this.LODs[e].object3D.visible=!0;for(;e<this.LODs.length;e++)this.LODs[e].object3D.visible=!1}},THREE.Sprite=function(t){THREE.Object3D.call(this),this.color=new THREE.Color(void 0!==t.color?t.color:16777215),this.map=t.map instanceof THREE.Texture?t.map:THREE.ImageUtils.loadTexture(t.map),this.blending=void 0!==t.blending?t.blending:THREE.NormalBlending,this.useScreenCoordinates=void 0!==t.useScreenCoordinates?t.useScreenCoordinates:!0,this.mergeWith3D=void 0!==t.mergeWith3D?t.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==t.affectedByDistance?t.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==t.scaleByViewport?t.scaleByViewport:!this.affectedByDistance,this.alignment=t.alignment instanceof THREE.Vector2?t.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)
},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.addObject=function(t){if(t instanceof THREE.Light)-1===this.lights.indexOf(t)&&this.lights.push(t);else if(!(t instanceof THREE.Camera||t instanceof THREE.Bone)&&-1===this.objects.indexOf(t)){this.objects.push(t),this.__objectsAdded.push(t);var e=this.__objectsRemoved.indexOf(t);-1!==e&&this.__objectsRemoved.splice(e,1)}for(e=0;e<t.children.length;e++)this.addObject(t.children[e])},THREE.Scene.prototype.removeObject=function(t){if(t instanceof THREE.Light){var e=this.lights.indexOf(t);-1!==e&&this.lights.splice(e,1)}else t instanceof THREE.Camera||(e=this.objects.indexOf(t),-1!==e&&(this.objects.splice(e,1),this.__objectsRemoved.push(t),e=this.__objectsAdded.indexOf(t),-1!==e&&this.__objectsAdded.splice(e,1)));for(e=0;e<t.children.length;e++)this.removeObject(t.children[e])},THREE.Fog=function(t,e,i){this.color=new THREE.Color(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3},THREE.FogExp2=function(t,e){this.color=new THREE.Color(t),this.density=void 0!==e?e:25e-5},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var t,e,i,n,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){t=r,e=o,i=t/2,n=e/2},this.render=function(t,e){var a,s,l,h,c,u,f,d;for(r=o.projectScene(t,e),a=0,s=r.length;s>a;a++)if(c=r[a],c instanceof THREE.RenderableParticle)for(f=c.x*i+i,d=c.y*n+n,l=0,h=c.material.length;h>l;l++)u=c.material[l],u instanceof THREE.ParticleDOMMaterial&&(u=u.domElement,u.style.left=f+"px",u.style.top=d+"px")}},THREE.CanvasRenderer=function(t){function e(t){Q!=t&&($.globalAlpha=Q=t)}function i(t){if(Z!=t){switch(t){case THREE.NormalBlending:$.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:$.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:$.globalCompositeOperation="darker"}Z=t}}function n(t){K!=t&&($.strokeStyle=K=t)}function r(t){J!=t&&($.fillStyle=J=t)}var o,a,s,l,h,c,u,f,d,p,m,E,g,v,y,T,b,R,x,w,H,_,S,M,C,A,k,L,N,P,F,D,z,V,I,B,U,O,j,W=this,G=new THREE.Projector,t=t||{},X=void 0!==t.canvas?t.canvas:document.createElement("canvas"),$=X.getContext("2d"),q=new THREE.Color(0),Y=0,Q=1,Z=0,K=null,J=null,te=null,ee=null,ie=null,ne=new THREE.RenderableVertex,re=new THREE.RenderableVertex,oe=new THREE.Color,ae=new THREE.Color,se=new THREE.Color,le=new THREE.Color,he=new THREE.Color,ce=[],ue=[],fe=new THREE.Rectangle,de=new THREE.Rectangle,pe=new THREE.Rectangle,me=!1,Ee=new THREE.Color,ge=new THREE.Color,ve=new THREE.Color,ye=new THREE.Vector3,t=16;V=document.createElement("canvas"),V.width=V.height=2,I=V.getContext("2d"),I.fillStyle="rgba(0,0,0,1)",I.fillRect(0,0,2,2),B=I.getImageData(0,0,2,2),U=B.data,O=document.createElement("canvas"),O.width=O.height=t,j=O.getContext("2d"),j.translate(-t/2,-t/2),j.scale(t,t),t--,this.domElement=X,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(t,e){l=t,h=e,c=Math.floor(l/2),u=Math.floor(h/2),X.width=l,X.height=h,fe.set(-c,-u,c,u),de.set(-c,-u,c,u),Q=1,Z=0,ie=ee=te=J=K=null},this.setClearColor=function(t,e){q.copy(t),Y=e,de.set(-c,-u,c,u)},this.setClearColorHex=function(t,e){q.setHex(t),Y=e,de.set(-c,-u,c,u)},this.clear=function(){$.setTransform(1,0,0,-1,c,u),de.isEmpty()||(de.minSelf(fe),de.inflate(2),1>Y&&$.clearRect(Math.floor(de.getX()),Math.floor(de.getY()),Math.floor(de.getWidth()),Math.floor(de.getHeight())),Y>0&&(i(THREE.NormalBlending),e(1),r("rgba("+Math.floor(255*q.r)+","+Math.floor(255*q.g)+","+Math.floor(255*q.b)+","+Y+")"),$.fillRect(Math.floor(de.getX()),Math.floor(de.getY()),Math.floor(de.getWidth()),Math.floor(de.getHeight()))),de.empty())},this.render=function(t,l){function h(t){var e,i,n,r;for(Ee.setRGB(0,0,0),ge.setRGB(0,0,0),ve.setRGB(0,0,0),e=0,i=t.length;i>e;e++)n=t[e],r=n.color,n instanceof THREE.AmbientLight?(Ee.r+=r.r,Ee.g+=r.g,Ee.b+=r.b):n instanceof THREE.DirectionalLight?(ge.r+=r.r,ge.g+=r.g,ge.b+=r.b):n instanceof THREE.PointLight&&(ve.r+=r.r,ve.g+=r.g,ve.b+=r.b)}function X(t,e,i,n){var r,o,a,s,l,h;for(r=0,o=t.length;o>r;r++)a=t[r],s=a.color,a instanceof THREE.DirectionalLight?(l=a.matrixWorld.getPosition(),h=i.dot(l),0>=h||(h*=a.intensity,n.r+=s.r*h,n.g+=s.g*h,n.b+=s.b*h)):a instanceof THREE.PointLight&&(l=a.matrixWorld.getPosition(),h=i.dot(ye.sub(l,e).normalize()),0>=h||(h*=0==a.distance?1:1-Math.min(e.distanceTo(l)/a.distance,1),0!=h&&(h*=a.intensity,n.r+=s.r*h,n.g+=s.g*h,n.b+=s.b*h)))}function q(t,o,a){e(a.opacity),i(a.blending);var s,l,h,f,d,p;a instanceof THREE.ParticleBasicMaterial?a.map&&(f=a.map.image,d=f.width>>1,p=f.height>>1,a=o.scale.x*c,h=o.scale.y*u,s=a*d,l=h*p,pe.set(t.x-s,t.y-l,t.x+s,t.y+l),fe.intersects(pe)&&($.save(),$.translate(t.x,t.y),$.rotate(-o.rotation),$.scale(a,-h),$.translate(-d,-p),$.drawImage(f,0,0),$.restore())):a instanceof THREE.ParticleCanvasMaterial&&(s=o.scale.x*c,l=o.scale.y*u,pe.set(t.x-s,t.y-l,t.x+s,t.y+l),fe.intersects(pe)&&(n(a.color.getContextStyle()),r(a.color.getContextStyle()),$.save(),$.translate(t.x,t.y),$.rotate(-o.rotation),$.scale(s,l),a.program($),$.restore()))}function Y(t,r,o,a){e(a.opacity),i(a.blending),$.beginPath(),$.moveTo(t.positionScreen.x,t.positionScreen.y),$.lineTo(r.positionScreen.x,r.positionScreen.y),$.closePath(),a instanceof THREE.LineBasicMaterial&&(t=a.linewidth,te!=t&&($.lineWidth=te=t),t=a.linecap,ee!=t&&($.lineCap=ee=t),t=a.linejoin,ie!=t&&($.lineJoin=ie=t),n(a.color.getContextStyle()),$.stroke(),pe.inflate(2*a.linewidth))}function Q(t,n,r,o,a,h,c,u){W.info.render.vertices+=3,W.info.render.faces++,e(u.opacity),i(u.blending),E=t.positionScreen.x,g=t.positionScreen.y,v=n.positionScreen.x,y=n.positionScreen.y,T=r.positionScreen.x,b=r.positionScreen.y,K(E,g,v,y,T,b),u instanceof THREE.MeshBasicMaterial?u.map?u.map.mapping instanceof THREE.UVMapping&&(k=c.uvs[0],Re(E,g,v,y,T,b,k[o].u,k[o].v,k[a].u,k[a].v,k[h].u,k[h].v,u.map)):u.envMap?u.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(t=l.matrixWorldInverse,ye.copy(c.vertexNormalsWorld[o]),L=.5*(ye.x*t.n11+ye.y*t.n12+ye.z*t.n13)+.5,N=.5*-(ye.x*t.n21+ye.y*t.n22+ye.z*t.n23)+.5,ye.copy(c.vertexNormalsWorld[a]),P=.5*(ye.x*t.n11+ye.y*t.n12+ye.z*t.n13)+.5,F=.5*-(ye.x*t.n21+ye.y*t.n22+ye.z*t.n23)+.5,ye.copy(c.vertexNormalsWorld[h]),D=.5*(ye.x*t.n11+ye.y*t.n12+ye.z*t.n13)+.5,z=.5*-(ye.x*t.n21+ye.y*t.n22+ye.z*t.n23)+.5,Re(E,g,v,y,T,b,L,N,P,F,D,z,u.envMap)):u.wireframe?Te(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(u.color):u instanceof THREE.MeshLambertMaterial?(u.map&&!u.wireframe&&(u.map.mapping instanceof THREE.UVMapping&&(k=c.uvs[0],Re(E,g,v,y,T,b,k[o].u,k[o].v,k[a].u,k[a].v,k[h].u,k[h].v,u.map)),i(THREE.SubtractiveBlending)),me?u.wireframe||u.shading!=THREE.SmoothShading||3!=c.vertexNormalsWorld.length?(oe.r=Ee.r,oe.g=Ee.g,oe.b=Ee.b,X(s,c.centroidWorld,c.normalWorld,oe),oe.r=Math.max(0,Math.min(u.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(u.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(u.color.b*oe.b,1)),u.wireframe?Te(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(oe)):(ae.r=se.r=le.r=Ee.r,ae.g=se.g=le.g=Ee.g,ae.b=se.b=le.b=Ee.b,X(s,c.v1.positionWorld,c.vertexNormalsWorld[0],ae),X(s,c.v2.positionWorld,c.vertexNormalsWorld[1],se),X(s,c.v3.positionWorld,c.vertexNormalsWorld[2],le),ae.r=Math.max(0,Math.min(u.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(u.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(u.color.b*ae.b,1)),se.r=Math.max(0,Math.min(u.color.r*se.r,1)),se.g=Math.max(0,Math.min(u.color.g*se.g,1)),se.b=Math.max(0,Math.min(u.color.b*se.b,1)),le.r=Math.max(0,Math.min(u.color.r*le.r,1)),le.g=Math.max(0,Math.min(u.color.g*le.g,1)),le.b=Math.max(0,Math.min(u.color.b*le.b,1)),he.r=.5*(se.r+le.r),he.g=.5*(se.g+le.g),he.b=.5*(se.b+le.b),A=we(ae,se,le,he),xe(E,g,v,y,T,b,0,0,1,0,0,1,A)):u.wireframe?Te(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(u.color)):u instanceof THREE.MeshDepthMaterial?(M=l.near,C=l.far,ae.r=ae.g=ae.b=1-He(t.positionScreen.z,M,C),se.r=se.g=se.b=1-He(n.positionScreen.z,M,C),le.r=le.g=le.b=1-He(r.positionScreen.z,M,C),he.r=.5*(se.r+le.r),he.g=.5*(se.g+le.g),he.b=.5*(se.b+le.b),A=we(ae,se,le,he),xe(E,g,v,y,T,b,0,0,1,0,0,1,A)):u instanceof THREE.MeshNormalMaterial&&(oe.r=_e(c.normalWorld.x),oe.g=_e(c.normalWorld.y),oe.b=_e(c.normalWorld.z),u.wireframe?Te(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(oe))}function Z(t,n,r,o,a,h,c,u,f){W.info.render.vertices+=4,W.info.render.faces++,e(u.opacity),i(u.blending),u.map||u.envMap?(Q(t,n,o,0,1,3,c,u,f),Q(a,r,h,1,2,3,c,u,f)):(E=t.positionScreen.x,g=t.positionScreen.y,v=n.positionScreen.x,y=n.positionScreen.y,T=r.positionScreen.x,b=r.positionScreen.y,R=o.positionScreen.x,x=o.positionScreen.y,w=a.positionScreen.x,H=a.positionScreen.y,_=h.positionScreen.x,S=h.positionScreen.y,u instanceof THREE.MeshBasicMaterial?(J(E,g,v,y,T,b,R,x),u.wireframe?Te(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(u.color)):u instanceof THREE.MeshLambertMaterial?me?u.wireframe||u.shading!=THREE.SmoothShading||4!=c.vertexNormalsWorld.length?(oe.r=Ee.r,oe.g=Ee.g,oe.b=Ee.b,X(s,c.centroidWorld,c.normalWorld,oe),oe.r=Math.max(0,Math.min(u.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(u.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(u.color.b*oe.b,1)),J(E,g,v,y,T,b,R,x),u.wireframe?Te(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(oe)):(ae.r=se.r=le.r=he.r=Ee.r,ae.g=se.g=le.g=he.g=Ee.g,ae.b=se.b=le.b=he.b=Ee.b,X(s,c.v1.positionWorld,c.vertexNormalsWorld[0],ae),X(s,c.v2.positionWorld,c.vertexNormalsWorld[1],se),X(s,c.v4.positionWorld,c.vertexNormalsWorld[3],le),X(s,c.v3.positionWorld,c.vertexNormalsWorld[2],he),ae.r=Math.max(0,Math.min(u.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(u.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(u.color.b*ae.b,1)),se.r=Math.max(0,Math.min(u.color.r*se.r,1)),se.g=Math.max(0,Math.min(u.color.g*se.g,1)),se.b=Math.max(0,Math.min(u.color.b*se.b,1)),le.r=Math.max(0,Math.min(u.color.r*le.r,1)),le.g=Math.max(0,Math.min(u.color.g*le.g,1)),le.b=Math.max(0,Math.min(u.color.b*le.b,1)),he.r=Math.max(0,Math.min(u.color.r*he.r,1)),he.g=Math.max(0,Math.min(u.color.g*he.g,1)),he.b=Math.max(0,Math.min(u.color.b*he.b,1)),A=we(ae,se,le,he),K(E,g,v,y,R,x),xe(E,g,v,y,R,x,0,0,1,0,0,1,A),K(w,H,T,b,_,S),xe(w,H,T,b,_,S,1,0,1,1,0,1,A)):(J(E,g,v,y,T,b,R,x),u.wireframe?Te(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(u.color)):u instanceof THREE.MeshNormalMaterial?(oe.r=_e(c.normalWorld.x),oe.g=_e(c.normalWorld.y),oe.b=_e(c.normalWorld.z),J(E,g,v,y,T,b,R,x),u.wireframe?Te(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):be(oe)):u instanceof THREE.MeshDepthMaterial&&(M=l.near,C=l.far,ae.r=ae.g=ae.b=1-He(t.positionScreen.z,M,C),se.r=se.g=se.b=1-He(n.positionScreen.z,M,C),le.r=le.g=le.b=1-He(o.positionScreen.z,M,C),he.r=he.g=he.b=1-He(r.positionScreen.z,M,C),A=we(ae,se,le,he),K(E,g,v,y,R,x),xe(E,g,v,y,R,x,0,0,1,0,0,1,A),K(w,H,T,b,_,S),xe(w,H,T,b,_,S,1,0,1,1,0,1,A)))}function K(t,e,i,n,r,o){$.beginPath(),$.moveTo(t,e),$.lineTo(i,n),$.lineTo(r,o),$.lineTo(t,e),$.closePath()}function J(t,e,i,n,r,o,a,s){$.beginPath(),$.moveTo(t,e),$.lineTo(i,n),$.lineTo(r,o),$.lineTo(a,s),$.lineTo(t,e),$.closePath()}function Te(t,e,i,r){te!=e&&($.lineWidth=te=e),ee!=i&&($.lineCap=ee=i),ie!=r&&($.lineJoin=ie=r),n(t.getContextStyle()),$.stroke(),pe.inflate(2*e)}function be(t){r(t.getContextStyle()),$.fill()}function Re(t,e,i,n,o,a,s,l,h,c,u,f,d){if(0!=d.image.width){if(1==d.needsUpdate||void 0==ce[d.id]){var p=d.wrapS==THREE.RepeatWrapping,m=d.wrapT==THREE.RepeatWrapping;ce[d.id]=$.createPattern(d.image,p&&m?"repeat":p&&!m?"repeat-x":!p&&m?"repeat-y":"no-repeat"),d.needsUpdate=!1}r(ce[d.id]);var p=d.offset.x/d.repeat.x,m=d.offset.y/d.repeat.y,E=d.image.width*d.repeat.x,g=d.image.height*d.repeat.y,s=(s+p)*E,l=(l+m)*g,h=(h+p)*E,c=(c+m)*g,u=(u+p)*E,f=(f+m)*g;i-=t,n-=e,o-=t,a-=e,h-=s,c-=l,u-=s,f-=l,p=h*f-u*c,0==p?(void 0==ue[d.id]&&(e=document.createElement("canvas"),e.width=d.image.width,e.height=d.image.height,t=e.getContext("2d"),t.drawImage(d.image,0,0),ue[d.id]=t.getImageData(0,0,d.image.width,d.image.height).data,delete e),e=ue[d.id],s=4*(Math.floor(s)+Math.floor(l)*d.image.width),oe.setRGB(e[s]/255,e[s+1]/255,e[s+2]/255),be(oe)):(p=1/p,d=(f*i-c*o)*p,c=(f*n-c*a)*p,i=(h*o-u*i)*p,n=(h*a-u*n)*p,t=t-d*s-i*l,s=e-c*s-n*l,$.save(),$.transform(d,c,i,n,t,s),$.fill(),$.restore())}}function xe(t,e,i,n,r,o,a,s,l,h,c,u,f){var d,p;d=f.width-1,p=f.height-1,a*=d,s*=p,l*=d,h*=p,c*=d,u*=p,i-=t,n-=e,r-=t,o-=e,l-=a,h-=s,c-=a,u-=s,p=1/(l*u-c*h),d=(u*i-h*r)*p,h=(u*n-h*o)*p,i=(l*r-c*i)*p,n=(l*o-c*n)*p,t=t-d*a-i*s,e=e-h*a-n*s,$.save(),$.transform(d,h,i,n,t,e),$.clip(),$.drawImage(f,0,0),$.restore()}function we(t,e,i,n){var r=~~(255*t.r),o=~~(255*t.g),t=~~(255*t.b),a=~~(255*e.r),s=~~(255*e.g),e=~~(255*e.b),l=~~(255*i.r),h=~~(255*i.g),i=~~(255*i.b),c=~~(255*n.r),u=~~(255*n.g),n=~~(255*n.b);return U[0]=0>r?0:r>255?255:r,U[1]=0>o?0:o>255?255:o,U[2]=0>t?0:t>255?255:t,U[4]=0>a?0:a>255?255:a,U[5]=0>s?0:s>255?255:s,U[6]=0>e?0:e>255?255:e,U[8]=0>l?0:l>255?255:l,U[9]=0>h?0:h>255?255:h,U[10]=0>i?0:i>255?255:i,U[12]=0>c?0:c>255?255:c,U[13]=0>u?0:u>255?255:u,U[14]=0>n?0:n>255?255:n,I.putImageData(B,0,0),j.drawImage(V,0,0),O}function He(t,e,i){return t=(t-e)/(i-e),t*t*(3-2*t)}function _e(t){return t=.5*(t+1),0>t?0:t>1?1:t}function Se(t,e){var i=e.x-t.x,n=e.y-t.y,r=i*i+n*n;0!=r&&(r=1/Math.sqrt(r),i*=r,n*=r,e.x+=i,e.y+=n,t.x-=i,t.y-=n)}var Me,Ce,Ae,ke;for(this.autoClear?this.clear():$.setTransform(1,0,0,-1,c,u),W.info.render.vertices=0,W.info.render.faces=0,o=G.projectScene(t,l,this.sortElements),a=o.elements,s=o.lights,(me=s.length>0)&&h(s),Me=0,Ce=a.length;Ce>Me;Me++)Ae=a[Me],ke=Ae.material,ke=ke instanceof THREE.MeshFaceMaterial?Ae.faceMaterial:ke,null==ke||0==ke.opacity||(pe.empty(),Ae instanceof THREE.RenderableParticle?(f=Ae,f.x*=c,f.y*=u,q(f,Ae,ke,t)):Ae instanceof THREE.RenderableLine?(f=Ae.v1,d=Ae.v2,f.positionScreen.x*=c,f.positionScreen.y*=u,d.positionScreen.x*=c,d.positionScreen.y*=u,pe.addPoint(f.positionScreen.x,f.positionScreen.y),pe.addPoint(d.positionScreen.x,d.positionScreen.y),fe.intersects(pe)&&Y(f,d,Ae,ke,t)):Ae instanceof THREE.RenderableFace3?(f=Ae.v1,d=Ae.v2,p=Ae.v3,f.positionScreen.x*=c,f.positionScreen.y*=u,d.positionScreen.x*=c,d.positionScreen.y*=u,p.positionScreen.x*=c,p.positionScreen.y*=u,ke.overdraw&&(Se(f.positionScreen,d.positionScreen),Se(d.positionScreen,p.positionScreen),Se(p.positionScreen,f.positionScreen)),pe.add3Points(f.positionScreen.x,f.positionScreen.y,d.positionScreen.x,d.positionScreen.y,p.positionScreen.x,p.positionScreen.y),fe.intersects(pe)&&Q(f,d,p,0,1,2,Ae,ke,t)):Ae instanceof THREE.RenderableFace4&&(f=Ae.v1,d=Ae.v2,p=Ae.v3,m=Ae.v4,f.positionScreen.x*=c,f.positionScreen.y*=u,d.positionScreen.x*=c,d.positionScreen.y*=u,p.positionScreen.x*=c,p.positionScreen.y*=u,m.positionScreen.x*=c,m.positionScreen.y*=u,ne.positionScreen.copy(d.positionScreen),re.positionScreen.copy(m.positionScreen),ke.overdraw&&(Se(f.positionScreen,d.positionScreen),Se(d.positionScreen,m.positionScreen),Se(m.positionScreen,f.positionScreen),Se(p.positionScreen,ne.positionScreen),Se(p.positionScreen,re.positionScreen)),pe.addPoint(f.positionScreen.x,f.positionScreen.y),pe.addPoint(d.positionScreen.x,d.positionScreen.y),pe.addPoint(p.positionScreen.x,p.positionScreen.y),pe.addPoint(m.positionScreen.x,m.positionScreen.y),fe.intersects(pe)&&Z(f,d,p,m,ne,re,Ae,ke,t)),de.addRectangle(pe));$.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function t(t,e,i,n){var r,o,a,s,l,h;for(r=0,o=t.length;o>r;r++)a=t[r],s=a.color,a instanceof THREE.DirectionalLight?(l=a.matrixWorld.getPosition(),h=i.dot(l),0>=h||(h*=a.intensity,n.r+=s.r*h,n.g+=s.g*h,n.b+=s.b*h)):a instanceof THREE.PointLight&&(l=a.matrixWorld.getPosition(),h=i.dot(M.sub(l,e).normalize()),0>=h||(h*=0==a.distance?1:1-Math.min(e.distanceTo(l)/a.distance,1),0!=h&&(h*=a.intensity,n.r+=s.r*h,n.g+=s.g*h,n.b+=s.b*h)))}function e(t){return null==C[t]&&(C[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==k&&C[t].setAttribute("shape-rendering","crispEdges")),C[t]}function i(t){return t=.5*(t+1),0>t?0:t>1?1:t}var n,r,o,a,s,l,h,c,u,f,d,p,m,E,g,v=this,y=new THREE.Projector,T=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=new THREE.Rectangle,R=new THREE.Rectangle,x=!1,w=new THREE.Color,H=new THREE.Color,_=new THREE.Color,S=new THREE.Color,M=new THREE.Vector3,C=[],A=[],k=1;this.domElement=T,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(t){switch(t){case"high":k=1;break;case"low":k=0}},this.setSize=function(t,e){a=t,s=e,l=a/2,h=s/2,T.setAttribute("viewBox",-l+" "+-h+" "+a+" "+s),T.setAttribute("width",a),T.setAttribute("height",s),b.set(-l,-h,l,h)},this.clear=function(){for(;T.childNodes.length>0;)T.removeChild(T.childNodes[0])},this.render=function(a,s){var M,C,L,N;if(this.autoClear&&this.clear(),v.info.render.vertices=0,v.info.render.faces=0,n=y.projectScene(a,s,this.sortElements),r=n.elements,o=n.lights,g=E=0,x=o.length>0)for(H.setRGB(0,0,0),_.setRGB(0,0,0),S.setRGB(0,0,0),M=0,C=o.length;C>M;M++)N=o[M],L=N.color,N instanceof THREE.AmbientLight?(H.r+=L.r,H.g+=L.g,H.b+=L.b):N instanceof THREE.DirectionalLight?(_.r+=L.r,_.g+=L.g,_.b+=L.b):N instanceof THREE.PointLight&&(S.r+=L.r,S.g+=L.g,S.b+=L.b);for(M=0,C=r.length;C>M;M++)if(L=r[M],N=L.material,N=N instanceof THREE.MeshFaceMaterial?L.faceMaterial:N,!(null==N||0==N.opacity))if(R.empty(),L instanceof THREE.RenderableParticle)c=L,c.x*=l,c.y*=-h;else if(L instanceof THREE.RenderableLine){if(c=L.v1,u=L.v2,c.positionScreen.x*=l,c.positionScreen.y*=-h,u.positionScreen.x*=l,u.positionScreen.y*=-h,R.addPoint(c.positionScreen.x,c.positionScreen.y),R.addPoint(u.positionScreen.x,u.positionScreen.y),b.intersects(R)){L=c;var P=u,F=g++;null==A[F]&&(A[F]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==k&&A[F].setAttribute("shape-rendering","crispEdges")),m=A[F],m.setAttribute("x1",L.positionScreen.x),m.setAttribute("y1",L.positionScreen.y),m.setAttribute("x2",P.positionScreen.x),m.setAttribute("y2",P.positionScreen.y),N instanceof THREE.LineBasicMaterial&&(m.setAttribute("style","fill: none; stroke: "+N.color.getContextStyle()+"; stroke-width: "+N.linewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.linecap+"; stroke-linejoin: "+N.linejoin),T.appendChild(m))}}else if(L instanceof THREE.RenderableFace3){if(c=L.v1,u=L.v2,f=L.v3,c.positionScreen.x*=l,c.positionScreen.y*=-h,u.positionScreen.x*=l,u.positionScreen.y*=-h,f.positionScreen.x*=l,f.positionScreen.y*=-h,R.addPoint(c.positionScreen.x,c.positionScreen.y),R.addPoint(u.positionScreen.x,u.positionScreen.y),R.addPoint(f.positionScreen.x,f.positionScreen.y),b.intersects(R)){var P=c,F=u,D=f;v.info.render.vertices+=3,v.info.render.faces++,m=e(E++),m.setAttribute("d","M "+P.positionScreen.x+" "+P.positionScreen.y+" L "+F.positionScreen.x+" "+F.positionScreen.y+" L "+D.positionScreen.x+","+D.positionScreen.y+"z"),N instanceof THREE.MeshBasicMaterial?w.copy(N.color):N instanceof THREE.MeshLambertMaterial?x?(w.r=H.r,w.g=H.g,w.b=H.b,t(o,L.centroidWorld,L.normalWorld,w),w.r=Math.max(0,Math.min(N.color.r*w.r,1)),w.g=Math.max(0,Math.min(N.color.g*w.g,1)),w.b=Math.max(0,Math.min(N.color.b*w.b,1))):w.copy(N.color):N instanceof THREE.MeshDepthMaterial?(p=1-N.__2near/(N.__farPlusNear-L.z*N.__farMinusNear),w.setRGB(p,p,p)):N instanceof THREE.MeshNormalMaterial&&w.setRGB(i(L.normalWorld.x),i(L.normalWorld.y),i(L.normalWorld.z)),N.wireframe?m.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+N.wireframeLinewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.wireframeLinecap+"; stroke-linejoin: "+N.wireframeLinejoin):m.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+N.opacity),T.appendChild(m)}}else if(L instanceof THREE.RenderableFace4&&(c=L.v1,u=L.v2,f=L.v3,d=L.v4,c.positionScreen.x*=l,c.positionScreen.y*=-h,u.positionScreen.x*=l,u.positionScreen.y*=-h,f.positionScreen.x*=l,f.positionScreen.y*=-h,d.positionScreen.x*=l,d.positionScreen.y*=-h,R.addPoint(c.positionScreen.x,c.positionScreen.y),R.addPoint(u.positionScreen.x,u.positionScreen.y),R.addPoint(f.positionScreen.x,f.positionScreen.y),R.addPoint(d.positionScreen.x,d.positionScreen.y),b.intersects(R))){var P=c,F=u,D=f,z=d;v.info.render.vertices+=4,v.info.render.faces++,m=e(E++),m.setAttribute("d","M "+P.positionScreen.x+" "+P.positionScreen.y+" L "+F.positionScreen.x+" "+F.positionScreen.y+" L "+D.positionScreen.x+","+D.positionScreen.y+" L "+z.positionScreen.x+","+z.positionScreen.y+"z"),N instanceof THREE.MeshBasicMaterial?w.copy(N.color):N instanceof THREE.MeshLambertMaterial?x?(w.r=H.r,w.g=H.g,w.b=H.b,t(o,L.centroidWorld,L.normalWorld,w),w.r=Math.max(0,Math.min(N.color.r*w.r,1)),w.g=Math.max(0,Math.min(N.color.g*w.g,1)),w.b=Math.max(0,Math.min(N.color.b*w.b,1))):w.copy(N.color):N instanceof THREE.MeshDepthMaterial?(p=1-N.__2near/(N.__farPlusNear-L.z*N.__farMinusNear),w.setRGB(p,p,p)):N instanceof THREE.MeshNormalMaterial&&w.setRGB(i(L.normalWorld.x),i(L.normalWorld.y),i(L.normalWorld.z)),N.wireframe?m.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+N.wireframeLinewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.wireframeLinecap+"; stroke-linejoin: "+N.wireframeLinejoin):m.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+N.opacity),T.appendChild(m)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(t){var e,i,n,r={};
for(e=0;e<t.length;e++)for(i in n=this.clone(t[e]))r[i]=n[i];return r},clone:function(t){var e,i,n,r={};for(e in t)for(i in r[e]={},t[e])n=t[e][i],r[e][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n;return r}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:.0039},shadowDarkness:{type:"f",value:.2}}},THREE.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(t){function e(t,e){var i=t.vertices.length,n=e.material;if(n.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=U.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}}function i(t,e){return!t.material||t.material instanceof THREE.MeshFaceMaterial?e.materialIndex>=0?t.geometry.materials[e.materialIndex]:void 0:t.material}function n(t){return t instanceof THREE.MeshBasicMaterial&&!t.envMap||t instanceof THREE.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function r(t){return t.vertexColors?t.vertexColors:!1}function o(t){return t.map||t.lightMap||t instanceof THREE.ShaderMaterial?!0:!1}function a(t,e,i){var n,r,o,a,s=t.vertices;a=s.length;var l=t.colors,h=l.length,c=t.__vertexArray,u=t.__colorArray,f=t.__sortArray,d=t.__dirtyVertices,p=t.__dirtyColors,m=t.__webglCustomAttributesList;if(i.sortParticles){for(fe.multiplySelf(i.matrixWorld),n=0;a>n;n++)r=s[n].position,me.copy(r),fe.multiplyVector3(me),f[n]=[me.z,n];for(f.sort(function(t,e){return e[0]-t[0]}),n=0;a>n;n++)r=s[f[n][1]].position,o=3*n,c[o]=r.x,c[o+1]=r.y,c[o+2]=r.z;for(n=0;h>n;n++)o=3*n,r=l[f[n][1]],u[o]=r.r,u[o+1]=r.g,u[o+2]=r.b;if(m)for(l=0,h=m.length;h>l;l++)if(s=m[l],void 0===s.boundTo||"vertices"===s.boundTo)if(o=0,r=s.value.length,1===s.size)for(n=0;r>n;n++)a=f[n][1],s.array[n]=s.value[a];else if(2===s.size)for(n=0;r>n;n++)a=f[n][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(n=0;r>n;n++)a=f[n][1],a=s.value[a],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(n=0;r>n;n++)a=f[n][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(n=0;r>n;n++)a=f[n][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}else{if(d)for(n=0;a>n;n++)r=s[n].position,o=3*n,c[o]=r.x,c[o+1]=r.y,c[o+2]=r.z;if(p)for(n=0;h>n;n++)r=l[n],o=3*n,u[o]=r.r,u[o+1]=r.g,u[o+2]=r.b;if(m)for(l=0,h=m.length;h>l;l++)if(s=m[l],s.needsUpdate&&(void 0===s.boundTo||"vertices"===s.boundTo))if(r=s.value.length,o=0,1===s.size)for(n=0;r>n;n++)s.array[n]=s.value[n];else if(2===s.size)for(n=0;r>n;n++)a=s.value[n],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(n=0;r>n;n++)a=s.value[n],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(n=0;r>n;n++)a=s.value[n],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(n=0;r>n;n++)a=s.value[n],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}if((d||i.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,t.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,c,e)),(p||i.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,t.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,u,e)),m)for(l=0,h=m.length;h>l;l++)s=m[l],(s.needsUpdate||i.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,s.buffer),U.bufferData(U.ARRAY_BUFFER,s.array,e))}function s(t,e,i){if(t.__webglVertexBuffer||(t.__webglVertexBuffer=U.createBuffer()),t.__webglNormalBuffer||(t.__webglNormalBuffer=U.createBuffer()),t.hasPos&&(U.bindBuffer(U.ARRAY_BUFFER,t.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,t.positionArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(e.attributes.position),U.vertexAttribPointer(e.attributes.position,3,U.FLOAT,!1,0,0)),t.hasNormal){if(U.bindBuffer(U.ARRAY_BUFFER,t.__webglNormalBuffer),i===THREE.FlatShading){var n,r,o,a,s,l,h,c,u,f,d=3*t.count;for(f=0;d>f;f+=9)i=t.normalArray,n=i[f],r=i[f+1],o=i[f+2],a=i[f+3],l=i[f+4],c=i[f+5],s=i[f+6],h=i[f+7],u=i[f+8],n=(n+a+s)/3,r=(r+l+h)/3,o=(o+c+u)/3,i[f]=n,i[f+1]=r,i[f+2]=o,i[f+3]=n,i[f+4]=r,i[f+5]=o,i[f+6]=n,i[f+7]=r,i[f+8]=o}U.bufferData(U.ARRAY_BUFFER,t.normalArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(e.attributes.normal),U.vertexAttribPointer(e.attributes.normal,3,U.FLOAT,!1,0,0)}U.drawArrays(U.TRIANGLES,0,t.count),t.count=0}function l(t,e,i,n,r,o){if(0!==n.opacity){var a,s,i=y(t,e,i,n,o),e=i.attributes,t=!1,i=16777215*r.id+2*i.id+(n.wireframe?1:0);if(i!==Q&&(Q=i,t=!0),!n.morphTargets&&e.position>=0)t&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglVertexBuffer),U.vertexAttribPointer(e.position,3,U.FLOAT,!1,0,0));else if(o.morphTargetBase){if(i=n.program.attributes,-1!==o.morphTargetBase?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[o.morphTargetBase]),U.vertexAttribPointer(i.position,3,U.FLOAT,!1,0,0)):i.position>=0&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglVertexBuffer),U.vertexAttribPointer(i.position,3,U.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){a=0;var l=o.morphTargetForcedOrder;for(s=o.morphTargetInfluences;a<n.numSupportedMorphTargets&&a<l.length;)U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[l[a]]),U.vertexAttribPointer(i["morphTarget"+a],3,U.FLOAT,!1,0,0),o.__webglMorphTargetInfluences[a]=s[l[a]],a++}else{var l=[],h=-1,c=0;s=o.morphTargetInfluences;var u,f=s.length;for(a=0,-1!==o.morphTargetBase&&(l[o.morphTargetBase]=!0);a<n.numSupportedMorphTargets;){for(u=0;f>u;u++)!l[u]&&s[u]>h&&(c=u,h=s[c]);U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[c]),U.vertexAttribPointer(i["morphTarget"+a],3,U.FLOAT,!1,0,0),o.__webglMorphTargetInfluences[a]=h,l[c]=1,h=-1,a++}}null!==n.program.uniforms.morphTargetInfluences&&U.uniform1fv(n.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(t){if(r.__webglCustomAttributesList)for(a=0,s=r.__webglCustomAttributesList.length;s>a;a++)i=r.__webglCustomAttributesList[a],e[i.buffer.belongsToAttribute]>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.buffer),U.vertexAttribPointer(e[i.buffer.belongsToAttribute],i.size,U.FLOAT,!1,0,0));e.color>=0&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglColorBuffer),U.vertexAttribPointer(e.color,3,U.FLOAT,!1,0,0)),e.normal>=0&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglNormalBuffer),U.vertexAttribPointer(e.normal,3,U.FLOAT,!1,0,0)),e.tangent>=0&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglTangentBuffer),U.vertexAttribPointer(e.tangent,4,U.FLOAT,!1,0,0)),e.uv>=0&&(r.__webglUVBuffer?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglUVBuffer),U.vertexAttribPointer(e.uv,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(e.uv)):U.disableVertexAttribArray(e.uv)),e.uv2>=0&&(r.__webglUV2Buffer?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglUV2Buffer),U.vertexAttribPointer(e.uv2,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(e.uv2)):U.disableVertexAttribArray(e.uv2)),n.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinVertexABuffer),U.vertexAttribPointer(e.skinVertexA,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinVertexBBuffer),U.vertexAttribPointer(e.skinVertexB,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinIndicesBuffer),U.vertexAttribPointer(e.skinIndex,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinWeightsBuffer),U.vertexAttribPointer(e.skinWeight,4,U.FLOAT,!1,0,0))}o instanceof THREE.Mesh?(n.wireframe?(n=n.wireframeLinewidth,n!==ae&&(U.lineWidth(n),ae=n),t&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),U.drawElements(U.LINES,r.__webglLineCount,U.UNSIGNED_SHORT,0)):(t&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),U.drawElements(U.TRIANGLES,r.__webglFaceCount,U.UNSIGNED_SHORT,0)),G.info.render.calls++,G.info.render.vertices+=r.__webglFaceCount,G.info.render.faces+=r.__webglFaceCount/3):o instanceof THREE.Line?(o=o.type===THREE.LineStrip?U.LINE_STRIP:U.LINES,n=n.linewidth,n!==ae&&(U.lineWidth(n),ae=n),U.drawArrays(o,0,r.__webglLineCount),G.info.render.calls++):o instanceof THREE.ParticleSystem?(U.drawArrays(U.POINTS,0,r.__webglParticleCount),G.info.render.calls++):o instanceof THREE.Ribbon&&(U.drawArrays(U.TRIANGLE_STRIP,0,r.__webglVertexCount),G.info.render.calls++)}}function h(t){ue[0].set(t.n41-t.n11,t.n42-t.n12,t.n43-t.n13,t.n44-t.n14),ue[1].set(t.n41+t.n11,t.n42+t.n12,t.n43+t.n13,t.n44+t.n14),ue[2].set(t.n41+t.n21,t.n42+t.n22,t.n43+t.n23,t.n44+t.n24),ue[3].set(t.n41-t.n21,t.n42-t.n22,t.n43-t.n23,t.n44-t.n24),ue[4].set(t.n41-t.n31,t.n42-t.n32,t.n43-t.n33,t.n44-t.n34),ue[5].set(t.n41+t.n31,t.n42+t.n32,t.n43+t.n33,t.n44+t.n34);for(var e,t=0;6>t;t++)e=ue[t],e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))}function c(t){for(var e=t.matrixWorld,i=-t.geometry.boundingSphere.radius*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)),n=0;6>n;n++)if(t=ue[n].x*e.n14+ue[n].y*e.n24+ue[n].z*e.n34+ue[n].w,i>=t)return!1;return!0}function u(t,e){return e.z-t.z}function f(t){var e,i,n,r,o,a,u,f,d=0,p=t.lights;for(O||(O=new THREE.PerspectiveCamera(G.shadowCameraFov,G.shadowMapWidth/G.shadowMapHeight,G.shadowCameraNear,G.shadowCameraFar)),e=0,i=p.length;i>e;e++)if(f=p[e],f.castShadow&&f instanceof THREE.SpotLight){for(Y=-1,G.shadowMap[d]||(G.shadowMap[d]=new THREE.WebGLRenderTarget(G.shadowMapWidth,G.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),ge[d]=new THREE.Matrix4),n=G.shadowMap[d],r=ge[d],O.position.copy(f.position),O.lookAt(f.target.position),null==O.parent&&(console.warn("Camera is not on the Scene. Adding it..."),t.add(O),this.autoUpdateScene&&t.updateMatrixWorld()),O.matrixWorldInverse.getInverse(O.matrixWorld),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiplySelf(O.projectionMatrix),r.multiplySelf(O.matrixWorldInverse),O.matrixWorldInverse.flattenToArray(pe),O.projectionMatrix.flattenToArray(de),fe.multiply(O.projectionMatrix,O.matrixWorldInverse),h(fe),A(n),U.clearColor(1,1,1,1),G.clear(),U.clearColor(V.r,V.g,V.b,I),r=t.__webglObjects.length,n=0;r>n;n++)a=t.__webglObjects[n],f=a.object,a.render=!1,!f.visible||!f.castShadow||f instanceof THREE.Mesh&&f.frustumCulled&&!c(f)||(f.matrixWorld.flattenToArray(f._objectMatrixArray),T(f,O,!1),a.render=!0);for(R(!0),H(THREE.NormalBlending),n=0;r>n;n++)a=t.__webglObjects[n],a.render&&(f=a.object,a=a.buffer,b(f),u=f.customDepthMaterial?f.customDepthMaterial:f.geometry.morphTargets.length?W:j,l(O,p,null,u,a,f));for(r=t.__webglObjectsImmediate.length,n=0;r>n;n++)a=t.__webglObjectsImmediate[n],f=a.object,f.visible&&f.castShadow&&(f.matrixAutoUpdate&&f.matrixWorld.flattenToArray(f._objectMatrixArray),Q=-1,T(f,O,!1),b(f),o=y(O,p,null,j,f),f.immediateRenderCallback?f.immediateRenderCallback(o,U,ue):f.render(function(t){s(t,o,j.shading)}));d++}}function d(t,e,i,n,r,o,a,s){var h,c,u,f;e?(c=t.length-1,f=e=-1):(c=0,e=t.length,f=1);for(var d=c;d!==e;d+=f)if(h=t[d],h.render){if(c=h.object,u=h.buffer,s)h=s;else{if(h=h[i],!h)continue;a&&H(h.blending),R(h.depthTest),x(h.depthWrite),w(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}b(c),l(n,r,o,h,u,c)}}function p(t,e,i,n,r,o,a){for(var l,h,c,u,f=0,d=t.length;d>f;f++)if(l=t[f],h=l.object,h.visible){if(Q=-1,a)c=a;else{if(c=l[e],!c)continue;o&&H(c.blending),R(c.depthTest),x(c.depthWrite),w(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}b(h),u=y(i,n,r,c,h),h.immediateRenderCallback?h.immediateRenderCallback(u,U,ue):h.render(function(t){s(t,u,c.shading)})}}function m(t,e,i){t.push({buffer:e,object:i,opaque:null,transparent:null})}function E(t){for(var e in t.attributes)if(t.attributes[e].needsUpdate)return!0;return!1}function g(t){for(var e in t.attributes)t.attributes[e].needsUpdate=!1}function v(t,e){for(var i=t.length-1;i>=0;i--)t[i].object===e&&t.splice(i,1)}function y(t,e,i,n,r){if(n.program||G.initMaterial(n,e,i,r),n.morphTargets&&!r.__webglMorphTargetInfluences){r.__webglMorphTargetInfluences=new Float32Array(G.maxMorphTargets);for(var o=0,a=G.maxMorphTargets;a>o;o++)r.__webglMorphTargetInfluences[o]=0}var s=!1,o=n.program,a=o.uniforms,l=n.uniforms;if(o!==$&&(U.useProgram(o),$=o,s=!0),n.id!==Y&&(Y=n.id,s=!0),s){if(U.uniformMatrix4fv(a.projectionMatrix,!1,de),i&&n.fog&&(l.fogColor.value=i.color,i instanceof THREE.Fog?(l.fogNear.value=i.near,l.fogFar.value=i.far):i instanceof THREE.FogExp2&&(l.fogDensity.value=i.density)),n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n.lights){for(var h,c,u,f,d,p=0,m=0,E=0,g=Ee,v=g.directional.colors,y=g.directional.positions,T=g.point.colors,b=g.point.positions,R=g.point.distances,x=0,w=0,i=h=d=0,s=e.length;s>i;i++)h=e[i],c=h.color,u=h.position,f=h.intensity,d=h.distance,h instanceof THREE.AmbientLight?G.gammaInput?(p+=c.r*c.r,m+=c.g*c.g,E+=c.b*c.b):(p+=c.r,m+=c.g,E+=c.b):h instanceof THREE.DirectionalLight?(d=3*x,G.gammaInput?(v[d]=c.r*c.r*f*f,v[d+1]=c.g*c.g*f*f,v[d+2]=c.b*c.b*f*f):(v[d]=c.r*f,v[d+1]=c.g*f,v[d+2]=c.b*f),y[d]=u.x,y[d+1]=u.y,y[d+2]=u.z,x+=1):h instanceof THREE.SpotLight?(d=3*x,G.gammaInput?(v[d]=c.r*c.r*f*f,v[d+1]=c.g*c.g*f*f,v[d+2]=c.b*c.b*f*f):(v[d]=c.r*f,v[d+1]=c.g*f,v[d+2]=c.b*f),c=1/u.length(),y[d]=u.x*c,y[d+1]=u.y*c,y[d+2]=u.z*c,x+=1):h instanceof THREE.PointLight&&(h=3*w,G.gammaInput?(T[h]=c.r*c.r*f*f,T[h+1]=c.g*c.g*f*f,T[h+2]=c.b*c.b*f*f):(T[h]=c.r*f,T[h+1]=c.g*f,T[h+2]=c.b*f),b[h]=u.x,b[h+1]=u.y,b[h+2]=u.z,R[w]=d,w+=1);for(i=3*x,s=v.length;s>i;i++)v[i]=0;for(i=3*w,s=T.length;s>i;i++)T[i]=0;g.point.length=w,g.directional.length=x,g.ambient[0]=p,g.ambient[1]=m,g.ambient[2]=E,e=Ee,l.ambientLightColor.value=e.ambient,l.directionalLightColor.value=e.directional.colors,l.directionalLightDirection.value=e.directional.positions,l.pointLightColor.value=e.point.colors,l.pointLightPosition.value=e.point.positions,l.pointLightDistance.value=e.point.distances}if((n instanceof THREE.MeshBasicMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial)&&(l.opacity.value=n.opacity,G.gammaInput?l.diffuse.value.copyGammaToLinear(n.color):l.diffuse.value=n.color,(l.map.texture=n.map)&&l.offsetRepeat.value.set(n.map.offset.x,n.map.offset.y,n.map.repeat.x,n.map.repeat.y),l.lightMap.texture=n.lightMap,l.envMap.texture=n.envMap,l.flipEnvMap.value=n.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,l.reflectivity.value=n.reflectivity,l.refractionRatio.value=n.refractionRatio,l.combine.value=n.combine,l.useRefract.value=n.envMap&&n.envMap.mapping instanceof THREE.CubeRefractionMapping),n instanceof THREE.LineBasicMaterial?(l.diffuse.value=n.color,l.opacity.value=n.opacity):n instanceof THREE.ParticleBasicMaterial?(l.psColor.value=n.color,l.opacity.value=n.opacity,l.size.value=n.size,l.scale.value=N.height/2,l.map.texture=n.map):n instanceof THREE.MeshPhongMaterial?(l.shininess.value=n.shininess,G.gammaInput?(l.ambient.value.copyGammaToLinear(n.ambient),l.specular.value.copyGammaToLinear(n.specular)):(l.ambient.value=n.ambient,l.specular.value=n.specular)):n instanceof THREE.MeshLambertMaterial?G.gammaInput?l.ambient.value.copyGammaToLinear(n.ambient):l.ambient.value=n.ambient:n instanceof THREE.MeshDepthMaterial?(l.mNear.value=t.near,l.mFar.value=t.far,l.opacity.value=n.opacity):n instanceof THREE.MeshNormalMaterial&&(l.opacity.value=n.opacity),r.receiveShadow&&!n._shadowPass&&l.shadowMatrix){for(e=0;e<ge.length;e++)l.shadowMatrix.value[e]=ge[e],l.shadowMap.texture[e]=G.shadowMap[e];l.shadowDarkness.value=G.shadowMapDarkness,l.shadowBias.value=G.shadowMapBias}for(e=n.uniformsList,l=0,i=e.length;i>l;l++)if(m=o.uniforms[e[l][1]])if(p=e[l][0],E=p.type,s=p.value,"i"===E)U.uniform1i(m,s);else if("f"===E)U.uniform1f(m,s);else if("v2"===E)U.uniform2f(m,s.x,s.y);else if("v3"===E)U.uniform3f(m,s.x,s.y,s.z);else if("v4"===E)U.uniform4f(m,s.x,s.y,s.z,s.w);else if("c"===E)U.uniform3f(m,s.r,s.g,s.b);else if("fv1"===E)U.uniform1fv(m,s);else if("fv"===E)U.uniform3fv(m,s);else if("v3v"===E){for(p._array||(p._array=new Float32Array(3*s.length)),E=0,u=s.length;u>E;E++)g=3*E,p._array[g]=s[E].x,p._array[g+1]=s[E].y,p._array[g+2]=s[E].z;U.uniform3fv(m,p._array)}else if("m4"===E)p._array||(p._array=new Float32Array(16)),s.flattenToArray(p._array),U.uniformMatrix4fv(m,!1,p._array);else if("m4v"===E){for(p._array||(p._array=new Float32Array(16*s.length)),E=0,u=s.length;u>E;E++)s[E].flattenToArrayOffset(p._array,16*E);U.uniformMatrix4fv(m,!1,p._array)}else if("t"===E){if(U.uniform1i(m,s),m=p.texture)if(m.image instanceof Array&&6===m.image.length){if(p=m,6===p.image.length)if(p.needsUpdate){for(p.image.__webglTextureCube||(p.image.__webglTextureCube=U.createTexture()),U.activeTexture(U.TEXTURE0+s),U.bindTexture(U.TEXTURE_CUBE_MAP,p.image.__webglTextureCube),s=S(U.TEXTURE_CUBE_MAP,p,p.image[0]),m=0;6>m;m++)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,p.image[m]);s&&U.generateMipmap(U.TEXTURE_CUBE_MAP),p.needsUpdate=!1}else U.activeTexture(U.TEXTURE0+s),U.bindTexture(U.TEXTURE_CUBE_MAP,p.image.__webglTextureCube)}else m instanceof THREE.WebGLRenderTargetCube?(p=m,U.activeTexture(U.TEXTURE0+s),U.bindTexture(U.TEXTURE_CUBE_MAP,p.__webglTexture)):M(m,s)}else if("tv"===E){if(!p._array)for(p._array=[],E=0,u=p.texture.length;u>E;E++)p._array[E]=s+E;for(U.uniform1iv(m,p._array),E=0,u=p.texture.length;u>E;E++)(m=p.texture[E])&&M(m,p._array[E])}(n instanceof THREE.ShaderMaterial||n instanceof THREE.MeshPhongMaterial||n.envMap)&&null!==a.cameraPosition&&U.uniform3f(a.cameraPosition,t.position.x,t.position.y,t.position.z),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.ShaderMaterial||n.skinning)&&null!==a.viewMatrix&&U.uniformMatrix4fv(a.viewMatrix,!1,pe),n.skinning&&(U.uniformMatrix4fv(a.cameraInverseMatrix,!1,pe),U.uniformMatrix4fv(a.boneGlobalMatrices,!1,r.boneMatrices))}return U.uniformMatrix4fv(a.modelViewMatrix,!1,r._modelViewMatrixArray),a.normalMatrix&&U.uniformMatrix3fv(a.normalMatrix,!1,r._normalMatrixArray),(n instanceof THREE.ShaderMaterial||n.envMap||n.skinning||r.receiveShadow)&&null!==a.objectMatrix&&U.uniformMatrix4fv(a.objectMatrix,!1,r._objectMatrixArray),o}function T(t,e,i){t._modelViewMatrix.multiplyToArray(e.matrixWorldInverse,t.matrixWorld,t._modelViewMatrixArray),i&&THREE.Matrix4.makeInvert3x3(t._modelViewMatrix).transposeIntoArray(t._normalMatrixArray)}function b(t){K!==t.doubleSided&&(t.doubleSided?U.disable(U.CULL_FACE):U.enable(U.CULL_FACE),K=t.doubleSided),J!==t.flipSided&&(U.frontFace(t.flipSided?U.CW:U.CCW),J=t.flipSided)}function R(t){ee!==t&&(t?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST),ee=t)}function x(t){ie!==t&&(U.depthMask(t),ie=t)}function w(t,e,i){ne!==t&&(t?U.enable(U.POLYGON_OFFSET_FILL):U.disable(U.POLYGON_OFFSET_FILL),ne=t),!t||re===e&&oe===i||(U.polygonOffset(e,i),re=e,oe=i)}function H(t){if(t!==te){switch(t){case THREE.AdditiveBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE);break;case THREE.SubtractiveBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.SRC_COLOR);break;default:U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)}te=t}}function _(t,e){var i;return"fragment"===t?i=U.createShader(U.FRAGMENT_SHADER):"vertex"===t&&(i=U.createShader(U.VERTEX_SHADER)),U.shaderSource(i,e),U.compileShader(i),U.getShaderParameter(i,U.COMPILE_STATUS)?i:(console.error(U.getShaderInfoLog(i)),console.error(e),null)}function S(t,e,i){return 0===(i.width&i.width-1)&&0===(i.height&i.height-1)?(U.texParameteri(t,U.TEXTURE_WRAP_S,L(e.wrapS)),U.texParameteri(t,U.TEXTURE_WRAP_T,L(e.wrapT)),U.texParameteri(t,U.TEXTURE_MAG_FILTER,L(e.magFilter)),U.texParameteri(t,U.TEXTURE_MIN_FILTER,L(e.minFilter)),!0):(U.texParameteri(t,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(t,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(t,U.TEXTURE_MAG_FILTER,k(e.magFilter)),U.texParameteri(t,U.TEXTURE_MIN_FILTER,k(e.minFilter)),!1)}function M(t,e){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.__webglTexture=U.createTexture(),G.info.memory.textures++),U.activeTexture(U.TEXTURE0+e),U.bindTexture(U.TEXTURE_2D,t.__webglTexture);var i=S(U.TEXTURE_2D,t,t.image);t instanceof THREE.DataTexture?U.texImage2D(U.TEXTURE_2D,0,L(t.format),t.image.width,t.image.height,0,L(t.format),U.UNSIGNED_BYTE,t.image.data):U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,t.image),i&&U.generateMipmap(U.TEXTURE_2D),t.needsUpdate=!1,t.onUpdated&&t.onUpdated()}else U.activeTexture(U.TEXTURE0+e),U.bindTexture(U.TEXTURE_2D,t.__webglTexture)}function C(t,e){U.bindRenderbuffer(U.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,e.width,e.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,e.width,e.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,t)):U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,e.width,e.height)}function A(t){var e=t instanceof THREE.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){if(void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.__webglTexture=U.createTexture(),e){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],U.bindTexture(U.TEXTURE_CUBE_MAP,t.__webglTexture),S(U.TEXTURE_CUBE_MAP,t,t);for(var i=0;6>i;i++){t.__webglFramebuffer[i]=U.createFramebuffer(),t.__webglRenderbuffer[i]=U.createRenderbuffer(),U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,L(t.format),t.width,t.height,0,L(t.format),L(t.type),null);var n=t,r=U.TEXTURE_CUBE_MAP_POSITIVE_X+i;U.bindFramebuffer(U.FRAMEBUFFER,t.__webglFramebuffer[i]),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,r,n.__webglTexture,0),C(t.__webglRenderbuffer[i],t)}}else t.__webglFramebuffer=U.createFramebuffer(),t.__webglRenderbuffer=U.createRenderbuffer(),U.bindTexture(U.TEXTURE_2D,t.__webglTexture),S(U.TEXTURE_2D,t,t),U.texImage2D(U.TEXTURE_2D,0,L(t.format),t.width,t.height,0,L(t.format),L(t.type),null),i=U.TEXTURE_2D,U.bindFramebuffer(U.FRAMEBUFFER,t.__webglFramebuffer),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,i,t.__webglTexture,0),C(t.__webglRenderbuffer,t);
e?U.bindTexture(U.TEXTURE_CUBE_MAP,null):U.bindTexture(U.TEXTURE_2D,null),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null)}t?(e=e?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,i=t.width,t=t.height,r=n=0):(e=null,i=he,t=ce,n=se,r=le),e!==q&&(U.bindFramebuffer(U.FRAMEBUFFER,e),U.viewport(n,r,i,t),q=e)}function k(t){switch(t){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return U.NEAREST;default:return U.LINEAR}}function L(t){switch(t){case THREE.RepeatWrapping:return U.REPEAT;case THREE.ClampToEdgeWrapping:return U.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return U.MIRRORED_REPEAT;case THREE.NearestFilter:return U.NEAREST;case THREE.NearestMipMapNearestFilter:return U.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return U.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return U.LINEAR;case THREE.LinearMipMapNearestFilter:return U.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return U.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return U.BYTE;case THREE.UnsignedByteType:return U.UNSIGNED_BYTE;case THREE.ShortType:return U.SHORT;case THREE.UnsignedShortType:return U.UNSIGNED_SHORT;case THREE.IntType:return U.INT;case THREE.UnsignedShortType:return U.UNSIGNED_INT;case THREE.FloatType:return U.FLOAT;case THREE.AlphaFormat:return U.ALPHA;case THREE.RGBFormat:return U.RGB;case THREE.RGBAFormat:return U.RGBA;case THREE.LuminanceFormat:return U.LUMINANCE;case THREE.LuminanceAlphaFormat:return U.LUMINANCE_ALPHA}return 0}var t=t||{},N=void 0!==t.canvas?t.canvas:document.createElement("canvas"),P=void 0!==t.precision?t.precision:"highp",F=void 0!==t.antialias?t.antialias:!1,D=void 0!==t.stencil?t.stencil:!0,z=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,V=new THREE.Color(void 0!==t.clearColor?t.clearColor:0),I=void 0!==t.clearAlpha?t.clearAlpha:0,B=void 0!==t.maxLights?t.maxLights:4;this.domElement=N,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapBias=.0039,this.shadowMapDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCameraNear=1,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowMap=[],this.shadowMapEnabled=!1,this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.maxMorphTargets=8,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var U,O,j,W,G=this,X=[],$=null,q=null,Y=-1,Q=null,Z=0,K=null,J=null,te=null,ee=null,ie=null,ne=null,re=null,oe=null,ae=null,se=0,le=0,he=0,ce=0,ue=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],fe=new THREE.Matrix4,de=new Float32Array(16),pe=new Float32Array(16),me=new THREE.Vector4,Ee={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},ge=[],ve={},ye=!1;U=function(){var t;try{if(!(t=N.getContext("experimental-webgl",{antialias:F,stencil:D,preserveDrawingBuffer:z})))throw"Error creating WebGL context.";console.log(navigator.userAgent+" | "+t.getParameter(t.VERSION)+" | "+t.getParameter(t.VENDOR)+" | "+t.getParameter(t.RENDERER)+" | "+t.getParameter(t.SHADING_LANGUAGE_VERSION))}catch(e){console.error(e)}return t}(),U.clearColor(0,0,0,1),U.clearDepth(1),U.clearStencil(0),U.enable(U.DEPTH_TEST),U.depthFunc(U.LEQUAL),U.frontFace(U.CCW),U.cullFace(U.BACK),U.enable(U.CULL_FACE),U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA),U.clearColor(V.r,V.g,V.b,I),function(){ve.vertices=new Float32Array(16),ve.faces=new Uint16Array(6);var t=0;ve.vertices[t++]=-1,ve.vertices[t++]=-1,ve.vertices[t++]=0,ve.vertices[t++]=1,ve.vertices[t++]=1,ve.vertices[t++]=-1,ve.vertices[t++]=1,ve.vertices[t++]=1,ve.vertices[t++]=1,ve.vertices[t++]=1,ve.vertices[t++]=1,ve.vertices[t++]=0,ve.vertices[t++]=-1,ve.vertices[t++]=1,ve.vertices[t++]=0,t=ve.vertices[t++]=0,ve.faces[t++]=0,ve.faces[t++]=1,ve.faces[t++]=2,ve.faces[t++]=0,ve.faces[t++]=2,ve.faces[t++]=3,ve.vertexBuffer=U.createBuffer(),ve.elementBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,ve.vertexBuffer),U.bufferData(U.ARRAY_BUFFER,ve.vertices,U.STATIC_DRAW),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,ve.elementBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,ve.faces,U.STATIC_DRAW),ve.program=U.createProgram(),U.attachShader(ve.program,_("fragment",THREE.ShaderLib.sprite.fragmentShader)),U.attachShader(ve.program,_("vertex",THREE.ShaderLib.sprite.vertexShader)),U.linkProgram(ve.program),ve.attributes={},ve.uniforms={},ve.attributes.position=U.getAttribLocation(ve.program,"position"),ve.attributes.uv=U.getAttribLocation(ve.program,"uv"),ve.uniforms.uvOffset=U.getUniformLocation(ve.program,"uvOffset"),ve.uniforms.uvScale=U.getUniformLocation(ve.program,"uvScale"),ve.uniforms.rotation=U.getUniformLocation(ve.program,"rotation"),ve.uniforms.scale=U.getUniformLocation(ve.program,"scale"),ve.uniforms.alignment=U.getUniformLocation(ve.program,"alignment"),ve.uniforms.color=U.getUniformLocation(ve.program,"color"),ve.uniforms.map=U.getUniformLocation(ve.program,"map"),ve.uniforms.opacity=U.getUniformLocation(ve.program,"opacity"),ve.uniforms.useScreenCoordinates=U.getUniformLocation(ve.program,"useScreenCoordinates"),ve.uniforms.affectedByDistance=U.getUniformLocation(ve.program,"affectedByDistance"),ve.uniforms.screenPosition=U.getUniformLocation(ve.program,"screenPosition"),ve.uniforms.modelViewMatrix=U.getUniformLocation(ve.program,"modelViewMatrix"),ve.uniforms.projectionMatrix=U.getUniformLocation(ve.program,"projectionMatrix")}(),function(){var t=THREE.ShaderLib.depthRGBA,e=THREE.UniformsUtils.clone(t.uniforms);j=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:e}),W=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:e,morphTargets:!0}),j._shadowPass=!0,W._shadowPass=!0}(),this.context=U;var Te=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return U},this.supportsVertexTextures=function(){return Te},this.setSize=function(t,e){N.width=t,N.height=e,this.setViewport(0,0,N.width,N.height)},this.setViewport=function(t,e,i,n){se=t,le=e,he=i,ce=n,U.viewport(se,le,he,ce)},this.setScissor=function(t,e,i,n){U.scissor(t,e,i,n)},this.enableScissorTest=function(t){t?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)},this.setClearColorHex=function(t,e){V.setHex(t),I=e,U.clearColor(V.r,V.g,V.b,I)},this.setClearColor=function(t,e){V.copy(t),I=e,U.clearColor(V.r,V.g,V.b,I)},this.getClearColor=function(){return V},this.getClearAlpha=function(){return I},this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=U.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=U.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=U.STENCIL_BUFFER_BIT),U.clear(n)},this.clearTarget=function(t,e,i,n){A(t),this.clear(e,i,n)},this.deallocateObject=function(t){if(t.__webglInit)if(t.__webglInit=!1,delete t._modelViewMatrix,delete t._normalMatrixArray,delete t._modelViewMatrixArray,delete t._objectMatrixArray,t instanceof THREE.Mesh)for(var e in t.geometry.geometryGroups){var i=t.geometry.geometryGroups[e];if(U.deleteBuffer(i.__webglVertexBuffer),U.deleteBuffer(i.__webglNormalBuffer),U.deleteBuffer(i.__webglTangentBuffer),U.deleteBuffer(i.__webglColorBuffer),U.deleteBuffer(i.__webglUVBuffer),U.deleteBuffer(i.__webglUV2Buffer),U.deleteBuffer(i.__webglSkinVertexABuffer),U.deleteBuffer(i.__webglSkinVertexBBuffer),U.deleteBuffer(i.__webglSkinIndicesBuffer),U.deleteBuffer(i.__webglSkinWeightsBuffer),U.deleteBuffer(i.__webglFaceBuffer),U.deleteBuffer(i.__webglLineBuffer),i.numMorphTargets)for(var n=0,r=i.numMorphTargets;r>n;n++)U.deleteBuffer(i.__webglMorphTargetsBuffers[n]);if(i.__webglCustomAttributesList)for(n in n=void 0,i.__webglCustomAttributesList)U.deleteBuffer(i.__webglCustomAttributesList[n].buffer);G.info.memory.geometries--}else t instanceof THREE.Ribbon?(t=t.geometry,U.deleteBuffer(t.__webglVertexBuffer),U.deleteBuffer(t.__webglColorBuffer),G.info.memory.geometries--):t instanceof THREE.Line?(t=t.geometry,U.deleteBuffer(t.__webglVertexBuffer),U.deleteBuffer(t.__webglColorBuffer),G.info.memory.geometries--):t instanceof THREE.ParticleSystem&&(t=t.geometry,U.deleteBuffer(t.__webglVertexBuffer),U.deleteBuffer(t.__webglColorBuffer),G.info.memory.geometries--)},this.deallocateTexture=function(t){t.__webglInit&&(t.__webglInit=!1,U.deleteTexture(t.__webglTexture),G.info.memory.textures--)},this.updateShadowMap=function(t,e){f(t,e)},this.render=function(t,e,i,n){var r,o,a,s,l=t.lights,m=t.fog;for(Y=-1,this.autoUpdateObjects&&this.initWebGLObjects(t),void 0===e.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),t.add(e)),this.autoUpdateScene&&t.updateMatrixWorld(),this.shadowMapEnabled&&this.shadowMapAutoUpdate&&f(t,e),G.info.render.calls=0,G.info.render.vertices=0,G.info.render.faces=0,e.matrixWorldInverse.getInverse(e.matrixWorld),e.matrixWorldInverse.flattenToArray(pe),e.projectionMatrix.flattenToArray(de),fe.multiply(e.projectionMatrix,e.matrixWorldInverse),h(fe),A(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s=t.__webglObjects,n=0,r=s.length;r>n;n++)if(o=s[n],a=o.object,o.render=!1,!(!a.visible||a instanceof THREE.Mesh&&a.frustumCulled&&!c(a))){a.matrixWorld.flattenToArray(a._objectMatrixArray),T(a,e,!0);var E=o,g=E.object,v=E.buffer,y=void 0,y=y=void 0,y=g.material;y instanceof THREE.MeshFaceMaterial?(y=v.materialIndex,y>=0&&(y=g.geometry.materials[y],y.transparent?(E.transparent=y,E.opaque=null):(E.opaque=y,E.transparent=null))):y&&(y.transparent?(E.transparent=y,E.opaque=null):(E.opaque=y,E.transparent=null)),o.render=!0,this.sortObjects&&(a.renderDepth?o.z=a.renderDepth:(me.copy(a.position),fe.multiplyVector3(me),o.z=me.z))}for(this.sortObjects&&s.sort(u),s=t.__webglObjectsImmediate,n=0,r=s.length;r>n;n++)o=s[n],a=o.object,a.visible&&(a.matrixAutoUpdate&&a.matrixWorld.flattenToArray(a._objectMatrixArray),T(a,e,!0),a=o.object.material,a.transparent?(o.transparent=a,o.opaque=null):(o.opaque=a,o.transparent=null));if(t.overrideMaterial?(H(t.overrideMaterial.blending),R(t.overrideMaterial.depthTest),x(t.overrideMaterial.depthWrite),w(t.overrideMaterial.polygonOffset,t.overrideMaterial.polygonOffsetFactor,t.overrideMaterial.polygonOffsetUnits),d(t.__webglObjects,!1,"",e,l,m,!0,t.overrideMaterial),p(t.__webglObjectsImmediate,"",e,l,m,!1,t.overrideMaterial)):(H(THREE.NormalBlending),d(t.__webglObjects,!0,"opaque",e,l,m,!1),p(t.__webglObjectsImmediate,"opaque",e,l,m,!1),d(t.__webglObjects,!1,"transparent",e,l,m,!0),p(t.__webglObjectsImmediate,"transparent",e,l,m,!0)),t.__webglSprites.length){for(a=ve.attributes,l=ve.uniforms,m=ce/he,n=[],r=.5*he,s=.5*ce,o=!0,U.useProgram(ve.program),$=ve.program,Q=ee=te=-1,ye||(U.enableVertexAttribArray(ve.attributes.position),U.enableVertexAttribArray(ve.attributes.uv),ye=!0),U.disable(U.CULL_FACE),U.enable(U.BLEND),U.depthMask(!0),U.bindBuffer(U.ARRAY_BUFFER,ve.vertexBuffer),U.vertexAttribPointer(a.position,2,U.FLOAT,!1,16,0),U.vertexAttribPointer(a.uv,2,U.FLOAT,!1,16,8),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,ve.elementBuffer),U.uniformMatrix4fv(l.projectionMatrix,!1,de),U.activeTexture(U.TEXTURE0),U.uniform1i(l.map,0),a=0,E=t.__webglSprites.length;E>a;a++)g=t.__webglSprites[a],g.visible&&0!==g.opacity&&(g.useScreenCoordinates?g.z=-g.position.z:(g._modelViewMatrix.multiplyToArray(e.matrixWorldInverse,g.matrixWorld,g._modelViewMatrixArray),g.z=-g._modelViewMatrix.n34));for(t.__webglSprites.sort(u),a=0,E=t.__webglSprites.length;E>a;a++)g=t.__webglSprites[a],g.visible&&0!==g.opacity&&g.map&&g.map.image&&g.map.image.width&&(g.useScreenCoordinates?(U.uniform1i(l.useScreenCoordinates,1),U.uniform3f(l.screenPosition,(g.position.x-r)/r,(s-g.position.y)/s,Math.max(0,Math.min(1,g.position.z)))):(U.uniform1i(l.useScreenCoordinates,0),U.uniform1i(l.affectedByDistance,g.affectedByDistance?1:0),U.uniformMatrix4fv(l.modelViewMatrix,!1,g._modelViewMatrixArray)),e=g.map.image.width/(g.scaleByViewport?ce:1),n[0]=e*m*g.scale.x,n[1]=e*g.scale.y,U.uniform2f(l.uvScale,g.uvScale.x,g.uvScale.y),U.uniform2f(l.uvOffset,g.uvOffset.x,g.uvOffset.y),U.uniform2f(l.alignment,g.alignment.x,g.alignment.y),U.uniform1f(l.opacity,g.opacity),U.uniform3f(l.color,g.color.r,g.color.g,g.color.b),U.uniform1f(l.rotation,g.rotation),U.uniform2fv(l.scale,n),g.mergeWith3D&&!o?(U.enable(U.DEPTH_TEST),o=!0):!g.mergeWith3D&&o&&(U.disable(U.DEPTH_TEST),o=!1),H(g.blending),M(g.map,0),U.drawElements(U.TRIANGLES,6,U.UNSIGNED_SHORT,0));U.enable(U.CULL_FACE),U.enable(U.DEPTH_TEST),U.depthMask(ie)}i&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&(i instanceof THREE.WebGLRenderTargetCube?(U.bindTexture(U.TEXTURE_CUBE_MAP,i.__webglTexture),U.generateMipmap(U.TEXTURE_CUBE_MAP),U.bindTexture(U.TEXTURE_CUBE_MAP,null)):(U.bindTexture(U.TEXTURE_2D,i.__webglTexture),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null)))},this.initWebGLObjects=function(t){for(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[]);t.__objectsAdded.length;){var s=t.__objectsAdded[0],l=t,h=void 0,c=void 0,u=void 0;if(!s.__webglInit)if(s.__webglInit=!0,s._modelViewMatrix=new THREE.Matrix4,s._normalMatrixArray=new Float32Array(9),s._modelViewMatrixArray=new Float32Array(16),s._objectMatrixArray=new Float32Array(16),s.matrixWorld.flattenToArray(s._objectMatrixArray),s instanceof THREE.Mesh){if(c=s.geometry,void 0===c.geometryGroups){var u=c,f=void 0,d=void 0,p=void 0,y=void 0,T=void 0,b=void 0,R=void 0,x={},w=u.morphTargets.length;for(u.geometryGroups={},f=0,d=u.faces.length;d>f;f++)p=u.faces[f],y=p.materialIndex,b=void 0!==y?y:-1,void 0===x[b]&&(x[b]={hash:b,counter:0}),R=x[b].hash+"_"+x[b].counter,void 0===u.geometryGroups[R]&&(u.geometryGroups[R]={faces3:[],faces4:[],materialIndex:y,vertices:0,numMorphTargets:w}),T=p instanceof THREE.Face3?3:4,u.geometryGroups[R].vertices+T>65535&&(x[b].counter+=1,R=x[b].hash+"_"+x[b].counter,void 0===u.geometryGroups[R]&&(u.geometryGroups[R]={faces3:[],faces4:[],materialIndex:y,vertices:0,numMorphTargets:w})),p instanceof THREE.Face3?u.geometryGroups[R].faces3.push(f):u.geometryGroups[R].faces4.push(f),u.geometryGroups[R].vertices+=T;u.geometryGroupsList=[],f=void 0;for(f in u.geometryGroups)u.geometryGroups[f].id=Z++,u.geometryGroupsList.push(u.geometryGroups[f])}for(h in c.geometryGroups)if(u=c.geometryGroups[h],!u.__webglVertexBuffer){if(f=u,f.__webglVertexBuffer=U.createBuffer(),f.__webglNormalBuffer=U.createBuffer(),f.__webglTangentBuffer=U.createBuffer(),f.__webglColorBuffer=U.createBuffer(),f.__webglUVBuffer=U.createBuffer(),f.__webglUV2Buffer=U.createBuffer(),f.__webglSkinVertexABuffer=U.createBuffer(),f.__webglSkinVertexBBuffer=U.createBuffer(),f.__webglSkinIndicesBuffer=U.createBuffer(),f.__webglSkinWeightsBuffer=U.createBuffer(),f.__webglFaceBuffer=U.createBuffer(),f.__webglLineBuffer=U.createBuffer(),f.numMorphTargets)for(p=d=void 0,f.__webglMorphTargetsBuffers=[],d=0,p=f.numMorphTargets;p>d;d++)f.__webglMorphTargetsBuffers.push(U.createBuffer());if(G.info.memory.geometries++,y=s,T=y.geometry,d=u.faces3,b=u.faces4,f=3*d.length+4*b.length,p=1*d.length+2*b.length,b=3*d.length+4*b.length,d=i(y,u),R=o(d),x=n(d),w=r(d),u.__vertexArray=new Float32Array(3*f),x&&(u.__normalArray=new Float32Array(3*f)),T.hasTangents&&(u.__tangentArray=new Float32Array(4*f)),w&&(u.__colorArray=new Float32Array(3*f)),R&&((T.faceUvs.length>0||T.faceVertexUvs.length>0)&&(u.__uvArray=new Float32Array(2*f)),(T.faceUvs.length>1||T.faceVertexUvs.length>1)&&(u.__uv2Array=new Float32Array(2*f))),y.geometry.skinWeights.length&&y.geometry.skinIndices.length&&(u.__skinVertexAArray=new Float32Array(4*f),u.__skinVertexBArray=new Float32Array(4*f),u.__skinIndexArray=new Float32Array(4*f),u.__skinWeightArray=new Float32Array(4*f)),u.__faceArray=new Uint16Array(3*p),u.__lineArray=new Uint16Array(2*b),u.numMorphTargets)for(u.__morphTargetsArrays=[],y=0,T=u.numMorphTargets;T>y;y++)u.__morphTargetsArrays.push(new Float32Array(3*f));if(u.__webglFaceCount=3*p,u.__webglLineCount=2*b,d.attributes){void 0===u.__webglCustomAttributesList&&(u.__webglCustomAttributesList=[]),p=void 0;for(p in d.attributes){var H,y=d.attributes[p],T={};for(H in y)T[H]=y[H];(!T.__webglInitialized||T.createUniqueBuffers)&&(T.__webglInitialized=!0,b=1,"v2"===T.type?b=2:"v3"===T.type?b=3:"v4"===T.type?b=4:"c"===T.type&&(b=3),T.size=b,T.array=new Float32Array(f*b),T.buffer=U.createBuffer(),T.buffer.belongsToAttribute=p,y.needsUpdate=!0,T.__original=y),u.__webglCustomAttributesList.push(T)}}u.__inittedArrays=!0,c.__dirtyVertices=!0,c.__dirtyMorphTargets=!0,c.__dirtyElements=!0,c.__dirtyUvs=!0,c.__dirtyNormals=!0,c.__dirtyTangents=!0,c.__dirtyColors=!0}}else s instanceof THREE.Ribbon?(c=s.geometry,c.__webglVertexBuffer||(u=c,u.__webglVertexBuffer=U.createBuffer(),u.__webglColorBuffer=U.createBuffer(),G.info.memory.geometries++,u=c,f=u.vertices.length,u.__vertexArray=new Float32Array(3*f),u.__colorArray=new Float32Array(3*f),u.__webglVertexCount=f,c.__dirtyVertices=!0,c.__dirtyColors=!0)):s instanceof THREE.Line?(c=s.geometry,c.__webglVertexBuffer||(u=c,u.__webglVertexBuffer=U.createBuffer(),u.__webglColorBuffer=U.createBuffer(),G.info.memory.geometries++,u=c,f=s,d=u.vertices.length,u.__vertexArray=new Float32Array(3*d),u.__colorArray=new Float32Array(3*d),u.__webglLineCount=d,e(u,f),c.__dirtyVertices=!0,c.__dirtyColors=!0)):s instanceof THREE.ParticleSystem&&(c=s.geometry,!c.__webglVertexBuffer)&&(u=c,u.__webglVertexBuffer=U.createBuffer(),u.__webglColorBuffer=U.createBuffer(),G.info.geometries++,u=c,f=s,d=u.vertices.length,u.__vertexArray=new Float32Array(3*d),u.__colorArray=new Float32Array(3*d),u.__sortArray=[],u.__webglParticleCount=d,e(u,f),c.__dirtyVertices=!0,c.__dirtyColors=!0);if(!s.__webglActive){if(s instanceof THREE.Mesh)for(h in c=s.geometry,c.geometryGroups)u=c.geometryGroups[h],m(l.__webglObjects,u,s);else s instanceof THREE.Ribbon||s instanceof THREE.Line||s instanceof THREE.ParticleSystem?(c=s.geometry,m(l.__webglObjects,c,s)):void 0!==THREE.MarchingCubes&&s instanceof THREE.MarchingCubes||s.immediateRenderCallback?l.__webglObjectsImmediate.push({object:s,opaque:null,transparent:null}):s instanceof THREE.Sprite&&l.__webglSprites.push(s);s.__webglActive=!0}t.__objectsAdded.splice(0,1)}for(;t.__objectsRemoved.length;){if(s=t.__objectsRemoved[0],l=t,s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem||s instanceof THREE.Ribbon||s instanceof THREE.Line)v(l.__webglObjects,s);else if(s instanceof THREE.Sprite)for(l=l.__webglSprites,h=s,c=l.length-1;c>=0;c--)l[c]===h&&l.splice(c,1);else(s instanceof THREE.MarchingCubes||s.immediateRenderCallback)&&v(l.__webglObjectsImmediate,s);s.__webglActive=!1,t.__objectsRemoved.splice(0,1)}for(s=0,l=t.__webglObjects.length;l>s;s++)if(H=t.__webglObjects[s].object,h=H.geometry,c=p=d=void 0,H instanceof THREE.Mesh){for(u=0,f=h.geometryGroupsList.length;f>u;u++)if(d=h.geometryGroupsList[u],c=i(H,d),p=c.attributes&&E(c),h.__dirtyVertices||h.__dirtyMorphTargets||h.__dirtyElements||h.__dirtyUvs||h.__dirtyNormals||h.__dirtyColors||h.__dirtyTangents||p){var _=H,p=U.DYNAMIC_DRAW,y=!h.dynamic,R=c;if(d.__inittedArrays){var T=n(R),b=r(R),S=o(R),M=T===THREE.SmoothShading,C=x=R=void 0,A=void 0,k=void 0,L=void 0,N=void 0,P=void 0,F=void 0,D=C=void 0,z=void 0,V=void 0,I=void 0,B=A=void 0,O=void 0,j=void 0,W=A=F=void 0,X=void 0,$=I=V=z=N=void 0,q=A=I=V=z=$=I=V=z=$=I=V=z=void 0,Y=void 0,Q=L=void 0,K=void 0,J=void 0,te=void 0,ee=void 0,ie=D=J=Y=0,ne=0,re=q=C=0,oe=N=B=0,ae=0,se=void 0,oe=d.__vertexArray,K=d.__uvArray,ae=d.__uv2Array,Q=d.__normalArray,k=d.__tangentArray,O=d.__colorArray,W=d.__skinVertexAArray,X=d.__skinVertexBArray,P=d.__skinIndexArray,le=d.__skinWeightArray,$=d.__morphTargetsArrays,w=d.__webglCustomAttributesList,he=void 0,he=d.__faceArray,se=d.__lineArray,j=_.geometry,ce=j.__dirtyElements,ue=j.__dirtyUvs,L=j.__dirtyNormals,F=j.__dirtyTangents,fe=j.__dirtyColors,te=j.__dirtyMorphTargets,ee=j.vertices,_=d.faces3,de=d.faces4,pe=j.faces,me=j.faceVertexUvs[0],Ee=j.faceVertexUvs[1],ge=j.skinVerticesA,ve=j.skinVerticesB,ye=j.skinIndices,Te=j.skinWeights,be=j.morphTargets;if(j.__dirtyVertices){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],z=ee[A.a].position,V=ee[A.b].position,I=ee[A.c].position,oe[J]=z.x,oe[J+1]=z.y,oe[J+2]=z.z,oe[J+3]=V.x,oe[J+4]=V.y,oe[J+5]=V.z,oe[J+6]=I.x,oe[J+7]=I.y,oe[J+8]=I.z,J+=9;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=ee[A.a].position,V=ee[A.b].position,I=ee[A.c].position,A=ee[A.d].position,oe[J]=z.x,oe[J+1]=z.y,oe[J+2]=z.z,oe[J+3]=V.x,oe[J+4]=V.y,oe[J+5]=V.z,oe[J+6]=I.x,oe[J+7]=I.y,oe[J+8]=I.z,oe[J+9]=A.x,oe[J+10]=A.y,oe[J+11]=A.z,J+=12;U.bindBuffer(U.ARRAY_BUFFER,d.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,oe,p)}if(te)for(J=0,te=be.length;te>J;J++){for(R=oe=0,x=_.length;x>R;R++)A=pe[_[R]],z=be[J].vertices[A.a].position,V=be[J].vertices[A.b].position,I=be[J].vertices[A.c].position,ee=$[J],ee[oe]=z.x,ee[oe+1]=z.y,ee[oe+2]=z.z,ee[oe+3]=V.x,ee[oe+4]=V.y,ee[oe+5]=V.z,ee[oe+6]=I.x,ee[oe+7]=I.y,ee[oe+8]=I.z,oe+=9;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=be[J].vertices[A.a].position,V=be[J].vertices[A.b].position,I=be[J].vertices[A.c].position,A=be[J].vertices[A.d].position,ee=$[J],ee[oe]=z.x,ee[oe+1]=z.y,ee[oe+2]=z.z,ee[oe+3]=V.x,ee[oe+4]=V.y,ee[oe+5]=V.z,ee[oe+6]=I.x,ee[oe+7]=I.y,ee[oe+8]=I.z,ee[oe+9]=A.x,ee[oe+10]=A.y,ee[oe+11]=A.z,oe+=12;U.bindBuffer(U.ARRAY_BUFFER,d.__webglMorphTargetsBuffers[J]),U.bufferData(U.ARRAY_BUFFER,$[J],p)}if(Te.length){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],z=Te[A.a],V=Te[A.b],I=Te[A.c],le[N]=z.x,le[N+1]=z.y,le[N+2]=z.z,le[N+3]=z.w,le[N+4]=V.x,le[N+5]=V.y,le[N+6]=V.z,le[N+7]=V.w,le[N+8]=I.x,le[N+9]=I.y,le[N+10]=I.z,le[N+11]=I.w,z=ye[A.a],V=ye[A.b],I=ye[A.c],P[N]=z.x,P[N+1]=z.y,P[N+2]=z.z,P[N+3]=z.w,P[N+4]=V.x,P[N+5]=V.y,P[N+6]=V.z,P[N+7]=V.w,P[N+8]=I.x,P[N+9]=I.y,P[N+10]=I.z,P[N+11]=I.w,z=ge[A.a],V=ge[A.b],I=ge[A.c],W[N]=z.x,W[N+1]=z.y,W[N+2]=z.z,W[N+3]=1,W[N+4]=V.x,W[N+5]=V.y,W[N+6]=V.z,W[N+7]=1,W[N+8]=I.x,W[N+9]=I.y,W[N+10]=I.z,W[N+11]=1,z=ve[A.a],V=ve[A.b],I=ve[A.c],X[N]=z.x,X[N+1]=z.y,X[N+2]=z.z,X[N+3]=1,X[N+4]=V.x,X[N+5]=V.y,X[N+6]=V.z,X[N+7]=1,X[N+8]=I.x,X[N+9]=I.y,X[N+10]=I.z,X[N+11]=1,N+=12;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=Te[A.a],V=Te[A.b],I=Te[A.c],$=Te[A.d],le[N]=z.x,le[N+1]=z.y,le[N+2]=z.z,le[N+3]=z.w,le[N+4]=V.x,le[N+5]=V.y,le[N+6]=V.z,le[N+7]=V.w,le[N+8]=I.x,le[N+9]=I.y,le[N+10]=I.z,le[N+11]=I.w,le[N+12]=$.x,le[N+13]=$.y,le[N+14]=$.z,le[N+15]=$.w,z=ye[A.a],V=ye[A.b],I=ye[A.c],$=ye[A.d],P[N]=z.x,P[N+1]=z.y,P[N+2]=z.z,P[N+3]=z.w,P[N+4]=V.x,P[N+5]=V.y,P[N+6]=V.z,P[N+7]=V.w,P[N+8]=I.x,P[N+9]=I.y,P[N+10]=I.z,P[N+11]=I.w,P[N+12]=$.x,P[N+13]=$.y,P[N+14]=$.z,P[N+15]=$.w,z=ge[A.a],V=ge[A.b],I=ge[A.c],$=ge[A.d],W[N]=z.x,W[N+1]=z.y,W[N+2]=z.z,W[N+3]=1,W[N+4]=V.x,W[N+5]=V.y,W[N+6]=V.z,W[N+7]=1,W[N+8]=I.x,W[N+9]=I.y,W[N+10]=I.z,W[N+11]=1,W[N+12]=$.x,W[N+13]=$.y,W[N+14]=$.z,W[N+15]=1,z=ve[A.a],V=ve[A.b],I=ve[A.c],A=ve[A.d],X[N]=z.x,X[N+1]=z.y,X[N+2]=z.z,X[N+3]=1,X[N+4]=V.x,X[N+5]=V.y,X[N+6]=V.z,X[N+7]=1,X[N+8]=I.x,X[N+9]=I.y,X[N+10]=I.z,X[N+11]=1,X[N+12]=A.x,X[N+13]=A.y,X[N+14]=A.z,X[N+15]=1,N+=16;N>0&&(U.bindBuffer(U.ARRAY_BUFFER,d.__webglSkinVertexABuffer),U.bufferData(U.ARRAY_BUFFER,W,p),U.bindBuffer(U.ARRAY_BUFFER,d.__webglSkinVertexBBuffer),U.bufferData(U.ARRAY_BUFFER,X,p),U.bindBuffer(U.ARRAY_BUFFER,d.__webglSkinIndicesBuffer),U.bufferData(U.ARRAY_BUFFER,P,p),U.bindBuffer(U.ARRAY_BUFFER,d.__webglSkinWeightsBuffer),U.bufferData(U.ARRAY_BUFFER,le,p))}if(fe&&b){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],N=A.vertexColors,P=A.color,3===N.length&&b===THREE.VertexColors?(A=N[0],W=N[1],X=N[2]):X=W=A=P,O[B]=A.r,O[B+1]=A.g,O[B+2]=A.b,O[B+3]=W.r,O[B+4]=W.g,O[B+5]=W.b,O[B+6]=X.r,O[B+7]=X.g,O[B+8]=X.b,B+=9;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],N=A.vertexColors,P=A.color,4===N.length&&b===THREE.VertexColors?(A=N[0],W=N[1],X=N[2],N=N[3]):N=X=W=A=P,O[B]=A.r,O[B+1]=A.g,O[B+2]=A.b,O[B+3]=W.r,O[B+4]=W.g,O[B+5]=W.b,O[B+6]=X.r,O[B+7]=X.g,O[B+8]=X.b,O[B+9]=N.r,O[B+10]=N.g,O[B+11]=N.b,B+=12;B>0&&(U.bindBuffer(U.ARRAY_BUFFER,d.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,O,p))}if(F&&j.hasTangents){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],F=A.vertexTangents,B=F[0],O=F[1],j=F[2],k[q]=B.x,k[q+1]=B.y,k[q+2]=B.z,k[q+3]=B.w,k[q+4]=O.x,k[q+5]=O.y,k[q+6]=O.z,k[q+7]=O.w,k[q+8]=j.x,k[q+9]=j.y,k[q+10]=j.z,k[q+11]=j.w,q+=12;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],F=A.vertexTangents,B=F[0],O=F[1],j=F[2],F=F[3],k[q]=B.x,k[q+1]=B.y,k[q+2]=B.z,k[q+3]=B.w,k[q+4]=O.x,k[q+5]=O.y,k[q+6]=O.z,k[q+7]=O.w,k[q+8]=j.x,k[q+9]=j.y,k[q+10]=j.z,k[q+11]=j.w,k[q+12]=F.x,k[q+13]=F.y,k[q+14]=F.z,k[q+15]=F.w,q+=16;U.bindBuffer(U.ARRAY_BUFFER,d.__webglTangentBuffer),U.bufferData(U.ARRAY_BUFFER,k,p)}if(L&&T){for(R=0,x=_.length;x>R;R++)if(A=pe[_[R]],k=A.vertexNormals,L=A.normal,3===k.length&&M)for(q=0;3>q;q++)L=k[q],Q[C]=L.x,Q[C+1]=L.y,Q[C+2]=L.z,C+=3;else for(q=0;3>q;q++)Q[C]=L.x,Q[C+1]=L.y,Q[C+2]=L.z,C+=3;for(R=0,x=de.length;x>R;R++)if(A=pe[de[R]],k=A.vertexNormals,L=A.normal,4===k.length&&M)for(q=0;4>q;q++)L=k[q],Q[C]=L.x,Q[C+1]=L.y,Q[C+2]=L.z,C+=3;else for(q=0;4>q;q++)Q[C]=L.x,Q[C+1]=L.y,Q[C+2]=L.z,C+=3;U.bindBuffer(U.ARRAY_BUFFER,d.__webglNormalBuffer),U.bufferData(U.ARRAY_BUFFER,Q,p)}if(ue&&me&&S){for(R=0,x=_.length;x>R;R++)if(C=_[R],C=me[C],void 0!==C)for(q=0;3>q;q++)Q=C[q],K[D]=Q.u,K[D+1]=Q.v,D+=2;for(R=0,x=de.length;x>R;R++)if(C=de[R],C=me[C],void 0!==C)for(q=0;4>q;q++)Q=C[q],K[D]=Q.u,K[D+1]=Q.v,D+=2;D>0&&(U.bindBuffer(U.ARRAY_BUFFER,d.__webglUVBuffer),U.bufferData(U.ARRAY_BUFFER,K,p))}if(ue&&Ee&&S){for(R=0,x=_.length;x>R;R++)if(C=_[R],D=Ee[C],void 0!==D)for(q=0;3>q;q++)K=D[q],ae[ie]=K.u,ae[ie+1]=K.v,ie+=2;for(R=0,x=de.length;x>R;R++)if(C=de[R],D=Ee[C],void 0!==D)for(q=0;4>q;q++)K=D[q],ae[ie]=K.u,ae[ie+1]=K.v,ie+=2;ie>0&&(U.bindBuffer(U.ARRAY_BUFFER,d.__webglUV2Buffer),U.bufferData(U.ARRAY_BUFFER,ae,p))}if(ce){for(R=0,x=_.length;x>R;R++)he[ne]=Y,he[ne+1]=Y+1,he[ne+2]=Y+2,ne+=3,se[re]=Y,se[re+1]=Y+1,se[re+2]=Y,se[re+3]=Y+2,se[re+4]=Y+1,se[re+5]=Y+2,re+=6,Y+=3;for(R=0,x=de.length;x>R;R++)he[ne]=Y,he[ne+1]=Y+1,he[ne+2]=Y+3,he[ne+3]=Y+1,he[ne+4]=Y+2,he[ne+5]=Y+3,ne+=6,se[re]=Y,se[re+1]=Y+1,se[re+2]=Y,se[re+3]=Y+3,se[re+4]=Y+1,se[re+5]=Y+2,se[re+6]=Y+2,se[re+7]=Y+3,re+=8,Y+=4;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,d.__webglFaceBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,he,p),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,d.__webglLineBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,se,p)}if(w)for(q=0,Y=w.length;Y>q;q++)if(he=w[q],he.__original.needsUpdate){if(ae=0,1===he.size){if(void 0===he.boundTo||"vertices"===he.boundTo){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],he.array[ae]=he.value[A.a],he.array[ae+1]=he.value[A.b],he.array[ae+2]=he.value[A.c],ae+=3;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],he.array[ae]=he.value[A.a],he.array[ae+1]=he.value[A.b],he.array[ae+2]=he.value[A.c],he.array[ae+3]=he.value[A.d],ae+=4}else if("faces"===he.boundTo){for(R=0,x=_.length;x>R;R++)se=he.value[_[R]],he.array[ae]=se,he.array[ae+1]=se,he.array[ae+2]=se,ae+=3;for(R=0,x=de.length;x>R;R++)se=he.value[de[R]],he.array[ae]=se,he.array[ae+1]=se,he.array[ae+2]=se,he.array[ae+3]=se,ae+=4}}else if(2===he.size){if(void 0===he.boundTo||"vertices"===he.boundTo){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=V.x,he.array[ae+3]=V.y,he.array[ae+4]=I.x,he.array[ae+5]=I.y,ae+=6;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],A=he.value[A.d],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=V.x,he.array[ae+3]=V.y,he.array[ae+4]=I.x,he.array[ae+5]=I.y,he.array[ae+6]=A.x,he.array[ae+7]=A.y,ae+=8}else if("faces"===he.boundTo){for(R=0,x=_.length;x>R;R++)I=V=z=se=he.value[_[R]],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=V.x,he.array[ae+3]=V.y,he.array[ae+4]=I.x,he.array[ae+5]=I.y,ae+=6;for(R=0,x=de.length;x>R;R++)A=I=V=z=se=he.value[de[R]],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=V.x,he.array[ae+3]=V.y,he.array[ae+4]=I.x,he.array[ae+5]=I.y,he.array[ae+6]=A.x,he.array[ae+7]=A.y,ae+=8}}else if(3===he.size){if(T="c"===he.type?["r","g","b"]:["x","y","z"],void 0===he.boundTo||"vertices"===he.boundTo){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],he.array[ae]=z[T[0]],he.array[ae+1]=z[T[1]],he.array[ae+2]=z[T[2]],he.array[ae+3]=V[T[0]],he.array[ae+4]=V[T[1]],he.array[ae+5]=V[T[2]],he.array[ae+6]=I[T[0]],he.array[ae+7]=I[T[1]],he.array[ae+8]=I[T[2]],ae+=9;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],A=he.value[A.d],he.array[ae]=z[T[0]],he.array[ae+1]=z[T[1]],he.array[ae+2]=z[T[2]],he.array[ae+3]=V[T[0]],he.array[ae+4]=V[T[1]],he.array[ae+5]=V[T[2]],he.array[ae+6]=I[T[0]],he.array[ae+7]=I[T[1]],he.array[ae+8]=I[T[2]],he.array[ae+9]=A[T[0]],he.array[ae+10]=A[T[1]],he.array[ae+11]=A[T[2]],ae+=12}else if("faces"===he.boundTo){for(R=0,x=_.length;x>R;R++)I=V=z=se=he.value[_[R]],he.array[ae]=z[T[0]],he.array[ae+1]=z[T[1]],he.array[ae+2]=z[T[2]],he.array[ae+3]=V[T[0]],he.array[ae+4]=V[T[1]],he.array[ae+5]=V[T[2]],he.array[ae+6]=I[T[0]],he.array[ae+7]=I[T[1]],he.array[ae+8]=I[T[2]],ae+=9;for(R=0,x=de.length;x>R;R++)A=I=V=z=se=he.value[de[R]],he.array[ae]=z[T[0]],he.array[ae+1]=z[T[1]],he.array[ae+2]=z[T[2]],he.array[ae+3]=V[T[0]],he.array[ae+4]=V[T[1]],he.array[ae+5]=V[T[2]],he.array[ae+6]=I[T[0]],he.array[ae+7]=I[T[1]],he.array[ae+8]=I[T[2]],he.array[ae+9]=A[T[0]],he.array[ae+10]=A[T[1]],he.array[ae+11]=A[T[2]],ae+=12}}else if(4===he.size)if(void 0===he.boundTo||"vertices"===he.boundTo){for(R=0,x=_.length;x>R;R++)A=pe[_[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=z.z,he.array[ae+3]=z.w,he.array[ae+4]=V.x,he.array[ae+5]=V.y,he.array[ae+6]=V.z,he.array[ae+7]=V.w,he.array[ae+8]=I.x,he.array[ae+9]=I.y,he.array[ae+10]=I.z,he.array[ae+11]=I.w,ae+=12;for(R=0,x=de.length;x>R;R++)A=pe[de[R]],z=he.value[A.a],V=he.value[A.b],I=he.value[A.c],A=he.value[A.d],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=z.z,he.array[ae+3]=z.w,he.array[ae+4]=V.x,he.array[ae+5]=V.y,he.array[ae+6]=V.z,he.array[ae+7]=V.w,he.array[ae+8]=I.x,he.array[ae+9]=I.y,he.array[ae+10]=I.z,he.array[ae+11]=I.w,he.array[ae+12]=A.x,he.array[ae+13]=A.y,he.array[ae+14]=A.z,he.array[ae+15]=A.w,ae+=16}else if("faces"===he.boundTo){for(R=0,x=_.length;x>R;R++)I=V=z=se=he.value[_[R]],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=z.z,he.array[ae+3]=z.w,he.array[ae+4]=V.x,he.array[ae+5]=V.y,he.array[ae+6]=V.z,he.array[ae+7]=V.w,he.array[ae+8]=I.x,he.array[ae+9]=I.y,he.array[ae+10]=I.z,he.array[ae+11]=I.w,ae+=12;for(R=0,x=de.length;x>R;R++)A=I=V=z=se=he.value[de[R]],he.array[ae]=z.x,he.array[ae+1]=z.y,he.array[ae+2]=z.z,he.array[ae+3]=z.w,he.array[ae+4]=V.x,he.array[ae+5]=V.y,he.array[ae+6]=V.z,he.array[ae+7]=V.w,he.array[ae+8]=I.x,he.array[ae+9]=I.y,he.array[ae+10]=I.z,he.array[ae+11]=I.w,he.array[ae+12]=A.x,he.array[ae+13]=A.y,he.array[ae+14]=A.z,he.array[ae+15]=A.w,ae+=16}U.bindBuffer(U.ARRAY_BUFFER,he.buffer),U.bufferData(U.ARRAY_BUFFER,he.array,p)}y&&(delete d.__inittedArrays,delete d.__colorArray,delete d.__normalArray,delete d.__tangentArray,delete d.__uvArray,delete d.__uv2Array,delete d.__faceArray,delete d.__vertexArray,delete d.__lineArray,delete d.__skinVertexAArray,delete d.__skinVertexBArray,delete d.__skinIndexArray,delete d.__skinWeightArray)}}h.__dirtyVertices=!1,h.__dirtyMorphTargets=!1,h.__dirtyElements=!1,h.__dirtyUvs=!1,h.__dirtyNormals=!1,h.__dirtyColors=!1,h.__dirtyTangents=!1,c.attributes&&g(c)}else if(H instanceof THREE.Ribbon){if(h.__dirtyVertices||h.__dirtyColors){if(c=h,H=U.DYNAMIC_DRAW,T=u=T=y=y=void 0,b=c.vertices,f=c.colors,R=b.length,d=f.length,x=c.__vertexArray,p=c.__colorArray,w=c.__dirtyColors,c.__dirtyVertices){for(y=0;R>y;y++)T=b[y].position,u=3*y,x[u]=T.x,x[u+1]=T.y,x[u+2]=T.z;U.bindBuffer(U.ARRAY_BUFFER,c.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,x,H)}if(w){for(y=0;d>y;y++)T=f[y],u=3*y,p[u]=T.r,p[u+1]=T.g,p[u+2]=T.b;U.bindBuffer(U.ARRAY_BUFFER,c.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,p,H)}}h.__dirtyVertices=!1,h.__dirtyColors=!1}else if(H instanceof THREE.Line){if(c=i(H,d),p=c.attributes&&E(c),h.__dirtyVertices||h.__dirtyColors||p){if(H=h,u=U.DYNAMIC_DRAW,R=f=M=b=S=void 0,b=H.vertices,d=H.colors,R=b.length,p=d.length,x=H.__vertexArray,y=H.__colorArray,w=H.__dirtyColors,T=H.__webglCustomAttributesList,Y=pe=de=_=M=S=void 0,H.__dirtyVertices){for(S=0;R>S;S++)M=b[S].position,f=3*S,x[f]=M.x,x[f+1]=M.y,x[f+2]=M.z;U.bindBuffer(U.ARRAY_BUFFER,H.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,x,u)}if(w){for(b=0;p>b;b++)R=d[b],f=3*b,y[f]=R.r,y[f+1]=R.g,y[f+2]=R.b;U.bindBuffer(U.ARRAY_BUFFER,H.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,y,u)
}if(T)for(S=0,M=T.length;M>S;S++)if(Y=T[S],Y.needsUpdate&&(void 0===Y.boundTo||"vertices"===Y.boundTo)){if(f=0,de=Y.value.length,1===Y.size)for(_=0;de>_;_++)Y.array[_]=Y.value[_];else if(2===Y.size)for(_=0;de>_;_++)pe=Y.value[_],Y.array[f]=pe.x,Y.array[f+1]=pe.y,f+=2;else if(3===Y.size)if("c"===Y.type)for(_=0;de>_;_++)pe=Y.value[_],Y.array[f]=pe.r,Y.array[f+1]=pe.g,Y.array[f+2]=pe.b,f+=3;else for(_=0;de>_;_++)pe=Y.value[_],Y.array[f]=pe.x,Y.array[f+1]=pe.y,Y.array[f+2]=pe.z,f+=3;else if(4===Y.size)for(_=0;de>_;_++)pe=Y.value[_],Y.array[f]=pe.x,Y.array[f+1]=pe.y,Y.array[f+2]=pe.z,Y.array[f+3]=pe.w,f+=4;U.bindBuffer(U.ARRAY_BUFFER,Y.buffer),U.bufferData(U.ARRAY_BUFFER,Y.array,u)}}h.__dirtyVertices=!1,h.__dirtyColors=!1,c.attributes&&g(c)}else H instanceof THREE.ParticleSystem&&(c=i(H,d),p=c.attributes&&E(c),(h.__dirtyVertices||h.__dirtyColors||H.sortParticles||p)&&a(h,U.DYNAMIC_DRAW,H),h.__dirtyVertices=!1,h.__dirtyColors=!1,c.attributes&&g(c))},this.initMaterial=function(t,e,i,n){var r,o,a,s;if(t instanceof THREE.MeshDepthMaterial?s="depth":t instanceof THREE.MeshNormalMaterial?s="normal":t instanceof THREE.MeshBasicMaterial?s="basic":t instanceof THREE.MeshLambertMaterial?s="lambert":t instanceof THREE.MeshPhongMaterial?s="phong":t instanceof THREE.LineBasicMaterial?s="basic":t instanceof THREE.ParticleBasicMaterial&&(s="particle_basic"),s){var l=THREE.ShaderLib[s];t.uniforms=THREE.UniformsUtils.clone(l.uniforms),t.vertexShader=l.vertexShader,t.fragmentShader=l.fragmentShader}var h,c,u;for(h=u=l=0,c=e.length;c>h;h++)a=e[h],a instanceof THREE.SpotLight&&u++,a instanceof THREE.DirectionalLight&&u++,a instanceof THREE.PointLight&&l++;for(B>=l+u?h=u:(h=Math.ceil(B*u/(l+u)),l=B-h),a={directional:h,point:l},l=u=0,h=e.length;h>l;l++)c=e[l],c instanceof THREE.SpotLight&&c.castShadow&&u++;var f=50;void 0!==n&&n instanceof THREE.SkinnedMesh&&(f=n.bones.length);var d;t:{h=t.fragmentShader,c=t.vertexShader;var p,l=t.uniforms,e=t.attributes,i={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,vertexColors:t.vertexColors,fog:i,useFog:t.fog,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,morphTargets:t.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:a.directional,maxPointLights:a.point,maxBones:f,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:u,alphaTest:t.alphaTest,metal:t.metal,perPixel:t.perPixel},n=[];s?n.push(s):(n.push(h),n.push(c));for(p in i)n.push(p),n.push(i[p]);for(s=n.join(),p=0,n=X.length;n>p;p++)if(X[p].code===s){d=X[p].program;break t}p=U.createProgram(),n=[Te?"#define VERTEX_TEXTURES":"",G.gammaInput?"#define GAMMA_INPUT":"",G.gammaOutput?"#define GAMMA_OUTPUT":"",G.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),a=["#ifdef GL_ES","precision "+P+" float;","#endif","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",G.gammaInput?"#define GAMMA_INPUT":"",G.gammaOutput?"#define GAMMA_OUTPUT":"",G.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapSoft?"#define SHADOWMAP_WIDTH "+i.shadowMapWidth.toFixed(1):"",i.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+i.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),U.attachShader(p,_("fragment",a+h)),U.attachShader(p,_("vertex",n+c)),U.linkProgram(p),U.getProgramParameter(p,U.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+U.getProgramParameter(p,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]"),p.uniforms={},p.attributes={};var m,n=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(m in l)n.push(m);for(m=n,n=0,l=m.length;l>n;n++)h=m[n],p.uniforms[h]=U.getUniformLocation(p,h);for(n=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],m=0;m<i.maxMorphTargets;m++)n.push("morphTarget"+m);for(d in e)n.push(d);for(d=n,m=0,e=d.length;e>m;m++)i=d[m],p.attributes[i]=U.getAttribLocation(p,i);p.id=X.length,X.push({program:p,code:s}),G.info.memory.programs=X.length,d=p}if(t.program=d,d=t.program.attributes,d.position>=0&&U.enableVertexAttribArray(d.position),d.color>=0&&U.enableVertexAttribArray(d.color),d.normal>=0&&U.enableVertexAttribArray(d.normal),d.tangent>=0&&U.enableVertexAttribArray(d.tangent),t.skinning&&d.skinVertexA>=0&&d.skinVertexB>=0&&d.skinIndex>=0&&d.skinWeight>=0&&(U.enableVertexAttribArray(d.skinVertexA),U.enableVertexAttribArray(d.skinVertexB),U.enableVertexAttribArray(d.skinIndex),U.enableVertexAttribArray(d.skinWeight)),t.attributes)for(o in t.attributes)void 0!==d[o]&&d[o]>=0&&U.enableVertexAttribArray(d[o]);if(t.morphTargets)for(o=t.numSupportedMorphTargets=0;o<this.maxMorphTargets;o++)m="morphTarget"+o,d[m]>=0&&(U.enableVertexAttribArray(d[m]),t.numSupportedMorphTargets++);t.uniformsList=[];for(r in t.uniforms)t.uniformsList.push([t.uniforms[r],r])},this.setFaceCulling=function(t,e){t?(U.frontFace(e&&"ccw"!==e?U.CW:U.CCW),U.cullFace("back"===t?U.BACK:"front"===t?U.FRONT:U.FRONT_AND_BACK),U.enable(U.CULL_FACE)):U.disable(U.CULL_FACE)}},THREE.WebGLRenderTarget=function(t,e,i){this.width=t,this.height=e,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0},THREE.WebGLRenderTarget.prototype.clone=function(){var t=new THREE.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t},THREE.WebGLRenderTargetCube=function(t,e,i){THREE.WebGLRenderTarget.call(this,t,e,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(t,e,i,n){var r=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(t,r),r.h=THREE.Math.clamp(r.h+e,0,1),r.s=THREE.Math.clamp(r.s+i,0,1),r.v=THREE.Math.clamp(r.v+n,0,1),t.setHSV(r.h,r.s,r.v)},rgbToHsv:function(t,e){var i=t.r,n=t.g,r=t.b,o=Math.max(Math.max(i,n),r),a=Math.min(Math.min(i,n),r);if(a===o)a=i=0;else{var s=o-a,a=s/o,i=i===o?(n-r)/s:n===o?2+(r-i)/s:4+(i-n)/s;i/=6,0>i&&(i+=1),i>1&&(i-=1)}return void 0===e&&(e={h:0,s:0,v:0}),e.h=i,e.s=a,e.v=o,e}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(t,e){for(var i,n,r=t.vertices.length,o=e instanceof THREE.Mesh?e.geometry:e,a=t.vertices,s=o.vertices,l=t.faces,h=o.faces,c=t.faceVertexUvs[0],u=o.faceVertexUvs[0],f={},d=0;d<t.materials.length;d++)f[t.materials[d].id]=d;e instanceof THREE.Mesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,n=new THREE.Matrix4,n.extractRotation(i,e.scale));for(var d=0,p=s.length;p>d;d++){var m=new THREE.Vertex(s[d].position.clone());i&&i.multiplyVector3(m.position),a.push(m)}for(d=0,p=h.length;p>d;d++){var E,g,a=h[d],v=a.vertexNormals,y=a.vertexColors;for(a instanceof THREE.Face3?E=new THREE.Face3(a.a+r,a.b+r,a.c+r):a instanceof THREE.Face4&&(E=new THREE.Face4(a.a+r,a.b+r,a.c+r,a.d+r)),E.normal.copy(a.normal),n&&n.multiplyVector3(E.normal),s=0,m=v.length;m>s;s++)g=v[s].clone(),n&&n.multiplyVector3(g),E.vertexNormals.push(g);for(E.color.copy(a.color),s=0,m=y.length;m>s;s++)g=y[s],E.vertexColors.push(g.clone());void 0!==a.materialIndex&&(s=o.materials[a.materialIndex],m=f[s.id],void 0===m&&(m=t.materials.length,t.materials.push(s)),E.materialIndex=m),E.centroid.copy(a.centroid),i&&i.multiplyVector3(E.centroid),l.push(E)}for(d=0,p=u.length;p>d;d++){for(i=u[d],n=[],s=0,m=i.length;m>s;s++)n.push(new THREE.UV(i[s].u,i[s].v));c.push(n)}},clone:function(t){var e,i=new THREE.Geometry,n=t.vertices,r=t.faces,o=t.faceVertexUvs[0];for(t.materials&&(i.materials=t.materials.slice()),t=0,e=n.length;e>t;t++){var a=new THREE.Vertex(n[t].position.clone());i.vertices.push(a)}for(t=0,e=r.length;e>t;t++){var s,l,h=r[t],c=h.vertexNormals,u=h.vertexColors;for(h instanceof THREE.Face3?s=new THREE.Face3(h.a,h.b,h.c):h instanceof THREE.Face4&&(s=new THREE.Face4(h.a,h.b,h.c,h.d)),s.normal.copy(h.normal),n=0,a=c.length;a>n;n++)l=c[n],s.vertexNormals.push(l.clone());for(s.color.copy(h.color),n=0,a=u.length;a>n;n++)l=u[n],s.vertexColors.push(l.clone());s.materialIndex=h.materialIndex,s.centroid.copy(h.centroid),i.faces.push(s)}for(t=0,e=o.length;e>t;t++){for(r=o[t],s=[],n=0,a=r.length;a>n;n++)s.push(new THREE.UV(r[n].u,r[n].v));i.faceVertexUvs[0].push(s)}return i},randomPointInTriangle:function(t,e,i){var n,r,o,a=new THREE.Vector3,s=THREE.GeometryUtils.__v1;return n=THREE.GeometryUtils.random(),r=THREE.GeometryUtils.random(),n+r>1&&(n=1-n,r=1-r),o=1-n-r,a.copy(t),a.multiplyScalar(n),s.copy(e),s.multiplyScalar(r),a.addSelf(s),s.copy(i),s.multiplyScalar(o),a.addSelf(s),a},randomPointInFace:function(t,e,i){var n,r,o;if(t instanceof THREE.Face3)return n=e.vertices[t.a].position,r=e.vertices[t.b].position,o=e.vertices[t.c].position,THREE.GeometryUtils.randomPointInTriangle(n,r,o);if(t instanceof THREE.Face4){n=e.vertices[t.a].position,r=e.vertices[t.b].position,o=e.vertices[t.c].position;var a,e=e.vertices[t.d].position;return i?t._area1&&t._area2?(i=t._area1,a=t._area2):(i=THREE.GeometryUtils.triangleArea(n,r,e),a=THREE.GeometryUtils.triangleArea(r,o,e),t._area1=i,t._area2=a):(i=THREE.GeometryUtils.triangleArea(n,r,e),a=THREE.GeometryUtils.triangleArea(r,o,e)),THREE.GeometryUtils.random()*(i+a)<i?THREE.GeometryUtils.randomPointInTriangle(n,r,e):THREE.GeometryUtils.randomPointInTriangle(r,o,e)}},randomPointsInGeometry:function(t,e){function i(t){function e(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return d[r]>t?e(i,r-1):d[r]<t?e(r+1,n):r}return e(0,d.length-1)}var n,r,o,a,s,l,h=t.faces,c=t.vertices,u=h.length,f=0,d=[];for(r=0;u>r;r++)n=h[r],n instanceof THREE.Face3?(o=c[n.a].position,a=c[n.b].position,s=c[n.c].position,n._area=THREE.GeometryUtils.triangleArea(o,a,s)):n instanceof THREE.Face4&&(o=c[n.a].position,a=c[n.b].position,s=c[n.c].position,l=c[n.d].position,n._area1=THREE.GeometryUtils.triangleArea(o,a,l),n._area2=THREE.GeometryUtils.triangleArea(a,s,l),n._area=n._area1+n._area2),f+=n._area,d[r]=f;for(n=[],c={},r=0;e>r;r++)u=THREE.GeometryUtils.random()*f,u=i(u),n[r]=THREE.GeometryUtils.randomPointInFace(h[u],t,!0),c[u]?c[u]+=1:c[u]=1;return n},triangleArea:function(t,e,i){var n,r=THREE.GeometryUtils.__v1;return r.sub(t,e),n=r.length(),r.sub(t,i),t=r.length(),r.sub(e,i),i=r.length(),e=.5*(n+t+i),Math.sqrt(e*(e-n)*(e-t)*(e-i))},center:function(t){t.computeBoundingBox();var e=new THREE.Matrix4;e.setTranslation(-.5*(t.boundingBox.x[1]+t.boundingBox.x[0]),-.5*(t.boundingBox.y[1]+t.boundingBox.y[0]),-.5*(t.boundingBox.z[1]+t.boundingBox.z[0])),t.applyMatrix(e),t.computeBoundingBox()}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={loadTexture:function(t,e,i){var n=new Image,r=new THREE.Texture(n,e);return n.onload=function(){r.needsUpdate=!0,i&&i(this)},n.crossOrigin="",n.src=t,r},loadTextureCube:function(t,e,i){var n,r=[],o=new THREE.Texture(r,e),e=r.loadCount=0;for(n=t.length;n>e;++e)r[e]=new Image,r[e].onload=function(){r.loadCount+=1,6===r.loadCount&&(o.needsUpdate=!0),i&&i(this)},r[e].crossOrigin="",r[e].src=t[e];return o},getNormalMap:function(t,e){var i=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]};e|=1;var n=t.width,r=t.height,o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");a.drawImage(t,0,0);for(var s=a.getImageData(0,0,n,r).data,l=a.createImageData(n,r),h=l.data,c=0;n>c;c++)for(var u=1;r>u;u++){var f=0>u-1?r-1:u-1,d=(u+1)%r,p=0>c-1?n-1:c-1,m=(c+1)%n,E=[],g=[0,0,s[4*(u*n+c)]/255*e];for(E.push([-1,0,s[4*(u*n+p)]/255*e]),E.push([-1,-1,s[4*(f*n+p)]/255*e]),E.push([0,-1,s[4*(f*n+c)]/255*e]),E.push([1,-1,s[4*(f*n+m)]/255*e]),E.push([1,0,s[4*(u*n+m)]/255*e]),E.push([1,1,s[4*(d*n+m)]/255*e]),E.push([0,1,s[4*(d*n+c)]/255*e]),E.push([-1,1,s[4*(d*n+p)]/255*e]),f=[],p=E.length,d=0;p>d;d++){var m=E[d],v=E[(d+1)%p],m=[m[0]-g[0],m[1]-g[1],m[2]-g[2]],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]];f.push(i([m[1]*v[2]-m[2]*v[1],m[2]*v[0]-m[0]*v[2],m[0]*v[1]-m[1]*v[0]]))}for(E=[0,0,0],d=0;d<f.length;d++)E[0]+=f[d][0],E[1]+=f[d][1],E[2]+=f[d][2];E[0]/=f.length,E[1]/=f.length,E[2]/=f.length,g=4*(u*n+c),h[g]=(E[0]+1)/2*255|0,h[g+1]=255*(E[1]+.5)|0,h[g+2]=255*E[2]|0,h[g+3]=255}return a.putImageData(l,0,0),o}},THREE.SceneUtils={showHierarchy:function(t,e){THREE.SceneUtils.traverseHierarchy(t,function(t){t.visible=e})},traverseHierarchy:function(t,e){var i,n,r=t.children.length;for(n=0;r>n;n++)i=t.children[n],e(i),THREE.SceneUtils.traverseHierarchy(i,e)},createMultiMaterialObject:function(t,e){var i,n=e.length,r=new THREE.Object3D;for(i=0;n>i;i++){var o=new THREE.Mesh(t,e[i]);r.add(o)}return r},cloneObject:function(t){var e;t instanceof THREE.MorphAnimMesh?(e=new THREE.MorphAnimMesh(t.geometry,t.material),e.duration=t.duration,e.mirroredLoop=t.mirroredLoop,e.time=t.time,e.lastKeyframe=t.lastKeyframe,e.currentKeyframe=t.currentKeyframe,e.direction=t.direction,e.directionBackwards=t.directionBackwards):t instanceof THREE.SkinnedMesh?e=new THREE.SkinnedMesh(t.geometry,t.material):t instanceof THREE.Mesh?e=new THREE.Mesh(t.geometry,t.material):t instanceof THREE.Line?e=new THREE.Line(t.geometry,t.material,t.type):t instanceof THREE.Ribbon?e=new THREE.Ribbon(t.geometry,t.material):t instanceof THREE.ParticleSystem?(e=new THREE.ParticleSystem(t.geometry,t.material),e.sortParticles=t.sortParticles):t instanceof THREE.Particle?e=new THREE.Particle(t.material):t instanceof THREE.Sprite?(e=new THREE.Sprite({}),e.color.copy(t.color),e.map=t.map,e.blending=t.blending,e.useScreenCoordinates=t.useScreenCoordinates,e.mergeWith3D=t.mergeWith3D,e.affectedByDistance=t.affectedByDistance,e.scaleByViewport=t.scaleByViewport,e.alignment=t.alignment,e.rotation3d.copy(t.rotation3d),e.rotation=t.rotation,e.opacity=t.opacity,e.uvOffset.copy(t.uvOffset),e.uvScale.copy(t.uvScale)):t instanceof THREE.LOD?e=new THREE.LOD:t instanceof THREE.MarchingCubes?(e=new THREE.MarchingCubes(t.resolution,t.material),e.field.set(t.field),e.isolation=t.isolation):t instanceof THREE.Object3D&&(e=new THREE.Object3D),e.parent=t.parent,e.up.copy(t.up),e.position.copy(t.position),e.rotation instanceof THREE.Vector3&&e.rotation.copy(t.rotation),e.eulerOrder=t.eulerOrder,e.scale.copy(t.scale),e.dynamic=t.dynamic,e.doubleSided=t.doubleSided,e.flipSided=t.flipSided,e.renderDepth=t.renderDepth,e.rotationAutoUpdate=t.rotationAutoUpdate,e.matrix.copy(t.matrix),e.matrixWorld.copy(t.matrixWorld),e.matrixRotationWorld.copy(t.matrixRotationWorld),e.matrixAutoUpdate=t.matrixAutoUpdate,e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,e.quaternion.copy(t.quaternion),e.useQuaternion=t.useQuaternion,e.boundRadius=t.boundRadius,e.boundRadiusScale=t.boundRadiusScale,e.visible=t.visible,e.castShadow=t.castShadow,e.receiveShadow=t.receiveShadow,e.frustumCulled=t.frustumCulled;for(var i=0;i<t.children.length;i++){var n=THREE.SceneUtils.cloneObject(t.children[i]);e.children[i]=n,n.parent=e}if(t instanceof THREE.LOD)for(i=0;i<t.LODs.length;i++)e.LODs[i]={visibleAtDistance:t.LODs[i].visibleAtDistance,object3D:e.children[i]};return e}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(t){return this.getPoint(this.getUtoTmapping(t))},THREE.Curve.prototype.getPoints=function(t){t||(t=5);var e,i=[];for(e=0;t>=e;e++)i.push(this.getPoint(e/t));return i},THREE.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,i=[];for(e=0;t>=e;e++)i.push(this.getPointAt(e/t));return i},THREE.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},THREE.Curve.prototype.getLengths=function(t){if(t||(t=200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;t>=i;i++)e=this.getPoint(i/t),o+=e.distanceTo(r),n.push(o),r=e;return this.cacheArcLengths=n},THREE.Curve.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e?e:t*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=Math.floor(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}return r=l,n[r]==i?r/(o-1):(s=n[r],n=(r+(i-s)/(n[r+1]-s))/(o-1))},THREE.Curve.prototype.getNormalVector=function(t){return t=this.getTangent(t),new THREE.Vector2(-t.y,t.x)},THREE.Curve.prototype.getTangent=function(t){var e=t-1e-4;return t+=1e-4,0>e&&(e=0),t>1&&(t=1),e=this.getPoint(e),t=this.getPoint(t),e.clone().subSelf(t).normalize()},THREE.Curve.prototype.getTangentAt=function(t){return this.getTangent(this.getUtoTmapping(t))},THREE.LineCurve=function(t,e){t instanceof THREE.Vector2?(this.v1=t,this.v2=e):THREE.LineCurve.oldConstructor.apply(this,arguments)},THREE.LineCurve.oldConstructor=function(t,e,i,n){this.constructor(new THREE.Vector2(t,e),new THREE.Vector2(i,n))},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(t){var e=new THREE.Vector2;return e.sub(this.v2,this.v1),e.multiplyScalar(t).addSelf(this.v1),e},THREE.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},THREE.LineCurve.prototype.getTangent=function(){var t=new THREE.Vector2;return t.sub(this.v2,this.v1),t.normalize(),t},THREE.QuadraticBezierCurve=function(t,e,i){if(!(e instanceof THREE.Vector2))var n=Array.prototype.slice.call(arguments),t=new THREE.Vector2(n[0],n[1]),e=new THREE.Vector2(n[2],n[3]),i=new THREE.Vector2(n[4],n[5]);this.v0=t,this.v1=e,this.v2=i},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var e;return e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(e,t)},THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var e;return e=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),e=new THREE.Vector2(e,t),e.normalize(),e},THREE.CubicBezierCurve=function(t,e,i,n){if(!(e instanceof THREE.Vector2))var r=Array.prototype.slice.call(arguments),t=new THREE.Vector2(r[0],r[1]),e=new THREE.Vector2(r[2],r[3]),i=new THREE.Vector2(r[4],r[5]),n=new THREE.Vector2(r[6],r[7]);this.v0=t,this.v1=e,this.v2=i,this.v3=n},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(t){var e;return e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(e,t)},THREE.CubicBezierCurve.prototype.getTangent=function(t){var e;return e=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=new THREE.Vector2(e,t),e.normalize(),e},THREE.SplineCurve=function(t){this.points=void 0==t?[]:t},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(t){var e,i=new THREE.Vector2,n=[],r=this.points;return e=(r.length-1)*t,t=Math.floor(e),e-=t,n[0]=0==t?t:t-1,n[1]=t,n[2]=t>r.length-2?t:t+1,n[3]=t>r.length-3?t:t+2,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,e),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,e),i},THREE.ArcCurve=function(t,e,i,n,r,o){this.aX=t,this.aY=e,this.aRadius=i,this.aStartAngle=n,this.aEndAngle=r,this.aClockwise=o},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(t){var e=this.aEndAngle-this.aStartAngle;return this.aClockwise||(t=1-t),t=this.aStartAngle+t*e,new THREE.Vector2(this.aX+this.aRadius*Math.cos(t),this.aY+this.aRadius*Math.sin(t))
},THREE.Curve.Utils={tangentQuadraticBezier:function(t,e,i,n){return 2*(1-t)*(i-e)+2*t*(n-i)},tangentCubicBezier:function(t,e,i,n,r){return-3*e*(1-t)*(1-t)+3*i*(1-t)*(1-t)-6*t*i*(1-t)+6*t*n*(1-t)-3*t*t*n+3*t*t*r},tangentSpline:function(t){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(t,e,i,n,r){var t=.5*(i-t),n=.5*(n-e),o=r*r;return(2*e-2*i+t+n)*r*o+(-3*e+3*i-2*t-n)*o+t*r+e}},THREE.Curve.create=function(t,e){return t.prototype=new THREE.Curve,t.prototype.constructor=t,t.prototype.getPoint=e,t},THREE.LineCurve3=THREE.Curve.create(function(t,e){this.v1=t,this.v2=e},function(t){var e=new THREE.Vector3;return e.sub(this.v2,this.v1),e.multiplyScalar(t),e.addSelf(this.v1),e}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(t,e,i){this.v0=t,this.v1=e,this.v2=i},function(t){var e,i;return e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(e,i,t)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n},function(t){var e,i;return e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(e,i,t)}),THREE.SplineCurve3=THREE.Curve.create(function(t){this.points=void 0==t?[]:t},function(t){var e,i=new THREE.Vector3,n=[],r=this.points;return e=(r.length-1)*t,t=Math.floor(e),e-=t,n[0]=0==t?t:t-1,n[1]=t,n[2]=t>r.length-2?t:t+1,n[3]=t>r.length-3?t:t+2,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,e),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,e),i.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,e),i}),THREE.CurvePath=function(){this.curves=[],this.bends=[]},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(t){this.curves.push(t)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){},THREE.CurvePath.prototype.getPoint=function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),t=0;t<i.length;){if(i[t]>=e)return e=i[t]-e,t=this.curves[t],e=1-e/t.getLength(),t.getPointAt(e);t++}return null},THREE.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],i=0,n=this.curves.length;for(t=0;n>t;t++)i+=this.curves[t].getLength(),e.push(i);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var t,e,i,n,r=this.getPoints();t=e=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var o,a,s,l;for(l=new THREE.Vector2,a=0,s=r.length;s>a;a++)o=r[a],o.x>t?t=o.x:o.x<i&&(i=o.x),o.y>e?e=o.y:o.y<e&&(n=o.y),l.addSelf(o.x,o.y);return{minX:i,minY:n,maxX:t,maxY:e,centroid:l.divideScalar(s)}},THREE.CurvePath.prototype.createPointsGeometry=function(t){return this.createGeometry(this.getPoints(t,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(t){return this.createGeometry(this.getSpacedPoints(t,!0))},THREE.CurvePath.prototype.createGeometry=function(t){for(var e=new THREE.Geometry,i=0;i<t.length;i++)e.vertices.push(new THREE.Vertex(new THREE.Vector3(t[i].x,t[i].y,0)));return e},THREE.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},THREE.CurvePath.prototype.getTransformedPoints=function(t,e){var i,n,r=this.getPoints(t);for(e||(e=this.bends),i=0,n=e.length;n>i;i++)r=this.getWrapPoints(r,e[i]);return r},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var i,n,r=this.getSpacedPoints(t);for(e||(e=this.bends),i=0,n=e.length;n>i;i++)r=this.getWrapPoints(r,e[i]);return r},THREE.CurvePath.prototype.getWrapPoints=function(t,e){var i,n,r,o,a,s,l=this.getBoundingBox();for(i=0,n=t.length;n>i;i++)r=t[i],o=r.x,a=r.y,s=o/l.maxX,s=e.getUtoTmapping(s,o),o=e.getPoint(s),a=e.getNormalVector(s).multiplyScalar(a),r.x=o.x+a.x,r.y=o.y+a.y;return t},THREE.Path=function(t){THREE.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);var e,i=t.length;for(e=1;i>e;e++)this.lineTo(t[e].x,t[e].y)},THREE.Path.prototype.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:t})},THREE.Path.prototype.lineTo=function(t,e){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(n[n.length-2],n[n.length-1]),new THREE.Vector2(t,e))),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(t,e,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(i,n))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})},THREE.Path.prototype.bezierCurveTo=function(t,e,i,n,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(i,n),new THREE.Vector2(r,o))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new THREE.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,t),this.curves.push(new THREE.SplineCurve(i)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:e})},THREE.Path.prototype.arc=function(t,e,i,n,r,o){var a=Array.prototype.slice.call(arguments);this.curves.push(new THREE.ArcCurve(t,e,i,n,r,o)),this.actions.push({action:THREE.PathActions.ARC,args:a})},THREE.Path.prototype.getSpacedPoints=function(t){t||(t=40);for(var e=[],i=0;t>i;i++)e.push(this.getPoint(i/t));return e},THREE.Path.prototype.getPoints=function(t,e){var i,n,r,o,a,s,l,h,c,u,f,d,p,t=t||12,m=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],o=r.action,r=r.args,o){case THREE.PathActions.LINE_TO:m.push(new THREE.Vector2(r[0],r[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(a=r[2],s=r[3],c=r[0],u=r[1],m.length>0?(o=m[m.length-1],f=o.x,d=o.y):(o=this.actions[i-1].args,f=o[o.length-2],d=o[o.length-1]),o=1;t>=o;o++)p=o/t,r=THREE.Shape.Utils.b2(p,f,c,a),p=THREE.Shape.Utils.b2(p,d,u,s),m.push(new THREE.Vector2(r,p));break;case THREE.PathActions.BEZIER_CURVE_TO:for(a=r[4],s=r[5],c=r[0],u=r[1],l=r[2],h=r[3],m.length>0?(o=m[m.length-1],f=o.x,d=o.y):(o=this.actions[i-1].args,f=o[o.length-2],d=o[o.length-1]),o=1;t>=o;o++)p=o/t,r=THREE.Shape.Utils.b3(p,f,c,l,a),p=THREE.Shape.Utils.b3(p,d,u,h,s),m.push(new THREE.Vector2(r,p));break;case THREE.PathActions.CSPLINE_THRU:for(o=this.actions[i-1].args,o=[new THREE.Vector2(o[o.length-2],o[o.length-1])],p=t*r[0].length,o=o.concat(r[0]),r=new THREE.SplineCurve(o),o=1;p>=o;o++)m.push(r.getPointAt(o/p));break;case THREE.PathActions.ARC:o=this.actions[i-1].args,a=r[0],s=r[1],l=r[2],c=r[3],p=r[4],u=!!r[5],h=o[o.length-2],f=o[o.length-1],0==o.length&&(h=f=0),d=p-c;var E=2*t;for(o=1;E>=o;o++)p=o/E,u||(p=1-p),p=c+p*d,r=h+a+l*Math.cos(p),p=f+s+l*Math.sin(p),m.push(new THREE.Vector2(r,p))}return e&&m.push(m[0]),m},THREE.Path.prototype.transform=function(t,e){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(e),t)},THREE.Path.prototype.nltransform=function(t,e,i,n,r,o){var a,s,l,h,c,u=this.getPoints();for(a=0,s=u.length;s>a;a++)l=u[a],h=l.x,c=l.y,l.x=t*h+e*c+i,l.y=n*c+r*h+o;return u},THREE.Path.prototype.debug=function(t){var e=this.getBoundingBox();t||(t=document.createElement("canvas"),t.setAttribute("width",e.maxX+100),t.setAttribute("height",e.maxY+100),document.body.appendChild(t)),e=t.getContext("2d"),e.fillStyle="white",e.fillRect(0,0,t.width,t.height),e.strokeStyle="black",e.beginPath();var i,n,r,t=0;for(i=this.actions.length;i>t;t++)n=this.actions[t],r=n.args,n=n.action,n!=THREE.PathActions.CSPLINE_THRU&&e[n].apply(e,r);for(e.stroke(),e.closePath(),e.strokeStyle="red",n=this.getPoints(),t=0,i=n.length;i>t;t++)r=n[t],e.beginPath(),e.arc(r.x,r.y,1.5,0,2*Math.PI,!1),e.stroke(),e.closePath()},THREE.Path.prototype.toShapes=function(){var t,e,i,n,r=[],o=new THREE.Path;for(t=0,e=this.actions.length;e>t;t++)i=this.actions[t],n=i.args,i=i.action,i==THREE.PathActions.MOVE_TO&&0!=o.actions.length&&(r.push(o),o=new THREE.Path),o[i].apply(o,n);if(0!=o.actions.length&&r.push(o),0==r.length)return[];var a,o=[];if(THREE.Shape.Utils.isClockWise(r[0].getPoints())){for(t=0,e=r.length;e>t;t++)n=r[t],THREE.Shape.Utils.isClockWise(n.getPoints())?(a&&o.push(a),a=new THREE.Shape,a.actions=n.actions,a.curves=n.curves):a.holes.push(n);o.push(a)}else for(a=new THREE.Shape,t=0,e=r.length;e>t;t++)n=r[t],THREE.Shape.Utils.isClockWise(n.getPoints())?(a.actions=n.actions,a.curves=n.curves,o.push(a),a=new THREE.Shape):a.holes.push(n);return o},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(t){return new THREE.ExtrudeGeometry(this,t)},THREE.Shape.prototype.getPointsHoles=function(t){var e,i=this.holes.length,n=[];for(e=0;i>e;e++)n[e]=this.holes[e].getTransformedPoints(t,this.bends);return n},THREE.Shape.prototype.getSpacedPointsHoles=function(t){var e,i=this.holes.length,n=[];for(e=0;i>e;e++)n[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return n},THREE.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},THREE.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},THREE.Shape.Utils={removeHoles:function(t,e){var i,n,r,o,a,s,l,h,c,u,f=t.concat(),d=f.concat(),p=[];for(a=0;a<e.length;a++){for(s=e[a],Array.prototype.push.apply(d,s),n=Number.POSITIVE_INFINITY,i=0;i<s.length;i++)for(c=s[i],u=[],h=0;h<f.length;h++)l=f[h],l=c.distanceToSquared(l),u.push(l),n>l&&(n=l,r=i,o=h);i=o-1>=0?o-1:f.length-1,n=r-1>=0?r-1:s.length-1;var m=[s[r],f[o],f[i]];h=THREE.FontUtils.Triangulate.area(m);var E=[s[r],s[n],f[o]];c=THREE.FontUtils.Triangulate.area(E),u=o,l=r,o+=1,r+=-1,0>o&&(o+=f.length),o%=f.length,0>r&&(r+=s.length),r%=s.length,i=o-1>=0?o-1:f.length-1,n=r-1>=0?r-1:s.length-1,m=[s[r],f[o],f[i]],m=THREE.FontUtils.Triangulate.area(m),E=[s[r],s[n],f[o]],E=THREE.FontUtils.Triangulate.area(E),h+c>m+E&&(o=u,r=l,0>o&&(o+=f.length),o%=f.length,0>r&&(r+=s.length),r%=s.length,i=o-1>=0?o-1:f.length-1,n=r-1>=0?r-1:s.length-1),h=f.slice(0,o),c=f.slice(o),u=s.slice(r),l=s.slice(0,r),n=[s[r],s[n],f[o]],p.push([s[r],f[o],f[i]]),p.push(n),f=h.concat(u).concat(l).concat(c)}return{shape:f,isolatedPts:p,allpoints:d}},triangulateShape:function(t,e){var i,n,r,o,a=THREE.Shape.Utils.removeHoles(t,e),s=a.allpoints,l=a.isolatedPts,a=THREE.FontUtils.Triangulate(a.shape,!1),h={};for(i=0,n=s.length;n>i;i++)o=s[i].x+":"+s[i].y,void 0!==h[o]&&console.log("Duplicate point",o),h[o]=i;for(i=0,n=a.length;n>i;i++)for(r=a[i],s=0;3>s;s++)o=r[s].x+":"+r[s].y,o=h[o],void 0!==o&&(r[s]=o);for(i=0,n=l.length;n>i;i++)for(r=l[i],s=0;3>s;s++)o=r[s].x+":"+r[s].y,o=h[o],void 0!==o&&(r[s]=o);return a.concat(l)},isClockWise:function(t){return THREE.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var i=1-t;return i*i*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,i,n){return this.b2p0(t,e)+this.b2p1(t,i)+this.b2p2(t,n)},b3p0:function(t,e){var i=1-t;return i*i*i*e},b3p1:function(t,e){var i=1-t;return 3*i*i*t*e},b3p2:function(t,e){return 3*(1-t)*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,i,n,r){return this.b3p0(t,e)+this.b3p1(t,i)+this.b3p2(t,n)+this.b3p3(t,r)}},THREE.TextPath=function(t,e){THREE.Path.call(this),this.parameters=e||{},this.set(t)},THREE.TextPath.prototype.set=function(t,e){this.text=t;var e=e||this.parameters,i=void 0!==e.curveSegments?e.curveSegments:4,n=void 0!==e.font?e.font:"helvetiker",r=void 0!==e.weight?e.weight:"normal",o=void 0!==e.style?e.style:"normal";THREE.FontUtils.size=void 0!==e.size?e.size:100,THREE.FontUtils.divisions=i,THREE.FontUtils.face=n,THREE.FontUtils.weight=r,THREE.FontUtils.style=o},THREE.TextPath.prototype.toShapes=function(){for(var t=THREE.FontUtils.drawText(this.text).paths,e=[],i=0,n=t.length;n>i;i++)Array.prototype.push.apply(e,t[i].toShapes());return e},THREE.AnimationHandler=function(){var t=[],e={},i={update:function(e){for(var i=0;i<t.length;i++)t[i].update(e)},addToUpdate:function(e){-1===t.indexOf(e)&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},add:function(t){if(void 0!==e[t.name]&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting."),e[t.name]=t,t.initialized!==!0){for(var i=0;i<t.hierarchy.length;i++){for(var n=0;n<t.hierarchy[i].keys.length;n++)if(t.hierarchy[i].keys[n].time<0&&(t.hierarchy[i].keys[n].time=0),void 0!==t.hierarchy[i].keys[n].rot&&!(t.hierarchy[i].keys[n].rot instanceof THREE.Quaternion)){var r=t.hierarchy[i].keys[n].rot;t.hierarchy[i].keys[n].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}if(void 0!==t.hierarchy[i].keys[0].morphTargets){for(r={},n=0;n<t.hierarchy[i].keys.length;n++)for(var o=0;o<t.hierarchy[i].keys[n].morphTargets.length;o++){var a=t.hierarchy[i].keys[n].morphTargets[o];r[a]=-1}for(t.hierarchy[i].usedMorphTargets=r,n=0;n<t.hierarchy[i].keys.length;n++){var s={};for(a in r){for(o=0;o<t.hierarchy[i].keys[n].morphTargets.length;o++)if(t.hierarchy[i].keys[n].morphTargets[o]===a){s[a]=t.hierarchy[i].keys[n].morphTargetsInfluences[o];break}o===t.hierarchy[i].keys[n].morphTargets.length&&(s[a]=0)}t.hierarchy[i].keys[n].morphTargetsInfluences=s}}for(n=1;n<t.hierarchy[i].keys.length;n++)t.hierarchy[i].keys[n].time===t.hierarchy[i].keys[n-1].time&&(t.hierarchy[i].keys.splice(n,1),n--);for(n=1;n<t.hierarchy[i].keys.length;n++)t.hierarchy[i].keys[n].index=n}for(n=parseInt(t.length*t.fps,10),t.JIT={},t.JIT.hierarchy=[],i=0;i<t.hierarchy.length;i++)t.JIT.hierarchy.push(Array(n));t.initialized=!0}},get:function(t){return"string"==typeof t?e[t]?e[t]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+t),null):void 0},parse:function(t){var e=[];if(t instanceof THREE.SkinnedMesh)for(var i=0;i<t.bones.length;i++)e.push(t.bones[i]);else n(t,e);return e}},n=function(t,e){e.push(t);for(var i=0;i<t.children.length;i++)n(t.children[i],e)};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),THREE.Animation=function(t,e,i,n){this.root=t,this.data=THREE.AnimationHandler.get(e),this.hierarchy=THREE.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.JITCompile=void 0!==n?n:!0,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(t,e){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==e?e:0;var i,n,r=this.hierarchy.length;for(i=0;r>i;i++){n=this.hierarchy[i],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(n.useQuaternion=!0),n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var o=n.animationCache.prevKey;n=n.animationCache.nextKey,o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],n.pos=this.getNextKeyWith("pos",i,1),n.rot=this.getNextKeyWith("rot",i,1),n.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.hierarchy.length;t++)void 0!==this.hierarchy[t].animationCache&&(this.hierarchy[t]instanceof THREE.Bone?this.hierarchy[t].skinMatrix=this.hierarchy[t].animationCache.originalMatrix:this.hierarchy[t].matrix=this.hierarchy[t].animationCache.originalMatrix,delete this.hierarchy[t].animationCache)},THREE.Animation.prototype.update=function(t){if(this.isPlaying){var e,i,n,r,o,a,s,l,h,c,u=["pos","rot","scl"],f=this.data.JIT.hierarchy;this.currentTime+=t*this.timeScale,c=this.currentTime,h=this.currentTime%=this.data.length,l=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);for(var d=0,p=this.hierarchy.length;p>d;d++)if(t=this.hierarchy[d],s=t.animationCache,this.JITCompile&&void 0!==f[d][l])t instanceof THREE.Bone?(t.skinMatrix=f[d][l],t.matrixAutoUpdate=!1,t.matrixWorldNeedsUpdate=!1):(t.matrix=f[d][l],t.matrixAutoUpdate=!1,t.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(t instanceof THREE.Bone?t.skinMatrix=t.animationCache.originalMatrix:t.matrix=t.animationCache.originalMatrix);for(var m=0;3>m;m++){if(e=u[m],o=s.prevKey[e],a=s.nextKey[e],a.time<=c){if(c>h){if(!this.loop)return void this.stop();for(o=this.data.hierarchy[d].keys[0],a=this.getNextKeyWith(e,d,1);a.time<h;)o=a,a=this.getNextKeyWith(e,d,a.index+1)}else do o=a,a=this.getNextKeyWith(e,d,a.index+1);while(a.time<h);s.prevKey[e]=o,s.nextKey[e]=a}t.matrixAutoUpdate=!0,t.matrixWorldNeedsUpdate=!0,i=(h-o.time)/(a.time-o.time),n=o[e],r=a[e],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+d),i=0>i?0:1),"pos"===e?(e=t.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(e.x=n[0]+(r[0]-n[0])*i,e.y=n[1]+(r[1]-n[1])*i,e.z=n[2]+(r[2]-n[2])*i):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",d,o.index-1).pos,this.points[1]=n,this.points[2]=r,this.points[3]=this.getNextKeyWith("pos",d,a.index+1).pos,i=.33*i+.33,n=this.interpolateCatmullRom(this.points,i),e.x=n[0],e.y=n[1],e.z=n[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(i=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(i[0],i[1],i[2]),this.target.subSelf(e),this.target.y=0,this.target.normalize(),i=Math.atan2(this.target.x,this.target.z),t.rotation.set(0,i,0)))):"rot"===e?THREE.Quaternion.slerp(n,r,t.quaternion,i):"scl"===e&&(e=t.scale,e.x=n[0]+(r[0]-n[0])*i,e.y=n[1]+(r[1]-n[1])*i,e.z=n[2]+(r[2]-n[2])*i)}}if(this.JITCompile&&void 0===f[0][l])for(this.hierarchy[0].update(null,!0),d=0;d<this.hierarchy.length;d++)f[d][l]=this.hierarchy[d]instanceof THREE.Bone?this.hierarchy[d].skinMatrix.clone():this.hierarchy[d].matrix.clone()}},THREE.Animation.prototype.interpolateCatmullRom=function(t,e){var i,n,r,o,a,s,l=[],h=[];return i=(t.length-1)*e,n=Math.floor(i),i-=n,l[0]=0===n?n:n-1,l[1]=n,l[2]=n>t.length-2?n:n+1,l[3]=n>t.length-3?n:n+2,n=t[l[0]],o=t[l[1]],a=t[l[2]],s=t[l[3]],l=i*i,r=i*l,h[0]=this.interpolate(n[0],o[0],a[0],s[0],i,l,r),h[1]=this.interpolate(n[1],o[1],a[1],s[1],i,l,r),h[2]=this.interpolate(n[2],o[2],a[2],s[2],i,l,r),h},THREE.Animation.prototype.interpolate=function(t,e,i,n,r,o,a){return t=.5*(i-t),n=.5*(n-e),(2*(e-i)+t+n)*a+(-3*(e-i)-2*t-n)*o+t*r+e},THREE.Animation.prototype.getNextKeyWith=function(t,e,i){var n=this.data.hierarchy[e].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][t])return n[i];return this.data.hierarchy[e].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(t,e,i){for(var n=this.data.hierarchy[e].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][t])return n[i];return this.data.hierarchy[e].keys[n.length-1]},THREE.CubeCamera=function(t,e,i,n){this.heightOffset=i,this.position=new THREE.Vector3(0,i,0),this.cameraPX=new THREE.PerspectiveCamera(90,1,t,e),this.cameraNX=new THREE.PerspectiveCamera(90,1,t,e),this.cameraPY=new THREE.PerspectiveCamera(90,1,t,e),this.cameraNY=new THREE.PerspectiveCamera(90,1,t,e),this.cameraPZ=new THREE.PerspectiveCamera(90,1,t,e),this.cameraNZ=new THREE.PerspectiveCamera(90,1,t,e),this.cameraPX.position=this.position,this.cameraNX.position=this.position,this.cameraPY.position=this.position,this.cameraNY.position=this.position,this.cameraPZ.position=this.position,this.cameraNZ.position=this.position,this.cameraPX.up.set(0,-1,0),this.cameraNX.up.set(0,-1,0),this.cameraPY.up.set(0,0,1),this.cameraNY.up.set(0,0,-1),this.cameraPZ.up.set(0,-1,0),this.cameraNZ.up.set(0,-1,0),this.targetPX=new THREE.Vector3(0,0,0),this.targetNX=new THREE.Vector3(0,0,0),this.targetPY=new THREE.Vector3(0,0,0),this.targetNY=new THREE.Vector3(0,0,0),this.targetPZ=new THREE.Vector3(0,0,0),this.targetNZ=new THREE.Vector3(0,0,0),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updatePosition=function(t){this.position.copy(t),this.position.y+=this.heightOffset,this.targetPX.copy(this.position),this.targetNX.copy(this.position),this.targetPY.copy(this.position),this.targetNY.copy(this.position),this.targetPZ.copy(this.position),this.targetNZ.copy(this.position),this.targetPX.x+=1,this.targetNX.x-=1,this.targetPY.y+=1,this.targetNY.y-=1,this.targetPZ.z+=1,this.targetNZ.z-=1,this.cameraPX.lookAt(this.targetPX),this.cameraNX.lookAt(this.targetNX),this.cameraPY.lookAt(this.targetPY),this.cameraNY.lookAt(this.targetNY),this.cameraPZ.lookAt(this.targetPZ),this.cameraNZ.lookAt(this.targetNZ)},this.updateCubeMap=function(t,e){var i=this.renderTarget;i.activeCubeFace=0,t.render(e,this.cameraPX,i),i.activeCubeFace=1,t.render(e,this.cameraNX,i),i.activeCubeFace=2,t.render(e,this.cameraPY,i),i.activeCubeFace=3,t.render(e,this.cameraNY,i),i.activeCubeFace=4,t.render(e,this.cameraPZ,i),i.activeCubeFace=5,t.render(e,this.cameraNZ,i)}},THREE.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")},THREE.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")},THREE.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")},THREE.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")},THREE.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")},THREE.CombinedCamera=function(t,e,i,n,r,o,a){THREE.Camera.call(this),this.fov=i,this.left=-t/2,this.right=t/2,this.top=e/2,this.bottom=-e/2,this.cameraO=new THREE.OrthographicCamera(t/-2,t/2,e/2,e/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(i,t/e,n,r),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=new THREE.Camera,THREE.CombinedCamera.prototype.constructor=THREE.CoolCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var t=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),e=2*t*this.cameraP.aspect/2;t/=this.zoom,e/=this.zoom,this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setFov=function(t){this.fov=t,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.setLens=function(t,e){e||(e=43.25);var i=2*Math.atan(e/(2*t));return i*=180/Math.PI,this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(t){this.zoom=t,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(t,e){function i(t,e){return function(){e.apply(t,arguments)}}this.object=t,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==e?e:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(t){if(this.domElement!==document&&this.domElement.focus(),t.preventDefault(),t.stopPropagation(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(t){if(t.preventDefault(),t.stopPropagation(),this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(t){this.domElement===document?(this.mouseX=t.pageX-this.viewHalfX,this.mouseY=t.pageY-this.viewHalfY):(this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(t){var e=0;if(!this.freeze){if(this.heightSpeed){var i=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*i*this.heightCoef}else this.autoSpeedFactor=0;e=t*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(e+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(e),this.moveLeft&&this.object.translateX(-e),this.moveRight&&this.object.translateX(e),this.moveUp&&this.object.translateY(e),this.moveDown&&this.object.translateY(-e),i=t*this.lookSpeed,this.activeLook||(i=0),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,t=this.target,e=this.object.position,t.x=e.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=e.y+100*Math.cos(this.phi),t.z=e.z+100*Math.sin(this.phi)*Math.sin(this.theta)}t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,e=this.object.position,t.x=e.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=e.y+100*Math.cos(this.phi),t.z=e.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",i(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",i(this,this.onKeyUp),!1)},THREE.PathControls=function(t,e){function i(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function n(t,e){return function(){e.apply(t,arguments)}}function r(t,e,i,n){var r,o={name:i,fps:.6,length:n,hierarchy:[]},a=e.getControlPointsArray(),s=e.getLength(),l=a.length,h=0;for(r=l-1,e={parent:-1,keys:[]},e.keys[0]={time:0,pos:a[0],rot:[0,0,0,1],scl:[1,1,1]},e.keys[r]={time:n,pos:a[r],rot:[0,0,0,1],scl:[1,1,1]},r=1;l-1>r;r++)h=n*s.chunks[r]/s.total,e.keys[r]={time:h,pos:a[r]};return o.hierarchy[0]=e,THREE.AnimationHandler.add(o),new THREE.Animation(t,i,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function o(t,e){var i,n,r=new THREE.Geometry;for(i=0;i<t.points.length*e;i++)n=i/(t.points.length*e),n=t.getPoint(n),r.vertices[i]=new THREE.Vertex(new THREE.Vector3(n.x,n.y,n.z));return r}this.object=t,this.domElement=void 0!==e?e:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var a=2*Math.PI,s=Math.PI/180;this.update=function(t){var e;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*t),this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*t),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*s,this.theta=this.lon*s,t=this.phi%a,this.phi=t>=0?t:t+a,e=this.verticalAngleMap.srcRange,t=this.verticalAngleMap.dstRange,e=THREE.Math.mapLinear(this.phi,e[0],e[1],t[0],t[1]);var n=t[1]-t[0];this.phi=i((e-t[0])/n)*n+t[0],e=this.horizontalAngleMap.srcRange,t=this.horizontalAngleMap.dstRange,e=THREE.Math.mapLinear(this.theta,e[0],e[1],t[0],t[1]),n=t[1]-t[0],this.theta=i((e-t[0])/n)*n+t[0],t=this.target.position,t.x=100*Math.sin(this.phi)*Math.cos(this.theta),t.y=100*Math.cos(this.phi),t.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(t){this.domElement===document?(this.mouseX=t.pageX-this.viewHalfX,this.mouseY=t.pageY-this.viewHalfY):(this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var t=new THREE.MeshLambertMaterial({color:30719}),e=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),a=new THREE.CubeGeometry(2,2,10);
this.animationParent=new THREE.Mesh(i,t),t=new THREE.Mesh(a,e),t.position.set(0,10,0),this.animation=r(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(t)}else this.animation=r(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var t=this.debugPath,e=this.spline,a=o(e,10),i=o(e,10),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),a=new THREE.Line(a,s),i=new THREE.ParticleSystem(i,new THREE.ParticleBasicMaterial({color:16755200,size:3}));a.scale.set(1,1,1),t.add(a),i.scale.set(1,1,1),t.add(i);for(var a=new THREE.SphereGeometry(1,16,8),s=new THREE.MeshBasicMaterial({color:65280}),l=0;l<e.points.length;l++)i=new THREE.Mesh(a,s),i.position.copy(e.points[l]),t.add(i)}this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1)}},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(t,e){function i(t,e){return function(){e.apply(t,arguments)}}this.object=t,this.domElement=void 0!==e?e:document,e&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)},this.keydown=function(t){if(!t.altKey){switch(t.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(t){switch(t.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(t){if(this.domElement!==document&&this.domElement.focus(),t.preventDefault(),t.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(t.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(t){if(!this.dragToLook||this.mouseStatus>0){var e=this.getContainerDimensions(),i=e.size[0]/2,n=e.size[1]/2;this.moveState.yawLeft=-(t.pageX-e.offset[0]-i)/i,this.moveState.pitchDown=(t.pageY-e.offset[1]-n)/n,this.updateRotationVector()}},this.mouseup=function(t){if(t.preventDefault(),t.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(t){var e=t*this.movementSpeed;t*=this.rollSpeed,this.object.translateX(this.moveVector.x*e),this.object.translateY(this.moveVector.y*e),this.object.translateZ(this.moveVector.z*e),this.tmpQuaternion.set(this.rotationVector.x*t,this.rotationVector.y*t,this.rotationVector.z*t,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-t+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",i(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",i(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",i(this,this.mouseup),!1),this.domElement.addEventListener("keydown",i(this,this.keydown),!1),this.domElement.addEventListener("keyup",i(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(t,e){this.object=t,this.domElement=void 0!==e?e:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Matrix4,a=!1,s=1,l=0,h=0,c=0,u=0,f=0,d=window.innerWidth/2,p=window.innerHeight/2;this.update=function(t){if(this.mouseLook){var e=t*this.lookSpeed;this.rotateHorizontally(e*u),this.rotateVertically(e*f)}e=t*this.movementSpeed,this.object.translateZ(-e*(l>0||this.autoForward&&!(0>l)?1:l)),this.object.translateX(e*h),this.object.translateY(e*c),a&&(this.roll+=this.rollSpeed*t*s),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),r.copy(this.forward),n.set(0,1,0),i.cross(n,r).normalize(),n.cross(r,i).normalize(),this.object.matrix.n11=i.x,this.object.matrix.n12=n.x,this.object.matrix.n13=r.x,this.object.matrix.n21=i.y,this.object.matrix.n22=n.y,this.object.matrix.n23=r.y,this.object.matrix.n31=i.z,this.object.matrix.n32=n.z,this.object.matrix.n33=r.z,o.identity(),o.n11=Math.cos(this.roll),o.n12=-Math.sin(this.roll),o.n21=Math.sin(this.roll),o.n22=Math.cos(this.roll),this.object.matrix.multiplySelf(o),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.n14=this.object.position.x,this.object.matrix.n24=this.object.position.y,this.object.matrix.n34=this.object.position.z},this.translateX=function(t){this.object.position.x+=this.object.matrix.n11*t,this.object.position.y+=this.object.matrix.n21*t,this.object.position.z+=this.object.matrix.n31*t},this.translateY=function(t){this.object.position.x+=this.object.matrix.n12*t,this.object.position.y+=this.object.matrix.n22*t,this.object.position.z+=this.object.matrix.n32*t},this.translateZ=function(t){this.object.position.x-=this.object.matrix.n13*t,this.object.position.y-=this.object.matrix.n23*t,this.object.position.z-=this.object.matrix.n33*t},this.rotateHorizontally=function(t){i.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31),i.multiplyScalar(t),this.forward.subSelf(i),this.forward.normalize()},this.rotateVertically=function(t){n.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32),n.multiplyScalar(t),this.forward.addSelf(n),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(t){u=(t.clientX-d)/window.innerWidth,f=(t.clientY-p)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(t){switch(t.preventDefault(),t.stopPropagation(),t.button){case 0:l=1;break;case 2:l=-1}},!1),this.domElement.addEventListener("mouseup",function(t){switch(t.preventDefault(),t.stopPropagation(),t.button){case 0:l=0;break;case 2:l=0}},!1),this.domElement.addEventListener("keydown",function(t){switch(t.keyCode){case 38:case 87:l=1;break;case 37:case 65:h=-1;break;case 40:case 83:l=-1;break;case 39:case 68:h=1;break;case 81:a=!0,s=1;break;case 69:a=!0,s=-1;break;case 82:c=1;break;case 70:c=-1}},!1),this.domElement.addEventListener("keyup",function(t){switch(t.keyCode){case 38:case 87:l=0;break;case 37:case 65:h=0;break;case 40:case 83:l=0;break;case 39:case 68:h=0;break;case 81:a=!1;break;case 69:a=!1;break;case 82:c=0;break;case 70:c=0}},!1)},THREE.TrackballControls=function(t,e){var i=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3(0,0,0);var r=!1,o=n.NONE,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector2,c=new THREE.Vector2,u=new THREE.Vector2,f=new THREE.Vector2;this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)},this.getMouseOnScreen=function(t,e){return new THREE.Vector2((t-i.screen.offsetLeft)/i.radius*.5,(e-i.screen.offsetTop)/i.radius*.5)},this.getMouseProjectionOnBall=function(t,e){var n=new THREE.Vector3((t-.5*i.screen.width-i.screen.offsetLeft)/i.radius,(.5*i.screen.height+i.screen.offsetTop-e)/i.radius,0),r=n.length();return r>1?n.normalize():n.z=Math.sqrt(1-r*r),a.copy(i.object.position).subSelf(i.target),r=i.object.up.clone().setLength(n.y),r.addSelf(i.object.up.clone().crossSelf(a).setLength(n.x)),r.addSelf(a.setLength(n.z)),r},this.rotateCamera=function(){var t=Math.acos(s.dot(l)/s.length()/l.length());if(t){var e=(new THREE.Vector3).cross(s,l).normalize(),n=new THREE.Quaternion;t*=i.rotateSpeed,n.setFromAxisAngle(e,-t),n.multiplyVector3(a),n.multiplyVector3(i.object.up),n.multiplyVector3(l),i.staticMoving?s=l:(n.setFromAxisAngle(e,t*(i.dynamicDampingFactor-1)),n.multiplyVector3(s))}},this.zoomCamera=function(){var t=1+(c.y-h.y)*i.zoomSpeed;1!==t&&t>0&&(a.multiplyScalar(t),i.staticMoving?h=c:h.y+=(c.y-h.y)*this.dynamicDampingFactor)},this.panCamera=function(){var t=f.clone().subSelf(u);if(t.lengthSq()){t.multiplyScalar(a.length()*i.panSpeed);var e=a.clone().crossSelf(i.object.up).setLength(t.x);e.addSelf(i.object.up.clone().setLength(t.y)),i.object.position.addSelf(e),i.target.addSelf(e),i.staticMoving?u=f:u.addSelf(t.sub(f,u).multiplyScalar(i.dynamicDampingFactor))}},this.checkDistances=function(){i.noZoom&&i.noPan||(i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance),a.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,a.setLength(i.minDistance)))},this.update=function(){a.copy(i.object.position).subSelf(this.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.add(i.target,a),i.checkDistances(),i.object.lookAt(i.target)},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(t){i.enabled&&(r&&(s=l=i.getMouseProjectionOnBall(t.clientX,t.clientY),h=c=i.getMouseOnScreen(t.clientX,t.clientY),u=f=i.getMouseOnScreen(t.clientX,t.clientY),r=!1),o!==n.NONE&&(o!==n.ROTATE||i.noRotate?o!==n.ZOOM||i.noZoom?o===n.PAN&&!i.noPan&&(f=i.getMouseOnScreen(t.clientX,t.clientY)):c=i.getMouseOnScreen(t.clientX,t.clientY):l=i.getMouseProjectionOnBall(t.clientX,t.clientY)))},!1),this.domElement.addEventListener("mousedown",function(t){i.enabled&&(t.preventDefault(),t.stopPropagation(),o===n.NONE)&&(o=t.button,o!==n.ROTATE||i.noRotate?o!==n.ZOOM||i.noZoom?this.noPan||(u=f=i.getMouseOnScreen(t.clientX,t.clientY)):h=c=i.getMouseOnScreen(t.clientX,t.clientY):s=l=i.getMouseProjectionOnBall(t.clientX,t.clientY))},!1),this.domElement.addEventListener("mouseup",function(t){i.enabled&&(t.preventDefault(),t.stopPropagation(),o=n.NONE)},!1),window.addEventListener("keydown",function(t){i.enabled&&o===n.NONE&&(t.keyCode!==i.keys[n.ROTATE]||i.noRotate?t.keyCode!==i.keys[n.ZOOM]||i.noZoom?t.keyCode!==i.keys[n.PAN]||i.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE,o!==n.NONE&&(r=!0))},!1),window.addEventListener("keyup",function(){i.enabled&&o!==n.NONE&&(o=n.NONE)},!1)},THREE.CubeGeometry=function(t,e,i,n,r,o,a,s){function l(t,e,i,a,s,l,h,c){var u,f=n||1,d=r||1,p=s/2,E=l/2,g=m.vertices.length;"x"===t&&"y"===e||"y"===t&&"x"===e?u="z":"x"===t&&"z"===e||"z"===t&&"x"===e?(u="y",d=o||1):("z"===t&&"y"===e||"y"===t&&"z"===e)&&(u="x",f=o||1);var v=f+1,y=d+1,T=s/f,b=l/d,R=new THREE.Vector3;for(R[u]=h>0?1:-1,s=0;y>s;s++)for(l=0;v>l;l++){var x=new THREE.Vector3;x[t]=(l*T-p)*i,x[e]=(s*b-E)*a,x[u]=h,m.vertices.push(new THREE.Vertex(x))}for(s=0;d>s;s++)for(l=0;f>l;l++)t=new THREE.Face4(l+v*s+g,l+v*(s+1)+g,l+1+v*(s+1)+g,l+1+v*s+g),t.normal.copy(R),t.vertexNormals.push(R.clone(),R.clone(),R.clone(),R.clone()),t.materialIndex=c,m.faces.push(t),m.faceVertexUvs[0].push([new THREE.UV(l/f,s/d),new THREE.UV(l/f,(s+1)/d),new THREE.UV((l+1)/f,(s+1)/d),new THREE.UV((l+1)/f,s/d)])}THREE.Geometry.call(this);var h,c,u,f,d,p,m=this,E=t/2,g=e/2,v=i/2;if(void 0!==a){if(a instanceof Array)this.materials=a;else for(this.materials=[],h=0;6>h;h++)this.materials.push(a);h=0,f=1,c=2,d=3,u=4,p=5}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},void 0!=s)for(var y in s)void 0!=this.sides[y]&&(this.sides[y]=s[y]);this.sides.px&&l("z","y",-1,-1,i,e,E,h),this.sides.nx&&l("z","y",1,-1,i,e,-E,f),this.sides.py&&l("x","z",1,1,t,i,g,c),this.sides.ny&&l("x","z",1,-1,t,i,-g,d),this.sides.pz&&l("x","y",1,-1,t,e,v,u),this.sides.nz&&l("x","y",-1,-1,t,e,-v,p),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(t,e,i,n,r,o){THREE.Geometry.call(this);var a,s,t=null!=t?t:20,e=null!=e?e:20,i=i||100,l=i/2,n=n||8,r=r||1,h=[],c=[];for(s=0;r>=s;s++){var u=[],f=[],d=s/r,p=d*(e-t)+t;for(a=0;n>=a;a++){var m=a/n;this.vertices.push(new THREE.Vertex(new THREE.Vector3(p*Math.sin(m*Math.PI*2),-d*i+l,p*Math.cos(m*Math.PI*2)))),u.push(this.vertices.length-1),f.push(new THREE.UV(m,d))}h.push(u),c.push(f)}for(s=0;r>s;s++)for(a=0;n>a;a++){var i=h[s][a],u=h[s+1][a],f=h[s+1][a+1],d=h[s][a+1],p=this.vertices[i].position.clone().setY(0).normalize(),m=this.vertices[u].position.clone().setY(0).normalize(),E=this.vertices[f].position.clone().setY(0).normalize(),g=this.vertices[d].position.clone().setY(0).normalize(),v=c[s][a].clone(),y=c[s+1][a].clone(),T=c[s+1][a+1].clone(),b=c[s][a+1].clone();this.faces.push(new THREE.Face4(i,u,f,d,[p,m,E,g])),this.faceVertexUvs[0].push([v,y,T,b])}if(!o&&t>0)for(this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,l,0))),a=0;n>a;a++)i=h[0][a],u=h[0][a+1],f=this.vertices.length-1,p=new THREE.Vector3(0,1,0),m=new THREE.Vector3(0,1,0),E=new THREE.Vector3(0,1,0),v=c[0][a].clone(),y=c[0][a+1].clone(),T=new THREE.UV(y.u,0),this.faces.push(new THREE.Face3(i,u,f,[p,m,E])),this.faceVertexUvs[0].push([v,y,T]);if(!o&&e>0)for(this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,-l,0))),a=0;n>a;a++)i=h[s][a+1],u=h[s][a],f=this.vertices.length-1,p=new THREE.Vector3(0,-1,0),m=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,-1,0),v=c[s][a+1].clone(),y=c[s][a].clone(),T=new THREE.UV(y.u,1),this.faces.push(new THREE.Face3(i,u,f,[p,m,E])),this.faceVertexUvs[0].push([v,y,T]);this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(t,e){if("undefined"!=typeof t){THREE.Geometry.call(this);var i,n,t=t instanceof Array?t:[t],r=t.length;for(this.shapebb=t[r-1].getBoundingBox(),i=0;r>i;i++)n=t[i],this.addShape(n,e);this.computeCentroids(),this.computeFaceNormals()}},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShape=function(t,e){function i(t,e,i){return e||console.log("die"),e.clone().multiplyScalar(i).addSelf(t)}function n(t,e,i){var n=THREE.ExtrudeGeometry.__v1,r=THREE.ExtrudeGeometry.__v2,o=THREE.ExtrudeGeometry.__v3,a=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;return n.set(t.x-e.x,t.y-e.y),r.set(t.x-i.x,t.y-i.y),n=n.normalize(),r=r.normalize(),o.set(-n.y,n.x),a.set(r.y,-r.x),s.copy(t).addSelf(o),l.copy(t).addSelf(a),s.equals(l)?a.clone():(s.copy(e).addSelf(o),l.copy(i).addSelf(a),o=n.dot(a),a=l.subSelf(s).dot(a),0===o&&(console.log("Either infinite or no solutions!"),console.log(0===a?"Its finite solutions.":"Too bad, no solutions.")),a/=o,0>a?(e=Math.atan2(e.y-t.y,e.x-t.x),t=Math.atan2(i.y-t.y,i.x-t.x),e>t&&(t+=2*Math.PI),t=(e+t)/2,new THREE.Vector2(-Math.cos(t),-Math.sin(t))):n.multiplyScalar(a).addSelf(s).subSelf(t).clone())}function r(t){for(S=t.length;--S>=0;){I=S,B=S-1,0>B&&(B=t.length-1);for(var e=0,i=p+2*u,e=0;i>e;e++){var n=N*e,r=N*(e+1),o=U+I+n,a=U+I+r,s=o,n=U+B+n,r=U+B+r,c=a;s+=_,n+=_,r+=_,c+=_,H.faces.push(new THREE.Face4(s,n,r,c,null,null,T)),T&&(s=e/i,n=(e+1)/i,r=l+2*h,o=(H.vertices[o].position.z+h)/r,a=(H.vertices[a].position.z+h)/r,H.faceVertexUvs[0].push([new THREE.UV(o,s),new THREE.UV(a,s),new THREE.UV(a,n),new THREE.UV(o,n)]))}}}function o(t,e,i){H.vertices.push(new THREE.Vertex(new THREE.Vector3(t,e,i)))}function a(t,e,i){if(t+=_,e+=_,i+=_,H.faces.push(new THREE.Face3(t,e,i,null,null,y)),y){var n=b.maxY,r=b.maxX,o=H.vertices[e].position.x,e=H.vertices[e].position.y,a=H.vertices[i].position.x,i=H.vertices[i].position.y;H.faceVertexUvs[0].push([new THREE.UV(H.vertices[t].position.x/r,H.vertices[t].position.y/n),new THREE.UV(o/r,e/n),new THREE.UV(a/r,i/n)])}}var s,l=void 0!==e.amount?e.amount:100,h=void 0!==e.bevelThickness?e.bevelThickness:6,c=void 0!==e.bevelSize?e.bevelSize:h-2,u=void 0!==e.bevelSegments?e.bevelSegments:3,f=void 0!==e.bevelEnabled?e.bevelEnabled:!0,d=void 0!==e.curveSegments?e.curveSegments:12,p=void 0!==e.steps?e.steps:1,m=e.bendPath,E=e.extrudePath,g=!1,v=void 0!==e.useSpacedPoints?e.useSpacedPoints:!1,y=e.material,T=e.extrudeMaterial,b=this.shapebb;E&&(s=E.getPoints(d),p=s.length,g=!0,f=!1),f||(c=h=u=0);var R,x,w,H=this,_=this.vertices.length;if(m&&t.addWrapPath(m),d=v?t.extractAllSpacedPoints(d):t.extractAllPoints(d),m=d.shape,d=d.holes,E=!THREE.Shape.Utils.isClockWise(m)){for(m=m.reverse(),x=0,w=d.length;w>x;x++)R=d[x],THREE.Shape.Utils.isClockWise(R)&&(d[x]=R.reverse());E=!1}for(E=THREE.Shape.Utils.triangulateShape(m,d),v=m,x=0,w=d.length;w>x;x++)R=d[x],m=m.concat(R);var S,M,C,A,k,L,N=m.length,P=E.length,F=[];for(S=0,M=v.length,I=M-1,B=S+1;M>S;S++,I++,B++)I===M&&(I=0),B===M&&(B=0),F[S]=n(v[S],v[I],v[B]);var D,z=[],V=F.concat();for(x=0,w=d.length;w>x;x++){for(R=d[x],D=[],S=0,M=R.length,I=M-1,B=S+1;M>S;S++,I++,B++)I===M&&(I=0),B===M&&(B=0),D[S]=n(R[S],R[I],R[B]);z.push(D),V=V.concat(D)}for(C=0;u>C;C++){for(A=C/u,k=h*(1-A),A=c*Math.sin(A*Math.PI/2),S=0,M=v.length;M>S;S++)L=i(v[S],F[S],A),o(L.x,L.y,-k);for(x=0,w=d.length;w>x;x++)for(R=d[x],D=z[x],S=0,M=R.length;M>S;S++)L=i(R[S],D[S],A),o(L.x,L.y,-k)}for(A=c,S=0;N>S;S++)L=f?i(m[S],V[S],A):m[S],g?o(L.x,L.y+s[0].y,s[0].x):o(L.x,L.y,0);for(C=1;p>=C;C++)for(S=0;N>S;S++)L=f?i(m[S],V[S],A):m[S],g?o(L.x,L.y+s[C-1].y,s[C-1].x):o(L.x,L.y,l/p*C);for(C=u-1;C>=0;C--){for(A=C/u,k=h*(1-A),A=c*Math.sin(A*Math.PI/2),S=0,M=v.length;M>S;S++)L=i(v[S],F[S],A),o(L.x,L.y,l+k);for(x=0,w=d.length;w>x;x++)for(R=d[x],D=z[x],S=0,M=R.length;M>S;S++)L=i(R[S],D[S],A),g?o(L.x,L.y+s[p-1].y,s[p-1].x+k):o(L.x,L.y,l+k)}if(f){for(f=0*N,S=0;P>S;S++)c=E[S],a(c[2]+f,c[1]+f,c[0]+f);for(f=N*(p+2*u),S=0;P>S;S++)c=E[S],a(c[0]+f,c[1]+f,c[2]+f)}else{for(S=0;P>S;S++)c=E[S],a(c[2],c[1],c[0]);for(S=0;P>S;S++)c=E[S],a(c[0]+N*p,c[1]+N*p,c[2]+N*p)}var I,B,U=0;for(r(v),U+=v.length,x=0,w=d.length;w>x;x++)R=d[x],r(R),U+=R.length},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.IcosahedronGeometry=function(t){function e(t,e,i){var n=Math.sqrt(t*t+e*e+i*i);return r.vertices.push(new THREE.Vertex(new THREE.Vector3(t/n,e/n,i/n)))-1}function i(t,e,i,n){var o=r.vertices[t].position,a=r.vertices[e].position,s=r.vertices[i].position,t=new THREE.Face3(t,e,i);t.vertexNormals.push(o.clone().normalize(),a.clone().normalize(),s.clone().normalize()),n.faces.push(t),n.faceVertexUvs[0].push([new THREE.UV(1-(Math.atan2(o.z,o.x)+Math.PI)%Math.PI/Math.PI*.5,.5-o.y/2),new THREE.UV(1-(Math.atan2(a.z,a.x)+Math.PI)%Math.PI/Math.PI*.5,.5-a.y/2),new THREE.UV(1-(Math.atan2(s.z,s.x)+Math.PI)%Math.PI/Math.PI*.5,.5-s.y/2)])}function n(t,i){var n=r.vertices[t].position,o=r.vertices[i].position;return e((n.x+o.x)/2,(n.y+o.y)/2,(n.z+o.z)/2)}var r=this,o=new THREE.Geometry;this.subdivisions=t||0,THREE.Geometry.call(this),t=(1+Math.sqrt(5))/2,e(-1,t,0),e(1,t,0),e(-1,-t,0),e(1,-t,0),e(0,-1,t),e(0,1,t),e(0,-1,-t),e(0,1,-t),e(t,0,-1),e(t,0,1),e(-t,0,-1),e(-t,0,1),i(0,11,5,o),i(0,5,1,o),i(0,1,7,o),i(0,7,10,o),i(0,10,11,o),i(1,5,9,o),i(5,11,4,o),i(11,10,2,o),i(10,7,6,o),i(7,1,8,o),i(3,9,4,o),i(3,4,2,o),i(3,2,6,o),i(3,6,8,o),i(3,8,9,o),i(4,9,5,o),i(2,4,11,o),i(6,2,10,o),i(8,6,7,o),i(9,8,1,o);for(var a=0;a<this.subdivisions;a++){var s,t=new THREE.Geometry;for(s in o.faces){var l=n(o.faces[s].a,o.faces[s].b),h=n(o.faces[s].b,o.faces[s].c),c=n(o.faces[s].c,o.faces[s].a);i(o.faces[s].a,l,c,t),i(o.faces[s].b,h,l,t),i(o.faces[s].c,c,h,t),i(l,h,c,t)}o.faces=t.faces,o.faceVertexUvs[0]=t.faceVertexUvs[0]}r.faces=o.faces,r.faceVertexUvs[0]=o.faceVertexUvs[0],this.computeCentroids(),this.computeFaceNormals()},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.LatheGeometry=function(t,e,i){THREE.Geometry.call(this),this.steps=e||12,this.angle=i||2*Math.PI;for(var e=this.angle/this.steps,i=[],n=[],r=[],o=[],a=(new THREE.Matrix4).setRotationZ(e),s=0;s<t.length;s++)this.vertices.push(new THREE.Vertex(t[s])),i[s]=t[s].clone(),n[s]=this.vertices.length-1;for(var l=0;l<=this.angle+.001;l+=e){for(s=0;s<i.length;s++)l<this.angle?(i[s]=a.multiplyVector3(i[s].clone()),this.vertices.push(new THREE.Vertex(i[s])),r[s]=this.vertices.length-1):r=o;for(0==l&&(o=n),s=0;s<n.length-1;s++)this.faces.push(new THREE.Face4(r[s],r[s+1],n[s+1],n[s])),this.faceVertexUvs[0].push([new THREE.UV(1-l/this.angle,s/t.length),new THREE.UV(1-l/this.angle,(s+1)/t.length),new THREE.UV(1-(l-e)/this.angle,(s+1)/t.length),new THREE.UV(1-(l-e)/this.angle,s/t.length)]);n=r,r=[]}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.OctahedronGeometry=function(t,e){function i(e){var i=e.clone().normalize(),i=new THREE.Vertex(i.clone().multiplyScalar(t));return i.index=a.vertices.push(i)-1,i.uv=new THREE.UV(Math.atan2(e.z,-e.x)/2/Math.PI+.5,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5),i}function n(t,e,i,s){1>s?(s=new THREE.Face3(t.index,e.index,i.index,[t.position,e.position,i.position]),s.centroid.addSelf(t.position).addSelf(e.position).addSelf(i.position).divideScalar(3),s.normal=s.centroid.clone().normalize(),a.faces.push(s),s=Math.atan2(s.centroid.z,-s.centroid.x),a.faceVertexUvs[0].push([o(t.uv,t.position,s),o(e.uv,e.position,s),o(i.uv,i.position,s)])):(s-=1,n(t,r(t,e),r(t,i),s),n(r(t,e),e,r(e,i),s),n(r(t,i),r(e,i),i,s),n(r(t,e),r(e,i),r(t,i),s))}function r(t,e){s[t.index]||(s[t.index]=[]),s[e.index]||(s[e.index]=[]);var n=s[t.index][e.index];return void 0===n&&(s[t.index][e.index]=s[e.index][t.index]=n=i((new THREE.Vector3).add(t.position,e.position).divideScalar(2))),n}function o(t,e,i){return 0>i&&1===t.u&&(t=new THREE.UV(t.u-1,t.v)),0===e.x&&0===e.z&&(t=new THREE.UV(i/2/Math.PI+.5,t.v)),t}THREE.Geometry.call(this);var e=e||0,a=this;i(new THREE.Vector3(1,0,0)),i(new THREE.Vector3(-1,0,0)),i(new THREE.Vector3(0,1,0)),i(new THREE.Vector3(0,-1,0)),i(new THREE.Vector3(0,0,1)),i(new THREE.Vector3(0,0,-1));var s=[],l=this.vertices;n(l[0],l[2],l[4],e),n(l[0],l[4],l[3],e),n(l[0],l[3],l[5],e),n(l[0],l[5],l[2],e),n(l[1],l[2],l[5],e),n(l[1],l[5],l[3],e),n(l[1],l[3],l[4],e),n(l[1],l[4],l[2],e),this.boundingSphere={radius:t}},THREE.OctahedronGeometry.prototype=new THREE.Geometry,THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.PlaneGeometry=function(t,e,i,n){THREE.Geometry.call(this);for(var r=t/2,o=e/2,i=i||1,n=n||1,a=i+1,s=n+1,l=t/i,h=e/n,c=new THREE.Vector3(0,0,1),t=0;s>t;t++)for(e=0;a>e;e++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(e*l-r,-(t*h-o),0)));for(t=0;n>t;t++)for(e=0;i>e;e++)r=new THREE.Face4(e+a*t,e+a*(t+1),e+1+a*(t+1),e+1+a*t),r.normal.copy(c),r.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),this.faces.push(r),this.faceVertexUvs[0].push([new THREE.UV(e/i,t/n),new THREE.UV(e/i,(t+1)/n),new THREE.UV((e+1)/i,(t+1)/n),new THREE.UV((e+1)/i,t/n)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(t,e,i,n,r,o,a){THREE.Geometry.call(this);var s,l,t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!=n?n:0,r=void 0!=r?r:2*Math.PI,o=void 0!=o?o:0,a=void 0!=a?a:Math.PI,h=[],c=[];for(l=0;i>=l;l++){var u=[],f=[];for(s=0;e>=s;s++){var d=s/e,p=l/i;this.vertices.push(new THREE.Vertex(new THREE.Vector3(-t*Math.cos(n+d*r)*Math.sin(o+p*a),t*Math.cos(o+p*a),t*Math.sin(n+d*r)*Math.sin(o+p*a)))),u.push(this.vertices.length-1),f.push(new THREE.UV(d,p))}h.push(u),c.push(f)}for(l=0;i>l;l++)for(s=0;e>s;s++){var n=h[l][s+1],r=h[l][s],o=h[l+1][s],a=h[l+1][s+1],u=this.vertices[n].position.clone().normalize(),f=this.vertices[r].position.clone().normalize(),d=this.vertices[o].position.clone().normalize(),p=this.vertices[a].position.clone().normalize(),m=c[l][s+1].clone(),E=c[l][s].clone(),g=c[l+1][s].clone(),v=c[l+1][s+1].clone();Math.abs(this.vertices[n].position.y)==t?(this.faces.push(new THREE.Face3(n,o,a,[u,d,p])),this.faceVertexUvs[0].push([m,g,v])):Math.abs(this.vertices[o].position.y)==t?(this.faces.push(new THREE.Face3(n,r,o,[u,f,d])),this.faceVertexUvs[0].push([m,E,g])):(this.faces.push(new THREE.Face4(n,r,o,a,[u,f,d,p])),this.faceVertexUvs[0].push([m,E,g,v]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:t}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(t,e){var i=new THREE.TextPath(t,e).toShapes();if(e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),e.bend){var n=i[i.length-1].getBoundingBox().maxX;e.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(n/2,120),new THREE.Vector2(n,0))}THREE.ExtrudeGeometry.call(this,i,e)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(t){var e=t.familyName.toLowerCase();return this.faces[e]=this.faces[e]||{},this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{},this.faces[e][t.cssFontWeight][t.cssFontStyle]=t,this.faces[e][t.cssFontWeight][t.cssFontStyle]=t},drawText:function(t){for(var e=this.getFace(),i=this.size/e.resolution,n=0,r=String(t).split(""),o=r.length,a=[],t=0;o>t;t++){var s=new THREE.Path,s=this.extractGlyphPoints(r[t],e,i,n,s);n+=s.offset,a.push(s.path)}return{paths:a,offset:n/2}},extractGlyphPoints:function(t,e,i,n,r){var o,a,s,l,h,c,u,f,d,p,m,E=[],g=e.glyphs[t]||e.glyphs["?"];if(g){if(g.o)for(e=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),l=e.length,t=0;l>t;)switch(s=e[t++]){case"m":s=e[t++]*i+n,h=e[t++]*i,E.push(new THREE.Vector2(s,h)),r.moveTo(s,h);break;case"l":s=e[t++]*i+n,h=e[t++]*i,E.push(new THREE.Vector2(s,h)),r.lineTo(s,h);break;case"q":if(s=e[t++]*i+n,h=e[t++]*i,f=e[t++]*i+n,d=e[t++]*i,r.quadraticCurveTo(f,d,s,h),o=E[E.length-1])for(c=o.x,u=o.y,o=1,a=this.divisions;a>=o;o++){var v=o/a,y=THREE.Shape.Utils.b2(v,c,f,s),v=THREE.Shape.Utils.b2(v,u,d,h);E.push(new THREE.Vector2(y,v))}break;case"b":if(s=e[t++]*i+n,h=e[t++]*i,f=e[t++]*i+n,d=e[t++]*-i,p=e[t++]*i+n,m=e[t++]*-i,r.bezierCurveTo(s,h,f,d,p,m),o=E[E.length-1])for(c=o.x,u=o.y,o=1,a=this.divisions;a>=o;o++)v=o/a,y=THREE.Shape.Utils.b3(v,c,f,p,s),v=THREE.Shape.Utils.b3(v,u,d,m,h),E.push(new THREE.Vector2(y,v))}return{offset:g.ha*i,points:E,path:r}}}},function(t){var e=function(t){for(var e=t.length,i=0,n=e-1,r=0;e>r;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i};return t.Triangulate=function(t,i){var n=t.length;if(3>n)return null;var r,o,a,s=[],l=[],h=[];if(e(t)>0)for(o=0;n>o;o++)l[o]=o;else for(o=0;n>o;o++)l[o]=n-1-o;var c=2*n;for(o=n-1;n>2;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),i?h:s;r=o,r>=n&&(r=0),o=r+1,o>=n&&(o=0),a=o+1,a>=n&&(a=0);var u;t:{u=t;var f=r,d=o,p=a,m=n,E=l,g=void 0,v=void 0,y=void 0,T=void 0,b=void 0,R=void 0,x=void 0,w=void 0,H=void 0,v=u[E[f]].x,y=u[E[f]].y,T=u[E[d]].x,b=u[E[d]].y,R=u[E[p]].x,x=u[E[p]].y;if(1e-10>(T-v)*(x-y)-(b-y)*(R-v))u=!1;else{for(g=0;m>g;g++)if(g!=f&&g!=d&&g!=p){var w=u[E[g]].x,H=u[E[g]].y,_=void 0,S=void 0,M=void 0,C=void 0,A=void 0,k=void 0,L=void 0,N=void 0,P=void 0,F=void 0,D=void 0,z=void 0,_=M=A=void 0,_=R-T,S=x-b,M=v-R,C=y-x,A=T-v,k=b-y,L=w-v,N=H-y,P=w-T,F=H-b,D=w-R,z=H-x,_=_*F-S*P,A=A*N-k*L,M=M*z-C*D;if(_>=0&&M>=0&&A>=0){u=!1;break t}}u=!0}}if(u){for(s.push([t[l[r]],t[l[o]],t[l[a]]]),h.push([l[r],l[o],l[a]]),r=o,a=o+1;n>a;r++,a++)l[r]=l[a];n--,c=2*n}}return i?h:s},t.Triangulate.area=e,t}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(t,e,i,n,r){for(THREE.Geometry.call(this),this.radius=t||100,this.tube=e||40,this.segmentsR=i||8,this.segmentsT=n||6,this.arc=r||2*Math.PI,r=new THREE.Vector3,t=[],e=[],i=0;i<=this.segmentsR;i++)for(n=0;n<=this.segmentsT;n++){var o=n/this.segmentsT*this.arc,a=i/this.segmentsR*Math.PI*2;r.x=this.radius*Math.cos(o),r.y=this.radius*Math.sin(o);var s=new THREE.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(o),s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(o),s.z=this.tube*Math.sin(a),this.vertices.push(new THREE.Vertex(s)),t.push(new THREE.UV(n/this.segmentsT,1-i/this.segmentsR)),e.push(s.clone().subSelf(r).normalize())}for(i=1;i<=this.segmentsR;i++)for(n=1;n<=this.segmentsT;n++){var r=(this.segmentsT+1)*i+n-1,o=(this.segmentsT+1)*(i-1)+n-1,a=(this.segmentsT+1)*(i-1)+n,s=(this.segmentsT+1)*i+n,l=new THREE.Face4(r,o,a,s,[e[r],e[o],e[a],e[s]]);l.normal.addSelf(e[r]),l.normal.addSelf(e[o]),l.normal.addSelf(e[a]),l.normal.addSelf(e[s]),l.normal.normalize(),this.faces.push(l),this.faceVertexUvs[0].push([t[r].clone(),t[o].clone(),t[a].clone(),t[s].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(t,e,i,n,r,o,a){function s(t,e,i,n,r,o){return e=i/n*t,i=Math.cos(e),new THREE.Vector3(r*(2+i)*.5*Math.cos(t),r*(2+i)*Math.sin(t)*.5,o*r*Math.sin(e)*.5)}for(THREE.Geometry.call(this),this.radius=t||200,this.tube=e||40,this.segmentsR=i||64,this.segmentsT=n||8,this.p=r||2,this.q=o||3,this.heightScale=a||1,this.grid=Array(this.segmentsR),i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,t=0;t<this.segmentsR;++t)for(this.grid[t]=Array(this.segmentsT),e=0;e<this.segmentsT;++e){var l=t/this.segmentsR*2*this.p*Math.PI,a=e/this.segmentsT*2*Math.PI,r=s(l,a,this.q,this.p,this.radius,this.heightScale),l=s(l+.01,a,this.q,this.p,this.radius,this.heightScale);i.x=l.x-r.x,i.y=l.y-r.y,i.z=l.z-r.z,n.x=l.x+r.x,n.y=l.y+r.y,n.z=l.z+r.z,o.cross(i,n),n.cross(o,i),o.normalize(),n.normalize(),l=-this.tube*Math.cos(a),a=this.tube*Math.sin(a),r.x+=l*n.x+a*o.x,r.y+=l*n.y+a*o.y,r.z+=l*n.z+a*o.z,this.grid[t][e]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(r.x,r.y,r.z)))-1
}for(t=0;t<this.segmentsR;++t)for(e=0;e<this.segmentsT;++e){var n=(t+1)%this.segmentsR,o=(e+1)%this.segmentsT,r=this.grid[t][e],i=this.grid[n][e],n=this.grid[n][o],o=this.grid[t][o],a=new THREE.UV(t/this.segmentsR,e/this.segmentsT),l=new THREE.UV((t+1)/this.segmentsR,e/this.segmentsT),h=new THREE.UV((t+1)/this.segmentsR,(e+1)/this.segmentsT),c=new THREE.UV(t/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(r,i,n,o)),this.faceVertexUvs[0].push([a,l,h,c])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.SubdivisionModifier=function(t){this.subdivisions=void 0===t?1:t,this.useOldVertexColors=!1,this.supportUVs=!0},THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier,THREE.SubdivisionModifier.prototype.modify=function(t){for(var e=this.subdivisions;e-->0;)this.smooth(t)},THREE.SubdivisionModifier.prototype.smooth=function(t){function e(t,e,i,n,r,o){var a=new THREE.Face4(t,e,i,n,null,r.color,r.material);if(u.useOldVertexColors){a.vertexColors=[];for(var s,l,f,d=0;4>d;d++){f=o[d],s=new THREE.Color,s.setRGB(0,0,0);for(var p=0;p<f.length;p++)l=r.vertexColors[f[p]-1],s.r+=l.r,s.g+=l.g,s.b+=l.b;s.r/=f.length,s.g/=f.length,s.b/=f.length,a.vertexColors[d]=s}}h.push(a),(!u.supportUVs||0!=g.length)&&c.push([g[t],g[e],g[i],g[n]])}function i(t,e){return Math.min(t,e)+"_"+Math.max(t,e)}var n,r,o,a,s,l=[],h=[],c=[],u=this,f=t.vertices,l=t.faces,d=f.concat(),p=[],m={},E={},g=[],v=t.faceVertexUvs[0];for(n=0,r=v.length;r>n;n++)for(o=0,a=v[n].length;a>o;o++)s=l[n]["abcd".charAt(o)],g[s]||(g[s]=v[n][o]);var y;for(n=0,r=l.length;r>n;n++)s=l[n],p.push(s.centroid),d.push(new THREE.Vertex(s.centroid)),u.supportUVs&&0!=g.length&&(y=new THREE.UV,s instanceof THREE.Face3?(y.u=g[s.a].u+g[s.b].u+g[s.c].u,y.v=g[s.a].v+g[s.b].v+g[s.c].v,y.u/=3,y.v/=3):s instanceof THREE.Face4&&(y.u=g[s.a].u+g[s.b].u+g[s.c].u+g[s.d].u,y.v=g[s.a].v+g[s.b].v+g[s.c].v+g[s.d].v,y.u/=4,y.v/=4),g.push(y));r=function(t){function e(t,e,i){void 0===t[e]&&(t[e]=[]),t[e].push(i)}var n,r,o,a,s={};for(n=0,r=t.faces.length;r>n;n++)o=t.faces[n],o instanceof THREE.Face3?(a=i(o.a,o.b),e(s,a,n),a=i(o.b,o.c),e(s,a,n),a=i(o.c,o.a),e(s,a,n)):o instanceof THREE.Face4&&(a=i(o.a,o.b),e(s,a,n),a=i(o.b,o.c),e(s,a,n),a=i(o.c,o.d),e(s,a,n),a=i(o.d,o.a),e(s,a,n));return s}(t);var T,b,R=0,v=f.length,x={},w={},H=function(t,e){void 0===x[t]&&(x[t]=[]),x[t].push(e)},_=function(t,e){void 0===w[t]&&(w[t]={}),w[t][e]=null};for(n in r){for(y=r[n],T=n.split("_"),b=T[0],T=T[1],H(b,[b,T]),H(T,[b,T]),o=0,a=y.length;a>o;o++)s=y[o],_(b,s,n),_(T,s,n);y.length<2&&(E[n]=!0)}for(n in r)y=r[n],s=y[0],y=y[1],T=n.split("_"),b=T[0],T=T[1],a=new THREE.Vector3,E[n]?(a.addSelf(f[b].position),a.addSelf(f[T].position),a.multiplyScalar(.5)):(a.addSelf(p[s]),a.addSelf(p[y]),a.addSelf(f[b].position),a.addSelf(f[T].position),a.multiplyScalar(.25)),m[n]=v+l.length+R,d.push(new THREE.Vertex(a)),R++,u.supportUVs&&0!=g.length&&(y=new THREE.UV,y.u=g[b].u+g[T].u,y.v=g[b].v+g[T].v,y.u/=2,y.v/=2,g.push(y));var S,M;T=["123","12","2","23"],a=["123","23","3","31"];var H=["123","31","1","12"],_=["1234","12","2","23"],C=["1234","23","3","34"],A=["1234","34","4","41"],k=["1234","41","1","12"];for(n=0,r=p.length;r>n;n++)s=l[n],y=v+n,s instanceof THREE.Face3?(R=i(s.a,s.b),b=i(s.b,s.c),S=i(s.c,s.a),e(y,m[R],s.b,m[b],s,T),e(y,m[b],s.c,m[S],s,a),e(y,m[S],s.a,m[R],s,H)):s instanceof THREE.Face4?(R=i(s.a,s.b),b=i(s.b,s.c),S=i(s.c,s.d),M=i(s.d,s.a),e(y,m[R],s.b,m[b],s,_),e(y,m[b],s.c,m[S],s,C),e(y,m[S],s.d,m[M],s,A),e(y,m[M],s.a,m[R],s,k)):console.log("face should be a face!",s);for(l=d,d=new THREE.Vector3,m=new THREE.Vector3,n=0,r=f.length;r>n;n++)if(void 0!==x[n]){d.set(0,0,0),m.set(0,0,0),s=new THREE.Vector3(0,0,0),y=0;for(o in w[n])d.addSelf(p[o]),y++;for(R=0,v=x[n].length,o=0;v>o;o++)E[i(x[n][o][0],x[n][o][1])]&&R++;if(2!=R){for(d.divideScalar(y),o=0;v>o;o++)y=x[n][o],y=f[y[0]].position.clone().addSelf(f[y[1]].position).divideScalar(2),m.addSelf(y);m.divideScalar(v),s.addSelf(f[n].position),s.multiplyScalar(v-3),s.addSelf(d),s.addSelf(m.multiplyScalar(2)),s.divideScalar(v),l[n].position=s}}t.vertices=l,t.faces=h,t.faceVertexUvs[0]=c,delete t.__tmpVertices,t.computeCentroids(),t.computeFaceNormals(),t.computeVertexNormals()},THREE.Loader=function(t){this.statusDomElement=(this.showStatus=t)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,addStatusElement:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.right="0px",t.style.top="0px",t.style.fontSize="0.8em",t.style.textAlign="left",t.style.background="rgba(0,0,0,0.25)",t.style.color="#fff",t.style.width="120px",t.style.padding="0.5em 0.5em 0.5em 0.5em",t.style.zIndex=1e3,t.innerHTML="Loading ...",t},updateProgress:function(t){var e="Loaded ";e+=t.total?(100*t.loaded/t.total).toFixed(0)+"%":(t.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=e},extractUrlbase:function(t){return t=t.split("/"),t.pop(),t.length<1?"":t.join("/")+"/"},initMaterials:function(t,e,i){t.materials=[];for(var n=0;n<e.length;++n)t.materials[n]=THREE.Loader.prototype.createMaterial(e[n],i)},hasNormals:function(t){var e,i,n=t.materials.length;for(i=0;n>i;i++)if(e=t.materials[i],e instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(t,e){function i(t){return t=Math.log(t)/Math.LN2,Math.floor(t)==t}function n(t,e){var n=new Image;n.onload=function(){if(i(this.width)&&i(this.height))t.image=this;else{var e=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),n=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));t.image.width=e,t.image.height=n,t.image.getContext("2d").drawImage(this,0,0,e,n)}t.needsUpdate=!0},n.src=e}function r(t,i,r,o,a,s){var l=document.createElement("canvas");t[i]=new THREE.Texture(l),t[i].sourceFile=r,o&&(t[i].repeat.set(o[0],o[1]),1!=o[0]&&(t[i].wrapS=THREE.RepeatWrapping),1!=o[1]&&(t[i].wrapT=THREE.RepeatWrapping)),a&&t[i].offset.set(a[0],a[1]),s&&(o={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==o[s[0]]&&(t[i].wrapS=o[s[0]]),void 0!==o[s[1]]&&(t[i].wrapT=o[s[1]])),n(t[i],e+"/"+r)}function o(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]}var a,s,l;if(s="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:t.wireframe},t.shading&&("Phong"==t.shading?s="MeshPhongMaterial":"Basic"==t.shading&&(s="MeshBasicMaterial")),t.blending&&("Additive"==t.blending?a.blending=THREE.AdditiveBlending:"Subtractive"==t.blending?a.blending=THREE.SubtractiveBlending:"Multiply"==t.blending&&(a.blending=THREE.MultiplyBlending)),(void 0!==t.transparent||t.opacity<1)&&(a.transparent=t.transparent),void 0!==t.depthTest&&(a.depthTest=t.depthTest),void 0!==t.vertexColors&&("face"==t.vertexColors?a.vertexColors=THREE.FaceColors:t.vertexColors&&(a.vertexColors=THREE.VertexColors)),t.colorDiffuse?a.color=o(t.colorDiffuse):t.DbgColor&&(a.color=t.DbgColor),t.colorSpecular&&(a.specular=o(t.colorSpecular)),t.colorAmbient&&(a.ambient=o(t.colorAmbient)),t.transparency&&(a.opacity=t.transparency),t.specularCoef&&(a.shininess=t.specularCoef),t.mapDiffuse&&e&&r(a,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap),t.mapLight&&e&&r(a,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap),t.mapNormal&&e&&r(a,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap),t.mapSpecular&&e&&r(a,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap),t.mapNormal){var h=THREE.ShaderUtils.lib.normal,c=THREE.UniformsUtils.clone(h.uniforms),u=a.color;s=a.specular,l=a.ambient;var f=a.shininess;c.tNormal.texture=a.normalMap,t.mapNormalFactor&&(c.uNormalScale.value=t.mapNormalFactor),a.map&&(c.tDiffuse.texture=a.map,c.enableDiffuse.value=!0),a.specularMap&&(c.tSpecular.texture=a.specularMap,c.enableSpecular.value=!0),a.lightMap&&(c.tAO.texture=a.lightMap,c.enableAO.value=!0),c.uDiffuseColor.value.setHex(u),c.uSpecularColor.value.setHex(s),c.uAmbientColor.value.setHex(l),c.uShininess.value=f,a.opacity&&(c.uOpacity.value=a.opacity),a=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:c,lights:!0,fog:!0})}else a=new THREE[s](a);return a}},THREE.BinaryLoader=function(t){THREE.Loader.call(this,t)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype,THREE.BinaryLoader.prototype.load=function(t,e,i,n){t instanceof Object&&(console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),n=t,t=n.model,e=n.callback,i=n.texture_path,n=n.bin_path);var i=i?i:this.extractUrlbase(t),n=n?n:this.extractUrlbase(t),r=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,t,e,i,n,r)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(t,e,i,n,r,o){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||0==a.status)try{var s=JSON.parse(a.responseText);void 0===s.metadata||void 0===s.metadata.formatVersion||3!==s.metadata.formatVersion?console.error("Deprecated file format."):t.loadAjaxBuffers(s,i,r,n,o)}catch(l){console.error(l),console.warn("DEPRECATED: ["+e+"] seems to be using old model format")}else console.error("Couldn't load ["+e+"] ["+a.status+"]")},a.open("GET",e,!0),a.overrideMimeType("text/plain; charset=x-user-defined"),a.setRequestHeader("Content-Type","text/plain"),a.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(t,e,i,n,r){var o=new XMLHttpRequest,a=i+"/"+t.buffers,s=0;o.onreadystatechange=function(){4==o.readyState?200==o.status||0==o.status?THREE.BinaryLoader.prototype.createBinModel(o.response,e,n,t.materials):console.error("Couldn't load ["+a+"] ["+o.status+"]"):3==o.readyState?r&&(0==s&&(s=o.getResponseHeader("Content-Length")),r({total:s,loaded:o.responseText.length})):2==o.readyState&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",a,!0),o.responseType="arraybuffer",o.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(t,e,i,n){var r=function(e){function i(t){return t%4?4-t%4:0}function r(t,e){return new Uint8Array(t,e,1)[0]}function o(t,e){return new Uint32Array(t,e,1)[0]}function a(e,i){var n,r,o,a,s,l,h,c,u=new Uint32Array(t,i,3*e);for(n=0;e>n;n++){r=u[3*n],o=u[3*n+1],a=u[3*n+2],s=R[2*r],r=R[2*r+1],l=R[2*o],h=R[2*o+1],o=R[2*a],c=R[2*a+1],a=y.faceVertexUvs[0];var f=[];f.push(new THREE.UV(s,r)),f.push(new THREE.UV(l,h)),f.push(new THREE.UV(o,c)),a.push(f)}}function s(e,i){var n,r,o,a,s,l,h,c,u,f,d=new Uint32Array(t,i,4*e);for(n=0;e>n;n++){r=d[4*n],o=d[4*n+1],a=d[4*n+2],s=d[4*n+3],l=R[2*r],r=R[2*r+1],h=R[2*o],u=R[2*o+1],c=R[2*a],f=R[2*a+1],a=R[2*s],o=R[2*s+1],s=y.faceVertexUvs[0];var p=[];p.push(new THREE.UV(l,r)),p.push(new THREE.UV(h,u)),p.push(new THREE.UV(c,f)),p.push(new THREE.UV(a,o)),s.push(p)}}function l(e,i,n){for(var r,o,a,s,i=new Uint32Array(t,i,3*e),l=new Uint16Array(t,n,e),n=0;e>n;n++)r=i[3*n],o=i[3*n+1],a=i[3*n+2],s=l[n],y.faces.push(new THREE.Face3(r,o,a,null,null,s))}function h(e,i,n){for(var r,o,a,s,l,i=new Uint32Array(t,i,4*e),h=new Uint16Array(t,n,e),n=0;e>n;n++)r=i[4*n],o=i[4*n+1],a=i[4*n+2],s=i[4*n+3],l=h[n],y.faces.push(new THREE.Face4(r,o,a,s,null,null,l))}function c(e,i,n,r){for(var o,a,s,l,h,c,u,i=new Uint32Array(t,i,3*e),n=new Uint32Array(t,n,3*e),f=new Uint16Array(t,r,e),r=0;e>r;r++){o=i[3*r],a=i[3*r+1],s=i[3*r+2],h=n[3*r],c=n[3*r+1],u=n[3*r+2],l=f[r];var d=b[3*c],p=b[3*c+1];c=b[3*c+2];var m=b[3*u],E=b[3*u+1];u=b[3*u+2],y.faces.push(new THREE.Face3(o,a,s,[new THREE.Vector3(b[3*h],b[3*h+1],b[3*h+2]),new THREE.Vector3(d,p,c),new THREE.Vector3(m,E,u)],null,l))}}function u(e,i,n,r){for(var o,a,s,l,h,c,u,f,d,i=new Uint32Array(t,i,4*e),n=new Uint32Array(t,n,4*e),p=new Uint16Array(t,r,e),r=0;e>r;r++){o=i[4*r],a=i[4*r+1],s=i[4*r+2],l=i[4*r+3],c=n[4*r],u=n[4*r+1],f=n[4*r+2],d=n[4*r+3],h=p[r];var m=b[3*u],E=b[3*u+1];u=b[3*u+2];var g=b[3*f],v=b[3*f+1];f=b[3*f+2];var T=b[3*d],R=b[3*d+1];d=b[3*d+2],y.faces.push(new THREE.Face4(o,a,s,l,[new THREE.Vector3(b[3*c],b[3*c+1],b[3*c+2]),new THREE.Vector3(m,E,u),new THREE.Vector3(g,v,f),new THREE.Vector3(T,R,d)],null,h))}}var f,d,p,m,E,g,v,y=this,T=0,b=[],R=[];THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(y,n,e),f={signature:function(t,e,i){for(var t=new Uint8Array(t,e,i),n="",r=0;i>r;r++)n+=String.fromCharCode(t[e+r]);return n}(t,T,12),header_bytes:r(t,T+12),vertex_coordinate_bytes:r(t,T+13),normal_coordinate_bytes:r(t,T+14),uv_coordinate_bytes:r(t,T+15),vertex_index_bytes:r(t,T+16),normal_index_bytes:r(t,T+17),uv_index_bytes:r(t,T+18),material_index_bytes:r(t,T+19),nvertices:o(t,T+20),nnormals:o(t,T+20+4),nuvs:o(t,T+20+8),ntri_flat:o(t,T+20+12),ntri_smooth:o(t,T+20+16),ntri_flat_uv:o(t,T+20+20),ntri_smooth_uv:o(t,T+20+24),nquad_flat:o(t,T+20+28),nquad_smooth:o(t,T+20+32),nquad_flat_uv:o(t,T+20+36),nquad_smooth_uv:o(t,T+20+40)},"Three.js 003"!==f.signature&&console.warn("DEPRECATED: binary model seems to be using old format"),T+=f.header_bytes,e=3*f.vertex_index_bytes+f.material_index_bytes,v=4*f.vertex_index_bytes+f.material_index_bytes,d=f.ntri_flat*e,p=f.ntri_smooth*(e+3*f.normal_index_bytes),m=f.ntri_flat_uv*(e+3*f.uv_index_bytes),E=f.ntri_smooth_uv*(e+3*f.normal_index_bytes+3*f.uv_index_bytes),g=f.nquad_flat*v,e=f.nquad_smooth*(v+4*f.normal_index_bytes),v=f.nquad_flat_uv*(v+4*f.uv_index_bytes),T+=function(e){var i,n,r,o,a=f.nvertices,e=new Float32Array(t,e,3*a);for(i=0;a>i;i++)n=e[3*i],r=e[3*i+1],o=e[3*i+2],y.vertices.push(new THREE.Vertex(new THREE.Vector3(n,r,o)));return 3*a*Float32Array.BYTES_PER_ELEMENT}(T),T+=function(e){var i=f.nnormals;if(i){var n,r,o,a,e=new Int8Array(t,e,3*i);for(n=0;i>n;n++)r=e[3*n],o=e[3*n+1],a=e[3*n+2],b.push(r/127,o/127,a/127)}return 3*i*Int8Array.BYTES_PER_ELEMENT}(T),T+=i(3*f.nnormals),T+=function(e){var i=f.nuvs;if(i){var n,r,o,e=new Float32Array(t,e,2*i);for(n=0;i>n;n++)r=e[2*n],o=e[2*n+1],R.push(r,o)}return 2*i*Float32Array.BYTES_PER_ELEMENT}(T),d=T+d+i(2*f.ntri_flat),p=d+p+i(2*f.ntri_smooth),m=p+m+i(2*f.ntri_flat_uv),E=m+E+i(2*f.ntri_smooth_uv),g=E+g+i(2*f.nquad_flat),e=g+e+i(2*f.nquad_smooth),v=e+v+i(2*f.nquad_flat_uv),function(t){var e=f.ntri_flat_uv;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*3;l(e,t,i+e*Uint32Array.BYTES_PER_ELEMENT*3),a(e,i)}}(p),function(t){var e=f.ntri_smooth_uv;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*3,n=i+e*Uint32Array.BYTES_PER_ELEMENT*3;c(e,t,i,n+e*Uint32Array.BYTES_PER_ELEMENT*3),a(e,n)}}(m),function(t){var e=f.nquad_flat_uv;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*4;h(e,t,i+e*Uint32Array.BYTES_PER_ELEMENT*4),s(e,i)}}(e),function(t){var e=f.nquad_smooth_uv;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*4,n=i+e*Uint32Array.BYTES_PER_ELEMENT*4;u(e,t,i,n+e*Uint32Array.BYTES_PER_ELEMENT*4),s(e,n)}}(v),function(t){var e=f.ntri_flat;e&&l(e,t,t+e*Uint32Array.BYTES_PER_ELEMENT*3)}(T),function(t){var e=f.ntri_smooth;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*3;c(e,t,i,i+e*Uint32Array.BYTES_PER_ELEMENT*3)}}(d),function(t){var e=f.nquad_flat;e&&h(e,t,t+e*Uint32Array.BYTES_PER_ELEMENT*4)}(E),function(t){var e=f.nquad_smooth;if(e){var i=t+e*Uint32Array.BYTES_PER_ELEMENT*4;u(e,t,i,i+e*Uint32Array.BYTES_PER_ELEMENT*4)}}(g),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};r.prototype=new THREE.Geometry,r.prototype.constructor=r,e(new r(i))},THREE.ColladaLoader=function(){function t(t,n,r){for($=t,n=n||Y,void 0!==r&&(t=r.split("/"),t.pop(),W=t.length<1?"":t.join("/")+"/"),Z=e("//dae:library_images/dae:image",a,"image"),ee=e("//dae:library_materials/dae:material",w,"material"),ie=e("//dae:library_effects/dae:effect",C,"effect"),te=e("//dae:library_geometries/dae:geometry",E,"geometry"),J=e("//dae:library_controllers/dae:controller",s,"controller"),K=e("//dae:library_animations/dae:animation",k,"animation"),j=e(".//dae:library_visual_scenes/dae:visual_scene",c,"visual_scene"),G=[],X=[],(t=$.evaluate(".//dae:scene/dae:instance_visual_scene",$,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(t=t.getAttribute("url").replace(/^#/,""),O=j[t]):O=null,q=new THREE.Object3D,t=0;t<O.nodes.length;t++)q.add(o(O.nodes[t]));i();for(var l in K);return l={scene:q,morphs:G,skins:X,dae:{images:Z,materials:ee,effects:ie,geometries:te,controllers:J,animations:K,visualScenes:j,scene:O}},n&&n(l),l}function e(t,e,i){for(var t=$.evaluate(t,$,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n={},r=t.iterateNext(),o=0;r;)r=(new e).parse(r),0==r.id.length&&(r.id=i+o++),n[r.id]=r,r=t.iterateNext();return n}function i(){var t,e=1e6,i=-e,n=0;for(t in K)for(var r=K[t],o=0;o<r.sampler.length;o++){var a=r.sampler[o];a.create(),e=Math.min(e,a.startTime),i=Math.max(i,a.endTime),n=Math.max(n,a.input.length)}return{start:e,end:i,frames:n}}function n(t,e,i,r){if(t.world=t.world||new THREE.Matrix4,t.world.copy(t.matrix),t.channels&&t.channels.length){var o=t.channels[0].sampler.output[i];o instanceof THREE.Matrix4&&t.world.copy(o)}for(r&&t.world.multiply(r,t.world),e.push(t),r=0;r<t.nodes.length;r++)n(t.nodes[r],e,i,t.world)}function r(t,e,r){var o=J[e.url];if(o&&o.skin)if(e.skeleton&&e.skeleton.length){var a,s,l,h,c,u=i(),e=O.getChildById(e.skeleton[0],!0)||O.getChildBySid(e.skeleton[0],!0),f=new THREE.Vector3;for(a=0;a<t.vertices.length;a++)o.skin.bindShapeMatrix.multiplyVector3(t.vertices[a].position);for(r=0;r<u.frames;r++){var d=[],p=[];for(a=0;a<t.vertices.length;a++)p.push(new THREE.Vertex(new THREE.Vector3));for(n(e,d,r),a=d,s=o.skin,h=0;h<a.length;h++)if(l=a[h],c=-1,"JOINT"==l.type){for(var m=0;m<s.joints.length;m++)if(l.sid==s.joints[m]){c=m;break}if(!(c>=0))throw"ColladaLoader: Could not find joint '"+l.sid+"'.";for(m=s.invBindMatrices[c],l.invBindMatrix=m,l.skinningMatrix=new THREE.Matrix4,l.skinningMatrix.multiply(l.world,m),l.weights=[],m=0;m<s.weights.length;m++)for(var E=0;E<s.weights[m].length;E++){var g=s.weights[m][E];g.joint==c&&l.weights.push(g)}}for(a=0;a<d.length;a++)if("JOINT"==d[a].type)for(s=0;s<d[a].weights.length;s++)l=d[a].weights[s],h=l.index,l=l.weight,c=t.vertices[h],h=p[h],f.x=c.position.x,f.y=c.position.y,f.z=c.position.z,d[a].skinningMatrix.multiplyVector3(f),h.position.x+=f.x*l,h.position.y+=f.y*l,h.position.z+=f.z*l;t.morphTargets.push({name:"target_"+r,vertices:p})}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function o(t){var e,i,n,a,s=new THREE.Object3D;for(n=0;n<t.controllers.length;n++){var l=J[t.controllers[n].url];switch(l.type){case"skin":if(te[l.skin.source]){var h=new m;h.url=l.skin.source,h.instance_material=t.controllers[n].instance_material,t.geometries.push(h),e=t.controllers[n]}else J[l.skin.source]&&(i=l=J[l.skin.source],l.morph&&te[l.morph.source])&&(h=new m,h.url=l.morph.source,h.instance_material=t.controllers[n].instance_material,t.geometries.push(h));break;case"morph":te[l.morph.source]&&(h=new m,h.url=l.morph.source,h.instance_material=t.controllers[n].instance_material,t.geometries.push(h),i=t.controllers[n]),console.log("ColladaLoader: Morph-controller partially supported.")}}for(n=0;n<t.geometries.length;n++){var c,l=t.geometries[n],h=l.instance_material,l=te[l.url],u={},f=0;if(l&&l.mesh&&l.mesh.primitives){if(0==s.name.length&&(s.name=l.id),h)for(a=0;a<h.length;a++){c=h[a];var p=ie[ee[c.target].instance_effect.url].shader;p.material.opacity=p.material.opacity?p.material.opacity:1,c=u[c.symbol]=p.material,f++}if(h=c||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading}),l=l.mesh.geometry3js,f>1)for(h=new THREE.MeshFaceMaterial,a=0;a<l.faces.length;a++)f=l.faces[a],f.materials=[u[f.daeMaterial]];if(void 0!==e)r(l,e),h.morphTargets=!0,h=new THREE.SkinnedMesh(l,h),h.skeleton=e.skeleton,h.skinController=J[e.url],h.skinInstanceController=e,h.name="skin_"+X.length,X.push(h);else if(void 0!==i){if(a=l,u=i instanceof d?J[i.url]:i,u&&u.morph){for(u=u.morph,f=0;f<u.targets.length;f++)p=te[u.targets[f]],p.mesh&&p.mesh.primitives&&p.mesh.primitives.length&&(p=p.mesh.primitives[0].geometry,p.vertices.length===a.vertices.length&&a.morphTargets.push({name:"target_1",vertices:p.vertices}));a.morphTargets.push({name:"target_Z",vertices:a.vertices})}else console.log("could not find morph controller!");h.morphTargets=!0,h=new THREE.Mesh(l,h),h.name="morph_"+G.length,G.push(h)}else h=new THREE.Mesh(l,h);t.geometries.length>1?s.add(h):s=h}}for(s.name=t.id||"",t.matrix.decompose(s.position,s.rotation,s.scale),n=0;n<t.nodes.length;n++)s.add(o(t.nodes[n],t));return s}function a(){this.init_from=this.id=""}function s(){this.type=this.name=this.id="",this.morph=this.skin=null}function l(){this.weights=this.targets=this.source=this.method=null}function h(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function c(){this.name=this.id="",this.nodes=[],this.scene=new THREE.Object3D}function u(){this.sid=this.name=this.id="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function f(){this.type=this.sid="",this.data=[],this.matrix=new THREE.Matrix4}function d(){this.url="",this.skeleton=[],this.instance_material=[]}function p(){this.target=this.symbol=""}function m(){this.url="",this.instance_material=[]}function E(){this.id="",this.mesh=null}function g(t){this.geometry=t.id,this.primitives=[],this.geometry3js=this.vertices=null}function v(){}function y(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function T(){this.source="",this.stride=this.count=0,this.params=[]}function b(){this.input={}}function R(){this.semantic="",this.offset=0,this.source="",this.set=0}function x(t){this.id=t,this.type=null}function w(){this.name=this.id="",this.instance_effect=null}function H(){this.color=new THREE.Color(0),this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texcoord=this.texture=null}function _(t,e){this.type=t,this.effect=e,this.material=null}function S(t){this.effect=t,this.format=this.init_from=null}function M(t){this.effect=t,this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function C(){this.name=this.id="",this.sampler=this.surface=this.shader=null}function A(){this.url=""}function k(){this.name=this.id="",this.source={},this.sampler=[],this.channel=[]}function L(t){this.animation=t,this.target=this.source="",this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function N(t){this.id="",this.animation=t,this.inputs=[],this.endTime=this.startTime=this.interpolation=this.output=this.input=null,this.duration=0}function P(t){var e=t.getAttribute("id");return void 0!=Q[e]?Q[e]:(Q[e]=new x(e).parse(t),Q[e])}function F(t){return"dae"==t?"http://www.collada.org/2005/11/COLLADASchema":null}function D(t){for(var t=V(t),e=[],i=0;i<t.length;i++)e.push(parseFloat(t[i]));return e}function z(t){for(var t=V(t),e=[],i=0;i<t.length;i++)e.push(parseInt(t[i],10));return e}function V(t){return t.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function I(t,e,i){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):i}function B(t,e){if(void 0===t){for(var i="0.";i.length<e+2;)i+="0";return i}for(e=e||2,i=t.toString().split("."),i[1]=i.length>1?i[1].substr(0,e):"0";i[1].length<e;)i[1]+="0";return i.join(".")}function U(t,e){var i="";return i+=B(t.x,e)+",",i+=B(t.y,e)+",",i+=B(t.z,e)}var O,j,W,G,X,$=null,q=null,Y=null,Q={},Z={},K={},J={},te={},ee={},ie={},ne=THREE.SmoothShading;return a.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},s.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"skin":this.skin=(new h).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new l).parse(i),this.type=i.nodeName}}return this},l.prototype.parse=function(t){var e,i={},n=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"source":r=(new x).parse(r),i[r.id]=r;break;case"targets":n=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(e=0;e<n.length;e++)switch(t=n[e],r=i[t.source],t.semantic){case"MORPH_TARGET":this.targets=r.read();break;case"MORPH_WEIGHT":this.weights=r.read()}return this},l.prototype.parseInputs=function(t){for(var e=[],i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"input":e.push((new R).parse(n))}}return e},h.prototype.parse=function(t){var e,i,n={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":o=D(o.textContent),this.bindShapeMatrix=new THREE.Matrix4,this.bindShapeMatrix.set(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15]);break;case"source":o=(new x).parse(o),n[o.id]=o;break;case"joints":e=o;break;case"vertex_weights":i=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,n),this.parseWeights(i,n),this},h.prototype.parseJoints=function(t,e){for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"input":var n=(new R).parse(n),r=e[n.source];"JOINT"==n.semantic?this.joints=r.read():"INV_BIND_MATRIX"==n.semantic&&(this.invBindMatrices=r.read())}}},h.prototype.parseWeights=function(t,e){for(var i,n,r=[],o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":r.push((new R).parse(a));break;case"v":i=z(a.textContent);break;case"vcount":n=z(a.textContent)}}for(o=a=0;o<n.length;o++){for(var s=n[o],l=[],h=0;s>h;h++){for(var c={},u=0;u<r.length;u++){var f=r[u],d=i[a+f.offset];switch(f.semantic){case"JOINT":c.joint=d;break;case"WEIGHT":c.weight=e[f.source].data[d]}}l.push(c),a+=r.length}for(h=0;h<l.length;h++)l[h].index=o;this.weights.push(l)}},c.prototype.getChildById=function(t,e){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(t,e);if(n)return n}return null},c.prototype.getChildBySid=function(t,e){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(t,e);if(n)return n}return null},c.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new u).parse(i))}}return this},u.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var i=this.channels[e],n=i.target.split("/");n.shift();var r,o=n.shift(),a=o.indexOf(".")>=0,s=o.indexOf("(")>=0;if(a)n=o.split("."),o=n.shift(),n.shift();else if(s)for(r=o.split("("),o=r.shift(),n=0;n<r.length;n++)r[n]=parseInt(r[n].replace(/\)/,""));if(o==t)return i.info={sid:o,dotSyntax:a,arrSyntax:s,arrIndices:r},i}return null},u.prototype.getChildById=function(t,e){if(this.id==t)return this;if(e)for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(t,e);if(n)return n}return null},u.prototype.getChildBySid=function(t,e){if(this.sid==t)return this;if(e)for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(t,e);if(n)return n}return null},u.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid==t)return this.transforms[e];return null},u.prototype.parse=function(t){var e;this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<t.childNodes.length;i++)if(e=t.childNodes[i],1==e.nodeType)switch(e.nodeName){case"node":this.nodes.push((new u).parse(e));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new d).parse(e));break;case"instance_geometry":this.geometries.push((new m).parse(e));break;case"instance_light":break;case"instance_node":e=e.getAttribute("url").replace(/^#/,""),(e=$.evaluate(".//dae:library_nodes//dae:node[@id='"+e+"']",$,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new u).parse(e));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new f).parse(e));break;case"extra":break;default:console.log(e.nodeName)}t=[],i=1e6,e=-1e6;for(var n in K)for(var r=K[n],o=0;o<r.channel.length;o++){var a=r.channel[o],s=r.sampler[o];n=a.target.split("/")[0],n==this.id&&(s.create(),a.sampler=s,i=Math.min(i,s.startTime),e=Math.max(e,s.endTime),t.push(a))}if(t.length&&(this.startTime=i,this.endTime=e),(this.channels=t)&&this.channels.length){for(n=1e7,t=0;t<this.channels.length;t++)for(i=this.channels[t].sampler,e=0;e<i.input.length-1;e++)n=Math.min(n,i.input[e+1]-i.input[e]);for(i=[],t=this.startTime;t<this.endTime;t+=n){e=t;for(var r={},l=o=void 0,o=0;o<this.channels.length;o++)l=this.channels[o],r[l.sid]=l;for(a=new THREE.Matrix4,o=0;o<this.transforms.length;o++)if(s=this.transforms[o],l=r[s.sid],void 0!==l){for(var h,c=l.sampler,l=0;l<c.input.length-1;l++)if(c.input[l+1]>e){h=c.output[l];break}a=void 0!==h&&h instanceof THREE.Matrix4?a.multiply(a,h):a.multiply(a,s.matrix)}else a=a.multiply(a,s.matrix);e=a,i.push({time:t,pos:[e.n14,e.n24,e.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=i}return this.updateMatrix(),this},u.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.matrix.multiply(this.matrix,this.transforms[t].matrix)},f.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=D(t.textContent),this.updateMatrix(),this},f.prototype.updateMatrix=function(){var t=0;switch(this.matrix.identity(),this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":t=this.data[3]*(Math.PI/180),this.matrix.setRotationAxis(new THREE.Vector3(this.data[0],this.data[1],this.data[2]),t);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix},d.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":if(i=$.evaluate(".//dae:instance_material",i,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null))for(var n=i.iterateNext();n;)this.instance_material.push((new p).parse(n)),n=i.iterateNext()}}return this},p.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},m.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType&&"bind_material"==i.nodeName){if(t=$.evaluate(".//dae:instance_material",i,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null))for(e=t.iterateNext();e;)this.instance_material.push((new p).parse(e)),e=t.iterateNext();break}}return this},E.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"mesh":this.mesh=new g(this).parse(i)}}return this},g.prototype.parse=function(t){function e(t,e){var i=U(t.position);return void 0===r[i]&&(r[i]={v:t,index:e}),r[i]}this.primitives=[];var i;for(i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];switch(n.nodeName){case"source":P(n);break;case"vertices":this.vertices=(new b).parse(n);break;case"triangles":this.primitives.push((new y).parse(n));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new v).parse(n))}}var r={};
for(this.geometry3js=new THREE.Geometry,n=Q[this.vertices.input.POSITION.source].data,t=i=0;i<n.length;i+=3,t++){var o=new THREE.Vertex(new THREE.Vector3(n[i],n[i+1],n[i+2]));e(o,t),this.geometry3js.vertices.push(o)}for(i=0;i<this.primitives.length;i++)t=this.primitives[i],t.setVertices(this.vertices),this.handlePrimitive(t,this.geometry3js,r);return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.computeVertexNormals(),this.geometry3js.computeBoundingBox(),this},g.prototype.handlePrimitive=function(t,e,i){var n,r,o,a,s,l,h=0,c=t.p,u=t.inputs,f=0,d=3,p=[];for(n=0;n<u.length;n++)switch(o=u[n],o.semantic){case"TEXCOORD":p.push(o.set)}for(;h<c.length;){var m=[],E=[],g={},v=[];for(t.vcount&&(d=t.vcount[f++]),n=0;d>n;n++)for(r=0;r<u.length;r++)switch(o=u[r],l=Q[o.source],a=c[h+n*u.length+o.offset],s=l.accessor.params.length,s*=a,o.semantic){case"VERTEX":o=U(e.vertices[a].position),m.push(i[o].index);break;case"NORMAL":E.push(new THREE.Vector3(l.data[s],l.data[s+1],l.data[s+2]));break;case"TEXCOORD":void 0===g[o.set]&&(g[o.set]=[]),g[o.set].push(new THREE.UV(l.data[s],l.data[s+1]));break;case"COLOR":v.push((new THREE.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}var y;for(3==d?y=new THREE.Face3(m[0],m[1],m[2],[E[0],E[1],E[2]],v.length?v:new THREE.Color):4==d&&(y=new THREE.Face4(m[0],m[1],m[2],m[3],[E[0],E[1],E[2],E[3]],v.length?v:new THREE.Color)),y.daeMaterial=t.material,e.faces.push(y),r=0;r<p.length;r++)n=g[p[r]],e.faceVertexUvs[r].push([n[0],n[1],n[2]]);h+=u.length*d}},v.prototype=new y,v.prototype.constructor=v,y.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source==t.id&&(this.inputs[e].source=t.input.POSITION.source)},y.prototype.parse=function(t){this.inputs=[],this.material=t.getAttribute("material"),this.count=I(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"input":this.inputs.push((new R).parse(t.childNodes[e]));break;case"vcount":this.vcount=z(i.textContent);break;case"p":this.p=z(i.textContent)}}return this},T.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=I(t,"count",0),this.stride=I(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if("param"==i.nodeName){var n={};n.name=i.getAttribute("name"),n.type=i.getAttribute("type"),this.params.push(n)}}return this},b.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"==t.childNodes[e].nodeName){var i=(new R).parse(t.childNodes[e]);this.input[i.semantic]=i}return this},R.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=I(t,"set",-1),this.offset=I(t,"offset",0),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0),this},x.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"bool_array":for(var n=V(i.textContent),r=[],o=0;o<n.length;o++)r.push("true"==n[o]||"1"==n[o]?!0:!1);this.data=r,this.type=i.nodeName;break;case"float_array":this.data=D(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=z(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=V(i.textContent),this.type=i.nodeName;break;case"technique_common":for(n=0;n<i.childNodes.length;n++)if("accessor"==i.childNodes[n].nodeName){this.accessor=(new T).parse(i.childNodes[n]);break}}}return this},x.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(e=0;e<this.data.length;e+=16){var i=this.data.slice(e,e+16),n=new THREE.Matrix4;n.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]),t.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},w.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"==t.childNodes[e].nodeName){this.instance_effect=(new A).parse(t.childNodes[e]);break}return this},H.prototype.isColor=function(){return null==this.texture},H.prototype.isTexture=function(){return null!=this.texture},H.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"color":i=D(i.textContent),this.color=new THREE.Color(0),this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord")}}return this},_.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new H).parse(i);break;case"shininess":case"reflectivity":case"transparency":var n;n=$.evaluate(".//dae:float",i,F,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var r=n.iterateNext(),o=[];r;)o.push(r),r=n.iterateNext();n=o,n.length>0&&(this[i.nodeName]=parseFloat(n[0].textContent))}}return this.create(),this},_.prototype.create=function(){var t,e={},i=void 0!==this.transparency&&this.transparency<1;for(t in this)switch(t){case"ambient":case"emission":case"diffuse":case"specular":var n=this[t];n instanceof H&&(n.isTexture()?this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(n=Z[this.effect.surface.init_from])&&(e.map=THREE.ImageUtils.loadTexture(W+n.init_from),e.map.wrapS=THREE.RepeatWrapping,e.map.wrapT=THREE.RepeatWrapping,e.map.repeat.x=1,e.map.repeat.y=-1):"diffuse"==t?e.color=n.color.getHex():i||(e[t]=n.color.getHex()));break;case"shininess":case"reflectivity":e[t]=this[t];break;case"transparency":i&&(e.transparent=!0,e.opacity=this[t],i=!0)}return e.shading=ne,this.material=new THREE.MeshLambertMaterial(e)},S.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},M.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},C.prototype.create=function(){return null==this.shader?null:void 0},C.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},C.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface=new S(this).parse(n),this.surface.sid=e;break;case"sampler2D":this.sampler=new M(this).parse(n),this.sampler.sid=e;break;case"extra":break;default:console.log(n.nodeName)}}},C.prototype.parseProfileCOMMON=function(t){for(var e,i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":e=n;break;case"newparam":this.parseNewparam(n);break;case"extra":break;default:console.log(n.nodeName)}}return e},C.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"lambert":case"blinn":case"phong":this.shader=new _(i.nodeName,this).parse(i)}}},A.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},k.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":i=(new x).parse(i),this.source[i.id]=i;break;case"sampler":this.sampler.push(new N(this).parse(i));break;case"channel":this.channel.push(new L(this).parse(i))}}return this},L.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/");e.shift();var i,n,t=e.shift(),r=t.indexOf(".")>=0,o=t.indexOf("(")>=0;if(r)e=t.split("."),t=e.shift(),n=e.shift();else if(o)for(i=t.split("("),t=i.shift(),e=0;e<i.length;e++)i[e]=parseInt(i[e].replace(/\)/,""));return this.sid=t,this.dotSyntax=r,this.arrSyntax=o,this.arrIndices=i,this.member=n,this},N.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new R).parse(i))}}return this},N.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],i=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read();break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.duration=this.endTime=this.startTime=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},{load:function(e,i){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null),e+="?rnd="+Math.random();var n=new XMLHttpRequest;n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4!=n.readyState||0!=n.status&&200!=n.status||(Y=i,t(n.responseXML,void 0,e))},n.open("GET",e,!0),n.send(null)}else alert("Don't know how to parse XML!")},parse:t,setPreferredShading:function(t){ne=t},applySkin:r,geometries:te}},THREE.JSONLoader=function(t){THREE.Loader.call(this,t)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.supr=THREE.Loader.prototype,THREE.JSONLoader.prototype.load=function(t,e,i){t instanceof Object&&(console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),i=t,t=i.model,e=i.callback,i=i.texture_path),i=i?i:this.extractUrlbase(t),this.onLoadStart(),this.loadAjaxJSON(this,t,e,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(t,e,i,n,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==o.status)try{var s=JSON.parse(o.responseText);t.createModel(s,i,n),t.onLoadComplete()}catch(l){console.error(l),console.warn("DEPRECATED: ["+e+"] seems to be using old model format")}else console.error("Couldn't load ["+e+"] ["+o.status+"]");else 3==o.readyState?r&&(0==a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):2==o.readyState&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",e,!0),o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.JSONLoader.prototype.createModel=function(t,e,i){var n=new THREE.Geometry,r=void 0!==t.scale?1/t.scale:1;this.initMaterials(n,t.materials,i),function(e){if(void 0===t.metadata||void 0===t.metadata.formatVersion||3!==t.metadata.formatVersion)console.error("Deprecated file format.");else{var i,r,o,a,s,l,h,c,u,f,d,p,m,E,g=t.faces;l=t.vertices;var v=t.normals,y=t.colors,T=0;for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&T++;for(i=0;T>i;i++)n.faceUvs[i]=[],n.faceVertexUvs[i]=[];for(a=0,s=l.length;s>a;)h=new THREE.Vertex,h.position.x=l[a++]*e,h.position.y=l[a++]*e,h.position.z=l[a++]*e,n.vertices.push(h);for(a=0,s=g.length;s>a;){if(e=g[a++],l=1&e,o=2&e,i=4&e,r=8&e,c=16&e,h=32&e,f=64&e,e&=128,l?(d=new THREE.Face4,d.a=g[a++],d.b=g[a++],d.c=g[a++],d.d=g[a++],l=4):(d=new THREE.Face3,d.a=g[a++],d.b=g[a++],d.c=g[a++],l=3),o&&(o=g[a++],d.materialIndex=o),o=n.faces.length,i)for(i=0;T>i;i++)p=t.uvs[i],u=g[a++],E=p[2*u],u=p[2*u+1],n.faceUvs[i][o]=new THREE.UV(E,u);if(r)for(i=0;T>i;i++){for(p=t.uvs[i],m=[],r=0;l>r;r++)u=g[a++],E=p[2*u],u=p[2*u+1],m[r]=new THREE.UV(E,u);n.faceVertexUvs[i][o]=m}if(c&&(c=3*g[a++],r=new THREE.Vector3,r.x=v[c++],r.y=v[c++],r.z=v[c],d.normal=r),h)for(i=0;l>i;i++)c=3*g[a++],r=new THREE.Vector3,r.x=v[c++],r.y=v[c++],r.z=v[c],d.vertexNormals.push(r);if(f&&(h=g[a++],h=new THREE.Color(y[h]),d.color=h),e)for(i=0;l>i;i++)h=g[a++],h=new THREE.Color(y[h]),d.vertexColors.push(h);n.faces.push(d)}}}(r),function(){var e,i,r,o;if(t.skinWeights)for(e=0,i=t.skinWeights.length;i>e;e+=2)r=t.skinWeights[e],o=t.skinWeights[e+1],n.skinWeights.push(new THREE.Vector4(r,o,0,0));if(t.skinIndices)for(e=0,i=t.skinIndices.length;i>e;e+=2)r=t.skinIndices[e],o=t.skinIndices[e+1],n.skinIndices.push(new THREE.Vector4(r,o,0,0));n.bones=t.bones,n.animation=t.animation}(),function(e){if(void 0!==t.morphTargets){var i,r,o,a,s,l,h,c,u;for(i=0,r=t.morphTargets.length;r>i;i++)for(n.morphTargets[i]={},n.morphTargets[i].name=t.morphTargets[i].name,n.morphTargets[i].vertices=[],c=n.morphTargets[i].vertices,u=t.morphTargets[i].vertices,o=0,a=u.length;a>o;o+=3)s=u[o]*e,l=u[o+1]*e,h=u[o+2]*e,c.push(new THREE.Vertex(new THREE.Vector3(s,l,h)))}if(void 0!==t.morphColors)for(i=0,r=t.morphColors.length;r>i;i++)for(n.morphColors[i]={},n.morphColors[i].name=t.morphColors[i].name,n.morphColors[i].colors=[],a=n.morphColors[i].colors,s=t.morphColors[i].colors,e=0,o=s.length;o>e;e+=3)l=new THREE.Color(16755200),l.setRGB(s[e],s[e+1],s[e+2]),a.push(l)}(r),n.computeCentroids(),n.computeFaceNormals(),this.hasNormals(n)&&n.computeTangents(),e(n)},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(t,e){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status||0==n.status)try{var r=JSON.parse(n.responseText);void 0===r.metadata||void 0===r.metadata.formatVersion||3!==r.metadata.formatVersion?console.error("Deprecated file format."):i.createScene(r,e,t)}catch(o){console.error(o),console.warn("DEPRECATED: ["+t+"] seems to be using old model format")}else console.error("Couldn't load ["+t+"] ["+n.status+"]")},n.open("GET",t,!0),n.overrideMimeType("text/plain; charset=x-user-defined"),n.setRequestHeader("Content-Type","text/plain"),n.send(null)},THREE.SceneLoader.prototype.createScene=function(t,e,i){function n(t,e){return"relativeToHTML"==e?t:F+"/"+t}function r(){var t;for(c in S.objects)if(!N.objects[c])if(m=S.objects[c],void 0!==m.geometry){if(x=N.geometries[m.geometry]){for(t=!1,z=0;z<m.materials.length;z++)_=N.materials[m.materials[z]],t=_ instanceof THREE.ShaderMaterial;if(t&&x.computeTangents(),v=m.position,y=m.rotation,T=m.quaternion,b=m.scale,T=0,0==_.length&&(_=new THREE.MeshFaceMaterial),_.length>1&&(_=new THREE.MeshFaceMaterial),t=new THREE.Mesh(x,_),t.name=c,t.position.set(v[0],v[1],v[2]),T?(t.quaternion.set(T[0],T[1],T[2],T[3]),t.useQuaternion=!0):t.rotation.set(y[0],y[1],y[2]),t.scale.set(b[0],b[1],b[2]),t.visible=m.visible,N.scene.add(t),N.objects[c]=t,m.meshCollider){var e=THREE.CollisionUtils.MeshColliderWBox(t);N.scene.collisions.colliders.push(e)}m.castsShadow&&(e=new THREE.ShadowVolume(x),N.scene.add(e),e.position=t.position,e.rotation=t.rotation,e.scale=t.scale),m.trigger&&"none"!=m.trigger.toLowerCase()&&(e={type:m.trigger,object:m},N.triggers[t.name]=e)}}else v=m.position,y=m.rotation,T=m.quaternion,b=m.scale,T=0,t=new THREE.Object3D,t.name=c,t.position.set(v[0],v[1],v[2]),T?(t.quaternion.set(T[0],T[1],T[2],T[3]),t.useQuaternion=!0):t.rotation.set(y[0],y[1],y[2]),t.scale.set(b[0],b[1],b[2]),t.visible=void 0!==m.visible?m.visible:!1,N.scene.add(t),N.objects[c]=t,N.empties[c]=t,m.trigger&&"none"!=m.trigger.toLowerCase()&&(e={type:m.trigger,object:m},N.triggers[t.name]=e)}function o(t){return function(e){N.geometries[t]=e,r(),C-=1,P.onLoadComplete(),s()}}function a(t){return function(e){N.geometries[t]=e}}function s(){P.callbackProgress({totalModels:k,totalTextures:L,loadedModels:k-C,loadedTextures:L-A},N),P.onLoadProgress(),0==C&&0==A&&e(N)}var l,h,c,u,f,d,p,m,E,g,v,y,T,b,R,x,w,H,_,S,M,C,A,k,L,N,P=this,F=THREE.Loader.prototype.extractUrlbase(i);S=t,i=new THREE.BinaryLoader,M=new THREE.JSONLoader,A=C=0,N={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}},t=!1;for(c in S.objects)if(m=S.objects[c],m.meshCollider){t=!0;break}if(t&&(N.scene.collisions=new THREE.CollisionSystem),S.transform){t=S.transform.position,E=S.transform.rotation;var D=S.transform.scale;t&&N.scene.position.set(t[0],t[1],t[2]),E&&N.scene.rotation.set(E[0],E[1],E[2]),D&&N.scene.scale.set(D[0],D[1],D[2]),(t||E||D)&&N.scene.updateMatrix()}t=function(){A-=1,s(),P.onLoadComplete()};for(f in S.cameras)E=S.cameras[f],"perspective"==E.type?w=new THREE.PerspectiveCamera(E.fov,E.aspect,E.near,E.far):"ortho"==E.type&&(w=new THREE.OrthographicCamera(E.left,E.right,E.top,E.bottom,E.near,E.far)),v=E.position,E=E.target,w.position.set(v[0],v[1],v[2]),w.target=new THREE.Vector3(E[0],E[1],E[2]),N.cameras[f]=w;for(u in S.lights)E=S.lights[u],f=void 0!==E.color?E.color:16777215,w=void 0!==E.intensity?E.intensity:1,"directional"==E.type?(v=E.direction,g=new THREE.DirectionalLight(f,w),g.position.set(v[0],v[1],v[2]),g.position.normalize()):"point"==E.type?(v=E.position,g=E.distance,g=new THREE.PointLight(f,w,g),g.position.set(v[0],v[1],v[2])):"ambient"==E.type&&(g=new THREE.AmbientLight(f)),N.scene.add(g),N.lights[u]=g;for(d in S.fogs)u=S.fogs[d],"linear"==u.type?H=new THREE.Fog(0,u.near,u.far):"exp2"==u.type&&(H=new THREE.FogExp2(0,u.density)),E=u.color,H.color.setRGB(E[0],E[1],E[2]),N.fogs[d]=H;N.cameras&&S.defaults.camera&&(N.currentCamera=N.cameras[S.defaults.camera]),N.fogs&&S.defaults.fog&&(N.scene.fog=N.fogs[S.defaults.fog]),E=S.defaults.bgcolor,N.bgColor=new THREE.Color,N.bgColor.setRGB(E[0],E[1],E[2]),N.bgColorAlpha=S.defaults.bgalpha;for(l in S.geometries)d=S.geometries[l],("bin_mesh"==d.type||"ascii_mesh"==d.type)&&(C+=1,P.onLoadStart());k=C;for(l in S.geometries)d=S.geometries[l],"cube"==d.type?(x=new THREE.CubeGeometry(d.width,d.height,d.depth,d.segmentsWidth,d.segmentsHeight,d.segmentsDepth,null,d.flipped,d.sides),N.geometries[l]=x):"plane"==d.type?(x=new THREE.PlaneGeometry(d.width,d.height,d.segmentsWidth,d.segmentsHeight),N.geometries[l]=x):"sphere"==d.type?(x=new THREE.SphereGeometry(d.radius,d.segmentsWidth,d.segmentsHeight),N.geometries[l]=x):"cylinder"==d.type?(x=new THREE.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs),N.geometries[l]=x):"torus"==d.type?(x=new THREE.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT),N.geometries[l]=x):"icosahedron"==d.type?(x=new THREE.IcosahedronGeometry(d.subdivisions),N.geometries[l]=x):"bin_mesh"==d.type?i.load(n(d.url,S.urlBaseType),o(l)):"ascii_mesh"==d.type?M.load(n(d.url,S.urlBaseType),o(l)):"embedded_mesh"==d.type&&(d=S.embeds[d.id])&&M.createModel(d,a(l),"");for(p in S.textures)if(l=S.textures[p],l.url instanceof Array)for(A+=l.url.length,d=0;d<l.url.length;d++)P.onLoadStart();else A+=1,P.onLoadStart();L=A;for(p in S.textures){if(l=S.textures[p],void 0!=l.mapping&&void 0!=THREE[l.mapping]&&(l.mapping=new THREE[l.mapping]),l.url instanceof Array){d=[];for(var z=0;z<l.url.length;z++)d[z]=n(l.url[z],S.urlBaseType);d=THREE.ImageUtils.loadTextureCube(d,l.mapping,t)}else d=THREE.ImageUtils.loadTexture(n(l.url,S.urlBaseType),l.mapping,t),void 0!=THREE[l.minFilter]&&(d.minFilter=THREE[l.minFilter]),void 0!=THREE[l.magFilter]&&(d.magFilter=THREE[l.magFilter]),l.repeat&&(d.repeat.set(l.repeat[0],l.repeat[1]),1!=l.repeat[0]&&(d.wrapS=THREE.RepeatWrapping),1!=l.repeat[1]&&(d.wrapT=THREE.RepeatWrapping)),l.offset&&d.offset.set(l.offset[0],l.offset[1]),l.wrap&&(H={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==H[l.wrap[0]]&&(d.wrapS=H[l.wrap[0]]),void 0!==H[l.wrap[1]]&&(d.wrapT=H[l.wrap[1]]));N.textures[p]=d}for(h in S.materials){p=S.materials[h];for(R in p.parameters)"envMap"==R||"map"==R||"lightMap"==R?p.parameters[R]=N.textures[p.parameters[R]]:"shading"==R?p.parameters[R]="flat"==p.parameters[R]?THREE.FlatShading:THREE.SmoothShading:"blending"==R?p.parameters[R]=THREE[p.parameters[R]]?THREE[p.parameters[R]]:THREE.NormalBlending:"combine"==R?p.parameters[R]="MixOperation"==p.parameters[R]?THREE.MixOperation:THREE.MultiplyOperation:"vertexColors"==R&&("face"==p.parameters[R]?p.parameters[R]=THREE.FaceColors:p.parameters[R]&&(p.parameters[R]=THREE.VertexColors));void 0!==p.parameters.opacity&&p.parameters.opacity<1&&(p.parameters.transparent=!0),p.parameters.normalMap?(l=THREE.ShaderUtils.lib.normal,t=THREE.UniformsUtils.clone(l.uniforms),d=p.parameters.color,H=p.parameters.specular,i=p.parameters.ambient,M=p.parameters.shininess,t.tNormal.texture=N.textures[p.parameters.normalMap],p.parameters.normalMapFactor&&(t.uNormalScale.value=p.parameters.normalMapFactor),p.parameters.map&&(t.tDiffuse.texture=p.parameters.map,t.enableDiffuse.value=!0),p.parameters.lightMap&&(t.tAO.texture=p.parameters.lightMap,t.enableAO.value=!0),p.parameters.specularMap&&(t.tSpecular.texture=N.textures[p.parameters.specularMap],t.enableSpecular.value=!0),t.uDiffuseColor.value.setHex(d),t.uSpecularColor.value.setHex(H),t.uAmbientColor.value.setHex(i),t.uShininess.value=M,p.parameters.opacity&&(t.uOpacity.value=p.parameters.opacity),p=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:t,lights:!0,fog:!0})):p=new THREE[p.type](p.parameters),N.materials[h]=p}r(),P.callbackSync(N),s()},THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype=new THREE.UTF8Loader,THREE.UTF8Loader.prototype.constructor=THREE.UTF8Loader,THREE.UTF8Loader.prototype.load=function(t,e,i){t instanceof Object&&(console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),i=t,t=i.model,e=i.callback,i={scale:i.scale,offsetX:i.offsetX,offsetY:i.offsetY,offsetZ:i.offsetZ});var n=new XMLHttpRequest,r=void 0!==i.scale?i.scale:1,o=void 0!==i.offsetX?i.offsetX:0,a=void 0!==i.offsetY?i.offsetY:0,s=void 0!==i.offsetZ?i.offsetZ:0;n.onreadystatechange=function(){4==n.readyState?200==n.status||0==n.status?THREE.UTF8Loader.prototype.createModel(n.responseText,e,r,o,a,s):alert("Couldn't load ["+t+"] ["+n.status+"]"):3!=n.readyState&&2==n.readyState&&n.getResponseHeader("Content-Length")},n.open("GET",t,!0),n.send(null)},THREE.UTF8Loader.prototype.decompressMesh=function(t){var e=t.charCodeAt(0);e>=57344&&(e-=2048),e++;for(var i=new Float32Array(8*e),n=1,r=0;8>r;r++){for(var o=0,a=0;e>a;++a){var s=t.charCodeAt(a+n);o+=s>>1^-(1&s),i[8*a+r]=o}n+=e}for(e=t.length-n,o=new Uint16Array(e),r=a=0;e>r;r++)s=t.charCodeAt(r+n),o[r]=a-s,0==s&&a++;return[i,o]},THREE.UTF8Loader.prototype.createModel=function(t,e,i,n,r,o){var a=function(){var e=this;e.materials=[],THREE.Geometry.call(this);var a=THREE.UTF8Loader.prototype.decompressMesh(t),s=[],l=[];!function(t,a,s){for(var l,h,c,u=t.length;u>s;s+=a)l=t[s],h=t[s+1],c=t[s+2],l=l/16383*i,h=h/16383*i,c=c/16383*i,l+=n,h+=r,c+=o,e.vertices.push(new THREE.Vertex(new THREE.Vector3(l,h,c)))}(a[0],8,0),function(t,e,i){for(var n,r,o=t.length;o>i;i+=e)n=t[i],r=t[i+1],n/=1023,r/=1023,l.push(n,1-r)}(a[0],8,3),function(t,e,i){for(var n,r,o,a=t.length;a>i;i+=e)n=t[i],r=t[i+1],o=t[i+2],n=(n-512)/511,r=(r-512)/511,o=(o-512)/511,s.push(n,r,o)}(a[0],8,5),function(t){var i,n,r,o,a,h,c,u,f,d=t.length;for(i=0;d>i;i+=3){n=t[i],r=t[i+1],o=t[i+2],a=e,u=n,f=r,h=o,c=n;var p=r,m=o,E=a.materials[0],g=s[3*p],v=s[3*p+1],p=s[3*p+2],y=s[3*m],T=s[3*m+1],m=s[3*m+2];c=new THREE.Vector3(s[3*c],s[3*c+1],s[3*c+2]),p=new THREE.Vector3(g,v,p),m=new THREE.Vector3(y,T,m),a.faces.push(new THREE.Face3(u,f,h,[c,p,m],null,E)),a=l[2*n],n=l[2*n+1],h=l[2*r],c=l[2*r+1],u=l[2*o],f=l[2*o+1],o=e.faceVertexUvs[0],r=h,h=c,c=[],c.push(new THREE.UV(a,n)),c.push(new THREE.UV(r,h)),c.push(new THREE.UV(u,f)),o.push(c)}}(a[1]),this.computeCentroids(),this.computeFaceNormals()};a.prototype=new THREE.Geometry,a.prototype.constructor=a,e(new a)},THREE.Axes=function(){THREE.Object3D.call(this);var t=new THREE.Geometry;t.vertices.push(new THREE.Vertex),t.vertices.push(new THREE.Vertex(new THREE.Vector3(0,100,0)));var e=new THREE.CylinderGeometry(0,5,25,5,1),i=new THREE.Line(t,new THREE.LineBasicMaterial({color:16711680}));i.rotation.z=-Math.PI/2,this.add(i),i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16711680})),i.position.x=100,i.rotation.z=-Math.PI/2,this.add(i),i=new THREE.Line(t,new THREE.LineBasicMaterial({color:65280})),this.add(i),i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:65280})),i.position.y=100,this.add(i),i=new THREE.Line(t,new THREE.LineBasicMaterial({color:255})),i.rotation.x=Math.PI/2,this.add(i),i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:255})),i.position.z=100,i.rotation.x=Math.PI/2,this.add(i)},THREE.Axes.prototype=new THREE.Object3D,THREE.Axes.prototype.constructor=THREE.Axes,THREE.MarchingCubes=function(t,e){THREE.Object3D.call(this),this.material=e,this.init=function(t){this.resolution=t,this.isolation=80,this.size=t,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.vlist=new Float32Array(36),this.nlist=new Float32Array(36),this.firstDraw=!0,this.maxCount=4096,this.count=0,this.hasNormal=this.hasPos=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount)},this.lerp=function(t,e,i){return t+(e-t)*i},this.VIntX=function(t,e,i,n,r,o,a,s,l,h){r=(r-l)/(h-l),l=this.normal_cache,e[n]=o+r*this.delta,e[n+1]=a,e[n+2]=s,i[n]=this.lerp(l[t],l[t+3],r),i[n+1]=this.lerp(l[t+1],l[t+4],r),i[n+2]=this.lerp(l[t+2],l[t+5],r)},this.VIntY=function(t,e,i,n,r,o,a,s,l,h){r=(r-l)/(h-l),l=this.normal_cache,e[n]=o,e[n+1]=a+r*this.delta,e[n+2]=s,e=t+3*this.yd,i[n]=this.lerp(l[t],l[e],r),i[n+1]=this.lerp(l[t+1],l[e+1],r),i[n+2]=this.lerp(l[t+2],l[e+2],r)},this.VIntZ=function(t,e,i,n,r,o,a,s,l,h){r=(r-l)/(h-l),l=this.normal_cache,e[n]=o,e[n+1]=a,e[n+2]=s+r*this.delta,e=t+3*this.zd,i[n]=this.lerp(l[t],l[e],r),i[n+1]=this.lerp(l[t+1],l[e+1],r),i[n+2]=this.lerp(l[t+2],l[e+2],r)},this.compNorm=function(t){var e=3*t;0===this.normal_cache[e]&&(this.normal_cache[e]=this.field[t-1]-this.field[t+1],this.normal_cache[e+1]=this.field[t-this.yd]-this.field[t+this.yd],this.normal_cache[e+2]=this.field[t-this.zd]-this.field[t+this.zd])},this.polygonize=function(t,e,i,n,r,o){var a=n+1,s=n+this.yd,l=n+this.zd,h=a+this.yd,c=a+this.zd,u=n+this.yd+this.zd,f=a+this.yd+this.zd,d=0,p=this.field[n],m=this.field[a],E=this.field[s],g=this.field[h],v=this.field[l],y=this.field[c],T=this.field[u],b=this.field[f];r>p&&(d|=1),r>m&&(d|=2),r>E&&(d|=8),r>g&&(d|=4),r>v&&(d|=16),r>y&&(d|=32),r>T&&(d|=128),r>b&&(d|=64);var R=THREE.edgeTable[d];if(0===R)return 0;var x=this.delta,w=t+x,H=e+x,x=i+x;for(1&R&&(this.compNorm(n),this.compNorm(a),this.VIntX(3*n,this.vlist,this.nlist,0,r,t,e,i,p,m)),2&R&&(this.compNorm(a),this.compNorm(h),this.VIntY(3*a,this.vlist,this.nlist,3,r,w,e,i,m,g)),4&R&&(this.compNorm(s),this.compNorm(h),this.VIntX(3*s,this.vlist,this.nlist,6,r,t,H,i,E,g)),8&R&&(this.compNorm(n),this.compNorm(s),this.VIntY(3*n,this.vlist,this.nlist,9,r,t,e,i,p,E)),16&R&&(this.compNorm(l),this.compNorm(c),this.VIntX(3*l,this.vlist,this.nlist,12,r,t,e,x,v,y)),32&R&&(this.compNorm(c),this.compNorm(f),this.VIntY(3*c,this.vlist,this.nlist,15,r,w,e,x,y,b)),64&R&&(this.compNorm(u),this.compNorm(f),this.VIntX(3*u,this.vlist,this.nlist,18,r,t,H,x,T,b)),128&R&&(this.compNorm(l),this.compNorm(u),this.VIntY(3*l,this.vlist,this.nlist,21,r,t,e,x,v,T)),256&R&&(this.compNorm(n),this.compNorm(l),this.VIntZ(3*n,this.vlist,this.nlist,24,r,t,e,i,p,v)),512&R&&(this.compNorm(a),this.compNorm(c),this.VIntZ(3*a,this.vlist,this.nlist,27,r,w,e,i,m,y)),1024&R&&(this.compNorm(h),this.compNorm(f),this.VIntZ(3*h,this.vlist,this.nlist,30,r,w,H,i,g,b)),2048&R&&(this.compNorm(s),this.compNorm(u),this.VIntZ(3*s,this.vlist,this.nlist,33,r,t,H,i,E,T)),d<<=4,r=n=0;-1!=THREE.triTable[d+r];)t=d+r,e=t+1,i=t+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[t],3*THREE.triTable[e],3*THREE.triTable[i],o),r+=3,n++;return n},this.posnormtriv=function(t,e,i,n,r,o){var a=3*this.count;this.positionArray[a]=t[i],this.positionArray[a+1]=t[i+1],this.positionArray[a+2]=t[i+2],this.positionArray[a+3]=t[n],this.positionArray[a+4]=t[n+1],this.positionArray[a+5]=t[n+2],this.positionArray[a+6]=t[r],this.positionArray[a+7]=t[r+1],this.positionArray[a+8]=t[r+2],this.normalArray[a]=e[i],this.normalArray[a+1]=e[i+1],this.normalArray[a+2]=e[i+2],this.normalArray[a+3]=e[n],this.normalArray[a+4]=e[n+1],this.normalArray[a+5]=e[n+2],this.normalArray[a+6]=e[r],this.normalArray[a+7]=e[r+1],this.normalArray[a+8]=e[r+2],this.hasNormal=this.hasPos=!0,this.count+=3,this.count>=this.maxCount-3&&o(this)},this.begin=function(){this.count=0,this.hasNormal=this.hasPos=!1},this.end=function(t){if(0!==this.count){for(var e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;t(this)}},this.addBall=function(t,e,i,n,r){var o=this.size*Math.sqrt(n/r),a=i*this.size,s=e*this.size,l=t*this.size,h=Math.floor(a-o);1>h&&(h=1),a=Math.floor(a+o),a>this.size-1&&(a=this.size-1);var c=Math.floor(s-o);1>c&&(c=1),s=Math.floor(s+o),s>this.size-1&&(s=this.size-1);var u=Math.floor(l-o);1>u&&(u=1),o=Math.floor(l+o),o>this.size-1&&(o=this.size-1);for(var f,d,p,m,E,g;a>h;h++)for(l=this.size2*h,d=h/this.size-i,E=d*d,d=c;s>d;d++)for(p=l+this.size*d,f=d/this.size-e,g=f*f,f=u;o>f;f++)m=f/this.size-t,m=n/(1e-6+m*m+g+E)-r,m>0&&(this.field[p+f]+=m)},this.addPlaneX=function(t,e){var i,n,r,o,a,s=this.size,l=this.yd,h=this.zd,c=this.field,u=s*Math.sqrt(t/e);for(u>s&&(u=s),i=0;u>i;i++)if(n=i/s,n*=n,o=t/(1e-4+n)-e,o>0)for(n=0;s>n;n++)for(a=i+n*l,r=0;s>r;r++)c[h*r+a]+=o},this.addPlaneY=function(t,e){var i,n,r,o,a,s,l=this.size,h=this.yd,c=this.zd,u=this.field,f=l*Math.sqrt(t/e);for(f>l&&(f=l),n=0;f>n;n++)if(i=n/l,i*=i,o=t/(1e-4+i)-e,o>0)for(a=n*h,i=0;l>i;i++)for(s=a+i,r=0;l>r;r++)u[c*r+s]+=o},this.addPlaneZ=function(t,e){var i,n,r,o,a,s,l=this.size,h=this.yd,c=this.zd,u=this.field,f=l*Math.sqrt(t/e);for(f>l&&(f=l),r=0;f>r;r++)if(i=r/l,i*=i,o=t/(1e-4+i)-e,o>0)for(a=c*r,n=0;l>n;n++)for(s=a+n*h,i=0;l>i;i++)u[s+i]+=o},this.reset=function(){var t;for(t=0;t<this.size3;t++)this.normal_cache[3*t]=0,this.field[t]=0},this.render=function(t){this.begin();var e,i,n,r,o,a,s,l,h,c=this.size-2;for(r=1;c>r;r++)for(h=this.size2*r,s=(r-this.halfsize)/this.halfsize,n=1;c>n;n++)for(l=h+this.size*n,a=(n-this.halfsize)/this.halfsize,i=1;c>i;i++)o=(i-this.halfsize)/this.halfsize,e=l+i,this.polygonize(o,a,s,e,this.isolation,t);this.end(t)},this.generateGeometry=function(){var t=0,e=new THREE.Geometry,i=[];return this.render(function(n){var r,o,a,s,l,h,c,u;for(r=0;r<n.count;r++)c=3*r,l=c+1,u=c+2,o=n.positionArray[c],a=n.positionArray[l],s=n.positionArray[u],h=new THREE.Vector3(o,a,s),o=n.normalArray[c],a=n.normalArray[l],s=n.normalArray[u],c=new THREE.Vector3(o,a,s),c.normalize(),l=new THREE.Vertex(h),e.vertices.push(l),i.push(c);for(h=n.count/3,r=0;h>r;r++)c=3*(t+r),l=c+1,u=c+2,o=i[c],a=i[l],s=i[u],c=new THREE.Face3(c,l,u,[o,a,s]),e.faces.push(c);t+=h,n.count=0}),e},this.init(t)},THREE.MarchingCubes.prototype=new THREE.Object3D,THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes,THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),THREE.WebGLRenderer&&(THREE.AnaglyphWebGLRenderer=function(t){THREE.WebGLRenderer.call(this,t),this.autoUpdateScene=!1;
var e,i,n,r,o=this,a=this.setSize,s=this.render,l=new THREE.PerspectiveCamera,h=new THREE.PerspectiveCamera,c=new THREE.Matrix4,u=new THREE.Matrix4;l.matrixAutoUpdate=h.matrixAutoUpdate=!1;var t={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},f=new THREE.WebGLRenderTarget(512,512,t),d=new THREE.WebGLRenderTarget(512,512,t),p=new THREE.PerspectiveCamera(53,1,1,1e4);p.position.z=2;var t=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:f},mapRight:{type:"t",value:1,texture:d}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),m=new THREE.Scene;m.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),t)),m.add(p),this.setSize=function(t,e){a.call(o,t,e),f.width=t,f.height=e,d.width=t,d.height=e},this.render=function(t,a){if(t.updateMatrixWorld(),e!==a.aspect||i!==a.near||n!==a.far||r!==a.fov){e=a.aspect,i=a.near,n=a.far,r=a.fov;var E,g=a.projectionMatrix.clone(),v=125/30*.5,y=v*i/125,T=i*Math.tan(r*Math.PI/360);c.n14=v,u.n14=-v,v=-T*e+y,E=T*e+y,g.n11=2*i/(E-v),g.n13=(E+v)/(E-v),l.projectionMatrix.copy(g),v=-T*e-y,E=T*e-y,g.n11=2*i/(E-v),g.n13=(E+v)/(E-v),h.projectionMatrix.copy(g)}l.matrixWorld.copy(a.matrixWorld).multiplySelf(u),l.position.copy(a.position),l.near=a.near,l.far=a.far,s.call(o,t,l,f,!0),h.matrixWorld.copy(a.matrixWorld).multiplySelf(c),h.position.copy(a.position),h.near=a.near,h.far=a.far,s.call(o,t,h,d,!0),m.updateMatrixWorld(),s.call(o,m,p)}}),THREE.WebGLRenderer&&(THREE.CrosseyedWebGLRenderer=function(t){THREE.WebGLRenderer.call(this,t),this.autoClear=!1;var e,i,n=this,r=this.setSize,o=this.render,a=new THREE.PerspectiveCamera;a.target=new THREE.Vector3(0,0,0);var s=new THREE.PerspectiveCamera;s.target=new THREE.Vector3(0,0,0),n.separation=10,t&&void 0!==t.separation&&(n.separation=t.separation),this.setSize=function(t,o){r.call(n,t,o),e=t/2,i=o},this.render=function(t,r){this.clear(),a.fov=r.fov,a.aspect=.5*r.aspect,a.near=r.near,a.far=r.far,a.updateProjectionMatrix(),a.position.copy(r.position),a.target.copy(r.target),a.translateX(n.separation),a.lookAt(a.target),s.projectionMatrix=a.projectionMatrix,s.position.copy(r.position),s.target.copy(r.target),s.translateX(-n.separation),s.lookAt(s.target),this.setViewport(0,0,e,i),o.call(n,t,a),this.setViewport(e,0,e,i),o.call(n,t,s,!1)}});var TWEEN=TWEEN||function(){var t,e,i,n,r=[];return{start:function(t){i=setInterval(this.update,1e3/(t||60))},stop:function(){clearInterval(i)},add:function(t){r.push(t)},getAll:function(){return r},removeAll:function(){r=[]},remove:function(e){t=r.indexOf(e),-1!==t&&r.splice(t,1)},update:function(){for(t=0,e=r.length,n=(new Date).getTime();e>t;)r[t].update(n)?t++:(r.splice(t,1),e--)}}}();/*!
 * Bootstrap v3.3.5 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under the MIT license
 */
if(TWEEN.Tween=function(t){var e={},i={},n={},r=1e3,o=0,a=null,s=TWEEN.Easing.Linear.EaseNone,l=null,h=null,c=null;this.to=function(e,i){null!==i&&(r=i);for(var o in e)null!==t[o]&&(n[o]=e[o]);return this},this.start=function(){TWEEN.add(this),a=(new Date).getTime()+o;for(var r in n)null!==t[r]&&(e[r]=t[r],i[r]=n[r]-t[r]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return o=t,this},this.easing=function(t){return s=t,this},this.chain=function(t){l=t},this.onUpdate=function(t){return h=t,this},this.onComplete=function(t){return c=t,this},this.update=function(n){var o,u;if(a>n)return!0;n=(n-a)/r,n=n>1?1:n,u=s(n);for(o in i)t[o]=e[o]+i[o]*u;return null!==h&&h.call(t,u),1==n?(null!==c&&c.call(t),null!==l&&l.start(),!1):!0}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(t){return t},TWEEN.Easing.Quadratic.EaseIn=function(t){return t*t},TWEEN.Easing.Quadratic.EaseOut=function(t){return-t*(t-2)},TWEEN.Easing.Quadratic.EaseInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(t){return t*t*t},TWEEN.Easing.Cubic.EaseOut=function(t){return--t*t*t+1},TWEEN.Easing.Cubic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},TWEEN.Easing.Quartic.EaseIn=function(t){return t*t*t*t},TWEEN.Easing.Quartic.EaseOut=function(t){return-(--t*t*t*t-1)},TWEEN.Easing.Quartic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},TWEEN.Easing.Quintic.EaseIn=function(t){return t*t*t*t*t},TWEEN.Easing.Quintic.EaseOut=function(t){return(t-=1)*t*t*t*t+1},TWEEN.Easing.Quintic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(t){return-Math.cos(t*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(t){return Math.sin(t*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},TWEEN.Easing.Exponential.EaseIn=function(t){return 0==t?0:Math.pow(2,10*(t-1))},TWEEN.Easing.Exponential.EaseOut=function(t){return 1==t?1:-Math.pow(2,-10*t)+1},TWEEN.Easing.Exponential.EaseInOut=function(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)},TWEEN.Easing.Circular.EaseIn=function(t){return-(Math.sqrt(1-t*t)-1)},TWEEN.Easing.Circular.EaseOut=function(t){return Math.sqrt(1- --t*t)},TWEEN.Easing.Circular.EaseInOut=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},TWEEN.Easing.Elastic.EaseIn=function(t){var e,i=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!i||1>i?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},TWEEN.Easing.Elastic.EaseOut=function(t){var e,i=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!i||1>i?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},TWEEN.Easing.Elastic.EaseInOut=function(t){var e,i=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!i||1>i?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)},TWEEN.Easing.Back.EaseIn=function(t){return t*t*(2.70158*t-1.70158)},TWEEN.Easing.Back.EaseOut=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},TWEEN.Easing.Back.EaseInOut=function(t){return(t*=2)<1?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},TWEEN.Easing.Bounce.EaseIn=function(t){return 1-TWEEN.Easing.Bounce.EaseOut(1-t)},TWEEN.Easing.Bounce.EaseOut=function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},TWEEN.Easing.Bounce.EaseInOut=function(t){return.5>t?.5*TWEEN.Easing.Bounce.EaseIn(2*t):.5*TWEEN.Easing.Bounce.EaseOut(2*t-1)+.5},"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var r=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})}var i='[data-dismiss="alert"]',n=function(e){t(e).on("click",i,this.close)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.prototype.close=function(e){function i(){a.detach().trigger("closed.bs.alert").remove()}var r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var a=t(o);e&&e.preventDefault(),a.length||(a=r.closest(".alert")),a.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(a.removeClass("in"),t.support.transition&&a.hasClass("fade")?a.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var r=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=r,this},t(document).on("click.bs.alert.data-api",i,n.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.button"),o="object"==typeof e&&e;r||n.data("bs.button",r=new i(this,o)),"toggle"==e?r.toggle():e&&r.setState(e)})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.isLoading=!1};i.VERSION="3.3.5",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",n=this.$element,r=n.is("input")?"val":"html",o=n.data();e+="Text",null==o.resetText&&n.data("resetText",n[r]()),setTimeout(t.proxy(function(){n[r](null==o[e]?this.options[e]:o[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var n=t(i.target);n.hasClass("btn")||(n=n.closest(".btn")),e.call(n,"toggle"),t(i.target).is('input[type="radio"]')||t(i.target).is('input[type="checkbox"]')||i.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.carousel"),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e),a="string"==typeof e?e:o.slide;r||n.data("bs.carousel",r=new i(this,o)),"number"==typeof e?r.to(e):a?r[a]():o.interval&&r.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),n="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(n&&!this.options.wrap)return e;var r="prev"==t?-1:1,o=(i+r)%this.$items.length;return this.$items.eq(o)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){return this.sliding?void 0:this.slide("next")},i.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},i.prototype.slide=function(e,n){var r=this.$element.find(".item.active"),o=n||this.getItemForDirection(e,r),a=this.interval,s="next"==e?"left":"right",l=this;if(o.hasClass("active"))return this.sliding=!1;var h=o[0],c=t.Event("slide.bs.carousel",{relatedTarget:h,direction:s});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,a&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(o)]);u&&u.addClass("active")}var f=t.Event("slid.bs.carousel",{relatedTarget:h,direction:s});return t.support.transition&&this.$element.hasClass("slide")?(o.addClass(e),o[0].offsetWidth,r.addClass(s),o.addClass(s),r.one("bsTransitionEnd",function(){o.removeClass([e,s].join(" ")).addClass("active"),r.removeClass(["active",s].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(f)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(f)),a&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var r=function(i){var n,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""));if(o.hasClass("carousel")){var a=t.extend({},o.data(),r.data()),s=r.attr("data-slide-to");s&&(a.interval=!1),e.call(o,a),s&&o.data("bs.carousel").to(s),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(n)}function i(e){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),o=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);!r&&o.toggle&&/show|hide/.test(e)&&(o.toggle=!1),r||i.data("bs.collapse",r=new n(this,o)),"string"==typeof e&&r[e]()})}var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.3.5",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(e=r.data("bs.collapse"),e&&e.transitioning))){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){r&&r.length&&(i.call(r,"hide"),e||r.data("bs.collapse",null));var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return s.call(this);var l=t.camelCase(["scroll",a].join("-"));this.$element.one("bsTransitionEnd",t.proxy(s,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[a](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(n.TRANSITION_DURATION):r.call(this)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,n){var r=t(n);this.addAriaAndCollapsedClass(e(r),r)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var r=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=r,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var r=t(this);r.attr("data-target")||n.preventDefault();var o=e(r),a=o.data("bs.collapse"),s=a?"toggle":r.data();i.call(o,s)})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(r).remove(),t(o).each(function(){var n=t(this),r=e(n),o={relatedTarget:this};r.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(r[0],i.target)||(r.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),r.removeClass("open").trigger("hidden.bs.dropdown",o))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new a(this)),"string"==typeof e&&n[e].call(i)})}var r=".dropdown-backdrop",o='[data-toggle="dropdown"]',a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.5",a.prototype.toggle=function(n){var r=t(this);if(!r.is(".disabled, :disabled")){var o=e(r),a=o.hasClass("open");if(i(),!a){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var s={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",s)),n.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger("shown.bs.dropdown",s)}return!1}},a.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var r=e(n),a=r.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&r.find(o).trigger("focus"),n.trigger("click");var s=" li:not(.disabled):visible a",l=r.find(".dropdown-menu"+s);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var s=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=s,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,a.prototype.toggle).on("keydown.bs.dropdown.data-api",o,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,n){return this.each(function(){var r=t(this),o=r.data("bs.modal"),a=t.extend({},i.DEFAULTS,r.data(),"object"==typeof e&&e);o||r.data("bs.modal",o=new i(this,a)),"string"==typeof e?o[e](n):a.show&&o.show(n)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var n=this,r=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),r&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});r?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(o)}).emulateTransitionEnd(i.TRANSITION_DURATION):n.$element.trigger("focus").trigger(o)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=t.support.transition&&r;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;o?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var a=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",a).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):a()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var n=t(this),r=n.attr("href"),o=t(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),a=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(r)&&r},o.data(),n.data());n.is("a")&&i.preventDefault(),o.one("show.bs.modal",function(t){t.isDefaultPrevented()||o.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(o,a,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tooltip"),o="object"==typeof e&&e;(r||!/destroy|hide/.test(e))&&(r||n.data("bs.tooltip",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),o=r.length;o--;){var a=r[o];if("click"==a)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=a){var s="hover"==a?"mouseenter":"focusin",l="hover"==a?"mouseleave":"focusout";this.$element.on(s+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),i.isInStateTrue()?void 0:(clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide())},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var n=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!n)return;var r=this,o=this.tip(),a=this.getUID(this.type);this.setContent(),o.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&o.addClass("fade");var s="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(s);h&&(s=s.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(s).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),u=o[0].offsetWidth,f=o[0].offsetHeight;if(h){var d=s,p=this.getPosition(this.$viewport);s="bottom"==s&&c.bottom+f>p.bottom?"top":"top"==s&&c.top-f<p.top?"bottom":"right"==s&&c.right+u>p.width?"left":"left"==s&&c.left-u<p.left?"right":s,o.removeClass(d).addClass(s)}var m=this.getCalculatedOffset(s,c,u,f);this.applyPlacement(m,s);var E=function(){var t=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==t&&r.leave(r)};t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",E).emulateTransitionEnd(i.TRANSITION_DURATION):E()}},i.prototype.applyPlacement=function(e,i){var n=this.tip(),r=n[0].offsetWidth,o=n[0].offsetHeight,a=parseInt(n.css("margin-top"),10),s=parseInt(n.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(s)&&(s=0),e.top+=a,e.left+=s,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,h=n[0].offsetHeight;"top"==i&&h!=o&&(e.top=e.top+o-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var u=/top|bottom/.test(i),f=u?2*c.left-r+l:2*c.top-o+h,d=u?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(f,n[0][d],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function n(){"in"!=r.hoverState&&o.detach(),r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),e&&e()}var r=this,o=t(this.$tip),a=t.Event("hide.bs."+this.type);return this.$element.trigger(a),a.isDefaultPrevented()?void 0:(o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n(),this.hoverState=null,this)},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],n="BODY"==i.tagName,r=i.getBoundingClientRect();null==r.width&&(r=t.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var o=n?{top:0,left:0}:e.offset(),a={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},s=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},r,a,s,o)},i.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,n){var r={top:0,left:0};if(!this.$viewport)return r;var o=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var s=e.top-o-a.scroll,l=e.top+o-a.scroll+n;s<a.top?r.top=a.top-s:l>a.top+a.height&&(r.top=a.top+a.height-l)}else{var h=e.left-o,c=e.left+o+i;h<a.left?r.left=a.left-h:c>a.right&&(r.left=a.left+a.width-c)}return r},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null})};var n=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.popover"),o="object"==typeof e&&e;(r||!/destroy|hide/.test(e))&&(r||n.data("bs.popover",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.5",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS
},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),+function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var n=t(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new e(this,o)),"string"==typeof i&&r[i]()})}e.VERSION="3.3.5",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),r=e.data("target")||e.attr("href"),o=/^#./.test(r)&&t(r);return o&&o.length&&o.is(":visible")&&[[o[i]().top+n,r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),r=this.offsets,o=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return a!=(t=o[o.length-1])&&this.activate(t);if(a&&e<r[0])return this.activeTarget=null,this.clear();for(t=r.length;t--;)a!=o[t]&&e>=r[t]&&(void 0===r[t+1]||e<r[t+1])&&this.activate(o[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new i(this)),"string"==typeof e&&r[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),a=t.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(o),e.trigger(a),!a.isDefaultPrevented()&&!o.isDefaultPrevented()){var s=t(n);this.activate(e.closest("li"),i),this.activate(s,s.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},i.prototype.activate=function(e,n,r){function o(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var a=n.find("> .active"),s=r&&t.support.transition&&(a.length&&a.hasClass("fade")||!!n.find("> .fade").length);a.length&&s?a.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),a.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var r=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.affix"),o="object"==typeof e&&e;r||n.data("bs.affix",r=new i(this,o)),"string"==typeof e&&r[e]()})}var i=function(e,n){this.options=t.extend({},i.DEFAULTS,n),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.5",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,n){var r=this.$target.scrollTop(),o=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return i>r?"top":!1;if("bottom"==this.affixed)return null!=i?r+this.unpin<=o.top?!1:"bottom":t-n>=r+a?!1:"bottom";var s=null==this.affixed,l=s?r:o.top,h=s?a:e;return null!=i&&i>=r?"top":null!=n&&l+h>=t-n?"bottom":!1},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,r=n.top,o=n.bottom,a=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(o=r=n),"function"==typeof r&&(r=n.top(this.$element)),"function"==typeof o&&(o=n.bottom(this.$element));var s=this.getState(a,e,r,o);if(this.affixed!=s){null!=this.unpin&&this.$element.css("top","");var l="affix"+(s?"-"+s:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=s,this.unpin="bottom"==s?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==s&&this.$element.offset({top:a-e-o})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),n=i.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(i,n)})})}(jQuery),function(t,e){var i=Object.prototype.hasOwnProperty,n=function(t,e){t=t||{};for(var n in e)i.call(e,n)&&(t[n]=e[n]);return t},r=function(t,e){var i=function(){},r=e.constructor;return i.prototype=t.prototype,r.prototype=new i,r.prototype.constructor=r,r.prototype=n(r.prototype,e),r.prototype.__super__=t.prototype,r},o=Math.round,a=Math.abs,s=Math.random,l=function(t,e){var i=1e-10;return a(t.x-e.x)<=i&&a(t.y-e.y)<=i&&a(t.z-e.z)<=i?!0:!1},h=function(t,e){return o(s()*(e-t)+t)},c=function(t){var e,i,n,r="";for(e=t.substr?t:t.toString(16),n=e.length,i=0;6-n>i;i++)r+="0";return"#"+r+e},u=function(t,e,i,n,r){return"<div style='position:absolute;background-color:"+c(t)+";width:"+e+"px;height:"+i+"px;top:"+n+"px;left:"+r+"px;'></div>"},f=r(THREE.Object3D,{constructor:function(t,i,n,r){THREE.Object3D.call(this),this.rubik=null,this.rotation_in_progress=!1,this.RA=.5*Math.PI,this.undolist=[],this.undo_in_action=!1,this.undolist_length=200,this.onChange=null,this.sides={bottom:3,top:2,right:0,left:1,front:4,back:5};var o=200,a=3,s=.3,l={inside:2894892,top:16777215,bottom:16766208,left:40544,right:20922,front:12852794,back:16734208};e!==i&&i>0&&(o=i),e!==t&&t>0&&(a=parseInt(t)),e!==n&&n>0&&(s=n),r&&(l=r);var h,c,u,f,d,p,m,E=[],g=a,v=a,y=a,T=o,b=o,R=o,x=T/2,w=b/2,H=R/2,_=T/(v+(v-1)*s),S=b/(y+(y-1)*s),M=R/(g+(g-1)*s),C=_/2,A=S/2,k=M/2;for(u=0;g>u;u++)for(h=0;v>h;h++)for(c=0;y>c;c++){for(f=[],d=0;6>d;d++)p=new THREE.MeshBasicMaterial({color:l.inside}),p.name="inside",f.push(p);0==c?(f[this.sides.bottom].color.setHex(l.bottom),f[this.sides.bottom].name="bottom"):y-1==c&&(f[this.sides.top].color.setHex(l.top),f[this.sides.top].name="top"),v-1==h?(f[this.sides.right].color.setHex(l.right),f[this.sides.right].name="right"):0==h&&(f[this.sides.left].color.setHex(l.left),f[this.sides.left].name="left"),g-1==u?(f[this.sides.front].color.setHex(l.front),f[this.sides.front].name="front"):0==u&&(f[this.sides.back].color.setHex(l.back),f[this.sides.back].name="back"),m=new THREE.Mesh(new THREE.CubeGeometry(_,S,M,1,1,1,f),new THREE.MeshFaceMaterial),m.position.x=(_+s*_)*h-x+C,m.position.y=(S+s*S)*c-w+A,m.position.z=(M+s*M)*u-H+k,m.overdraw=!0,m.extra_data={xx:h,yy:c,zz:u},E.push(m),this.add(m)}this.rubik={N:a,colors:{front:l.front,back:l.back,top:l.top,bottom:l.bottom,left:l.left,right:l.right,inside:l.inside},cubelets:E,side:T,cubeletside:_,dsp:s}},rubik:null,rotation_in_progress:!1,RA:0,undolist:null,undo_in_action:!1,undolist_length:200,onChange:null,sides:null,addHistory:function(t){if(!this.undo_in_action){for(;this.undolist.length>=this.undolist_length;)this.undolist.shift();this.undolist.push(t)}return this},getCubeStateAsString:function(){var t,e=this,i=[];return t=e.getFaceColorAndIndex("front",0,0).color_code+e.getFaceColorAndIndex("left",0,0).color_code+e.getFaceColorAndIndex("top",1,0).color_code,i[0]=t,i[1]=t[1]+t[2]+t[0],i[2]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("front",0,1).color_code+e.getFaceColorAndIndex("top",1,1).color_code+e.getFaceColorAndIndex("right",0,1).color_code,i[3]=t,i[4]=t[1]+t[2]+t[0],i[5]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("front",1,0).color_code+e.getFaceColorAndIndex("bottom",0,0).color_code+e.getFaceColorAndIndex("left",1,0).color_code,i[6]=t,i[7]=t[1]+t[2]+t[0],i[8]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("front",1,1).color_code+e.getFaceColorAndIndex("right",1,1).color_code+e.getFaceColorAndIndex("bottom",0,1).color_code,i[9]=t,i[10]=t[1]+t[2]+t[0],i[11]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("back",0,1).color_code+e.getFaceColorAndIndex("top",0,0).color_code+e.getFaceColorAndIndex("left",0,1).color_code,i[12]=t,i[13]=t[1]+t[2]+t[0],i[14]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("back",0,0).color_code+e.getFaceColorAndIndex("right",0,0).color_code+e.getFaceColorAndIndex("top",0,1).color_code,i[15]=t,i[16]=t[1]+t[2]+t[0],i[17]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("back",1,1).color_code+e.getFaceColorAndIndex("left",1,1).color_code+e.getFaceColorAndIndex("bottom",1,0).color_code,i[18]=t,i[19]=t[1]+t[2]+t[0],i[20]=t[2]+t[0]+t[1],t=e.getFaceColorAndIndex("back",1,0).color_code+e.getFaceColorAndIndex("bottom",1,1).color_code+e.getFaceColorAndIndex("right",1,0).color_code,i[21]=t,i[22]=t[1]+t[2]+t[0],i[23]=t[2]+t[0]+t[1],i.toString()},undo:function(){var t=null;return!this.rotation_in_progress&&this.undolist.length>0?(this.undo_in_action=!0,t=this.undolist.pop(),t.param?t.func.call(this,t.param):t.func.call(this),this.undo_in_action=!1,t.actiontype):""},setRotation:function(t){if(!this.rubik||this.rotation_in_progress)return this;var e,i,n=t.axis,r=t.angle,o=t.row;if(0==r)return this;if(e=this.getCubeletsIndex(n,o),null==e)return this;i=r*this.RA,n=n.charAt(0),n=n.toLowerCase();var a=new THREE.Matrix4;switch(n){case"x":a.setRotationX(i);break;case"y":a.setRotationY(i);break;case"z":a.setRotationZ(i);break;default:return}for(var s=0;s<e.length;s++){var l=this.rubik.cubelets[e[s]];l.matrixAutoUpdate=!1,l.matrix.multiply(a,l.matrix)}return t.angle=-r,t.duration=2,this.addHistory({func:this.rotate,param:t,actiontype:"setRotation"}),this.onChange&&this.onChange.call(this),this},scramble:function(t){if(this.rotation_in_progress)return this;var e,i,n,r=["x","y","z"],o=[-2,-1,1,2],a=this.rubik.N,s=0;for(("undefined"==typeof t||0>=t)&&(t=h(5,20)),s=0;t>s;s++)e=r[h(0,2)],i=h(0,a-1),n=o[h(0,3)],this.setRotation({axis:e,row:i,angle:n});return this},rotate:function(t){if(!this.rubik)return this;if(this.rotation_in_progress)return this;var e,i,n=5,r=t.axis,o=t.row;if(null!=t.duration&&(n=t.duration),e=t.angle,0>=n)return this;if(0==e)return this;if(i=this.getCubeletsIndex(r,o),null==i)return this;r=r.charAt(0),r=r.toLowerCase();var a,s,l,h=this.rubik.N*this.rubik.N,c=0,u=function(){c++,c>=h&&(this.thiss.rotation_in_progress=!1,c=0,this.params.onComplete&&this.params.onComplete.call(this.thiss),this.thiss.onChange&&this.thiss.onChange.call(this.thiss))},f=function(){var t=new THREE.Matrix4;switch(this.axis){case"x":t.setRotationX(this.angle-this.prevangle);break;case"y":t.setRotationY(this.angle-this.prevangle);break;case"z":t.setRotationZ(this.angle-this.prevangle);break;default:return}this.cubelet.matrixAutoUpdate=!1,this.cubelet.matrix.multiply(t,this.cubelet.matrix),this.cubelet.position=this.cubelet.matrix.getPosition(),this.cubelet.matrixWorldNeedsUpdate=!0,this.prevangle=this.angle};this.rotation_in_progress=!0,s=Math.abs(e)*n*200,l=e*this.RA;for(var d=0;d<i.length;d++)a={cubelet:this.rubik.cubelets[i[d]],axis:r,angle:0,prevangle:0,thiss:this,params:t},new TWEEN.Tween(a).onUpdate(f).onComplete(u).to({angle:l},s).easing(TWEEN.Easing.Exponential.EaseInOut).start();return t.angle=-e,this.addHistory({func:this.rotate,param:t,actiontype:"rotate"}),this},getCubeletSeenCoords:function(t){if(!this.rubik||this.rotation_in_progress)return null;var e;e=t instanceof THREE.Mesh?t:this.rubik.cubelets[t],e.matrixAutoUpdate=!1,e.updateMatrixWorld(!0),e.position=e.matrix.getPosition();var i={xx:o((e.position.x+this.rubik.side/2-this.rubik.cubeletside/2)/(this.rubik.cubeletside*(1+this.rubik.dsp))),yy:o((e.position.y+this.rubik.side/2-this.rubik.cubeletside/2)/(this.rubik.cubeletside*(1+this.rubik.dsp))),zz:o((e.position.z+this.rubik.side/2-this.rubik.cubeletside/2)/(this.rubik.cubeletside*(1+this.rubik.dsp)))};return i},getCubeletsIndex:function(t,e){if(!this.rubik)return[];if(this.rotation_in_progress)return[];var i,n=[],r=[],o=this.rubik.cubelets.length;if(0>e||e>=this.rubik.N)return[];for(t=t.charAt(0).toLowerCase(),i=0;o>i;i++)switch(this.rubik.cubelets[i].matrixAutoUpdate=!1,this.rubik.cubelets[i].updateMatrixWorld(!0),this.rubik.cubelets[i].position=this.rubik.cubelets[i].matrix.getPosition(),t){case"y":n[i]=[i,this.rubik.cubelets[i].position.y];break;case"x":n[i]=[i,this.rubik.cubelets[i].position.x];break;case"z":n[i]=[i,this.rubik.cubelets[i].position.z];break;default:return null}var a=function(t,e){return t[1]-e[1]};for(n.sort(a),i=0;i<this.rubik.N*this.rubik.N;i++)r[i]=n[e*this.rubik.N*this.rubik.N+i][0];return r},getFacesAsSeen:function(t){if(null==this.rubik||this.rotation_in_progress)return null;var e,i,n;e=t instanceof THREE.Mesh?t:this.rubik.cubelets[t];var r=[];e.matrixAutoUpdate=!1,e.updateMatrixWorld(!0),e.position=e.matrix.getPosition(),e.geometry.computeFaceNormals(),i=e.geometry.faces.length;var o=e.matrix.clone();for(o.setPosition(new THREE.Vector3(0,0,0)),n=0;i>n;n++)r.push(o.multiplyVector3(e.geometry.faces[n].normal.clone()).normalize());var a=e.geometry.materials,s=null,h="",c=[],u=[],f=[],d=[],p=new THREE.Vector3(0,1,0),m=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,0,1),g=new THREE.Vector3(0,0,-1),v=new THREE.Vector3(-1,0,0),y=new THREE.Vector3(1,0,0);for(n=0;n<r.length;n++)s=a[n],h=s.name,"inside"==h.toLowerCase()?(c.inside=s.color,u[h]="inside",f.inside=h,d.inside=s):(l(r[n],p)&&(c.top=s.color,u[h]="top",f.top=h,d.top=s),l(r[n],m)&&(c.bottom=s.color,u[h]="bottom",f.bottom=h,d.bottom=s),l(r[n],E)&&(c.front=s.color,u[h]="front",f.front=h,d.front=s),l(r[n],g)&&(c.back=s.color,u[h]="back",f.back=h,d.back=s),l(r[n],v)&&(c.left=s.color,u[h]="left",f.left=h,d.left=s),l(r[n],y)&&(c.right=s.color,u[h]="right",f.right=h,d.right=s));return{seencolor:c,faceseenas:u,invfaceseenas:f,mat:d}},getFacesByName:function(t,e){if(!this.rubik)return[];var i;i=t instanceof THREE.Mesh?t:this.rubik.cubelets[t];for(var n=[],r=i.geometry.materials,o=null,a=0;a<r.length;a++)o=r[a],o.name==e&&n.push(o);return n},getFacesByColor:function(t,e){if(!this.rubik)return[];var i;i=t instanceof THREE.Mesh?t:this.rubik.cubelets[t];for(var n=[],r=i.geometry.materials,o=null,a=0;a<r.length;a++)o=r[a],o.color.getHex()==e&&n.push(o);return n},setRubikColors:function(t){if(this.rubik&&!this.rotation_in_progress){var e,i,n,r,o=t.colors,a=null,s={front:this.rubik.colors.front,back:this.rubik.colors.back,top:this.rubik.colors.top,bottom:this.rubik.colors.bottom,left:this.rubik.colors.left,right:this.rubik.colors.right,inside:this.rubik.colors.inside},l={front:this.rubik.colors.front,back:this.rubik.colors.back,top:this.rubik.colors.top,bottom:this.rubik.colors.bottom,left:this.rubik.colors.left,right:this.rubik.colors.right,inside:this.rubik.colors.inside},h=!0;for(n in o)l[n]=o[n];for(n in l)for(r in l)if(l[n]==l[r]&&n!=r)return h=!1,!1;if(null!=o){for(e=0;e<this.rubik.cubelets.length;e++){if(null!=o.top){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.top),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.top);this.rubik.colors.top=o.top}if(null!=o.bottom){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.bottom),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.bottom);this.rubik.colors.bottom=o.bottom}if(null!=o.left){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.left),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.left);this.rubik.colors.left=o.left}if(null!=o.right){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.right),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.right);this.rubik.colors.right=o.right}if(null!=o.front){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.front),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.front);this.rubik.colors.front=o.front}if(null!=o.back){for(a=this.getFacesByColor(this.rubik.cubelets[e],s.back),i=0;i<a.length;i++)"inside"!=a[i].name&&a[i].color.setHex(o.back);this.rubik.colors.back=o.back}if(null!=o.inside){for(a=this.getFacesByName(this.rubik.cubelets[e],"inside"),i=0;i<a.length;i++)a[i].color.setHex(o.inside);this.rubik.colors.inside=o.inside}}return t.colors=s,this.addHistory({func:this.setRubikColors,param:t,actiontype:"setRubikColors"}),this.onChange&&this.onChange.call(this),!0}}},getFaceColorAndIndex:function(t,e,i){if(null==this.rubik||this.rotation_in_progress)return null;var n,r,o,a=this.rubik.cubelets,s={"#2c2c2c":"b","#ffffff":"w","#ffd500":"y","#009e60":"g","#0051ba":"b","#c41e3a":"r","#ff5800":"o"};for(n=0;n<a.length;n++)if(r=this.getFacesAsSeen(a[n]),o=this.getCubeletSeenCoords(a[n]),null!=r.seencolor[t]&&void 0!=r.seencolor[t])switch(t){case"top":if(o.xx==i&&o.zz==e)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]};break;case"bottom":if(o.xx==i&&o.zz==this.rubik.N-1-e)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]};break;case"left":if(o.yy==this.rubik.N-1-e&&o.zz==this.rubik.N-1-i)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]};break;case"right":if(o.yy==this.rubik.N-1-e&&o.zz==i)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]};break;case"front":if(o.xx==i&&o.yy==this.rubik.N-1-e)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]};break;case"back":if(o.xx==this.rubik.N-1-i&&o.yy==this.rubik.N-1-e)return{color:r.seencolor[t],color_code:s[c(r.seencolor[t].getHex())]}}return null},getFlatImage:function(t){if(null!=this.rubik&&!this.rotation_in_progress){var e,i,n,r,o="",a=this.rubik.N,s=5,l=5,h=3,c=5,f={top:[],bottom:[],front:[],back:[],left:[],right:[]};for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("top",i,a-1-e),f.top[i+e*a]=obj.color.getHex();for(n=a*(s+h)+c,r=0,e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.top[e+(a-1-i)*a],s,l,r+e*(l+h),n+i*(s+h));for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("left",i,a-1-e),f.left[i+e*a]=obj.color.getHex();for(n=0,r=a*(l+h)+c,e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.left[e+i*a],s,l,r+e*(l+h),n+i*(s+h));for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("front",i,a-1-e),f.front[i+e*a]=obj.color.getHex();for(n=a*(s+h)+c,r=a*(l+h)+c,e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.front[e+(a-1-i)*a],s,l,r+e*(l+h),n+i*(s+h));for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("right",i,a-1-e),f.right[i+e*a]=obj.color.getHex();for(n=2*(a*(s+h)+c),r=a*(l+h)+c,e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.right[e+i*a],s,l,r+e*(l+h),n+i*(s+h));for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("back",i,a-1-e),f.back[i+e*a]=obj.color.getHex();for(n=3*(a*(s+h)+c),r=a*(l+h)+c,e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.back[e+(a-1-i)*a],s,l,r+e*(l+h),n+i*(s+h));for(e=0;a>e;e++)for(i=0;a>i;i++)obj=this.getFaceColorAndIndex("bottom",i,a-1-e),f.bottom[i+e*a]=obj.color.getHex();for(n=a*(s+h)+c,r=2*(a*(l+h)+c),e=0;a>e;e++)for(i=0;a>i;i++)o+=u(f.bottom[e+(a-1-i)*a],s,l,r+e*(l+h),n+i*(s+h));return t.style.width=4*((s+h)*a+c)+10+"px",t.style.height=3*((l+h)*a+c)+10+"px",t.innerHTML=o,f}}});t.Rubik=f}(window),function(t,e){function i(){x.getFlatImage(g)}function n(t){t.preventDefault(),p.addEventListener("mousemove",r,!1),p.addEventListener("mouseup",o,!1),p.addEventListener("mouseout",a,!1),F=t.clientX/M*2-1,A=F,D=t.clientY/C*2-1,L=D,k=A,N=L}function r(t){t.clientX>M||t.clientX<0||t.clientY>C||t.clientY<0||(F=t.clientX/M*2-1,A=F,D=t.clientY/C*2-1,L=D)}function o(){p.removeEventListener("mousemove",r,!1),p.removeEventListener("mouseup",o,!1),p.removeEventListener("mouseout",a,!1)}function a(){p.removeEventListener("mousemove",r,!1),p.removeEventListener("mouseup",o,!1),p.removeEventListener("mouseout",a,!1)}function s(){requestAnimationFrame(s),y.position.x=P*Math.sin(A*I)*Math.cos(L*V),y.position.y=P*Math.sin(L*V),y.position.z=P*Math.cos(A*I)*Math.cos(L*V),y.lookAt(T.position),TWEEN.update(),b.render(T,y)}function l(t){var e={front_clockwise:{axis:"z",row:1,angle:-1,duration:1},front_counterclockwise:{axis:"z",row:1,angle:1,duration:1},left_clockwise:{axis:"x",row:0,angle:1,duration:1},left_counterclockwise:{axis:"x",row:0,angle:-1,duration:1},up_clockwise:{axis:"y",row:1,angle:-1,duration:1},up_counterclockwise:{axis:"y",row:1,angle:1,duration:1},back_clockwise:{axis:"z",row:0,angle:1,duration:1},back_counterclockwise:{axis:"z",row:0,angle:-1,duration:1},bottom_clockwise:{axis:"y",row:0,angle:1,duration:1},bottom_counterclockwise:{axis:"y",row:0,angle:-1,duration:1},right_clockwise:{axis:"x",row:1,angle:1,duration:1},right_counterclockwise:{axis:"x",row:1,angle:-1,duration:1}};return e[t]}function h(t){var e=t.keyCode,i={113:function(){x.rotate(l("front_clockwise"))},119:function(){x.rotate(l("front_counterclockwise"))},97:function(){x.rotate(l("left_clockwise"))},115:function(){x.rotate(l("left_counterclockwise"))},100:function(){x.rotate(l("right_clockwise"))},102:function(){x.rotate(l("right_counterclockwise"))},122:function(){x.rotate(l("up_clockwise"))},120:function(){x.rotate(l("up_counterclockwise"))},99:function(){x.rotate(l("bottom_clockwise"))},118:function(){x.rotate(l("bottom_counterclockwise"))},101:function(){x.rotate(l("back_clockwise"))},114:function(){x.rotate(l("back_counterclockwise"))}};i[e]()}function c(){var t=x.getCubeStateAsString();e("#loading_div").fadeIn(),e.post("/"+t,function(t){u(t,function(){e("#loading_div").fadeOut("slow"),e("#results span").text(t.length),e("#results").fadeIn("slow")})})}function u(t,e){moveCount=-1,function i(){moveCount++,moveCount<t.length?(f(t[moveCount]),setTimeout(i,1e3)):e()}()}function f(t){x.rotate(l(t))}t.requestAnimationFrame||(t.requestAnimationFrame=function(){return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}());var d,p,m,E,g,v,y,T,b,R,x,w,H,_,S,M=800,C=800,A=-.25,k=0,L=.25,N=0,P=500,F=0,D=0,z=(t.innerWidth/2,t.innerHeight/2,{inside:2894892,top:16777215,bottom:16766208,left:40544,right:20922,front:12852794,back:16734208}),V=.5*Math.PI,I=-Math.PI,B={init:function(){d=document.getElementById("container"),p=document.getElementById("container"),E=document.getElementById("newrubik"),m=document.getElementById("scramble"),g=document.getElementById("flatimage"),v=2,w=t.innerWidth,H=t.innerHeight,_=w/2,S=H/2,d.style.width=w+"px",d.style.height=H+"px",d.style.marginTop=.5*(t.innerHeight-H)+"px",T=new THREE.Scene,y=new THREE.PerspectiveCamera(50,w/H,1,1e3),y.position.z=P,T.add(y),R=new THREE.Projector,x=new Rubik(v,200,.3,z),T.add(x),x.onChange=i,b=new THREE.CanvasRenderer,b.setSize(w,H),d.appendChild(b.domElement),e(document).keypress(function(t){h(t)}),e("#solve").on("click",c),p.addEventListener("mousedown",n,!1),E.addEventListener("click",function(){T.remove(x),x=new Rubik(v,200,.3,z),T.add(x),x.onChange=i,b.render(T,y),i()},!1),m.addEventListener("click",function(){e("#results").fadeOut(),x.scramble(10),i()},!1),b.render(T,y),i(),s()},animate:s};t.RubikApplication=B}(window,jQuery);